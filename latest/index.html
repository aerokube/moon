<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.20">
<meta name="description" content="A Selenium, Cypress, Playwright and Puppeteer testing platform running in Kubernetes or Openshift clusters. Fully compatible with Selenium Webdriver protocol. Live and automated testing are supported. Runs on your own hardware or in any popular cloud platform: Google Cloud, Amazon Web Services, DigitalOcean, Microsoft Azure and so on.">
<meta name="author" content="Aerokube Software OÃœ">
<link rel="icon" type="image/png" href="img/favicon.png">
<title>Moon - A cross browser Selenium, Cypress, Playwright and Puppeteer solution for Kubernetes or Openshift cluster</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.square{list-style-type:square}
ul.circle ul:not([class]),ul.disc ul:not([class]),ul.square ul:not([class]){list-style:inherit}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:first-child,.sidebarblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child,.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,td.hdlist1,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
/*! Stylesheet for CodeRay to loosely match GitHub themes | MIT License */
pre.CodeRay{background:#f7f7f8}
.CodeRay .line-numbers{border-right:1px solid;opacity:.35;padding:0 .5em 0 0;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
.CodeRay span.line-numbers{display:inline-block;margin-right:.75em}
.CodeRay .line-numbers strong{color:#000}
table.CodeRay{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.CodeRay td{vertical-align:top;line-height:inherit}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.code{padding:0 0 0 .75em}
.CodeRay .debug{color:#fff!important;background:navy!important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:navy}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:teal}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:teal}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:teal}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword{color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:teal}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
<base href="https://aerokube.com/moon/latest/">
<meta property="og:image:height" content="1106">
<meta property="og:image:width" content="2113">
<meta property="og:title" content="Aerokube Moon | A cross browser Selenium solution for Kubernetes or Openshift cluster">
<meta property="og:description" content="Live and automated cross browser Selenium testing in Kubernetes or Openshift cluster">
<meta property="og:url" content="https://aerokube.com/moon/latest">
<meta property="og:image" content="https://aerokube.com/moon/latest/img/og-image.jpg">
<meta name="twitter:site" content="@aerokube">
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>Moon</h1>
<div class="details">
<span id="author" class="author">Aerokube Software OÃœ</span><br>
<span id="revnumber">version latest,</span>
<span id="revdate">2023-10-25</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#getting-started">1. Getting Started</a>
<ul class="sectlevel2">
<li><a href="#install">1.1. Quick Start Guide</a>
<ul class="sectlevel3">
<li><a href="#install-kubernetes">1.1.1. Installing to Kubernetes</a></li>
<li><a href="#install-openshift">1.1.2. Installing to Openshift</a></li>
</ul>
</li>
<li><a href="#architecture">1.2. Architecture</a>
<ul class="sectlevel3">
<li><a href="#moon-components">1.2.1. Moon Components</a></li>
<li><a href="#moon-operation-modes">1.2.2. Moon Operation Modes</a></li>
<li><a href="#moon-pod-contents">1.2.3. Browser Pod Contents</a></li>
</ul>
</li>
<li><a href="#recommended-cluster-settings">1.3. Recommended Cluster Settings</a></li>
<li><a href="#permissions">1.4. Required Permissions</a>
<ul class="sectlevel3">
<li><a href="#permissions-single-namespace">1.4.1. Single Namespace Mode</a></li>
<li><a href="#permissions-multiple-namespaces">1.4.2. Multiple Namespaces Mode</a></li>
</ul>
</li>
<li><a href="#moon2-vs-moon1">1.5. Difference between Moon 2.x and Moon 1.x</a></li>
<li><a href="#advantages">1.6. Moon vs other solutions</a></li>
</ul>
</li>
<li><a href="#main-features">2. Main Features</a>
<ul class="sectlevel2">
<li><a href="#user-interface">2.1. User Interface</a></li>
<li><a href="#selenium">2.2. Using Selenium</a>
<ul class="sectlevel3">
<li><a href="#selenium-moon-capabilities">2.2.1. Moon-specific Capabilities</a></li>
<li><a href="#selenium-headless">2.2.2. Headless Mode</a></li>
<li><a href="#selenium-video-recording">2.2.3. Video Recording</a></li>
<li><a href="#mobile-emulation">2.2.4. Mobile Emulation</a></li>
<li><a href="#clipboard">2.2.5. Accessing Clipboard</a></li>
<li><a href="#uploading-files">2.2.6. Uploading Files to Browser</a></li>
<li><a href="#selenium-context">2.2.7. Providing Additional Browser Data</a></li>
<li><a href="#accessing-downloaded-files">2.2.8. Accessing Files Downloaded with Browser</a></li>
<li><a href="#selenium-devtools">2.2.9. Accessing Developer Tools</a></li>
<li><a href="#selenium-locale">2.2.10. Changing Browser Locale</a></li>
<li><a href="#selenium-time-zone">2.2.11. Changing Browser Time Zone</a></li>
<li><a href="#selenium-external-host">2.2.12. Using External Hosts</a></li>
<li><a href="#selenium-proxy">2.2.13. Using Proxy Servers</a></li>
</ul>
</li>
<li><a href="#cypress">2.3. Using Cypress</a>
<ul class="sectlevel3">
<li><a href="#cypress-select-browser">2.3.1. Selecting Requested Browser</a></li>
<li><a href="#cypress-select-cypress-version">2.3.2. Selecting Exact Cypress Version</a></li>
<li><a href="#cypress-video-recording">2.3.3. Video Recording</a></li>
<li><a href="#cypress-additional-features">2.3.4. Enabling Additional Features</a></li>
<li><a href="#cypress-dashboard">2.3.5. Recording Runs to Cypress Dashboard</a></li>
</ul>
</li>
<li><a href="#playwright">2.4. Using Playwright</a>
<ul class="sectlevel3">
<li><a href="#playwright-select-browser">2.4.1. Selecting Requested Browser</a></li>
<li><a href="#playwright-video-recording">2.4.2. Video Recording</a></li>
<li><a href="#playwright-context">2.4.3. Additional Browser Data</a></li>
<li><a href="#playwright-additional-features">2.4.4. Enabling Additional Features</a></li>
</ul>
</li>
<li><a href="#devtools">2.5. Using Chrome Developer Tools</a>
<ul class="sectlevel3">
<li><a href="#devtools-select-browser">2.5.1. Selecting Requested Browser</a></li>
<li><a href="#devtools-video-recording">2.5.2. Video Recording</a></li>
<li><a href="#devtools-additional-features">2.5.3. Enabling Additional Features</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#configuration">3. Configuration</a>
<ul class="sectlevel2">
<li><a href="#license">3.1. License Key</a>
<ul class="sectlevel3">
<li><a href="#license-list">3.1.1. Listing License Keys</a></li>
<li><a href="#license-update">3.1.2. Updating a License Key</a></li>
<li><a href="#license-multiple">3.1.3. Multiple License Keys</a></li>
<li><a href="#license-delete">3.1.4. Deleting a License Key</a></li>
<li><a href="#license-expiration">3.1.5. License Key Expiration</a></li>
<li><a href="#license-ops">3.1.6. Updating License Key From An External Secret</a></li>
</ul>
</li>
<li><a href="#users-quotas">3.2. Users and Quotas</a>
<ul class="sectlevel3">
<li><a href="#users">3.2.1. Users</a></li>
<li><a href="#quotas">3.2.2. Quotas</a></li>
<li><a href="#configuration-object">3.2.3. Configuration Object</a></li>
<li><a href="#browsers-set">3.2.4. Browsers Set</a></li>
<li><a href="#devices-set">3.2.5. Devices Set</a></li>
</ul>
</li>
<li><a href="#video-recording">3.3. Video Recording</a>
<ul class="sectlevel3">
<li><a href="#video-recording-s3">3.3.1. Enabling S3 Storage</a></li>
<li><a href="#video-recording-enable">3.3.2. Requesting to Record a Video</a></li>
</ul>
</li>
<li><a href="#browser-ops">3.4. Automatically Updating Browser Versions</a>
<ul class="sectlevel3">
<li><a href="#browser-ops-installation">3.4.1. Installation</a></li>
<li><a href="#browser-ops-configuration">3.4.2. Configuration Options</a></li>
</ul>
</li>
<li><a href="#private-container-registry">3.5. Using Private Container Registry</a></li>
<li><a href="#timeouts">3.6. Adjusting Timeouts</a>
<ul class="sectlevel3">
<li><a href="#timeouts-moon">3.6.1. Adjusting Moon Timeouts</a></li>
<li><a href="#timeouts-other">3.6.2. Adjusting Other Timeouts</a></li>
</ul>
</li>
<li><a href="#resources">3.7. Adjusting Resources Consumption</a>
<ul class="sectlevel3">
<li><a href="#resources-browser">3.7.1. Browser Resources Consumption</a></li>
<li><a href="#resources-service-images">3.7.2. Service Images Resources Consumption</a></li>
<li><a href="#resources-qos">3.7.3. Pods Quality of Service</a></li>
</ul>
</li>
<li><a href="#ca-certs">3.8. Using Additional Trusted TLS Certificates</a></li>
<li><a href="#multiple-namespaces">3.9. Multiple Namespaces Mode</a></li>
<li><a href="#advanced-settings">3.10. Advanced Settings</a>
<ul class="sectlevel3">
<li><a href="#advanced-settings-annotations">3.10.1. Adding Custom Kubernetes Annotations</a></li>
<li><a href="#advanced-settings-labels">3.10.2. Adding Custom Kubernetes Labels</a></li>
<li><a href="#advanced-settings-network-policies">3.10.3. Adding Network Policies</a></li>
<li><a href="#node-selectors">3.10.4. Using Node Selectors</a></li>
<li><a href="#affinity">3.10.5. Using Affinity</a></li>
<li><a href="#tolerations">3.10.6. Using Tolerations</a></li>
<li><a href="#privileged-mode">3.10.7. Running Browser Pods in Privileged Mode</a></li>
<li><a href="#advanced-settings-user-group">3.10.8. Setting Custom User and Group Identifier to Browser Pods</a></li>
<li><a href="#advanced-settings-service-account">3.10.9. Setting Custom Service Account</a></li>
</ul>
</li>
<li><a href="#upgrade">3.11. Upgrading Moon Version</a></li>
<li><a href="#monitoring">3.12. Monitoring</a>
<ul class="sectlevel3">
<li><a href="#monitoring-setup">3.12.1. Setup</a></li>
<li><a href="#monitoring-built-in-metrics">3.12.2. Built-in Moon metrics</a></li>
<li><a href="#filter-by-labels">3.12.3. Filtering Browser Pods by Labels</a></li>
</ul>
</li>
<li><a href="#log-files">3.13. Log Files</a></li>
<li><a href="#_cli_flags">3.14. CLI Flags</a>
<ul class="sectlevel3">
<li><a href="#cli-flags-moon">3.14.1. Moon Container Flags</a></li>
<li><a href="#cli-flags-moon-auth">3.14.2. Moon Auth Container Flags</a></li>
<li><a href="#cli-flags-moon-basic-auth">3.14.3. Moon Basic Auth Container Flags</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_frequently_asked_questions">4. Frequently Asked Questions</a>
<ul class="sectlevel2">
<li><a href="#faq-moon-logs">4.1. Where are Moon logs?</a></li>
<li><a href="#faq-recorded-videos">4.2. Where are recorded videos stored?</a></li>
<li><a href="#faq-update-configuration">4.3. How to update configuration of a running Moon cluster?</a></li>
<li><a href="#faq-kubernetes-service-account">4.4. Is it possible to configure Kubernetes service account for Moon?</a></li>
<li><a href="#faq-custom-firewall-rules">4.5. Is it possible to assign custom firewall rules to browser pods?</a></li>
<li><a href="#faq-connection-closed-unexpectedly">4.6. Connection was closed unexpectedly</a></li>
<li><a href="#faq-dns-lookup-timeouts">4.7. DNS lookup timeouts</a></li>
<li><a href="#faq-session-timeouts-do-no-work">4.8. Browser session timeouts do not work</a></li>
<li><a href="#faq-json-errors">4.9. JSON processing errors in tests</a></li>
<li><a href="#faq-private-registry">4.10. Is it possible to use Moon with private Docker registry?</a></li>
<li><a href="#faq-ca-certs">4.11. Is it possible to test HTTPS web applications with self-signed TLS certificates?</a></li>
</ul>
</li>
<li><a href="#_license_agreement">5. License Agreement</a></li>
<li><a href="#_pricing">6. Pricing</a></li>
<li><a href="#mobile-emulation-devices">Appendix A: Supported Mobile Devices</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This reference for version: <em>latest</em></p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Moon 1.x documentation is published <a href="https://aerokube.com/moon/1-latest">here</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Moon is a browser automation solution compatible with <a href="https://www.w3.org/TR/webdriver/">Selenium</a>, <a href="https://www.cypress.io/">Cypress</a>, <a href="https://playwright.dev/">Playwright</a> and <a href="https://pptr.dev/">Puppeteer</a> using <a href="https://kubernetes.io/">Kubernetes</a> or <a href="https://openshift.com/">Openshift</a> to launch browsers.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="getting-started"><a class="anchor" href="#getting-started"></a>1. Getting Started</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="install"><a class="anchor" href="#install"></a>1.1. Quick Start Guide</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This section shows how to install Moon limited to 4 parallel browser sessions. Detailed information on installing a license key allowing to activate more parallel sessions is shown in <a href="#license">Installing License</a> section.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="install-kubernetes"><a class="anchor" href="#install-kubernetes"></a>1.1.1. Installing to Kubernetes</h4>
<div class="sect4">
<h5 id="install-prerequisites"><a class="anchor" href="#install-prerequisites"></a>Prerequisites</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Running <a href="https://kubernetes.io/">Kubernetes</a> cluster</p>
</li>
<li>
<p><code>kubectl</code> client installed and pointing to the cluster</p>
</li>
<li>
<p>If you are running Kubernetes cluster on virtual machines, we usually recommend having bigger VMs instead of smaller ones. This allows to avoid available CPUs and memory fragmentation issues. For example having 24 CPU cores overall it is better to start 3 x 8 CPU core VMs instead of 12 x 2 CPU core.</p>
</li>
<li>
<p>If you are starting Moon in Kubernetes cluster deployed on workstation with <a href="https://github.com/kubernetes/minikube/">minikube</a> tool - see <a href="#install-minikube">Option 3: you have Minikube</a>.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="install-helm"><a class="anchor" href="#install-helm"></a>Option 1: use Helm chart</h5>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Helm chart is the recommended Moon installation way. Steps below require Helm 3 and will not work with older releases.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>We deliver already packed and published <a href="https://helm.sh/">Helm</a> charts, so installing Moon with Helm is straightforward:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Add Aerokube <a href="https://github.com/aerokube/charts">charts</a> repository:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ helm repo add aerokube https://charts.aerokube.com/
$ helm repo update</code></pre>
</div>
</div>
</li>
<li>
<p>To list available Moon versions type:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ helm search repo aerokube --versions</code></pre>
</div>
</div>
</li>
<li>
<p>Create a namespace:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ kubectl create namespace moon</code></pre>
</div>
</div>
</li>
<li>
<p>To install or upgrade Moon type:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ helm upgrade --install -n moon moon aerokube/moon2</code></pre>
</div>
</div>
</li>
<li>
<p>Moon chart has a lot of other configuration parameters that can be listed as follows:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ helm show values aerokube/moon2</code></pre>
</div>
</div>
<div class="paragraph">
<p>To change one of these parameters - use <code>--set</code> flag:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ helm upgrade --install --set=moon.enabled.resources=false -n moon moon aerokube/moon2</code></pre>
</div>
</div>
</li>
<li>
<p>By default, deployed Ingress has <code>moon.aerokube.local</code> host name. To change it:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ helm upgrade --install -n moon moon aerokube/moon2 --set ingress.host=moon.example.com</code></pre>
</div>
</div>
<div class="paragraph">
<p>Open <a href="http://moon.example.com/" class="bare">http://moon.example.com/</a> in browser to show user interface. Use <a href="http://moon.example.com/wd/hub" class="bare">http://moon.example.com/wd/hub</a> as Selenium URL.</p>
</div>
</li>
<li>
<p>By default, Moon is started in HTTP-only mode. To enable TLS encryption (also known as HTTPS) - simply provide TLS certificate and private key:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ helm upgrade --install -n moon moon aerokube/moon2 --set ingress.host=moon.example.com --set-file ingress.tlsCert=server.crt --set-file ingress.tlsKey=server.key</code></pre>
</div>
</div>
<div class="paragraph">
<p>Usually TLS certificate and private key are provided by third-party providers or your company information security department. To generate a test pair of such files use the following commands:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash"># Generate the CA Key and Certificate
$ openssl req -x509 -sha256 -newkey rsa:4096 -keyout ca.key -out ca.crt -days 356 -nodes -subj '/CN=My Cert Authority'
# Generate the Server Key, Certificate request and Sign with the CA Certificate
$ openssl req -new -newkey rsa:4096 -keyout server.key -out server.csr -nodes -subj '/CN=moon.aerokube.local'
$ openssl x509 -req -sha256 -days 365 -in server.csr -CA ca.crt -CAkey ca.key -set_serial 01 -out server.crt</code></pre>
</div>
</div>
<div class="paragraph">
<p>When using such self-signed TLS certificates you may need to explicitly allow opening Moon in your browser.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="install-minikube"><a class="anchor" href="#install-minikube"></a>Option 2: you have Minikube</h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Every browser by default requires 1 CPU and 2 GB of memory. We recommend having at least 4 CPUs and 8GB of memory in your Minikube cluster. When having less CPUs browser pods may not start because of insufficient computing resources. We do not recommend using Docker driver for Minikube.</p>
</div>
<div class="listingblock">
<div class="title">Minikube startup under Linux</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ minikube start --cpus=4 --memory=8G --disk-size=20G --driver kvm2</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Minikube startup under MacOS</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ minikube start --cpus=4 --memory=8G --disk-size=20G --driver=hyperkit</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Minikube startup under Windows</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ DISM /Online /Enable-Feature /All /FeatureName:Microsoft-Hyper-V # Enable Hyper-V
$ minikube start --cpus=4 --memory=8G --disk-size=20G --driver=hyperv</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Enable Ingress addon in Minikube:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ minikube addons enable ingress</code></pre>
</div>
</div>
</li>
<li>
<p>Install Moon with Helm as shown <a href="#install-helm">above</a>.</p>
</li>
<li>
<p>Configure access to Moon:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p><strong>Option 1.</strong> Use <code>minikube ip</code> to patch Moon service.</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>Patch service with <code>minikube ip</code> command output:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ kubectl patch svc moon -n moon --patch &quot;{\&quot;spec\&quot;:{\&quot;externalIPs\&quot;:[\&quot;$(minikube ip)\&quot;]}}&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>On Windows - you may need to insert <code>minikube ip</code> output manually, because <code>$()</code> expression expansion may not work.</p>
</div>
</li>
<li>
<p>Add <code>moon.aerokube.local</code> to <code>/etc/hosts</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ sudo echo &quot;$(minikube ip) moon.aerokube.local&quot; &gt;&gt; /etc/hosts</code></pre>
</div>
</div>
<div class="paragraph">
<p>On Windows you may need to update hosts file manually.</p>
</div>
</li>
</ol>
</div>
</li>
<li>
<p><strong>Option 2.</strong> Use minikube tunnel. This works only when minikube is using Docker driver.</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>Add <code>moon.aerokube.local</code> to <code>/etc/hosts</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ sudo echo '127.0.0.1 moon.aerokube.local' &gt;&gt; /etc/hosts</code></pre>
</div>
</div>
</li>
<li>
<p>Start Minikube tunnel in a separate tab. Enter your password when prompted:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ minikube tunnel</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Open <a href="http://moon.aerokube.local/" class="bare">http://moon.aerokube.local/</a> in browser to show user interface. Use <a href="http://moon.aerokube.local/wd/hub" class="bare">http://moon.aerokube.local/wd/hub</a> as Selenium URL.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="install-openshift"><a class="anchor" href="#install-openshift"></a>1.1.2. Installing to Openshift</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Prerequisites:</p>
<div class="ulist">
<ul>
<li>
<p>Running <a href="https://www.openshift.com/">Openshift</a> 4.x cluster</p>
</li>
<li>
<p><code>oc</code> client installed and pointing to the cluster. Installation was tested when <code>oc</code> has administrator permissions.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Create a project (the same as Kubernetes namespace) for Moon:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ oc new-project moon</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the next steps we assume that Openshift project for Moon is called <code>moon</code>.</p>
</div>
</li>
<li>
<p>Add Aerokube <a href="https://github.com/aerokube/charts">charts</a> repository:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ helm repo add aerokube https://charts.aerokube.com/
$ helm repo update</code></pre>
</div>
</div>
</li>
<li>
<p>To install or upgrade Moon type:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ helm upgrade --install --set ingress.openshift=true -n moon moon aerokube/moon2</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here <code>-n moon</code> points to the project created on the previous step.</p>
</div>
</li>
<li>
<p>Edit user and group id in <a href="#configuration-object">configuration object</a> to match values allowed by Openshift policies (e.g. set to <code>1000650000</code>, exact value depends on Openshift configuration):</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ oc edit config.moon.aerokube.com default -n moon</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To test everything locally you can use <a href="https://console.redhat.com/openshift/create/local">RedHat CodeReady Containers</a>. In that case you need to additionally pass Ingress hostname as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ helm upgrade --install --set ingress.openshift=true --set ingress.host=moon.apps-crc.testing -n moon moon aerokube/moon2</code></pre>
</div>
</div>
<div class="paragraph">
<p>Having running Moon pods - add <code>moon.apps-crc.testing</code> to <code>/etc/hosts</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ sudo echo '127.0.0.1 moon.apps-crc.testing' &gt;&gt; /etc/hosts</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="architecture"><a class="anchor" href="#architecture"></a>1.2. Architecture</h3>
<div class="sect3">
<h4 id="moon-components"><a class="anchor" href="#moon-components"></a>1.2.1. Moon Components</h4>
<div class="paragraph">
<div class="title">Moon Components</div>
<p><span class="image"><img src="img/moon-components.png" alt="moon components"></span></p>
</div>
<div class="paragraph">
<p>Moon cluster consists of several components:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>One or more <code>Moon</code> application instances. Their main purpose is to start and stop browser containers. These replicas are usually exposed as <a href="https://kubernetes.io/docs/concepts/services-networking/service/">Kubernetes service</a> available on standard Selenium port <code>4444</code>. You should run all the tests against this service. Also, this application provides an API to get information about running browser instances (in Moon 1.x this was a separate application called <code>Moon API</code>).</p>
</li>
<li>
<p>One or more <code>Moon Conf</code> application instances. This application is restarting Moon pods when you update a license key.</p>
</li>
<li>
<p>One or more <code>Moon UI</code> application instances. <code>Moon UI</code> collects information from Moon and visualizes it. It is usually available on HTTP port <code>8080</code>.</p>
</li>
<li>
<p>Running browser pods.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="moon-operation-modes"><a class="anchor" href="#moon-operation-modes"></a>1.2.2. Moon Operation Modes</h4>
<div class="paragraph">
<p>Moon 2.x has two different operation modes: <strong>single namespace mode</strong> and <strong>multiple namespaces mode</strong>.</p>
</div>
<div class="paragraph">
<div class="title">Single Namespace Mode</div>
<p><span class="image"><img src="img/single-namespace-mode.png" alt="single-namespace-mode"></span></p>
</div>
<div class="paragraph">
<p>In single namespace mode Moon itself and all launched browser pods are running in the one Kubernetes namespace. Moon 1.x was only able to work like this. This is still suitable if only one team is using Moon or you don&#8217;t need to limit browser consumption of different Moon users. By default, Moon is launched in this mode.</p>
</div>
<div class="paragraph">
<div class="title">Multiple Namespaces Mode</div>
<p><span class="image"><img src="img/multiple-namespaces-mode.png" alt="multiple-namespaces-mode"></span></p>
</div>
<div class="paragraph">
<p>In multiple namespaces mode Moon is running in one namespace and browsers are launched in separate namespaces. The total number of such namespaces is unlimited. This mode is mainly needed when you want to control computing resources, browsers or network access rules (<a href="https://kubernetes.io/docs/concepts/services-networking/network-policies/">network policies</a>) available for every team. How to enable this mode is described <a href="#multiple-namespaces">here</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="moon-pod-contents"><a class="anchor" href="#moon-pod-contents"></a>1.2.3. Browser Pod Contents</h4>
<div class="paragraph">
<p>In addition to container with browser every pod created by Moon contains one or more service images.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Service Images</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Purpose</th>
<th class="tableblock halign-left valign-top">Started</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ca-certs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Needed to provide CA certificates to browser</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Always as init container</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">defender</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows only one browser session to be created in the pod, handles session timeouts</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Always</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">proxy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Handles proxy authentication for Selenium</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When <a href="#selenium-proxy">proxy</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">video-recoder</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Records video of running browser screen</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When <a href="#video-recording">video recording</a> is requested by user</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">vnc-server</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Delivers <a href="https://en.wikipedia.org/wiki/Virtual_Network_Computing">VNC</a> connectivity to browser images</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When browser window is visible</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">x-server</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Delivers an <a href="https://en.wikipedia.org/wiki/X_Window_System_core_protocol">X</a> server for running non-headless browsers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When browser window is visible</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="recommended-cluster-settings"><a class="anchor" href="#recommended-cluster-settings"></a>1.3. Recommended Cluster Settings</h3>
<div class="ulist">
<ul>
<li>
<p><strong>Use the biggest possible cluster node sizes</strong>. For example having 100 CPUs overall it is better to launch 5 nodes with 20 CPUs each than 50 nodes with 2 CPUs each. Browser pods can in some cases require more than 2 CPUs and this can lead to preliminary cluster fragmentation.</p>
</li>
<li>
<p><strong>Avoid cluster nodes with RedHat \ CentOS if possible.</strong> Nodes using these distributions are known to suffer from issues related to firewall \ SeLinux and can be more complicated to configure correctly.</p>
</li>
<li>
<p><strong>Use Calico container network interface instead of Flannel if possible</strong>. Calico has better performance than Flannel especially on big clusters.</p>
</li>
<li>
<p><strong>Use more than 1 Kubernetes API replica if needed</strong>. Moon is using Kubernetes API to create and delete browser pods. If you plan to run hundreds of browsers in parallel - take a look at Kubernetes API (Kubernetes master) host system metrics. Overloaded master can stop responding to requests properly and this can lead to frozen browser pods.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="permissions"><a class="anchor" href="#permissions"></a>1.4. Required Permissions</h3>
<div class="paragraph">
<p>Moon requires a limited set of permissions and should work with default Kubernetes settings. By default, Moon runs browsers in the same <code>moon</code> namespace where it runs (<strong>single namespace mode</strong>). Moon 2.0.0 and above supports multiple Kubernetes <a href="https://kubernetes.io/docs/tasks/administer-cluster/namespaces-walkthrough/">namespaces</a>. This allows you to have one Moon instance running in <code>moon</code> namespace and an arbitrary number of namespaces for running browsers of different users (<strong>multiple namespaces mode</strong>). This allows you to easily set maximum number of browsers allowed to run by every team.</p>
</div>
<div class="sect3">
<h4 id="permissions-single-namespace"><a class="anchor" href="#permissions-single-namespace"></a>1.4.1. Single Namespace Mode</h4>
<div class="paragraph">
<p>The following table summarizes what needs to be accessible for Moon in single namespace mode:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Required Moon Permissions In Single Namespace Mode</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Permission</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Purpose</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">To <strong>get</strong>, <strong>watch</strong>, <strong>list</strong>, <strong>create</strong>, <strong>delete</strong>, <strong>update</strong> and <strong>patch</strong> <a href="https://kubernetes.io/docs/concepts/workloads/pods/pod/">pods</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Used to manipulate pods with browsers</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">To <strong>get</strong>, <strong>watch</strong>, <strong>list</strong>, <strong>create</strong>, <strong>delete</strong>, <strong>update</strong> and <strong>patch</strong> <a href="https://kubernetes.io/docs/concepts/configuration/configmap/">config maps</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Used to pass users and groups to browser pods</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">To <strong>get</strong>, <strong>watch</strong>, <strong>list</strong>, <strong>create</strong>, <strong>delete</strong>, <strong>update</strong> and <strong>patch</strong> <a href="https://kubernetes.io/docs/concepts/workloads/controllers/deployment/">deployments</a> and <a href="https://kubernetes.io/docs/concepts/workloads/controllers/replicaset/">replica sets</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Used in license functionality</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">To <strong>get</strong>, <strong>watch</strong> and <strong>list</strong> Moon <a href="https://kubernetes.io/docs/concepts/extend-kubernetes/api-extension/custom-resources/">custom resources</a> in <code>moon.aerokube.com</code> API group</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">These custom resources store Moon configuration. Moon licenses (<code>licenses.moon.aerokube.com</code>) are cluster-wide, so a <a href="https://kubernetes.io/docs/reference/access-authn-authz/rbac/#role-and-clusterrole">ClusterRole</a> is needed for this resource.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="permissions-multiple-namespaces"><a class="anchor" href="#permissions-multiple-namespaces"></a>1.4.2. Multiple Namespaces Mode</h4>
<div class="paragraph">
<p>When running browsers in multiple namespaces required permissions differ. The following table shows Moon permissions in the namespace where it is running:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 3. Required Permissions for the Namespace where Moon runs</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Permission</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Purpose</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">To <strong>get</strong>, <strong>watch</strong> and <strong>list</strong> information about <a href="https://kubernetes.io/docs/concepts/workloads/pods/pod/">namespaces</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Needed to control how many browsers are running in every user namespace</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">To <strong>get</strong>, <strong>watch</strong> and <strong>list</strong> <a href="https://kubernetes.io/docs/concepts/workloads/pods/pod/">pods</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Used to analyze pods in Moon namespace</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">To <strong>get</strong>, <strong>watch</strong>, <strong>list</strong>, <strong>create</strong>, <strong>delete</strong>, <strong>update</strong> and <strong>patch</strong> <a href="https://kubernetes.io/docs/concepts/workloads/controllers/deployment/">deployments</a> and <a href="https://kubernetes.io/docs/concepts/workloads/controllers/replicaset/">replica sets</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Used in license functionality</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">To <strong>get</strong>, <strong>watch</strong> and <strong>list</strong> Moon <a href="https://kubernetes.io/docs/concepts/extend-kubernetes/api-extension/custom-resources/">custom resources</a> in <code>moon.aerokube.com</code> API group</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">These custom resources store Moon configuration.  Moon licenses (<code>licenses.moon.aerokube.com</code>) are cluster-wide, so a <a href="https://kubernetes.io/docs/reference/access-authn-authz/rbac/#role-and-clusterrole">ClusterRole</a> is needed for this resource.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>For every user namespace Moon needs the following permissions:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 4. Required Moon Permissions For User Namespace</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Permission</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Purpose</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">To <strong>get</strong>, <strong>watch</strong>, <strong>list</strong>, <strong>create</strong>, <strong>delete</strong>, <strong>update</strong> and <strong>patch</strong> <a href="https://kubernetes.io/docs/concepts/workloads/pods/pod/">pods</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Used to manipulate pods with browsers</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">To <strong>get</strong>, <strong>watch</strong>, <strong>list</strong>, <strong>create</strong>, <strong>delete</strong>, <strong>update</strong> and <strong>patch</strong> <a href="https://kubernetes.io/docs/concepts/configuration/configmap/">config maps</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Used to pass users and groups to browser pods</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="moon2-vs-moon1"><a class="anchor" href="#moon2-vs-moon1"></a>1.5. Difference between Moon 2.x and Moon 1.x</h3>
<div class="paragraph">
<p>Moon 2.x is the new major Moon version adding a lot of improvements. This section summarizes the most notable changes.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Multiple Kubernetes namespaces</strong>. Moon 1.x allows to run all browsers in <strong>one</strong> Kubernetes namespace. However, the same Moon cluster is often being used by different teams. A common problem is limiting the maximum number of browsers available for every team. Limiting the number of browsers is the same as limiting the number of CPUs and memory available for every team. Kubernetes solves this problem by introducing <strong>namespaces</strong>. Namespaces can be considered as projects that can have some limited number of computing resources assigned by Kubernetes administrator. In Moon 2.x you can create an unlimited number of separate namespaces for browsers, one for every team, and then configure Moon to launch browsers in these namespaces. This gives Kubernetes administrator full control of resources consumption for every team. From the license key perspective - you are still using one license key for all these namespaces. In Moon 1.x in order to use separate namespaces for different teams you had to install a separate Moon instance to every namespace and use a different license key for every such instance. This sometimes prevented teams from requesting more browsers during the peak load. In Moon 2.x one big license key is automatically shared between namespaces and thus if licenses are available, every team during the peak load can request more browsers than it usually needs. Detailed description of how it looks like is provided in <a href="#architecture">Architecture</a> section.</p>
</li>
<li>
<p><strong>Improved configuration</strong>. Moon 1.x is using <a href="https://json.org/">JSON</a> configuration files. For example Moon 1.x browsers list file is stored in Kubernetes config map and looks like this:</p>
<div class="listingblock">
<div class="title">Typical Moon 1.x Browsers List File</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">firefox</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">95.0</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">versions</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">95.0</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">image</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">browsers/firefox:95.0</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">port</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">4444</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">path</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">/wd/hub</span><span class="delimiter">&quot;</span></span>
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Moon 2.x instead if providing custom resources for configuration. For example browsers list file is now called a <strong>browser set</strong> and is a native Kubernetes citizen:</p>
</div>
<div class="listingblock">
<div class="title">Moon 2.x Browser Set</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">apiVersion</span>: <span class="string"><span class="content">moon.aerokube.com/v1</span></span>
<span class="key">kind</span>: <span class="string"><span class="content">BrowserSet</span></span>
<span class="key">metadata</span>:
  <span class="key">name</span>: <span class="string"><span class="content">default</span></span>
  <span class="key">namespace</span>: <span class="string"><span class="content">moon</span></span>
<span class="key">spec</span>:
  <span class="key">selenium</span>:
    <span class="key">firefox</span>:
      <span class="key">repository</span>: <span class="string"><span class="content">quay.io/browser/firefox</span></span>
    <span class="key">chrome</span>:
      <span class="key">repository</span>: <span class="string"><span class="content">quay.io/browser/chrome</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can easily inspect and update such objects with any compatible Kubernetes client, e.g.:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ kubectl get browsersets -n moon -o yaml # Show all available browser sets
$ kubectl edit browserset default -n moon</pre>
</div>
</div>
<div class="paragraph">
<p>The same applies to other configuration files and even to Moon license key manipulation:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ kubectl get license -n moon
NAME      LICENSEE          SESSIONS   EXPIRES
default   Acme Inc.         10         2022-10-11T18:38:42Z</pre>
</div>
</div>
<div class="paragraph">
<p>Every modification in such configuration objects is automatically validated by Kubernetes before saving, so it&#8217;s less error-prone.</p>
</div>
</li>
<li>
<p><strong>New browser versions are available automatically</strong>. Moon 1.x requires to add an image for every new browser version to browsers list file manually. If a browser version is missing, then Moon 1.x will not be able to start this browser. Moon 2.x contrarily only needs to configure a browser image repository for every browser type. Once configured - new browser versions are detected automatically.</p>
</li>
<li>
<p><strong>Improved browser performance</strong>. Moon 2.x is using completely new browser startup architecture that starts only required operating system components for current set of requested browser features. For example, operating system components responsible for window management are started only when browser window is visible (browser is not "headless"). This leads to smaller browser images, faster startup and faster browser commands execution.</p>
</li>
<li>
<p><strong>Lower cloud resources consumption</strong>. Reworked browser startup architecture leads to at least 20% lower average cloud resources (CPU, memory, network traffic) consumption.</p>
</li>
<li>
<p><strong>Improved network communication</strong>. Moon 1.x relies on Kubernetes DNS implementation (e.g. <a href="https://github.com/coredns/coredns">CoreDNS</a>) for communicating with browser pods. DNS service is known to suffer from caching and cloud-specific networking issues which can in rare cases lead to broken browser sessions. Moon 2.x relies on pod IP addresses instead and does not depend on DNS at all.</p>
</li>
<li>
<p><strong>No built-in authentication</strong>. Moon 1.x supports only <a href="https://en.wikipedia.org/wiki/Basic_access_authentication">basic HTTP authentication</a>. Moon 2.x instead does not provide built-in authentication mechanism by default. Instead, you can use existing Kubernetes-compatible software (e.g. <a href="https://github.com/kubernetes/ingress-nginx">Nginx Ingress Controller</a>) to provide any authentication mechanism (e.g. <a href="https://www.cloudflare.com/learning/access-management/what-is-mutual-tls/">mutual TLS authentication</a>) you need. Moon derives username from <code>Authorization</code> or <code>X-Moon-Quota</code> HTTP headers. See <a href="#users">Users</a> section for more details.</p>
</li>
<li>
<p><strong>OpenID Connect support</strong>. Moon 2.x comes with a ready-to-use sidecar container for using <a href="https://openid.net/connect/">OpenID Connect</a> authentication. This allows for example to easily use an existing private or public <a href="https://en.wikipedia.org/wiki/OAuth">OAuth</a> service. For example, you can easily load existing <a href="https://github.com/">Github</a> users like this.</p>
</li>
<li>
<p><strong>Improved self-signed TLS root certification authorities support</strong>. Companies are often using self-signed TLS certificates for internal web services. In Moon 2.x adding support for such self-signed TLS certificates is as easy as providing TLS self-signed root certification authority in Moon configuration. You can configure it globally for all Moon components and browser versions in a single place.</p>
<div class="listingblock">
<div class="title">Moon 2 self-signed root CA configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">apiVersion</span>: <span class="string"><span class="content">moon.aerokube.com/v1</span><span class="content">
  kind: Config
  metadata:
    annotations:
    name: default
    namespace: moon
  spec:
    additionalTrustedCAs: |
      -----BEGIN CERTIFICATE-----
      ...</span></span></code></pre>
</div>
</div>
</li>
<li>
<p><strong>Advanced Selenium features</strong>. Moon is fully compatible with <a href="https://www.w3.org/TR/webdriver/">W3C Webdriver protocol</a> meaning that all Selenium 4.x features will work out of the box. In addition to these standard features Moon provides some advanced browser manipulation methods like interacting with the <a href="#clipboard">clipboard</a> or <a href="#accessing-downloaded-files">getting files</a> from browser container. For example, you can easily copy and paste arbitrary text data and images from your tests to browser clipboard.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="advantages"><a class="anchor" href="#advantages"></a>1.6. Moon vs other solutions</h3>
<div class="paragraph">
<p>Moon takes all the best practices and features from existing browser automation solutions and adds many more:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Browser automation Swiss army knife</strong>. Moon supports all the most popular browser automation tools (<a href="https://selenium.dev/">Selenium</a>, <a href="https://playwright.dev/">Playwright</a>, <a href="https://cypress.io/">Cypress</a>, <a href="https://pptr.dev/">Puppeteer</a>) out of the box. We automatically build and publish <a href="https://quay.io/browser/">images</a> for all new browser releases.</p>
</li>
<li>
<p><strong>Unlimited automatic scalability.</strong> You always have enough browsers of any desired version available in the cluster. When running the cluster in cloud platforms such as <a href="https://aws.amazon.com/">Amazon Web Services</a> or <a href="http://cloud.google.com/">Google Cloud</a> you can adjust settings to automatically scale depending on current load. This allows to combine efficiency with competitive cost.</p>
</li>
<li>
<p><strong>Completely stateless</strong>. Selenoid and Selenium Grid 3.x store in memory information about currently running browser sessions. Selenium Grid 4.x is using a key-value storage (e.g. <a href="https://redis.io/">Redis</a>) for the same purpose. If for some reason process that stores sessions list crashes then all running sessions are lost. Moon contrarily has no internal state and can be replicated across datacenters. Browser sessions remain alive even if one or more replicas go down.</p>
</li>
<li>
<p><strong>Fine-grained resources control</strong>. Moon allows to easily configure computing resources available for every used component. This leads to predictable computing resources consumption and overall cluster cost.</p>
</li>
<li>
<p><strong>Fully graceful</strong>. Any maintenance operations with the cluster do not interrupt running browser sessions. Every cluster component shuts down gracefully.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="main-features"><a class="anchor" href="#main-features"></a>2. Main Features</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="user-interface"><a class="anchor" href="#user-interface"></a>2.1. User Interface</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>This feature is available since Moon 2.4.0.</p>
</li>
<li>
<p>User interface described in this section should be enabled explicitly when deploying Moon. To enable it - use the following parameter in Helm chart values:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">deployment:
  experimentalUI: true</code></pre>
</div>
</div>
<div class="paragraph">
<p>When enabled - new user interface (UI) is automatically available under <code>/ui/</code>, e.g. <code><a href="https://moon.example.com/ui/" class="bare">https://moon.example.com/ui/</a></code> and UI that was present is still available under <code>/</code> (<code><a href="https://moon.example.com/" class="bare">https://moon.example.com/</a></code>). We plan to stop using old UI when we get sufficient feedback from the teams and fix possibly found issues.</p>
</div>
</li>
</ol>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Moon comes with a powerful user interface allowing to list and filter running browser sessions, view browser screen, launch browser sessions for manual testing and so on.</p>
</div>
<div class="paragraph">
<div class="title">Moon UI general view</div>
<p><span class="image"><img src="img/moon-ui-general-view.png" alt="moon ui general view"></span></p>
</div>
<div class="paragraph">
<p>The main screen of the UI is showing the list of browser sessions that are currently running or being started. For every session you can see browser automation tool, browser name, version, test name, labels, status, duration, enabled features and so on. To delete a running session you have <strong>to click twice</strong> on the button with a trash can icon (two clicks are needed to prevent accidentally removing a running session). To create a browser session for <strong>manual testing</strong> - click on the button with browser name at the top of UI screen.</p>
</div>
<div class="paragraph">
<div class="title">Moon UI session filters</div>
<p><span class="image"><img src="img/moon-ui-filtering.png" alt="moon ui session filters"></span></p>
</div>
<div class="paragraph">
<p>One Moon cluster can run dozens, hundreds or even thousands of browser sessions in parallel. To find sessions that belong to your project or exact build number - <strong>use filters</strong>. These controls allow to filter browser sessions by <strong>id</strong>, <strong>name</strong> and <strong>labels</strong>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Session <strong>id</strong> is a unique value automatically assigned to every browser session by Moon. You can&#8217;t change it. Full session id looks like this: <code>chrome-73-0-ac15ffaa-e641-4c7f-a54c-f25b5be1f135</code>. In the UI we are printing only a few symbols of this long value.</p>
</li>
<li>
<p>Session <strong>name</strong> is a free-form value allowing to describe purpose of the session in the UI. Usually this value contains test case name. To change session name - use <strong><a href="#capability-name">name capability</a></strong> for Selenium or <strong>name parameter</strong> for <a href="#playwright-additional-features">Playwright</a>, <a href="#cypress-additional-features">Cypress</a> or <a href="#devtools-additional-features">developer tools</a>, e.g.:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">wss://moon.example.com/playwright/chromium?name=MyTestCaseName</code></pre>
</div>
</div>
</li>
<li>
<p>Session <strong>labels</strong> are free-form key-value pairs allowing to put additional metadata on every browser session. This can be for example build number, project name, release information and so on. To add labels - use <strong><a href="#capability-labels">labels capability</a></strong> for Selenium or configure <strong><a href="#browsers-set-custom-labels">labels in browsers set</a></strong>. Every label requested to be set by Moon is converted to a <a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/">Kubernetes label</a> added to respective browser pod. User interface is using exactly the same syntax of <a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/#label-selectors">label selectors</a> that is supported by Kubernetes. For example, having <code>project</code> and <code>buildNumber</code> labels set to some browser session you can use expressions like this:</p>
<div class="listingblock">
<div class="title">How to filter by labels</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">project=MyCoolProject # Exact match of one label

project=MyCoolProject,buildNumber=42 # Match of project AND buildNumber values

project in (MyCoolProject, AnotherProject),buildNumber!=42 # Select project from the list

project notin (MyCoolProject, AnotherProject),!buildNumber # Select project not from the list, build number not set

project!=AnotherProject,buildNumber # Any project except AnotherProject, build number should be set</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Moon UI browser screen</div>
<p><span class="image"><img src="img/moon-ui-vnc.png" alt="moon ui browser screen"></span></p>
</div>
<div class="paragraph">
<p>When you click on a row in the sessions list, browser screen is shown automatically if possible. For example for browser sessions with invisible browser window (so-called <strong>headless</strong> browsers) - nothing happens when you click on a row. By default, browser screen is in view-only mode. To interact with the browser - click on the button with the lock icon (ðŸ”’). Click on this button again - to switch back to view-only mode. Browser screen allows to follow automated test execution and intercept it when needed. When you launch a manual testing session - use this screen to manually execute your scenario step-by-step. All browser features like opening developer toolbar are working exactly the same as on your personal computer. To copy and paste values from your computer to Moon browser session - use <strong>Ctrl+C\Ctrl+V</strong> or <strong>Cmd+C\Cmd+V</strong> shortcuts on your keyboard.</p>
</div>
</div>
<div class="sect2">
<h3 id="selenium"><a class="anchor" href="#selenium"></a>2.2. Using Selenium</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>We maintain a set of minimalistic projects demonstrating how to use Moon with your Selenium tool:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/aerokube/moon-cloud-codeception-example">Codeception</a></p>
</li>
<li>
<p><a href="https://github.com/aerokube/moon-cloud-java-example">Java</a></p>
</li>
<li>
<p><a href="https://github.com/aerokube/moon-cloud-protractor-example">Protractor</a></p>
</li>
<li>
<p><a href="https://github.com/aerokube/moon-cloud-python-example">Python</a></p>
</li>
<li>
<p><a href="https://github.com/aerokube/moon-cloud-webdriverio-example">Webdriver.io</a></p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Running Selenium tests in Moon is straightforward. Just use the following as Selenium URL in your tests:</p>
</div>
<div class="listingblock">
<div class="title">Selenium URL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">https://moon.example.com/wd/hub</code></pre>
</div>
</div>
<div class="paragraph">
<p>Moon is fully compatible with <a href="https://www.w3.org/TR/webdriver/">W3C WebDriver specification</a>, so all <a href="https://www.w3.org/TR/webdriver/#capabilities">standard Selenium capabilities</a> and features should just work out of the box. To request a browser - you have to provide <code>browserName</code> capability in your code, for example:</p>
</div>
<div class="listingblock">
<div class="title">An example Selenium test in Python</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">from</span> <span class="include">selenium</span> <span class="keyword">import</span> <span class="include">webdriver</span>

capabilities = {
    <span class="string"><span class="delimiter">&quot;</span><span class="content">browserName</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">chrome</span><span class="delimiter">&quot;</span></span>
}

driver = webdriver.Remote(
    command_executor=<span class="string"><span class="delimiter">'</span><span class="content">https://moon.example.com/wd/hub</span><span class="delimiter">'</span></span>,
    desired_capabilities=capabilities
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Concrete browser version that will be used depends on Moon configuration, but by default this is the latest available version. To request an exact browser version - provide <code>browserVersion</code> capability:</p>
</div>
<div class="listingblock">
<div class="title">Providing an exact browser version</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">capabilities = {
    <span class="string"><span class="delimiter">&quot;</span><span class="content">browserName</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">chrome</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">&quot;</span><span class="content">browserVersion</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">96.0</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Moon provides additional features by using <a href="https://www.w3.org/TR/webdriver/#extensions-0">extension</a> commands and capabilities described in the next sections.</p>
</div>
<div class="sect3">
<h4 id="selenium-moon-capabilities"><a class="anchor" href="#selenium-moon-capabilities"></a>2.2.1. Moon-specific Capabilities</h4>
<div class="paragraph">
<p>Moon supports a set of extension capabilities. You can pass them in your code to enable or disable some features. All these capabilities should be passed under <code>moon:options</code> key:</p>
</div>
<div class="listingblock">
<div class="title">Providing Moon capabilities</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">capabilities = {
    <span class="string"><span class="delimiter">&quot;</span><span class="content">browserName</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">chrome</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">&quot;</span><span class="content">moon:options</span><span class="delimiter">&quot;</span></span>: { <span class="comment"># All Moon capabilities live under moon:options</span>
        <span class="string"><span class="delimiter">&quot;</span><span class="content">enableVideo</span><span class="delimiter">&quot;</span></span>: <span class="predefined-constant">True</span>,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">screenResolution</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">1280x1024</span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In statically-typed languages like Java or C# you should use a Map (Dictionary) to pass Moon capabilities, e.g.:</p>
</div>
<div class="listingblock">
<div class="title">Passing Moon capabilities in Java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">capabilities.setCapability(<span class="string"><span class="delimiter">&quot;</span><span class="content">moon:options</span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">Map</span>.of(
    <span class="string"><span class="delimiter">&quot;</span><span class="content">screenResolution</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">1280x1024</span><span class="delimiter">&quot;</span></span>
));</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="capability-screenResolution"><a class="anchor" href="#capability-screenResolution"></a>Custom Screen Resolution: screenResolution</h5>
<div class="paragraph">
<p>Moon allows you to set custom screen resolution in containers being run:</p>
</div>
<div class="listingblock">
<div class="title">Type: string, format: &lt;width&gt;x&lt;height&gt;</div>
<div class="content">
<pre>screenResolution: "1280x1024"</pre>
</div>
</div>
<div class="paragraph">
<p>You can optionally add colors depth:</p>
</div>
<div class="listingblock">
<div class="title">Type: string, format: &lt;width&gt;x&lt;height&gt;x&lt;colors-depth&gt;</div>
<div class="content">
<pre>screenResolution: "1280x1024x24"</pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This capability sets only screen resolution - not browser window size. Most of the browsers have some default window size value this is why your screenshot size can be smaller than screen resolution specified in capability. You should manually resize window to desired width and height or use Selenium <code>maximize</code> operation.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="capability-name"><a class="anchor" href="#capability-name"></a>Custom Test Name: name</h5>
<div class="paragraph">
<p>For debugging purposes it is often useful to give a distinct name to every test case. You can set test case name by passing the following capability:</p>
</div>
<div class="listingblock">
<div class="title">Type: string</div>
<div class="content">
<pre>name: "myCoolTestName"</pre>
</div>
</div>
<div class="paragraph">
<p>The main application of this capability - is debugging tests in the UI which is showing specified name for every running session.</p>
</div>
</div>
<div class="sect4">
<h5 id="capability-video-recording"><a class="anchor" href="#capability-video-recording"></a>Video Recording: enableVideo, videoName, videoScreenSize, videoFrameRate, videoCodec, pattern</h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Using video recording requires <a href="#video-recording">initial configuration</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To enable video recording for browser session, add:</p>
</div>
<div class="listingblock">
<div class="title">Type: boolean</div>
<div class="content">
<pre>enableVideo: true</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>By default, saved video files are named <code>video.mp4</code>. To provide custom video name specify:</p>
<div class="listingblock">
<div class="title">Type: string</div>
<div class="content">
<pre>videoName: "my-cool-video.mp4"</pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
It is important to add <code>mp4</code> file extension.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>By default, the entire screen picture is being recorded. Specifying <code>screenResolution</code> capability changes recorded video size (width and height) accordingly. You can override video screen size by passing a capability. In case of <code>videoScreenSize</code> resolution is less than actual, screen on video will be trimmed starting from top-left corner:</p>
<div class="listingblock">
<div class="title">Type: string</div>
<div class="content">
<pre>videoScreenSize: "1024x768"</pre>
</div>
</div>
</li>
<li>
<p>Default video frame rate is <code>12</code> frames per second. Specifying <code>videoFrameRate</code> capability changes this value:</p>
<div class="listingblock">
<div class="title">Type: int</div>
<div class="content">
<pre>videoFrameRate: 24</pre>
</div>
</div>
</li>
<li>
<p>By default, Moon is using <code>libx264</code> codec for video output. If this codec is consuming too much CPU, you can change it using <code>videoCodec</code> capability:</p>
<div class="listingblock">
<div class="title">Type: string</div>
<div class="content">
<pre>videoCodec: "mpeg4"</pre>
</div>
</div>
</li>
<li>
<p>To organize <a href="#video-recording-s3-custom-layout">custom S3 layout</a> for every uploaded video - use <code>pattern</code> (or <code>s3KeyPattern</code>) capability:</p>
<div class="listingblock">
<div class="title">Type: string</div>
<div class="content">
<pre>pattern: "$quota/$browserName/$sessionId"</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="capability-env"><a class="anchor" href="#capability-env"></a>Per-session Environment Variables: env</h5>
<div class="paragraph">
<p>Sometimes you may want to set some environment variables for every test case (for example to test with different default locales). To achieve this pass one more capability:</p>
</div>
<div class="listingblock">
<div class="title">Type: array, format: &lt;key&gt;=&lt;value&gt;</div>
<div class="content">
<pre>env: ["LANG=ru_RU.UTF-8", "LANGUAGE=ru:en", "LC_ALL=ru_RU.UTF-8"]</pre>
</div>
</div>
<div class="paragraph">
<p>Environment variables from this capability are appended to variables from Moon configuration. In statically-typed languages like Java or C# you should use a List to pass this capability, e.g.:</p>
</div>
<div class="listingblock">
<div class="title">Passing env in Java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">capabilities.setCapability(<span class="string"><span class="delimiter">&quot;</span><span class="content">moon:options</span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">Map</span>.of(
    <span class="string"><span class="delimiter">&quot;</span><span class="content">env</span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">Arrays</span>.asList(<span class="string"><span class="delimiter">&quot;</span><span class="content">LANG=ru_RU.UTF-8</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">LANGUAGE=ru:en</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">LC_ALL=ru_RU.UTF-8</span><span class="delimiter">&quot;</span></span>)
));</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="capability-hosts"><a class="anchor" href="#capability-hosts"></a>Hosts Aliases: hosts</h5>
<div class="paragraph">
<p>Although you can configure a separate list of host aliases in <code>/etc/hosts</code> for every browser image in <a href="#browsers-set">browsers set</a> sometimes you may need to add more entries for particular test cases. This can be easily achieved with:</p>
</div>
<div class="listingblock">
<div class="title">Type: array, format: &lt;hostname&gt;:&lt;ip-address&gt;</div>
<div class="content">
<pre>hosts: ["example.com:192.168.0.1", "test.com:192.168.0.2"]</pre>
</div>
</div>
<div class="paragraph">
<p>Entries from this capability will be override <code>/etc/hosts</code> entries from browsers set.</p>
</div>
</div>
<div class="sect4">
<h5 id="capability-nameservers"><a class="anchor" href="#capability-nameservers"></a>Custom DNS Servers: nameservers</h5>
<div class="paragraph">
<p>By default, browser pods are using global Kubernetes DNS settings. Sometimes you may need to override used DNS servers list for particular test cases. This can be easily achieved with:</p>
</div>
<div class="listingblock">
<div class="title">Type: array, format: &lt;dns-ip-address&gt;</div>
<div class="content">
<pre>nameservers: ["192.168.0.1", "192.168.0.2"]</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="capability-sessionTimeout"><a class="anchor" href="#capability-sessionTimeout"></a>Custom Session Timeout: sessionTimeout</h5>
<div class="paragraph">
<p>Sometimes you may want to change <a href="#timeouts">idle timeout</a> for selected browser session. To achieve this - pass the following capability:</p>
</div>
<div class="listingblock">
<div class="title">Type: string</div>
<div class="content">
<pre>sessionTimeout: "1m30s"</pre>
</div>
</div>
<div class="paragraph">
<p>Timeout is always specified in Golang duration format, e.g. <code>30s</code> or <code>2m</code> or <code>1h2m30s</code> and so on.</p>
</div>
</div>
<div class="sect4">
<h5 id="capability-mobile-emulation"><a class="anchor" href="#capability-mobile-emulation"></a>Mobile Emulation: mobileDevice</h5>
<div class="paragraph">
<p>This capability configures desired mobile device <a href="#mobile-emulation">Mobile Emulation</a>:</p>
</div>
<div class="listingblock">
<div class="title">Type: object</div>
<div class="content">
<pre>"mobileDevice": {
    "deviceName": "Apple iPhone XR",
    "orientation": "landscape"
}</pre>
</div>
</div>
<div class="paragraph">
<p>To select which device to emulate use <code>deviceName</code> key:</p>
</div>
<div class="listingblock">
<div class="title">Type: string</div>
<div class="content">
<pre>deviceName: "Apple iPhone XR"</pre>
</div>
</div>
<div class="paragraph">
<p>To explicitly specify device screen orientation (portrait or landscape) use <code>orientation</code> key:</p>
</div>
<div class="listingblock">
<div class="title">Type: string</div>
<div class="content">
<pre>orientation: "landscape"</pre>
</div>
</div>
<div class="paragraph">
<p>Possible <code>orientation</code> values are: <code>portrait</code>, <code>vertical</code> (alias for <code>portrait</code>), <code>landscape</code>, <code>horizontal</code> (alias for <code>landscape</code>). In statically-typed languages like Java or C# you should use a Map to pass this capability, e.g.:</p>
</div>
<div class="listingblock">
<div class="title">Passing mobileDevice in Java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">capabilities.setCapability(<span class="string"><span class="delimiter">&quot;</span><span class="content">moon:options</span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">Map</span>.of(
    <span class="string"><span class="delimiter">&quot;</span><span class="content">mobileDevice</span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">Map</span>.of(
        <span class="string"><span class="delimiter">&quot;</span><span class="content">deviceName</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Apple iPhone XR</span><span class="delimiter">&quot;</span></span>,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">orientation</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">landscape</span><span class="delimiter">&quot;</span></span>
    )
));</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="capability-labels"><a class="anchor" href="#capability-labels"></a>Pod Labels: labels</h5>
<div class="paragraph">
<p>Sometimes you may want to pass additional metadata to every browser session: environment, VCS revision, build number, project name and so on. These labels can be then used to get various browser usage statistics.</p>
</div>
<div class="listingblock">
<div class="title">Type: map, format: "&lt;key&gt;": "&lt;value&gt;"</div>
<div class="content">
<pre>labels: {"project": "MyCoolProject", "build-number": "14353"}</pre>
</div>
</div>
<div class="paragraph">
<p>Labels from this capability override labels from browsers set. More information about labels is described in <a href="#browsers-set-custom-labels">Using Custom Kubernetes Labels</a> section.</p>
</div>
</div>
<div class="sect4">
<h5 id="capability-log-level"><a class="anchor" href="#capability-log-level"></a>Browser Log Level: logLevel</h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This feature is available since Moon 2.2.0.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>By default, Moon browsers output very limited quality of logs to decrease overall load on Kubernetes and log storage software. You can change logging verbosity using <code>logLevel</code> capability:</p>
</div>
<div class="listingblock">
<div class="title">Type: string</div>
<div class="content">
<pre>logLevel: "INFO"</pre>
</div>
</div>
<div class="paragraph">
<p>Supported browsers are: Google Chrome, Microsoft Edge, Opera and Firefox. Possible values for this capability depend on browser type:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 5. Supported log levels for Chrome, Microsoft Edge and Opera</caption>
<colgroup>
<col style="width: 100%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Capability value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ALL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DEBUG</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">INFO</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">WARNING</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SEVERE</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OFF</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 6. Supported log levels for Firefox</caption>
<colgroup>
<col style="width: 100%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Capability value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fatal</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">error</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">warn</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">info</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">config</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">debug</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">trace</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="capability-additional-fonts"><a class="anchor" href="#capability-additional-fonts"></a>Enable Additional Fonts: additionalFonts</h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>This feature is available since Moon 2.2.1.</p>
</li>
<li>
<p>This feature is enabled automatically when launching manual session from Moon UI.</p>
</li>
<li>
<p>When this feature is enabled additional fonts are copied to browser container for every new pod, so browsers can start a bit slower.</p>
</li>
</ol>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>By default, Moon browsers do not provide support for Chinese, Japanese, Thai and other languages. To enable additional fonts containing these symbols add one more capability:</p>
</div>
<div class="listingblock">
<div class="title">Type: boolean</div>
<div class="content">
<pre>additionalFonts: true</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="capability-context"><a class="anchor" href="#capability-context"></a>Additional Browser Data: context</h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>This feature is available since Moon 2.3.0.</p>
</li>
</ol>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This capability allows to efficiently upload arbitrary files to browser pod. All required files are packed to a <code>*.tar.gz</code> archive and capability value should contain a download URL to this archive. Detailed description and examples can be found <a href="#selenium-context">here</a>.</p>
</div>
<div class="listingblock">
<div class="title">Type: string</div>
<div class="content">
<pre>context: "https://example.com/browser-data.tar.gz"</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="selenium-headless"><a class="anchor" href="#selenium-headless"></a>2.2.2. Headless Mode</h4>
<div class="paragraph">
<p>By default, all browsers in Moon are started with visible browser window. The majority of browsers nowadays support so-called "headless" mode, when browser is opening pages in the background and no window is visible to the user. Usually such mode is enabled by passing <code>--headless</code> flag to browser startup command in Selenium capabilities.</p>
</div>
<div class="listingblock">
<div class="title">Starting Chrome browser in headless mode</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">capabilities = {
    <span class="string"><span class="delimiter">&quot;</span><span class="content">browserName</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">chrome</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">&quot;</span><span class="content">google:chromeOptions</span><span class="delimiter">&quot;</span></span>: {
        <span class="string"><span class="delimiter">&quot;</span><span class="content">args</span><span class="delimiter">&quot;</span></span>: [<span class="string"><span class="delimiter">&quot;</span><span class="content">--headless</span><span class="delimiter">&quot;</span></span>]
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Moon automatically detects when browser is started in headless mode. Headless browsers do not require any graphical components like X-server or window manager, so Moon does not start such components when not needed. Because of this feature, there is no need to additionally pass <code>enableVNC</code> capability to show browser screen in Moon user interface.</p>
</div>
</div>
<div class="sect3">
<h4 id="selenium-video-recording"><a class="anchor" href="#selenium-video-recording"></a>2.2.3. Video Recording</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Using video recording requires <a href="#video-recording">initial configuration</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When video recording is configured, recording a video of Selenium session is as easy as adding one capability to your test:</p>
</div>
<div class="listingblock">
<div class="title">Enabling video in Selenium capabilities</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">capabilities = {
    <span class="string"><span class="delimiter">&quot;</span><span class="content">moon:options</span><span class="delimiter">&quot;</span></span>: {
        <span class="string"><span class="delimiter">&quot;</span><span class="content">enableVideo</span><span class="delimiter">&quot;</span></span>: <span class="predefined-constant">True</span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can optionally add other <a href="#capability-video-recording">capabilities</a> to change recorded video name, screen size, frame rate and so on.</p>
</div>
</div>
<div class="sect3">
<h4 id="mobile-emulation"><a class="anchor" href="#mobile-emulation"></a>2.2.4. Mobile Emulation</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>This feature is supported in Moon 1.8.0 and above.</p>
</li>
<li>
<p>This feature works with Chrome browser only.</p>
</li>
<li>
<p>Testing mobile applications is not possible.</p>
</li>
</ol>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Running automated tests in mobile platforms is nowadays very important. Using a set of real devices connected to server via USB requires too much work to deploy and maintain. Running Android Emulators requires hardware server or virtual machines with nested virtualization enabled. Running iOS Simulators requires to have Apple hardware. Even with correct computing resources tests are slower than on desktop platforms and consume slightly more CPUs and memory per browser.</p>
</div>
<div class="paragraph">
<p>Your goal however is catching bugs and not deploying complicated browser automation infrastructure. There are a lot of cases when a bug related to mobile version of tested web application can be reproduced simply by having exactly the same screen size and <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/User-Agent">User-Agent</a> HTTP header being sent by browser. This feature is already available in Chromium-based browsers and is called <strong>Mobile Emulation</strong>.</p>
</div>
<div class="paragraph">
<p>Example capabilities to enable this functionality are shown below:</p>
</div>
<div class="listingblock">
<div class="title">Mobile Emulation in Java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ChromeOptions options = <span class="keyword">new</span> ChromeOptions();
options.setCapability(<span class="string"><span class="delimiter">&quot;</span><span class="content">browserVersion</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">96.0</span><span class="delimiter">&quot;</span></span>);
options.setCapability(<span class="string"><span class="delimiter">&quot;</span><span class="content">moon:options</span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">Map</span>.of(
    <span class="string"><span class="delimiter">&quot;</span><span class="content">mobileDevice</span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">Map</span>.of(
        <span class="string"><span class="delimiter">&quot;</span><span class="content">deviceName</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Apple iPhone XR</span><span class="delimiter">&quot;</span></span>,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">orientation</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">landscape</span><span class="delimiter">&quot;</span></span>,
    )));</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Mobile Emulation in Python</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">capabilities = {
    <span class="string"><span class="delimiter">&quot;</span><span class="content">browserName</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">chrome</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">&quot;</span><span class="content">browserVersion</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">96.0</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">&quot;</span><span class="content">moon:options</span><span class="delimiter">&quot;</span></span>: {
        <span class="string"><span class="delimiter">&quot;</span><span class="content">mobileDevice</span><span class="delimiter">&quot;</span></span>: {
            <span class="string"><span class="delimiter">&quot;</span><span class="content">deviceName</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Apple iPhone XR</span><span class="delimiter">&quot;</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">orientation</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">landscape</span><span class="delimiter">&quot;</span></span>
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Moon comes with a preconfigured list of supported devices stored in <a href="#devices-set">devices set</a>. Full list of available devices is available in <a href="#mobile-emulation-devices">Supported Mobile Devices</a> section. In order to add your own mobile devices definitions - simply update this list.</p>
</div>
</div>
<div class="sect3">
<h4 id="clipboard"><a class="anchor" href="#clipboard"></a>2.2.5. Accessing Clipboard</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Clipboard is accessible only when browser session is running.</p>
</li>
<li>
<p>Only <a href="https://en.wikipedia.org/wiki/Portable_Network_Graphics">PNG</a> image format is supported.</p>
</li>
<li>
<p>This functionality is working out of the box in <a href="https://github.com/aerokube/lightning-java">Lightning</a> client.</p>
</li>
</ol>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Sometimes you may need to interact with the clipboard to check that your application copy-paste feature works. Moon has a dedicated API to interact with the clipboard:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Start a new session, for example with ID <code>firefox-95-0-f2bcd32b-d932-4cdc-a639-687ab8e4f840</code>.</p>
</li>
<li>
<p>To get clipboard value send the following HTTP request:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ curl -H 'Accept: application/json' https://moon.example.com/wd/hub/session/firefox-95-0-f2bcd32b-d932-4cdc-a639-687ab8e4f840/aerokube/clipboard

{&quot;value&quot;: &quot;some-clipboard-value&quot;, &quot;media&quot;: &quot;&quot;}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If clipboard contains an image, then response will contain <a href="https://en.wikipedia.org/wiki/Base64">Base64</a>-encoded image bytes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{<span class="key"><span class="delimiter">&quot;</span><span class="content">value</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">iVBORw0KGgoAAAAN....</span><span class="delimiter">&quot;</span></span>, <span class="key"><span class="delimiter">&quot;</span><span class="content">media</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">image/png</span><span class="delimiter">&quot;</span></span>}</code></pre>
</div>
</div>
</li>
<li>
<p>To update clipboard with text value:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ curl -X POST -H 'Content-Type: application/json' --data '{&quot;value&quot;: &quot;some-clipboard-value&quot;}' https://moon.example.com/wd/hub/session/firefox-95-0-f2bcd32b-d932-4cdc-a639-687ab8e4f840/aerokube/clipboard</code></pre>
</div>
</div>
</li>
<li>
<p>To update clipboard with image value, send <a href="https://en.wikipedia.org/wiki/Base64">Base64</a>-encoded image bytes and :</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ curl -X POST -H 'Content-Type: application/json' --data '{&quot;value&quot;: &quot;iVBORw0KGgoAAAAN....&quot;, &quot;media&quot;: &quot;image/png&quot;}' https://moon.example.com/wd/hub/session/firefox-95-0-f2bcd32b-d932-4cdc-a639-687ab8e4f840/aerokube/clipboard</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="uploading-files"><a class="anchor" href="#uploading-files"></a>2.2.6. Uploading Files to Browser</h4>
<div class="paragraph">
<p>Uploading files to browser is a built-in Selenium feature supported in the majority of Selenium clients. How to do this in different programming languages is shown below:</p>
</div>
<div class="listingblock">
<div class="title">Uploading files with <a href="https://github.com/seleniumhq/selenium">standard Java client</a></div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// Find file input element</span>
WebElement input = driver.findElement(By.cssSelector(<span class="string"><span class="delimiter">&quot;</span><span class="content">input[type='file']</span><span class="delimiter">&quot;</span></span>));

<span class="comment">// Make sure element is visible</span>
((JavascriptExecutor) driver).executeScript(<span class="string"><span class="delimiter">&quot;</span><span class="content">arguments[0].style.display = 'block';</span><span class="delimiter">&quot;</span></span>, input);

<span class="comment">// Configure your client to upload local files to remote Selenium instance</span>
driver.setFileDetector(<span class="keyword">new</span> LocalFileDetector());

<span class="comment">// Specify you local file path here (not path inside browser container!)</span>
input.sendKeys(<span class="string"><span class="delimiter">&quot;</span><span class="content">/path/to/file/on/machine/which/runs/tests</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Uploading files with <a href="https://github.com/aerokube/lightning-java">Lightning</a> Java client</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// Find file input element</span>
WebElement fileInput = driver.elements().findFirst(By.cssSelector(<span class="string"><span class="delimiter">&quot;</span><span class="content">input[type='file']</span><span class="delimiter">&quot;</span></span>));

<span class="comment">// Upload file</span>
Path fileToUpload = Paths.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">/path/to/file/on/machine/which/runs/tests</span><span class="delimiter">&quot;</span></span>);
<span class="predefined-type">String</span> fileRemotePath = driver.document().uploadFile(fileToUpload);

<span class="comment">// Set file input field value to remote uploaded file path</span>
fileInput.sendKeys(fileRemotePath);</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Uploading files with Python</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">from</span> <span class="include">selenium.webdriver.remote.file_detector</span> <span class="keyword">import</span> <span class="include">LocalFileDetector</span>

<span class="comment"># ...</span>

<span class="comment"># Find input field</span>
input = driver.find_element_by_css_selector(<span class="string"><span class="delimiter">&quot;</span><span class="content">input[type='file']</span><span class="delimiter">&quot;</span></span>)

<span class="comment"># Make sure it is visible</span>
driver.execute_script(<span class="string"><span class="delimiter">&quot;</span><span class="content">arguments[0].style.display = 'block';</span><span class="delimiter">&quot;</span></span>, <span class="predefined">input</span>)

<span class="comment"># Upload file</span>
driver.file_detector = LocalFileDetector()
<span class="predefined">input</span>.send_keys(<span class="string"><span class="delimiter">&quot;</span><span class="content">/path/to/file/on/machine/which/runs/tests</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Uploading files with C#</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="csharp">// Create driver instance
ChromeOptions options = new ChromeOptions();
IWebDriver driver = new RemoteWebDriver(new Uri(&quot;https://moon.example.com/wd/hub&quot;), options);

// Open page
driver.Navigate().GoToUrl(&quot;https://example.com/&quot;);

// Upload file
IAllowsFileDetection allowsDetection = (IAllowsFileDetection)driver;
allowsDetection.FileDetector = new LocalFileDetector();
driver.FindElement(By.Id(&quot;uploadfile_0&quot;)).SendKeys(&quot;/tmp/file.txt&quot;);</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Uploading files with <a href="https://github.com/webdriverio/webdriverio/">Webdriver.io</a></div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><span class="keyword">var</span> filePath = path.join(<span class="string"><span class="delimiter">'</span><span class="content">/path/to/file/on/machine/which/runs/tests</span><span class="delimiter">'</span></span>);
<span class="keyword">var</span> remoteFilePath = browser.uploadFile(filePath);
<span class="predefined">$</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">input[type='file']</span><span class="delimiter">&quot;</span></span>).setValue(remoteFilePath);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="selenium-context"><a class="anchor" href="#selenium-context"></a>2.2.7. Providing Additional Browser Data</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>This feature is available since Moon 2.3.0.</p>
</li>
<li>
<p>Only <code>*.tar.gz</code> archives are supported. We do not support regular <code>*.zip</code> archives because of performance issues.</p>
</li>
</ol>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Often when working with a browser you may need to use additional data: browser extensions, test files to be uploaded, browser settings files (also known as <code>browser profile</code>) and so on. In standard Selenium every such additional file is uploaded with different code snippet. The most important thing is that anyway all such data is being uploaded as HTTP request body. Every time you send file like this your Selenium implementation needs to read all the bytes into memory and this dramatically increases memory consumption. A lot more efficient way of delivering the same functionality is packing all required files to a single archive (e.g. on your CI server). An URL to this archive is then sent as a Selenium capability, thus allowing every browser session to download it before actually launching the browser. We call an archive like this a <code>browser context</code> and respective capability is named just <code>context</code>:</p>
</div>
<div class="listingblock">
<div class="title">Type: string</div>
<div class="content">
<pre>context: https://example.com/browser-data.tar.gz</pre>
</div>
</div>
<div class="paragraph">
<p>When you provide <code>context</code> capability, Moon will download an archive and unpack it to <code>/home/&lt;user&gt;</code> directory, where <code>&lt;user&gt;</code> is name of the user configured in <a href="#configuration-object">configuration object</a>. Default username is just <code>user</code>, so default directory is <code>/home/user/</code>.</p>
</div>
<div class="listingblock">
<div class="title">How archive is unpacked</div>
<div class="content">
<pre>browser-data.tar.gz    ===&gt;     /home/user
|                               |
---- some-file.txt              ---- some-file.txt
---- some-directory             ---- some-directory
     |                               |
     ---- another-file.xpi           ---- another-file.xpi
     ---- one-more-file.png          ---- one-more-file.png</pre>
</div>
</div>
<div class="paragraph">
<p>To create an archive with browser context:</p>
</div>
<div class="listingblock">
<div class="title">Creating an archive with browser context</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ tar cvzf browser-data.tar.gz some-file.txt some-directory # Add an arbitrary number of files and directories here</code></pre>
</div>
</div>
<div class="paragraph">
<p>Possible use cases of this feature include:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Uploading files to browser.</strong> You pack any test files and just set their path to file input fields or open them in the browser.</p>
<div class="listingblock">
<div class="title">Capabilities to upload test files to browser</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">browserName</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">chrome</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">moon:options</span><span class="delimiter">&quot;</span></span>:{<span class="key"><span class="delimiter">&quot;</span><span class="content">context</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">https://example.com/browser-data.tar.gz</span><span class="delimiter">&quot;</span></span>}
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The same as HTTP request:</p>
</div>
<div class="listingblock">
<div class="title">An HTTP request to upload test files to browser</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ curl https://moon.example.com/wd/hub/session -d'{&quot;capabilities&quot;:{&quot;alwaysMatch&quot;:{&quot;browserName&quot;:&quot;chrome&quot;, &quot;moon:options&quot;:{&quot;context&quot;:&quot;https://example.com/browser-data.tar.gz&quot;}}}}'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now just use unpacked files in your Selenium code:</p>
</div>
<div class="listingblock">
<div class="title">Using uploaded files from context</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// Find file input element</span>
WebElement input = driver.findElement(By.cssSelector(<span class="string"><span class="delimiter">&quot;</span><span class="content">input[type='file']</span><span class="delimiter">&quot;</span></span>));

<span class="comment">// Specify path of the file from context directory</span>
input.sendKeys(<span class="string"><span class="delimiter">&quot;</span><span class="content">/home/user/some-directory/one-more-file.png</span><span class="delimiter">&quot;</span></span>);

<span class="comment">// You can also open files from context directory in browser</span>
driver.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">file:///home/user/some-file.txt</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
</li>
<li>
<p><strong>Using browser extensions.</strong> You repack your extension (<code>extension.crx</code>) to the archive (<code>extension.tar.gz</code>) and then load it using browser command-line flags. To repack extension:</p>
<div class="listingblock">
<div class="title">How to repack extension to <code>*.tar.gz</code></div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ unzip extension.crx -d extension # The same works for *.xpi as both are zip archives
$ tar cvzf extension.tar.gz extension</code></pre>
</div>
</div>
<div class="paragraph">
<p>Respective capabilities can look like this:</p>
</div>
<div class="listingblock">
<div class="title">Capabilities to use a browser extension</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">browserName</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">chrome</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">goog:chromeOptions</span><span class="delimiter">&quot;</span></span>:{
    <span class="key"><span class="delimiter">&quot;</span><span class="content">args</span><span class="delimiter">&quot;</span></span>:[
      <span class="string"><span class="delimiter">&quot;</span><span class="content">--disable-extensions-except=/home/user/extension</span><span class="delimiter">&quot;</span></span>,
      <span class="string"><span class="delimiter">&quot;</span><span class="content">--load-extension=/home/user/extension</span><span class="delimiter">&quot;</span></span>
    ]
  },
  <span class="key"><span class="delimiter">&quot;</span><span class="content">moon:options</span><span class="delimiter">&quot;</span></span>:{<span class="key"><span class="delimiter">&quot;</span><span class="content">context</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">https://example.com/extension.tar.gz</span><span class="delimiter">&quot;</span></span>}
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The same as HTTP request:</p>
</div>
<div class="listingblock">
<div class="title">An HTTP request to use browser extension</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ curl https://moon.example.com/wd/hub/session -d'{&quot;capabilities&quot;:{&quot;alwaysMatch&quot;:{&quot;browserName&quot;:&quot;chrome&quot;, &quot;goog:chromeOptions&quot;:{&quot;args&quot;:[&quot;--disable-extensions-except=/home/user/extensions&quot;,&quot;--load-extension=/home/user/extensions&quot;]}, &quot;moon:options&quot;:{&quot;context&quot;:&quot;https://example.com/extensions.tar.gz&quot;}}}}'</code></pre>
</div>
</div>
</li>
<li>
<p><strong>Overriding browser profile.</strong> You pack a directory with browser profile (<code>profile</code>) to the archive (<code>profile.tar.gz</code>) and then load it using browser command-line flags. Respective capabilities for Chrome can look like this:</p>
<div class="listingblock">
<div class="title">Capabilities to override Chrome profile</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">browserName</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">chrome</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">goog:chromeOptions</span><span class="delimiter">&quot;</span></span>:{
    <span class="key"><span class="delimiter">&quot;</span><span class="content">args</span><span class="delimiter">&quot;</span></span>:[<span class="string"><span class="delimiter">&quot;</span><span class="content">--user-data-dir=/home/user/profile</span><span class="delimiter">&quot;</span></span>]
  },
  <span class="key"><span class="delimiter">&quot;</span><span class="content">moon:options</span><span class="delimiter">&quot;</span></span>:{<span class="key"><span class="delimiter">&quot;</span><span class="content">context</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">https://example.com/profile.tar.gz</span><span class="delimiter">&quot;</span></span>}
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The same as HTTP request:</p>
</div>
<div class="listingblock">
<div class="title">An HTTP request to override Chrome profile</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ curl https://moon.example.com/wd/hub/session -d'{&quot;capabilities&quot;:{&quot;alwaysMatch&quot;:{&quot;browserName&quot;:&quot;chrome&quot;, &quot;goog:chromeOptions&quot;:{&quot;args&quot;:[&quot;--user-data-dir=/home/user/profile&quot;]}, &quot;moon:options&quot;:{&quot;context&quot;:&quot;https://example.com/profile.tar.gz&quot;}}}}'</code></pre>
</div>
</div>
<div class="paragraph">
<p>For Firefox approach remains the same but command-line flags differ:</p>
</div>
<div class="listingblock">
<div class="title">Capabilities to override Firefox profile</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">browserName</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">firefox</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">moz:firefoxOptions</span><span class="delimiter">&quot;</span></span>:{
    <span class="key"><span class="delimiter">&quot;</span><span class="content">args</span><span class="delimiter">&quot;</span></span>:[<span class="string"><span class="delimiter">&quot;</span><span class="content">-profile</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">/home/user/profile</span><span class="delimiter">&quot;</span></span>]
  },
  <span class="key"><span class="delimiter">&quot;</span><span class="content">moon:options</span><span class="delimiter">&quot;</span></span>:{<span class="key"><span class="delimiter">&quot;</span><span class="content">context</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">https://example.com/profile.tar.gz</span><span class="delimiter">&quot;</span></span>}
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The same as HTTP request:</p>
</div>
<div class="listingblock">
<div class="title">An HTTP request to override Firefox profile</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ curl https://moon.example.com/wd/hub/session -H'Content-Type: application/json' -d'{&quot;capabilities&quot;:{&quot;alwaysMatch&quot;:{&quot;browserName&quot;:&quot;firefox&quot;, &quot;moz:firefoxOptions&quot;:{&quot;args&quot;:[&quot;-profile&quot;,&quot;/home/user/profile&quot;]}, &quot;moon:options&quot;:{&quot;context&quot;:&quot;https://example.com/profile.tar.gz&quot;}}}}'</code></pre>
</div>
</div>
</li>
<li>
<p><strong>Overriding various user settings.</strong> Previously we understood that browser context archive is unpacked to user home directory in browser pod. You can use this to override various operating system configuration files (<code>~/.bashrc</code>, <code>~/.gtkrc-3.0</code> to e.g. turn off cursor blinking) and directories (<code>~/.ssh</code>, <code>~/.gpg</code> and so on).</p>
</li>
<li>
<p><strong>Emulating web camera video.</strong> You upload a video file to browser pod and then use it as fake web camera video. You start by preparing a fake video:</p>
<div class="listingblock">
<div class="title">Converting an *.mp4 video to *.y4m</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ mkdir webcam-video
$ ffmpeg -i my-video.mp4 -vf hflip -pix_fmt yuv420p -s 1280x720 webcam-video/webcam-video.y4m</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then you add resulting video to an archive:</p>
</div>
<div class="listingblock">
<div class="title">Creating an archive with video</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ tar cvzf webcam-video.tar.gz webcam-video</code></pre>
</div>
</div>
<div class="paragraph">
<p>Having an archive you can now create a Chrome session with the following capabilities:</p>
</div>
<div class="listingblock">
<div class="title">Capabilities for Chrome web camera emulation</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">browserName</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">chrome</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">goog:chromeOptions</span><span class="delimiter">&quot;</span></span>:{
    <span class="key"><span class="delimiter">&quot;</span><span class="content">args</span><span class="delimiter">&quot;</span></span>:[
      <span class="string"><span class="delimiter">&quot;</span><span class="content">--disable-gpu</span><span class="delimiter">&quot;</span></span>,
      <span class="string"><span class="delimiter">&quot;</span><span class="content">--use-fake-ui-for-media-stream</span><span class="delimiter">&quot;</span></span>,
      <span class="string"><span class="delimiter">&quot;</span><span class="content">--use-fake-device-for-media-stream</span><span class="delimiter">&quot;</span></span>,
      <span class="string"><span class="delimiter">&quot;</span><span class="content">--use-file-for-fake-video-capture=/home/user/webcam-video/webcam-video.y4m</span><span class="delimiter">&quot;</span></span>
    ]
  },
  <span class="key"><span class="delimiter">&quot;</span><span class="content">moon:options</span><span class="delimiter">&quot;</span></span>:{<span class="key"><span class="delimiter">&quot;</span><span class="content">context</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">https://example.com/webcam-video.tar.gz</span><span class="delimiter">&quot;</span></span>}
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The same as HTTP request:</p>
</div>
<div class="listingblock">
<div class="title">An HTTP request to emulate web camera in Chrome</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ curl https://moon.example.com/wd/hub/session -H'Content-Type: application/json' -d'{&quot;capabilities&quot;:{&quot;alwaysMatch&quot;:{&quot;browserName&quot;:&quot;chrome&quot;, &quot;goog:chromeOptions&quot;:{&quot;args&quot;:[&quot;--disable-gpu&quot;, &quot;--use-fake-ui-for-media-stream&quot;, &quot;--use-fake-device-for-media-stream&quot;, &quot;--use-file-for-fake-video-capture=/home/user/webcam-video/webcam-video.y4m&quot;]},&quot;moon:options&quot;:{&quot;context&quot;:&quot;https://example.com/webcam-video.tar.gz&quot;}}}'</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="accessing-downloaded-files"><a class="anchor" href="#accessing-downloaded-files"></a>2.2.8. Accessing Files Downloaded with Browser</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Files are accessible only when browser session is running.</p>
</li>
<li>
<p>This functionality is working out of the box in <a href="https://github.com/aerokube/lightning-java">Lightning</a> client.</p>
</li>
</ol>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Your tests may need to download files with browsers. To analyze these files a common requirement is then to somehow extract downloaded files from browser containers. Moon provides an API to work with such files:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Start a new session, for example with ID <code>firefox-95-0-f2bcd32b-d932-4cdc-a639-687ab8e4f840</code>.</p>
</li>
<li>
<p>In tests code save all files to <code>/home/&lt;user&gt;/Downloads</code> directory, where <code>&lt;user&gt;</code> is name of the user configured in <a href="#configuration-object">configuration object</a>. Default username is just <code>user</code>, so default directory is <code>/home/user/Downloads</code>.</p>
</li>
<li>
<p>To list available files:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">curl -H 'Accept: application/json' https://moon.example.com/wd/hub/session/firefox-95-0-f2bcd32b-d932-4cdc-a639-687ab8e4f840/aerokube/download/

[&quot;myfile.txt&quot;, &quot;another-file.png&quot;]</code></pre>
</div>
</div>
</li>
<li>
<p>Access any file contents using the following URL:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">curl https://moon.example.com/wd/hub/session/firefox-95-0-f2bcd32b-d932-4cdc-a639-687ab8e4f840/aerokube/download/myfile.txt

file-contents-go-here</code></pre>
</div>
</div>
</li>
<li>
<p>To delete a file:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">curl -X DELETE https://moon.example.com/wd/hub/session/firefox-95-0-f2bcd32b-d932-4cdc-a639-687ab8e4f840/aerokube/download/myfile.txt</code></pre>
</div>
</div>
</li>
<li>
<p>Close the session</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="selenium-devtools"><a class="anchor" href="#selenium-devtools"></a>2.2.9. Accessing Developer Tools</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>This feature works in Moon 2.1.0 and above.</p>
</li>
<li>
<p>This feature requires to create a Selenium session first. If you need to use developer tools with tools like <a href="https://pptr.dev/">Puppeteer</a> - take a look at the following <a href="#devtools">documentation section</a>.</p>
</li>
<li>
<p>This feature needs full cluster URL in order to work properly. Make sure your Ingress configuration is proxying <code>X-Forwarded-Host</code>, <code>X-Forwarded-Port</code> and <code>X-Forwarded-Scheme</code> HTTP headers. In some cases such as using <a href="https://aws.amazon.com/elasticloadbalancing/application-load-balancer/">AWS ALB</a> or accessing Moon without Ingress, proxying headers above is not possible. In that case you have to set Moon <code>-callback-url</code> <a href="#cli-flags-moon">flag</a> to correct cluster address, e.g. <code>-callback-url <a href="https://moon.example.com/" class="bare">https://moon.example.com/</a></code>.</p>
</li>
</ol>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Selenium 4 and above has <a href="https://www.selenium.dev/documentation/webdriver/bidirectional/">bidirectional functionality</a> allowing to access advanced browser features. This works just out of the box. An example project demonstrating how to use it stored <a href="https://github.com/aerokube/moon-cloud-java-example/blob/master/src/test/java/com/aerokube/selenoid/DevtoolsTest.java">here</a>.</p>
</div>
<div class="paragraph">
<p>Moon 1.x and Selenoid <a href="https://aerokube.com/selenoid/latest/#_accessing_browser_developer_tools">have</a> custom <code>/devtools/</code> API allowing direct access to browser using <a href="https://chromedevtools.github.io/devtools-protocol/">Chrome Developer Tools Protocol</a>. For backwards compatibility this is also supported in Moon 2.x. In <a href="https://www.w3.org/TR/webdriver/">W3C WebDriver</a> standard Selenium extension commands should be located under vendor prefix, so having a Selenium session ID to access this API in Moon 2 you have to use URL like this:</p>
</div>
<div class="listingblock">
<div class="title">Old-style Chrome Developer Tools access URL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">wss://moon.example.com/session/&lt;session-id&gt;/aerokube/devtools</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="selenium-locale"><a class="anchor" href="#selenium-locale"></a>2.2.10. Changing Browser Locale</h4>
<div class="paragraph">
<p>In some test cases you may need to override preferred browser locale. You can do this with standard Selenium capabilities. How to override locale depends on browser.</p>
</div>
<div class="sect4">
<h5 id="selenium-locale-firefox"><a class="anchor" href="#selenium-locale-firefox"></a>Firefox</h5>
<div class="listingblock">
<div class="title">Overriding Browser Locale in Firefox</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">FirefoxOptions options = <span class="keyword">new</span> FirefoxOptions();
options.setCapability(<span class="string"><span class="delimiter">&quot;</span><span class="content">browserVersion</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">75.0</span><span class="delimiter">&quot;</span></span>);
options.addPreference(<span class="string"><span class="delimiter">&quot;</span><span class="content">intl.accept_languages</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">de</span><span class="delimiter">&quot;</span></span>);
WebDriver driver = <span class="keyword">new</span> RemoteWebDriver(<span class="keyword">new</span> <span class="predefined-type">URL</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">https://moon.example.com/wd/hub</span><span class="delimiter">&quot;</span></span>), options);</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="selenium-locale-chromium"><a class="anchor" href="#selenium-locale-chromium"></a>Chromium-based Browsers</h5>
<div class="listingblock">
<div class="title">Overriding Browser Locale in Chromium-based Browsers</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ChromeOptions options = <span class="keyword">new</span> ChromeOptions();
options.setCapability(<span class="string"><span class="delimiter">&quot;</span><span class="content">browserVersion</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">81.0</span><span class="delimiter">&quot;</span></span>);
options.setCapability(<span class="string"><span class="delimiter">&quot;</span><span class="content">moon:options</span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">Map</span>.of(
    <span class="string"><span class="delimiter">&quot;</span><span class="content">env</span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">Arrays</span>.asList(<span class="string"><span class="delimiter">&quot;</span><span class="content">LANG=de_AT.UTF-8</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">LANGUAGE=at:de</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">LC_ALL=de_AT.UTF-8</span><span class="delimiter">&quot;</span></span>)
));
WebDriver driver = <span class="keyword">new</span> RemoteWebDriver(<span class="keyword">new</span> <span class="predefined-type">URL</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">https://moon.example.com/wd/hub</span><span class="delimiter">&quot;</span></span>), options);</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="selenium-time-zone"><a class="anchor" href="#selenium-time-zone"></a>2.2.11. Changing Browser Time Zone</h4>
<div class="paragraph">
<p>A common testing task is checking that your web application behaves as expected in different <a href="https://en.wikipedia.org/wiki/Time_zone">time zones</a>. Depending on tested web application one of the following approaches can help.</p>
</div>
<div class="sect4">
<h5 id="selenium-time-zone-tz-env"><a class="anchor" href="#selenium-time-zone-tz-env"></a>Option 1: Setting TZ environment variable</h5>
<div class="paragraph">
<p>A typical approach for overriding time zone in Linux is setting <a href="https://www.gnu.org/software/libc/manual/html_node/TZ-Variable.html">TZ</a> environment variable. To do this in Moon - you just need to set <a href="#capability-env">env</a> capability in your code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ChromeOptions options = <span class="keyword">new</span> ChromeOptions();

capabilities.setCapability(<span class="string"><span class="delimiter">&quot;</span><span class="content">moon:options</span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">Map</span>.of(
    <span class="string"><span class="delimiter">&quot;</span><span class="content">env</span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">Arrays</span>.asList(<span class="string"><span class="delimiter">&quot;</span><span class="content">TZ=America/New_York</span><span class="delimiter">&quot;</span></span>) <span class="comment">// This is where you set TZ variable with values like &quot;America/New_York&quot; or &quot;Europe/London&quot;</span>
));

WebDriver driver = <span class="keyword">new</span> RemoteWebDriver(<span class="keyword">new</span> <span class="predefined-type">URL</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">https://moon.example.com/wd/hub</span><span class="delimiter">&quot;</span></span>), options);

driver.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">https://dateful.com/time-zone-converter</span><span class="delimiter">&quot;</span></span>); <span class="comment">// An example web site that respects TZ setting</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>When you set time zone like this, web application can fetch your time zone information using <a href="https://stackoverflow.com/questions/1091372/getting-the-clients-time-zone-and-offset-in-javascript">Javascript Time API</a>. The main problem with this approach is that not all web applications are using it. So if it does not work - then try the next option.</p>
</div>
</div>
<div class="sect4">
<h5 id="selenium-time-zone-geolocation"><a class="anchor" href="#selenium-time-zone-geolocation"></a>Option 2: Overriding Browser Geolocation</h5>
<div class="paragraph">
<p>Some web applications are applying time zone settings by analyzing browser geolocation information using <a href="https://developer.mozilla.org/en-US/docs/Web/API/Geolocation_API">Javascript Geolocation API</a>. If setting time zone directly does not work, you may try to override geolocation API coordinates:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ChromeOptions options = <span class="keyword">new</span> ChromeOptions();
WebDriver driver = <span class="keyword">new</span> RemoteWebDriver(<span class="keyword">new</span> <span class="predefined-type">URL</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">https://moon.example.com/wd/hub</span><span class="delimiter">&quot;</span></span>), options);
driver = <span class="keyword">new</span> Augmenter().augment(driver);

DevTools devTools = ((HasDevTools) driver).getDevTools();
devTools.createSession();

<span class="comment">// Location of London (change this to 40.715502419712244, -74.00597334074466 for New York)</span>
devTools.send(Emulation.setGeolocationOverride(Optional.of(<span class="float">51.495930861102245</span>),
        Optional.of(<span class="float">0.010205721644136127</span>),
        Optional.of(<span class="integer">1</span>)));

driver.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">https://google.com</span><span class="delimiter">&quot;</span></span>);
WebElement element = driver.findElement(By.name(<span class="string"><span class="delimiter">&quot;</span><span class="content">q</span><span class="delimiter">&quot;</span></span>));
Actions actionProvider = <span class="keyword">new</span> Actions(driver);
<span class="predefined-type">Action</span> select = actionProvider
        .sendKeys(<span class="string"><span class="delimiter">&quot;</span><span class="content">what is my time zone</span><span class="char">\n</span><span class="delimiter">&quot;</span></span>)
        .build();
select.perform();</code></pre>
</div>
</div>
<div class="paragraph">
<p>In some rare cases when both options do not work, this can be a signal that your web application is detecting your time zone by comparing your IP address with IP addresses geolocation database. In that case you may need to configure your browser to go through a proxy server physically located in desired geographic region.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="selenium-external-host"><a class="anchor" href="#selenium-external-host"></a>2.2.12. Using External Hosts</h4>
<div class="paragraph">
<p>Moon expects to run the majority of browsers in pods inside Kubernetes or Openshift cluster. However sometimes you may need to run Selenium tests on some external hosts: hardware servers or virtual machines. Mainly this could be needed in two situations:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Running Selenium tests on complicated platforms such as MacOS or iOS. According to license agreement these platforms require Apple hardware devices, and it is complicated to run Kubernetes on top of these devices.</p>
</li>
<li>
<p>Using Selenium online platforms for some browsers. In that case you can run the majority of browsers (e.g. Firefox, Chrome, Opera) in Moon and complicated browsers (don&#8217;t work on standard virtual machines) such as Chrome Mobile or real devices in external Selenium platform.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>To use external hosts you should have the following:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>A set of hosts with Selenium-compatible solution (Selenoid, Appium, Selenium Grid, etc.): <code>host1.example.com:4444</code>, <code>host1.example.com:4444</code> and so on.</p>
</li>
<li>
<p><strong>Optionally</strong> a <a href="https://en.wikipedia.org/wiki/Virtual_Network_Computing">VNC</a> server listening on every such host on standard port <code>5900</code>. Every VNC server should be password protected with the same password having 8+ characters.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>For every browser type you need to add the following to <a href="#browsers-set">browsers set</a>:</p>
</div>
<div class="listingblock">
<div class="title">Sending requests to external hosts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">selenium</span>:
    <span class="key"><span class="delimiter">&quot;</span><span class="content">internet explorer</span><span class="delimiter">&quot;</span></span>:
      <span class="key">default</span>: <span class="string"><span class="content">1.0.0</span></span>
      <span class="key">repository</span>: <span class="string"><span class="content">aerokube/moon-external-host</span></span>
      <span class="key">env</span>:
        - <span class="string"><span class="content">name: URLS</span></span>
          <span class="key">value</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">[\\\&quot;http://host1.example.com:4444/\\\&quot;, \\\&quot;http://host2.example.com:4444/\\\&quot;]</span><span class="delimiter">&quot;</span></span> <span class="comment"># A list of external hosts</span>
        - <span class="string"><span class="content">name: VNC_PASSWORD</span></span>
          <span class="key">value</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">myvncpassword</span><span class="delimiter">&quot;</span></span> <span class="comment"># At least 8 symbols</span>
      ]</code></pre>
</div>
</div>
<div class="paragraph">
<p>With such configuration Selenium session requests with be randomly load-balanced across the hosts specified in <code>URLS</code> environment variable. VNC feature should also work - you should be seeing remote host screen in Moon UI.</p>
</div>
</div>
<div class="sect3">
<h4 id="selenium-proxy"><a class="anchor" href="#selenium-proxy"></a>2.2.13. Using Proxy Servers</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Using proxy with username and password is available since Moon 2.5.0.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In some cases you may need to configure launched browser to go through some proxy server. Selenium WebDriver protocol <a href="https://www.w3.org/TR/webdriver/#proxy">supports</a> standard capabilities to configure proxy server for any browser. For example:</p>
</div>
<div class="listingblock">
<div class="title">Configuring proxy settings for a browser with raw capabilities</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ChromeOptions options = <span class="keyword">new</span> ChromeOptions();
<span class="predefined-type">String</span> proxyHost = <span class="string"><span class="delimiter">&quot;</span><span class="content">proxy.example.com:3128</span><span class="delimiter">&quot;</span></span>;
capabilities.setCapability(<span class="string"><span class="delimiter">&quot;</span><span class="content">proxy</span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">Map</span>.of(
    <span class="string"><span class="delimiter">&quot;</span><span class="content">proxyType</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">manual</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">&quot;</span><span class="content">httpProxy</span><span class="delimiter">&quot;</span></span>, proxyHost,
    <span class="string"><span class="delimiter">&quot;</span><span class="content">sslProxy</span><span class="delimiter">&quot;</span></span>, proxyHost,
));
WebDriver driver = <span class="keyword">new</span> RemoteWebDriver(<span class="keyword">new</span> <span class="predefined-type">URL</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">https://moon.example.com/wd/hub</span><span class="delimiter">&quot;</span></span>), options);</code></pre>
</div>
</div>
<div class="paragraph">
<p>For some programming languages there is a wrapper object called <code>Proxy</code> allowing to set the same value in more type-safe way:</p>
</div>
<div class="listingblock">
<div class="title">Configuring proxy settings for a browser with Proxy object</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ChromeOptions options = <span class="keyword">new</span> ChromeOptions();
<span class="predefined-type">Proxy</span> proxy = <span class="keyword">new</span> <span class="predefined-type">Proxy</span>();
<span class="predefined-type">String</span> proxyHost = <span class="string"><span class="delimiter">&quot;</span><span class="content">proxy.example.com:3128</span><span class="delimiter">&quot;</span></span>;
proxy
    .setProxyType(<span class="predefined-type">Proxy</span>.ProxyType.MANUAL)
    .setHttpProxy(proxyHost)
    .setSslProxy(proxyHost);
options.setProxy(proxy);
WebDriver driver = <span class="keyword">new</span> RemoteWebDriver(<span class="keyword">new</span> <span class="predefined-type">URL</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">https://moon.example.com/wd/hub</span><span class="delimiter">&quot;</span></span>), options);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Very often proxy servers require to provide username and password for authentication. While the majority of Selenium implementations don&#8217;t work with such proxy servers, Moon allows to configure authentication out of the box, using the same capabilities - simply add username and password to proxy host value (<code>username:password@host:port</code>):</p>
</div>
<div class="listingblock">
<div class="title">Configuring proxy settings with authentication</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ChromeOptions options = <span class="keyword">new</span> ChromeOptions();
<span class="comment">// Note username:password on the line below</span>
<span class="predefined-type">String</span> proxyHost = <span class="string"><span class="delimiter">&quot;</span><span class="content">username:password@proxy.example.com:3128</span><span class="delimiter">&quot;</span></span>;
capabilities.setCapability(<span class="string"><span class="delimiter">&quot;</span><span class="content">proxy</span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">Map</span>.of(
    <span class="string"><span class="delimiter">&quot;</span><span class="content">proxyType</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">manual</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">&quot;</span><span class="content">httpProxy</span><span class="delimiter">&quot;</span></span>, proxyHost,
    <span class="string"><span class="delimiter">&quot;</span><span class="content">sslProxy</span><span class="delimiter">&quot;</span></span>, proxyHost,
));
WebDriver driver = <span class="keyword">new</span> RemoteWebDriver(<span class="keyword">new</span> <span class="predefined-type">URL</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">https://moon.example.com/wd/hub</span><span class="delimiter">&quot;</span></span>), options);</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="cypress"><a class="anchor" href="#cypress"></a>2.3. Using Cypress</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>This feature is supported in Moon 1.9.0 and above.</p>
</li>
<li>
<p>No changes in Cypress project are required.</p>
</li>
<li>
<p>An example project demonstrating this feature can be found <a href="https://github.com/aerokube/moon-cloud-cypress-example">here</a>.</p>
</li>
</ol>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Moon is able to run <a href="https://github.com/cypress-io/cypress/">Cypress</a> tests out of the box. To do this:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Install a tool allowing to execute Cypress tests remotely:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ npm install @aerokube/cypress-moon</code></pre>
</div>
</div>
</li>
<li>
<p>Run your tests against Moon cluster:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ cd /path/to/my-test-project
my-test-project$ cypress-moon https://moon.example.com/cypress/chrome</code></pre>
</div>
</div>
<div class="paragraph">
<p>Each call of <code>cypress-moon</code> command will start a new browser in Moon.</p>
</div>
</li>
</ol>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If your Moon instance is running behind <a href="https://kubernetes.io/docs/concepts/services-networking/ingress/">Ingress</a> then correct URL would usually be: <code><a href="https://moon.example.com/cypress/chrome" class="bare">https://moon.example.com/cypress/chrome</a></code>.</p>
</li>
<li>
<p>Running Cypress tests requires sending compressed project to Moon. If your Cypress project is big and Moon is running behind Ingress you may need to increase maximum HTTP request body size. For example <a href="https://github.com/kubernetes/ingress-nginx">Nginx Ingress Controller</a> requires the following annotation to be added:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">nginx.ingress.kubernetes.io/proxy-body-size</span>: <span class="string"><span class="content">128m</span></span></code></pre>
</div>
</div>
</li>
</ol>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Cypress compared to Selenium has no <a href="https://www.w3.org/TR/webdriver/#capabilities">capabilities</a> concept. The only way to request an exact browser type or additional features is passing all these requirements in HTTP endpoint URL. Next section describes supported URL naming conventions.</p>
</div>
<div class="sect3">
<h4 id="cypress-select-browser"><a class="anchor" href="#cypress-select-browser"></a>2.3.1. Selecting Requested Browser</h4>
<div class="paragraph">
<p>You can request one of browsers supported by Cypress (<code>chrome</code>, <code>chromium</code>, <code>edge</code>, <code>electron</code> or <code>firefox</code>) by specifying its name in URL. By default, Moon will use <code>browsers/cypress-&lt;browser-name&gt;:latest</code> public image.</p>
</div>
<div class="listingblock">
<div class="title">Requesting Chrome (<code>browsers/cypress-chrome:latest</code> image)</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ cypress-moon https://moon.example.com/cypress/chrome</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Requesting Chromium (<code>browsers/cypress-chromium:latest</code> image)</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ cypress-moon https://moon.example.com/cypress/chromium</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Requesting Electron (<code>browsers/cypress-electron:latest</code> image)</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ cypress-moon https://moon.example.com/cypress/electron</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Requesting Microsoft Edge (<code>browsers/cypress-edge:latest</code> image)</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ cypress-moon https://moon.example.com/cypress/edge</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Requesting Firefox (<code>browsers/cypress-firefox:latest</code> image)</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ cypress-moon https://moon.example.com/cypress/firefox</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="cypress-select-cypress-version"><a class="anchor" href="#cypress-select-cypress-version"></a>2.3.2. Selecting Exact Cypress Version</h4>
<div class="paragraph">
<p>Cypress API can change from version to version. Because of that it is recommended to make sure that Cypress version being used in your project corresponds to Cypress version in browser image. To use an image compatible with exact Cypress version - add this version as follows:</p>
</div>
<div class="listingblock">
<div class="title">Selecting an image compatible to Cypress 7.3.0 (<code>browsers/cypress-electron:cypress-7.3.0</code> image)</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ cypress-moon https://moon.example.com/cypress/electron/cypress-7.3.0</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="cypress-video-recording"><a class="anchor" href="#cypress-video-recording"></a>2.3.3. Video Recording</h4>
<div class="paragraph">
<p>To enable <a href="#video-recording">video recording</a> - simply add <code>enableVideo</code> parameter to URL:</p>
</div>
<div class="listingblock">
<div class="title">Enabling video recording</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ cypress-moon https://moon.example.com/cypress/electron/cypress-7.3.0?headless=false&amp;enableVideo=true</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can optionally add other <a href="#cypress-additional-features">parameters</a> to change recorded video name, screen size, frame rate and so on.</p>
</div>
</div>
<div class="sect3">
<h4 id="cypress-additional-features"><a class="anchor" href="#cypress-additional-features"></a>2.3.4. Enabling Additional Features</h4>
<div class="paragraph">
<p>In addition to selecting Cypress version - you can enable additional features like changing screen resolution, passing custom test name and so on. All these optional features are set by adding parameters to URL:</p>
</div>
<div class="listingblock">
<div class="title">Adding parameters to enable additional features</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ cypress-moon https://moon.example.com/cypress/electron/cypress-7.3.0?noExit=true&amp;headless=false&amp;env=LANG%3Dde_AT.UTF-8&amp;env=LANGUAGE%3Dat:de</code></pre>
</div>
</div>
<div class="paragraph">
<p>Full list of supported parameters and their meaning is shown below.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 7. Supported parameters for enabling additional features</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter name</th>
<th class="tableblock halign-left valign-top">Possible values</th>
<th class="tableblock halign-left valign-top">Default value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">additionalFonts</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code> or <code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable <a href="#capability-additional-fonts">additional fonts</a> for Chinese, Japanese, Thai and other languages.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">configFile</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Custom Cypress configuration file</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not set</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Path to custom Cypress <a href="https://docs.cypress.io/guides/references/configuration">configuration file</a>. <strong>Supported for Cypress 9.0.0 and above.</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">enableVideo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code> or <code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable video recording.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">env</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Environment variables</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not set</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">One or more environment variables that will be visible to the browser. Can be passed multiple times: <code>env=LANG%3Dde_AT.UTF-8&amp;env=LANGUAGE%3Dat:de</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">headless</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code> or <code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to run browser in headless mode.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">host</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A typical <code>/etc/hosts</code> entry in format <code>www.example.com:127.0.0.1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not set</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows to explicitly add <code>/etc/hosts</code> entries. Can be passed multiple times.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">label</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kubernetes pod labels</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not set</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">One or more <a href="#browsers-set-custom-labels">custom Kubernetes labels</a> that will be added to browser pod. Can be passed multiple times: <code>label=first-label%3Dsome-value&amp;env=another-label%3Danother-value</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any human-readable string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not set</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows to set custom test name (same meaning as <code>name</code> Selenium capability).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nameserver</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DNS server name, e.g. <code>ns1.example.com</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not set</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows to explicitly set one or several DNS servers for browser. Can be passed multiple times.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">noExit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code> or <code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to leave container running after executing all tests. Mainly needed for debugging purposes.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">pattern</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A string with placeholders</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$quota/$browserName/$sessionId</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A custom S3 key <a href="#video-recording-s3-custom-layout">pattern</a> used to save videos to S3 bucket.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">screenResolution</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1280x1024</code> or <code>1280x1024x24</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1920x1080x24</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets resolution of the desktop where browser is running. <strong>Use Cypress methods to set browser window size.</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spec</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cypress test spec file name (e.g. <code>cypress/integration/my-spec.js</code>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not set</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows to run one or more concrete test files. Can be passed multiple times.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">videoCodec</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Codec to be used for video encoding, e.g. <code>mpeg4</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>libx264</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows to change codec used for video recording.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">videoFrameRate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Positive number</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Recorded video frame rate.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">videoName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Video file name with extension</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>video.mp4</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Recorded video file name.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">videoScreenSize</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1280x1024</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Equals to <code>screenResolution</code> value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Recorded video screen size. If value is smaller than <code>screenResolution</code>, then video will be cropped.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="cypress-dashboard"><a class="anchor" href="#cypress-dashboard"></a>2.3.5. Recording Runs to Cypress Dashboard</h4>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
This feature works with Cypress images 9.6.0 and above.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Cypress provides <a href="https://www.cypress.io/dashboard/">Cypress Dashboard</a> - an online service for storing test runs information. To send information about executed tests to this service you have to send your access key using <code>CYPRESS_RECORD_KEY</code> environment variable:</p>
</div>
<div class="listingblock">
<div class="title">Adding parameters to enable additional features</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ cypress-moon https://moon.example.com/cypress/chrome/cypress-9.6.0?&amp;env=CYPRESS_RECORD_KEY%3Dyour-key</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="playwright"><a class="anchor" href="#playwright"></a>2.4. Using Playwright</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>An example project demonstrating this feature can be found <a href="https://github.com/aerokube/moon-cloud-playwright-example">here</a>.</p>
</li>
</ol>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Moon is able to run browser images for <a href="https://github.com/microsoft/playwright">Playwright</a> framework out of the box. An example Playwright test that will work with Moon looks like the following:</p>
</div>
<div class="listingblock">
<div class="title">An example Playwright test working with Moon</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript">const { firefox } = require(<span class="string"><span class="delimiter">'</span><span class="content">playwright</span><span class="delimiter">'</span></span>);

(async () =&gt; {
  const browser = await firefox.connect({ <span class="key">timeout</span>: <span class="integer">0</span>, <span class="key">wsEndpoint</span>: <span class="string"><span class="delimiter">'</span><span class="content">wss://moon.example.com/playwright/firefox/playwright-1.23.3</span><span class="delimiter">'</span></span> });
  const page = await browser.newPage();
  await page.<span class="reserved">goto</span>(<span class="string"><span class="delimiter">'</span><span class="content">https://aerokube.com/moon/</span><span class="delimiter">'</span></span>);
  await page.screenshot({ <span class="key">path</span>: <span class="error">`</span>screenshot.png<span class="error">`</span> });
  await browser.close();
})();</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can see that the only difference from standard Playwright example is a web socket endpoint URL. Playwright compared to Selenium has no <a href="https://www.w3.org/TR/webdriver/#capabilities">capabilities</a> concept. The only way to request an exact browser version or environment variables is passing all these requirements in websocket endpoint URL. Next section describes supported URL naming conventions.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If your Moon instance is accessible over <a href="https://en.wikipedia.org/wiki/HTTPS">HTTPS</a> connection (e.g. <code><a href="https://moon.example.com/" class="bare">https://moon.example.com/</a></code> instead of <code><a href="http://moon.example.com/" class="bare">http://moon.example.com/</a></code>) then endpoint URL should start with <code>wss://</code> instead of <code>ws://</code> (e.g. <code>wss://moon.example.com/</code>).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="playwright-select-browser"><a class="anchor" href="#playwright-select-browser"></a>2.4.1. Selecting Requested Browser</h4>
<div class="paragraph">
<p>You can request one of browsers supported by Playwright (<code>chrome</code>, <code>chromium</code>, <code>firefox</code>  or <code>webkit</code>) by specifying its name in URL. By default, Moon will use <code>quay.io/playwright-&lt;browser-name&gt;</code> repository to download images. Currently, Playwright API can change from version to version. Because of that it is recommended to make sure that Playwright client version being used in your code corresponds to Playwright server version in browser image. To use an image compatible with exact Playwright version - add this version as follows:</p>
</div>
<div class="listingblock">
<div class="title">Requesting Chromium (<code>quay.io/browser/playwright-chromium:playwright-1.23.3</code> image)</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">wss://moon.example.com/playwright/chromium/playwright-1.23.3</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Requesting Chrome (<code>quay.io/browser/playwright-chrome:playwright-1.23.3</code> image)</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">wss://moon.example.com/playwright/chrome/playwright-1.23.3</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Requesting Firefox (<code>quay.io/browser/playwright-firefox:playwright-1.23.3</code> image)</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">wss://moon.example.com/playwright/firefox/playwright-1.23.3</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Requesting Webkit (<code>quay.io/browser/playwright-webkit:playwright-1.23.3</code> image)</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">wss://moon.example.com/playwright/webkit/playwright-1.23.3</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="playwright-video-recording"><a class="anchor" href="#playwright-video-recording"></a>2.4.2. Video Recording</h4>
<div class="paragraph">
<p>To enable <a href="#video-recording">video recording</a> - simply add <code>enableVideo</code> parameter to URL:</p>
</div>
<div class="listingblock">
<div class="title">Enabling video recording</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">wss://moon.example.com:4444/playwright/firefox/playwright-1.23.3?headless=false&amp;enableVideo=true</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can optionally add other <a href="#playwright-additional-features">parameters</a> to change recorded video name, screen size, frame rate and so on.</p>
</div>
</div>
<div class="sect3">
<h4 id="playwright-context"><a class="anchor" href="#playwright-context"></a>2.4.3. Additional Browser Data</h4>
<div class="paragraph">
<p>Similarly to Selenium, you can make browser pod automatically download arbitrary files as a single archive and unpack them to user directory. This feature is described in detail <a href="#selenium-context">here</a>. The main particularity in Playwright is that archive URL is being passed as Playwright <code>context</code> URL parameter and thus needs to be <a href="https://en.wikipedia.org/wiki/Percent-encoding">URL encoded</a>.</p>
</div>
<div class="listingblock">
<div class="title">Enabling browser context</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">wss://moon.example.com:4444/playwright/chrome/playwright-1.23.3?context=http%3A%2F%2Fexample.com%2Fbrowser-data.tar.gz</code></pre>
</div>
</div>
<div class="paragraph">
<p>For example to upload a browser extension:</p>
</div>
<div class="listingblock">
<div class="title">Enabling browser context</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><span class="keyword">var</span> browser = await chromium.connect({ <span class="key">timeout</span>: <span class="integer">0</span>, <span class="key">wsEndpoint</span>: <span class="string"><span class="delimiter">'</span><span class="content">wss://moon.example.com/playwright/chrome/playwright-1.23.3?headless=false&amp;context=https%3A%2F%2Fexample.com%2Fextensions.tar.gz&amp;arg=--disable-extensions-except%3D%2Fhome%2Fuser%2Fextensions&amp;arg=--load-extension%3D%2Fhome%2Fuser%2Fextensions</span><span class="delimiter">'</span></span> });</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="playwright-additional-features"><a class="anchor" href="#playwright-additional-features"></a>2.4.4. Enabling Additional Features</h4>
<div class="paragraph">
<p>In addition to selecting browser and its version - you can enable additional features like using headless browser versions, passing environment variables and so on. All these optional features are set by adding parameters to URL:</p>
</div>
<div class="listingblock">
<div class="title">Adding parameters to enable additional features</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">wss://moon.example.com/playwright/chrome/playwright-1.23.3?headless=false&amp;arg=--use-gl</code></pre>
</div>
</div>
<div class="paragraph">
<p>Full list of supported parameters and their meaning is shown below.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 8. Supported parameters for enabling additional features</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter name</th>
<th class="tableblock halign-left valign-top">Possible values</th>
<th class="tableblock halign-left valign-top">Default value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">additionalFonts</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code> or <code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable <a href="#capability-additional-fonts">additional fonts</a> for Chinese, Japanese, Thai and other languages.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">arg</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Browser command-line arguments</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not set</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">One or more additional command-line arguments to be passed to browser. This parameter can be passed multiple times: <code>arg=--use-fake-ui-for-media-stream&amp;arg=--use-gl</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">context</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Browser context HTTP URL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not set</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An HTTP URL for <code>*.tar.gz</code> file with additional files you want to be available to browser (so-called <code>browser context</code>).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">devtools</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code> or <code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to show Chrome Developer Toolbar (only applicable to <code>chromium</code> browser).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">enableVideo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code> or <code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable video recording.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">env</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Environment variables</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not set</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">One or more environment variables that will be visible to the browser. Can be passed multiple times: <code>env=LANG%3Dde_AT.UTF-8&amp;env=LANGUAGE%3Dat:de</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">headless</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code> or <code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to run browser in headless mode.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">host</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A typical <code>/etc/hosts</code> entry in format <code>www.example.com:127.0.0.1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not set</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows to explicitly add <code>/etc/hosts</code> entries. Can be passed multiple times.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">label</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kubernetes pod labels</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not set</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">One or more <a href="#browsers-set-custom-labels">custom Kubernetes labels</a> that will be added to browser pod. Can be passed multiple times: <code>label=first-label%3Dsome-value&amp;env=another-label%3Danother-value</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any human-readable string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not set</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows to set custom test name (same meaning as <code>name</code> Selenium capability).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nameserver</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DNS server name, e.g. <code>ns1.example.com</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not set</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows to explicitly set one or several DNS servers for browser. Can be passed multiple times.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">pattern</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A string with placeholders</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$quota/$browserName/$sessionId</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A custom S3 key <a href="#video-recording-s3-custom-layout">pattern</a> used to save videos to S3 bucket.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">screenResolution</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1280x1024</code> or <code>1280x1024x24</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1920x1080x24</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets resolution of the desktop where browser is running. <strong>Use Playwright methods to set browser window size.</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">videoCodec</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Codec to be used for video encoding, e.g. <code>mpeg4</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>libx264</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows to change codec used for video recording.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">videoFrameRate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Positive number</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Recorded video frame rate.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">videoName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Video file name with extension</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>video.mp4</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Recorded video file name.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">videoScreenSize</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1280x1024</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Equals to <code>screenResolution</code> value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Recorded video screen size. If value is smaller than <code>screenResolution</code>, then video will be cropped.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="devtools"><a class="anchor" href="#devtools"></a>2.5. Using Chrome Developer Tools</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>This is feature is supported in Moon 1.7.0 and above.</p>
</li>
<li>
<p>This feature will work only for Chrome 63+.</p>
</li>
<li>
<p>We recommend using the most recent Chrome version possible.</p>
</li>
<li>
<p>An example project demonstrating this feature can be found <a href="https://github.com/aerokube/moon-cloud-puppeteer-example">here</a>.</p>
</li>
</ol>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Moon can automate browsers using <a href="https://chromedevtools.github.io/devtools-protocol/">Chrome Developer Tools Protocol</a>. This allows you to run tests in parallel using libraries like <a href="https://github.com/puppeteer/puppeteer">Puppeteer</a> or <a href="https://github.com/getgauge/taiko">Taiko</a>. In order to start a new browser with these tools - simply use the following URL:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">wss://moon.example.com/devtools/chrome</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If your Moon instance is accessible over <a href="https://en.wikipedia.org/wiki/HTTPS">HTTPS</a> connection (e.g. <code><a href="https://moon.example.com/" class="bare">https://moon.example.com/</a></code> instead of <code><a href="http://moon.example.com/" class="bare">http://moon.example.com/</a></code>) then URL should start with <code>wss://</code> instead of <code>ws://</code> (e.g. <code>wss://moon.example.com/</code>).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>An example Puppeteer test is shown below:</p>
</div>
<div class="listingblock">
<div class="title">Accessing Developer Tools API with Puppeteer</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript">const puppeteer = require(<span class="string"><span class="delimiter">'</span><span class="content">puppeteer-core</span><span class="delimiter">'</span></span>);
const host = <span class="string"><span class="delimiter">'</span><span class="content">moon.example.com</span><span class="delimiter">'</span></span>;
(async () =&gt; {
    const devtools = await puppeteer.connect(
        { <span class="key">timeout</span>: <span class="integer">0</span>, <span class="key">browserWSEndpoint</span>: <span class="error">`</span>wss:<span class="comment">//${host}/devtools/chrome` }</span>
    ); <span class="comment">// For every call of this method a new browser is started</span>
    const page = await devtools.newPage();
    await page.<span class="reserved">goto</span>(<span class="string"><span class="delimiter">'</span><span class="content">https://aerokube.com</span><span class="delimiter">'</span></span>);
    await page.screenshot({<span class="key">path</span>: <span class="string"><span class="delimiter">'</span><span class="content">screenshot.png</span><span class="delimiter">'</span></span>});
    const title = await page.title();

    console.log(title);

    await devtools.close();
})();</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="devtools-select-browser"><a class="anchor" href="#devtools-select-browser"></a>2.5.1. Selecting Requested Browser</h4>
<div class="paragraph">
<p>You can choose desired browser version by changing connection URL:</p>
</div>
<div class="listingblock">
<div class="title">Selecting Chrome version (<code>cdtp/chrome:85.0</code> image)</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">wss://moon.example.com/devtools/chrome/85.0</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="devtools-video-recording"><a class="anchor" href="#devtools-video-recording"></a>2.5.2. Video Recording</h4>
<div class="paragraph">
<p>To enable <a href="#video-recording">video recording</a> - simply add <code>enableVideo</code> parameter to URL:</p>
</div>
<div class="listingblock">
<div class="title">Enabling video recording</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">wss://moon.example.com/devtools/chrome/85.0?headless=false&amp;enableVideo=true</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can optionally add other <a href="#devtools-additional-features">parameters</a> to change recorded video name, screen size, frame rate and so on.</p>
</div>
</div>
<div class="sect3">
<h4 id="devtools-additional-features"><a class="anchor" href="#devtools-additional-features"></a>2.5.3. Enabling Additional Features</h4>
<div class="paragraph">
<p>You can enable additional features by changing connection URL:</p>
</div>
<div class="listingblock">
<div class="title">Adding parameters to enable additional features</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">wss://moon.example.com/devtools/chrome?headless=false&amp;nameserver=ns1.example.com</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 9. Supported parameters for enabling additional features</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter name</th>
<th class="tableblock halign-left valign-top">Possible values</th>
<th class="tableblock halign-left valign-top">Default value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">additionalFonts</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code> or <code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable <a href="#capability-additional-fonts">additional fonts</a> for Chinese, Japanese, Thai and other languages.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">arg</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Browser command-line arguments</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not set</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">One or more additional command-line arguments to be passed to browser. This parameter can be passed multiple times: <code>arg=--use-fake-ui-for-media-stream&amp;arg=--use-gl</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">devtools</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code> or <code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to show Chrome Developer Toolbar.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">enableVideo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code> or <code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable video recording</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">env</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Environment variables</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not set</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">One or more environment variables that will be visible to the browser. Can be passed multiple times: <code>env=LANG%3Dde_AT.UTF-8&amp;env=LANGUAGE%3Dat:de</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">headless</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code> or <code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to run browser in headless mode.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">host</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A typical <code>/etc/hosts</code> entry in format <code>www.example.com:127.0.0.1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not set</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows to explicitly add <code>/etc/hosts</code> entries. Can be passed multiple times.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">label</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kubernetes pod labels</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not set</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">One or more <a href="#browsers-set-custom-labels">custom Kubernetes labels</a> that will be added to browser pod. Can be passed multiple times: <code>label=first-label%3Dsome-value&amp;env=another-label%3Danother-value</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any human-readable string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not set</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows to set custom test name.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nameserver</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DNS server name, e.g. <code>ns1.example.com</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not set</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows to explicitly set one or several DNS servers for browser. Can be passed multiple times.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">pattern</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A string with placeholders</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$quota/$browserName/$sessionId</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A custom S3 key <a href="#video-recording-s3-custom-layout">pattern</a> used to save videos to S3 bucket.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">screenResolution</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1280x1024</code> or <code>1280x1024x24</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1920x1080x24</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets resolution of the desktop where browser is running.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">videoCodec</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Codec to be used for video encoding, e.g. <code>mpeg4</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>libx264</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows to change codec used for video recording.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">videoFrameRate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Positive number</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Recorded video frame rate.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">videoName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Video file name with extension</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>video.mp4</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Recorded video file name.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">videoScreenSize</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1280x1024</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Equals to <code>screenResolution</code> value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Recorded video screen size. If value is smaller than <code>screenResolution</code>, then video will be cropped.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configuration"><a class="anchor" href="#configuration"></a>3. Configuration</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="license"><a class="anchor" href="#license"></a>3.1. License Key</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>According to license agreement you can use <strong>up to 4 parallel sessions</strong> for free and for unlimited period of time. If you wish to have more parallel sessions - order a license key. This section describes how to list and install license keys. A limited duration trial license key with more parallel sessions can be generated on <a href="https://aerokube.com/moon/">Moon website</a>.</p>
</li>
</ol>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A typical license key is a text file with <strong>*.key</strong> extension that looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ cat license.key
MG1RSVdpc2Z6YjdQQVZjd2lpei9KMkd1T3dzMTFuL1dlRjVSc3NOMUcxZk9QaUxWa3Q5SnBIakIxa09wWm0vVFJqQ0tsa21xVG1OODVRZnlQbjBjVmRHVWFLampTOFF1a3VLRXRPcEUwbnEySG16QWFQWHRDYTVjMm9jZzZFaUJqeFd5ODE4UFBHZzNCNWpCYXlha3oweFBscFl1RnB0V0U1Q3FwOGl5VDdKTk9abG5aSmlPdnRmZDFvSG1nNnVwVXBLV2E4RmYwWHcreERIR29ZTE1XTldPb1hvT2ZCUnZpcDhPWW05a1FqN0hBWWVOYUtLT1lPWlVJa1dsb1gxdjNOT1htTFpZalhsQ3h1Q3V6NWhiQjIwSjVIY0JTYnZybm9zYm14RXFkSFpQWVBKWUlKTzZvVlBnODhQeFErZ1EyTk5sWG82TC9XeXU3aisrNU0rSEdPcXlOSEdlNGx4Zm1nNVhjMWlnNkN1OCtNSVVYRzNqUllqOUY4ZHdReWpSbFNMNmFpL2dRQnc3TzY0U0lwdVF2d29jYi9kVzFSYWFRVkd3ZXYrOVdING8zRWRrYkVONUhRTmQ2MUxsUnFNdmtKeWVHV21tVlVUZ2dsMDRsTFFLTmZNVG81L2JVakNBMGhNeER5VHNJdmVRRGFMMklvTWpvcFk4VERlK1U2bUJvUDVxNVYrcCtDQVhjbjYxQlRaUVp0bmNqL0JBVkdNOEZ4NW9rWHRYSVAxUkY0a1VCckZVTDFyTWF1VkZqSk5xU1pLT293dUpMTTg2SEZ0Sld0eUlRK3ZZZm1pZU0xM292MnVleDBoRlhRdFkvMkt1dUhhN3dKV2pFT0pqaEVzTjhXSy82ZlFFbi9EQzcrNkw3NzhlbmVVZ2lLZ3VFbjlMMXZMYVZ5VWtQaWc9O2V5SnNhV05sYm5ObFpTSTZJa1JsWm1GMWJIUWlMQ0p3Y205a2RXTjBJam9pVFc5dmJpSXNJbTFoZUZObGMzTnBiMjV6SWpvMGZRPT0=</code></pre>
</div>
</div>
<div class="paragraph">
<p>In Moon 1.x license key was stored in <a href="https://kubernetes.io/docs/concepts/configuration/secret/">Kubernetes secret</a> and was mounted to Moon pod as a regular file. In Moon 2.x license keys (or just <code>licenses</code>) are stored in <a href="https://kubernetes.io/docs/concepts/extend-kubernetes/api-extension/custom-resources/">custom Kubernetes resource</a>.</p>
</div>
<div class="sect3">
<h4 id="license-list"><a class="anchor" href="#license-list"></a>3.1.1. Listing License Keys</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Contrarily to other resources introduced by Moon, licenses are stored <strong>cluster-wide</strong>. Thus, you don&#8217;t need to provide namespace name in the following commands (<code>-n moon</code> is not needed).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To list available licenses:</p>
</div>
<div class="listingblock">
<div class="title">Listing licenses (free license key output)</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ kubectl get licenses
NAME   LICENSEE   SESSIONS   EXPIRES   STATUS   NAMESPACE
moon   Default    4          Never     Ok       moon</code></pre>
</div>
</div>
<div class="paragraph">
<p>The output above is shown when the free license key is used. Columns meaning is as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Name</strong>. License key object name.</p>
</li>
<li>
<p><strong>Licensee</strong>. License key owner name. Usually equals to company name, e.g. <code>Acme LLC</code>. For free license key with 4 parallel sessions equals to <code>Default</code>.</p>
</li>
<li>
<p><strong>Sessions</strong>. Maximum number of browser sessions available in this license key.</p>
</li>
<li>
<p><strong>Expires</strong>. The number of days this license key expires in. Equals to <code>Already</code> when license key already expired and equals to <code>Never</code> if license key never expires.</p>
</li>
<li>
<p><strong>Status</strong>. License key status. Can be one of: <code>Ok</code> - license key is active, <code>Expired</code> - license key has expired, <code>Broken</code> - invalid license key data was provided.</p>
</li>
<li>
<p><strong>Namespace</strong>. Name of Kubernetes namespace where this license key is used.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You may have multiple custom Kubernetes resources named <code>license</code>. In that case in order to work with Moon licenses - simply use fully qualified resource name:</p>
</div>
<div class="listingblock">
<div class="title">Listing licenses (longer and fully qualified resource name)</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ kubectl get licenses.moon
NAME   LICENSEE   SESSIONS   EXPIRES   STATUS   NAMESPACE
moon   Default    4          Never     Ok       moon

$ kubectl get licenses.moon.aerokube.com
NAME   LICENSEE   SESSIONS   EXPIRES   STATUS   NAMESPACE
moon   Default    4          Never     Ok       moon</code></pre>
</div>
</div>
<div class="paragraph">
<p>To view a license key in YAML format:</p>
</div>
<div class="listingblock">
<div class="title">Showing license in YAML format</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ kubectl get license moon -o yaml
apiVersion: moon.aerokube.com/v1
kind: License
metadata:
  name: moon                        <i class="conum" data-value="1"></i><b>(1)</b>
  # Other Kubernetes metadata
spec:
  data: MG1RSVdpc2Z6YjdQQV....      <i class="conum" data-value="2"></i><b>(2)</b>
  namespace: moon                   <i class="conum" data-value="3"></i><b>(3)</b>
status:
  # Other keys and values</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>License key name</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>License key contents</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Namespace where this license key should be used</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="license-update"><a class="anchor" href="#license-update"></a>3.1.2. Updating a License Key</h4>
<div class="paragraph">
<p>To update an existing license key - simply update <code>data</code> field in respective license object:</p>
</div>
<div class="listingblock">
<div class="title">Updating license key</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ kubectl edit license moon # Replace data field with your new license key in text editor, save and exit</code></pre>
</div>
</div>
<div class="paragraph">
<p>When you update a license key - all changes are applied immediately. This usually also leads to graceful Moon pods restart (does not interrupt running browser sessions).</p>
</div>
</div>
<div class="sect3">
<h4 id="license-multiple"><a class="anchor" href="#license-multiple"></a>3.1.3. Multiple License Keys</h4>
<div class="paragraph">
<p>Moon 2.x <a href="#moon-operation-modes">supports</a> sharing the same license key among several Kubernetes namespaces and in the majority of cases a single license key should be enough. However, in some cases you may want to use a separate Moon instance and a separate license key for some teams. To achieve this:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#install">Deploy</a> two independent Moon clusters to namespace <code>ns1</code> and <code>ns2</code></p>
</li>
<li>
<p>Create two license objects with <code>namespace</code> field set to <code>ns1</code> and <code>ns2</code> and save them to file (e.g. <code>license-keys.yaml</code>):</p>
<div class="listingblock">
<div class="title">License keys to be created</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ cat license-keys.yaml
apiVersion: moon.aerokube.com/v1
kind: License
metadata:
  name: license-key-ns1
spec:
  data: &lt;license-key-1&gt;
  namespace: ns1
---
apiVersion: moon.aerokube.com/v1
kind: License
metadata:
  name: license-key-ns2
spec:
  data: &lt;license-key-2&gt;
  namespace: ns2</code></pre>
</div>
</div>
</li>
<li>
<p>Apply resulting file:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ kubectl apply -f license-keys.yaml</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>If you try to create two license keys with the same <code>data</code> field value, then one of them will be considered as a duplicate and automatically deleted.</p>
</li>
<li>
<p>If you have two different license keys with the same <code>namespace</code> field, then Moon will always choose the most recently created one.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>License keys will be applied automatically, and you will see the following in licenses list:</p>
<div class="listingblock">
<div class="title">Two license keys are applied</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ kubectl get licenses
NAME              LICENSEE    SESSIONS   EXPIRES   STATUS   NAMESPACE
license-key-ns1   Acme Inc.   10         32d       Ok       ns1
license-key-ns2   Acme Inc.   20         27d       Ok       ns2</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="license-delete"><a class="anchor" href="#license-delete"></a>3.1.4. Deleting a License Key</h4>
<div class="paragraph">
<p>To delete an existing license key - simply delete respective license object:</p>
</div>
<div class="listingblock">
<div class="title">Deleting license key</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ kubectl delete license moon</code></pre>
</div>
</div>
<div class="paragraph">
<p>When you delete the last license key with <code>namespace</code> field set to some Moon namespace, Moon will automatically fall back to the free license key with 4 parallel sessions included.</p>
</div>
</div>
<div class="sect3">
<h4 id="license-expiration"><a class="anchor" href="#license-expiration"></a>3.1.5. License Key Expiration</h4>
<div class="paragraph">
<p>There are several ways to always have active Moon license keys:</p>
</div>
<div class="sect4">
<h5 id="license-expiration-kubectl"><a class="anchor" href="#license-expiration-kubectl"></a>Option 1: Check Expiring License Keys with kubectl</h5>
<div class="paragraph">
<p>The easiest way to check for expiring or expired license keys is just listing them with <code>kubectl</code>:</p>
</div>
<div class="listingblock">
<div class="title">Listing license keys to understand when they expire</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ kubectl get licenses
NAME              LICENSEE    SESSIONS   EXPIRES   STATUS   NAMESPACE
license-key-ns1   Acme Inc.   10         32d       Ok       ns1
license-key-ns2   Acme Inc.   20         today     Ok       ns2</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can see that <strong>Expires</strong> column is showing the number of days remaining for every license key. When a license key expires the same command output will be:</p>
</div>
<div class="listingblock">
<div class="title">When one license key has expired</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ kubectl get licenses
NAME              LICENSEE    SESSIONS   EXPIRES   STATUS    NAMESPACE
license-key-ns1   Acme Inc.   10         32d       Ok        ns1
license-key-ns2   Acme Inc.   20         Already   Expired   ns2</code></pre>
</div>
</div>
<div class="paragraph">
<p>For expired license key <strong>Expires</strong> column will be set to <strong>Already</strong> and license key status will be <strong>Expired</strong>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You can also use Kubernetes API directly instead of <code>kubectl</code> to list license keys and find expiring or expired ones.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="license-expiration-prometheus"><a class="anchor" href="#license-expiration-prometheus"></a>Option 2: Use Prometheus License Key Expiration Metric</h5>
<div class="paragraph">
<p>Another possible way of getting license expiration information is using built-in Prometheus metric called <code>moon_license_expire</code>. This is described in detail in <a href="#monitoring">monitoring</a> section.</p>
</div>
<div class="listingblock">
<div class="title">Prometheus license key expiration metric</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ curl -s https://moon.example.com/metrics | grep license_expire
# HELP moon_license_expire Moon license expiration time.
# TYPE moon_license_expire gauge
moon_license_expire 1.6444512e+09</code></pre>
</div>
</div>
<div class="paragraph">
<p>These metrics are collected by Prometheus automatically, so you only need to configure alerts and charts if needed.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="license-ops"><a class="anchor" href="#license-ops"></a>3.1.6. Updating License Key From An External Secret</h4>
<div class="paragraph">
<p>In some cases you still may want to store license key in a <a href="https://kubernetes.io/docs/concepts/configuration/secret/">Kubernetes secret</a> and allow Moon to automatically read license key from this secret. To achieve this we provide a dedicated component called <code>license-ops</code>. This component is a <a href="https://kubernetes.io/docs/concepts/workloads/controllers/job/">Kubernetes job</a> that reads license key contents from configured secret and automatically updates custom Kubernetes resource being used by Moon. To enabled <code>license-ops</code> you need to install one more Helm chart:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Having Moon <a href="#install">installed</a>, create a regular Kubernetes secret in Moon namespace with license key contents:</p>
<div class="listingblock">
<div class="title">Example secret with license key</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">apiVersion</span>: <span class="string"><span class="content">v1</span></span>
<span class="key">kind</span>: <span class="string"><span class="content">Secret</span></span>
<span class="key">metadata</span>:
  <span class="key">name</span>: <span class="string"><span class="content">licensekey</span></span>
  <span class="key">namespace</span>: <span class="string"><span class="content">moon</span></span>
<span class="key">stringData</span>:
  <span class="key">license.key</span>: <span class="string"><span class="content">MG1RSVdpc2Z6....</span></span> <span class="comment"># Insert license key contents here</span></code></pre>
</div>
</div>
</li>
<li>
<p>Now install one more Helm chart (source code can be found <a href="https://github.com/aerokube/charts/tree/master/license-ops">here</a>):</p>
<div class="listingblock">
<div class="title">Installing license-ops Helm chart</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ helm upgrade --install -n moon license-ops aerokube/license-ops</code></pre>
</div>
</div>
<div class="paragraph">
<p>To change secret name, job schedule and other parameters - use Helm values:</p>
</div>
<div class="listingblock">
<div class="title">Updating license-ops parameters</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ helm upgrade --install --set secretName=mysecret --set schedule=&quot;0 * * * *&quot; -n moon license-ops aerokube/license-ops</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="users-quotas"><a class="anchor" href="#users-quotas"></a>3.2. Users and Quotas</h3>
<div class="sect3">
<h4 id="users"><a class="anchor" href="#users"></a>3.2.1. Users</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>By default, Moon is accessible without providing any credentials. This section describes how to configure Moon to require authentication. Usually this makes sense if you have multiple teams accessing the same cluster.</p>
</li>
<li>
<p>Moon is mainly handling browser session requests from your code being executed. This code is usually being maintained and executed by a team of engineers, so it is a bad practice to use real person access credentials in this code. Although, real person username and password can be useful for accessing Moon <a href="#user-interface">user interface</a>, program code will normally contain some service or robot account credentials being used by the entire team. So in this documentation we use terms <code>user</code> and <code>team</code> interchangeably, because Moon user credentials are often the entire team access credentials.</p>
</li>
<li>
<p>We recommend configuring <a href="https://en.wikipedia.org/wiki/Transport_Layer_Security">TLS encryption</a> when authentication is enabled. Otherwise, an attacker can capture network traffic between your computer and Moon cluster and extract your access credentials from this traffic.</p>
</li>
<li>
<p>Take a look at our <a href="https://blog.aerokube.com/selenium-securing-your-moon-cluster-in-kubernetes-and-openshift-92bde882a240">article about cluster security</a>. We describe TLS and basic authentication configuration there too.</p>
</li>
</ol>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Moon 2.x compared to Moon 1.x has <strong>no built-in authentication</strong> mechanism. This is because the recommended way to deliver authentication in Kubernetes is using available Ingress authentication features or sidecar containers delivering authentication. Moon reads username from <code>X-Moon-Quota</code> HTTP header being set by Ingress or sidecar container. The following sections describe possible authentication configurations.</p>
</div>
<div class="sect4">
<h5 id="users-basic-http"><a class="anchor" href="#users-basic-http"></a>Basic HTTP Authentication</h5>
<div class="paragraph">
<p>The most popular authentication method in browser automation now is the so-called <a href="https://en.wikipedia.org/wiki/Basic_access_authentication">basic HTTP authentication</a>. When using this method, username and password are expected to be passed in <code>Authorization</code> HTTP header:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Authorization: Basic base64("username:password")</pre>
</div>
</div>
<div class="paragraph">
<p>Also, the following URL notation is supported for using this type of authentication:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>https://username:password@example.com/</pre>
</div>
</div>
<div class="paragraph">
<p>The simplest way of providing the basic HTTP authentication is configuring Ingress. Below we describe several possible options of configuring basic HTTP authentication in Moon.</p>
</div>
<div class="sect5">
<h6 id="users-basic-http-nginx-automated"><a class="anchor" href="#users-basic-http-nginx-automated"></a>Option 1. Nginx Ingress Configured By Helm</h6>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>This approach works in Kubernetes and does not work in Openshift. Refer to <a href="#users-basic-http-openshift">Openshift</a> section for configuration instructions.</p>
</li>
<li>
<p>In this example we configure Moon to launch browsers in a separate Kubernetes namespace for every user. Existing Moon operation modes are described <a href="#moon-operation-modes">here</a>.</p>
</li>
<li>
<p>You should have permissions to create new Kubernetes namespaces. Detailed description of required Moon permissions is available <a href="#permissions-multiple-namespaces">here</a>.</p>
</li>
</ol>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">How Nginx Ingress Works</div>
<p><span class="image"><img src="img/users-nginx-ingress.png" alt="users-nginx-ingress"></span></p>
</div>
<div class="paragraph">
<p>The easiest way of getting a protected Moon cluster with multiple users enabled is using <a href="https://github.com/kubernetes/ingress-nginx">Nginx Ingress</a> instance automatically created by our Helm [chart](<a href="https://github.com/aerokube/charts" class="bare">https://github.com/aerokube/charts</a>):</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Add Aerokube <a href="https://github.com/aerokube/charts">charts</a> repository:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ helm repo add aerokube https://charts.aerokube.com/
$ helm repo update</code></pre>
</div>
</div>
</li>
<li>
<p>Create a <code>values.yaml</code> file with Ingress host and a list of users to be created:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">ingress</span>:
  <span class="key">host</span>: <span class="string"><span class="content">moon.example.com</span></span> <span class="comment"># Provide cluster hostname here</span>
<span class="key">quota</span>:
  <span class="key">moon</span>: <span class="string"><span class="content">null</span></span> <span class="comment"># This one is needed to disable single-namespace mode in Moon</span>
  <span class="key">alpha-team</span>:
    <span class="key">namespace</span>: <span class="string"><span class="content">alpha</span></span> <span class="comment"># Password for this team will be generated automatically</span>
  <span class="key">beta-team</span>:
    <span class="key">namespace</span>: <span class="string"><span class="content">beta</span></span>
    <span class="key">password</span>: <span class="string"><span class="content">beta-team-password</span></span> <span class="comment"># You can also set password value explicitly</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Depending on the number of users setting or not setting <code>password</code> field behaves differently:</p>
</div>
<div class="paragraph">
<p><strong>Option 1. You have only one user.</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>password</code> is missing: no authentication is configured.</p>
</li>
<li>
<p><code>password: ''</code> (empty string): authentication is configured, password is generated.</p>
</li>
<li>
<p><code>password: some-password</code>: authentication is configured, password is set to provided value.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Option 2. You have 2 or more users.</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>password</code> is missing or empty string: authentication is configured, password is generated.</p>
</li>
<li>
<p><code>password: some-password</code>: authentication is configured, password is set to provided value.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Deploy Moon with your <code>values.yaml</code> applied:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ helm upgrade --install -f values.yaml -n moon moon aerokube/moon2</code></pre>
</div>
</div>
</li>
<li>
<p>This will create a separate namespace for every team:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ kubectl get namespaces
NAME              STATUS   AGE
alpha              Active   40m
beta              Active   40m
# Other namespaces</code></pre>
</div>
</div>
<div class="paragraph">
<p>In every such namespace chart a secret with user password will be automatically created:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ kubectl get secrets -n alpha
NAME                            TYPE                                  DATA   AGE
alpha-team-basic-auth-password   Opaque                                1      2m11s
# Other secrets</code></pre>
</div>
</div>
<div class="paragraph">
<p>Password is stored in this secret. To print generated password value - simply extract <code>password</code> field (stored as <a href="https://en.wikipedia.org/wiki/Base64">Base64</a>) from the secret and decode it. A one line command how to do this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ kubectl get secret alpha-team-basic-auth-password -n alpha -o 'go-template={{index .data &quot;password&quot;}}' | base64 -d
8X4juoCQ9gHAACqbc05B3oPXUcV6Oxb7KNTSYdM15eYF</code></pre>
</div>
</div>
</li>
<li>
<p>Use quota name (<code>alpha-team</code>, <code>beta-team</code> and so on) as username and password from the secret. The same credentials should be used in your tests code and to access user interface. In multiple namespaces mode user interface is only showing browser sessions corresponding to one user.</p>
</li>
<li>
<p>To protect Moon with TLS encryption - use standard TLS private key (<code>server.key</code>) and certificate (<code>server.crt</code>) files as follows:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ helm upgrade --install -f values.yaml --set-file ingress.tlsCert=server.crt --set-file ingress.tlsKey=server.key -n moon moon aerokube/moon2</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect5">
<h6 id="users-basic-http-nginx-manual"><a class="anchor" href="#users-basic-http-nginx-manual"></a>Option 2. Nginx Ingress Configured Manually</h6>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In this approach we only configure authentication. <a href="#moon-operation-modes">Multiple namespaces mode</a> is not active.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To configure Nginx Ingress manually:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a text file with a list of available users in <a href="https://httpd.apache.org/docs/2.4/misc/password_encryptions.html">htpasswd</a> format:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ htpasswd -Bbn new-user new-user-password &gt;&gt; users.htpasswd # Adding new user
$ htpasswd -Bb users.htpasswd some-user new-password # Updating password
$ htpasswd -D users.htpasswd test-user # Deleting existing user</code></pre>
</div>
</div>
<div class="paragraph">
<p>Resulting file contents will look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ cat users.htpasswd
alpha-team:$apr1$.dZyHlKN$jdoZkin/kPviFNArx/cVL1 # User is alpha-team, password is encrypted
beta-team:$apr1$gyqzbSpt$RBNcxrsQaolPZCQZW0VQW1</code></pre>
</div>
</div>
</li>
<li>
<p>Save file contents to Kubernetes secret as follows:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ kubectl create secret generic moon-basic-auth --from-file=users.htpasswd -n moon</code></pre>
</div>
</div>
</li>
<li>
<p>Configure Nginx Ingress to use credentials for basic HTTP authentication:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">apiVersion</span>: <span class="string"><span class="content">networking.k8s.io/v1</span></span>
<span class="key">kind</span>: <span class="string"><span class="content">Ingress</span></span>
<span class="key">metadata</span>:
  <span class="key">name</span>: <span class="string"><span class="content">moon</span></span>
  <span class="key">namespace</span>: <span class="string"><span class="content">moon</span></span>
  <span class="key">annotations</span>:
    <span class="key">nginx.ingress.kubernetes.io/force-ssl-redirect</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
    <span class="key">nginx.ingress.kubernetes.io/auth-type</span>: <span class="string"><span class="content">basic                                      </span></span><i class="conum" data-value="1"></i><b>(1)</b>
    <span class="key">nginx.ingress.kubernetes.io/auth-secret</span>: <span class="string"><span class="content">moon-basic-auth                          </span></span><i class="conum" data-value="2"></i><b>(2)</b>
    <span class="key">nginx.ingress.kubernetes.io/auth-realm</span>: <span class="string"><span class="content">'Authentication Required - Moon Realm'    </span></span><i class="conum" data-value="3"></i><b>(3)</b>
    <span class="key">nginx.ingress.kubernetes.io/configuration-snippet</span>: <span class="string"><span class="delimiter">|</span></span>                              <i class="conum" data-value="4"></i><b>(4)</b>
      <span class="error">proxy_set_header X-Moon-Quota $remote_user;</span>
    <span class="key">nginx.ingress.kubernetes.io/proxy-connect-timeout</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">108000</span><span class="delimiter">&quot;</span></span>
    <span class="key">nginx.ingress.kubernetes.io/proxy-send-timeout</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">108000</span><span class="delimiter">&quot;</span></span>
    <span class="key">nginx.ingress.kubernetes.io/proxy-read-timeout</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">108000</span><span class="delimiter">&quot;</span></span>
<span class="key">spec</span>:
  <span class="key">ingressClassName</span>: <span class="string"><span class="content">nginx</span></span>
  <span class="key">tls</span>:
  - <span class="string"><span class="content">hosts:</span></span>
    - <span class="string"><span class="content">moon.example.com</span></span>
    <span class="key">secretName</span>: <span class="string"><span class="content">moon-tls                                                              </span></span><i class="conum" data-value="5"></i><b>(5)</b>
  <span class="key">rules</span>:
  - <span class="string"><span class="content">host: moon.example.com</span></span>
    <span class="key">http</span>:
      <span class="key">paths</span>:
      - <span class="string"><span class="content">path: /wd/hub</span></span>
        <span class="key">pathType</span>: <span class="string"><span class="content">Prefix</span></span>
        <span class="key">backend</span>:
          <span class="key">service</span>:
            <span class="key">name</span>: <span class="string"><span class="content">moon</span></span>
            <span class="key">port</span>:
              <span class="key">number</span>: <span class="string"><span class="content">4444</span></span>
      <span class="comment"># Other rules</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This is where we enable basic HTTP authentication in Nginx</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>This is where we configure Nginx to use our credentials list</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Any desired authentication realm name</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>This is where Nginx will set <code>X-Moon-Quota</code> and <code>Authorization</code> headers</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>How to configure TLS is described <a href="https://kubernetes.github.io/ingress-nginx/user-guide/tls/">here</a></td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</div>
<div class="sect5">
<h6 id="users-basic-http-openshift"><a class="anchor" href="#users-basic-http-openshift"></a>Option 3. Openshift Ingress</h6>
<div class="paragraph">
<p>Openshift Ingress often relies on <a href="http://www.haproxy.org/">HAProxy</a> where basic HTTP authentication options are limited or unavailable. To overcome this limitation Moon provides a sidecar container called <a href="#cli-flags-moon-basic-auth">moon-basic-auth</a>. This container is able to read users list from <a href="https://httpd.apache.org/docs/2.4/misc/password_encryptions.html">htpasswd</a> file, validate user information from <code>Authorization</code> header and send correct <code>X-Moon-Quota</code> to Moon.</p>
</div>
<div class="paragraph">
<div class="title">How Authentication In Openshift Works</div>
<p><span class="image"><img src="img/users-openshift.png" alt="users-openshift"></span></p>
</div>
<div class="paragraph">
<p>Configuring users for Openshift is done with Helm chart in exactly the same way as <a href="#users-basic-http-nginx-automated">Nginx Ingress</a>. The only difference is that you have to add <code>openshift: true</code> parameter to <code>values.yaml</code> as follows:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a <code>values.yaml</code> file:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">ingress</span>:
  <span class="key">host</span>: <span class="string"><span class="content">moon.example.com</span></span>
  <span class="key">openshift</span>: <span class="string"><span class="content">true</span></span> <span class="comment"># This enables sidecar for Openshift</span>
<span class="key">quota</span>:
  <span class="key">moon</span>: <span class="string"><span class="content">null</span></span>
  <span class="key">alpha-team</span>:
    <span class="key">namespace</span>: <span class="string"><span class="content">alpha</span></span>
  <span class="key">beta-team</span>:
    <span class="key">namespace</span>: <span class="string"><span class="content">beta</span></span>
    <span class="key">password</span>: <span class="string"><span class="content">beta-team-password</span></span></code></pre>
</div>
</div>
</li>
<li>
<p>Apply Helm chart:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ helm upgrade --install -f values.yaml -n moon moon aerokube/moon2
$ helm upgrade --install -f values.yaml --set-file ingress.tlsCert=server.crt --set-file ingress.tlsKey=server.key -n moon moon aerokube/moon2 # The same with TLS encryption</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect5">
<h6 id="users-basic-http-custom-ingress"><a class="anchor" href="#users-basic-http-custom-ingress"></a>Option 4. Custom Ingress</h6>
<div class="paragraph">
<p>Our Helm chart allows to provide custom Ingress configuration using <code>customIngress</code> Helm parameter. When using custom Ingress, our Helm chart always starts a sidecar container called <a href="#cli-flags-moon-basic-auth">moon-basic-auth</a> similarly to <a href="#users-basic-http-openshift">Openshift</a> section. That means that authentication is handled inside Moon pod and even trying to access Moon using Kubernetes service directly will require authentication. For example to configure an <a href="https://docs.aws.amazon.com/eks/latest/userguide/alb-ingress.html">ALB Ingress</a> in AWS:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a <code>values.yaml</code> file:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">customIngress</span>:
  <span class="key">enabled</span>: <span class="string"><span class="content">true</span></span>
  <span class="key">annotations</span>:
    <span class="key">external-dns.alpha.kubernetes.io/hostname</span>: <span class="string"><span class="content">moon.example.com</span></span>
    <span class="key">alb.ingress.kubernetes.io/group.name</span>: <span class="string"><span class="content">moon</span></span>
    <span class="key">alb.ingress.kubernetes.io/scheme</span>: <span class="string"><span class="content">internet-facing</span></span>
    <span class="key">alb.ingress.kubernetes.io/target-type</span>: <span class="string"><span class="content">ip</span></span>
  <span class="key">ingressClassName</span>: <span class="string"><span class="content">alb</span></span>
  <span class="key">host</span>: <span class="string"><span class="content">moon.example.com</span></span>
  <span class="key">paths</span>:
    - <span class="string"><span class="content">path: /api</span></span>
      <span class="key">port</span>: <span class="string"><span class="content">9090</span></span>
    - <span class="string"><span class="content">path: /cypress</span></span>
      <span class="key">port</span>: <span class="string"><span class="content">4444</span></span>
    - <span class="string"><span class="content">path: /playwright</span></span>
      <span class="key">port</span>: <span class="string"><span class="content">4444</span></span>
    - <span class="string"><span class="content">path: /devtools</span></span>
      <span class="key">port</span>: <span class="string"><span class="content">4444</span></span>
    - <span class="string"><span class="content">path: /metrics</span></span>
      <span class="key">port</span>: <span class="string"><span class="content">4444</span></span>
    - <span class="string"><span class="content">path: /wd/hub/session</span></span>
      <span class="key">port</span>: <span class="string"><span class="content">4444</span></span>
    - <span class="string"><span class="content">path: /ui</span></span>
      <span class="key">port</span>: <span class="string"><span class="content">9090</span></span>
    - <span class="string"><span class="content">path: /</span></span>
      <span class="key">port</span>: <span class="string"><span class="content">8080</span></span>
<span class="key">quota</span>:
  <span class="key">moon</span>: <span class="string"><span class="content">null</span></span>
  <span class="key">alpha-team</span>:
    <span class="key">namespace</span>: <span class="string"><span class="content">alpha</span></span>
  <span class="key">beta-team</span>:
    <span class="key">namespace</span>: <span class="string"><span class="content">beta</span></span>
    <span class="key">password</span>: <span class="string"><span class="content">beta-team-password</span></span></code></pre>
</div>
</div>
</li>
<li>
<p>Apply Helm chart:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ helm upgrade --install -f values.yaml -n moon moon aerokube/moon2
$ helm upgrade --install -f values.yaml --set-file ingress.tlsCert=server.crt --set-file ingress.tlsKey=server.key -n moon moon aerokube/moon2 # The same with TLS encryption</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect4">
<h5 id="users-openid-connect"><a class="anchor" href="#users-openid-connect"></a>OpenID Connect Support</h5>
<div class="paragraph">
<p>Moon supports integration with <a href="https://openid.net/connect/">OpenID Connect</a> implementations. OpenID Connect is an <a href="https://oauth.net/2/">OAuth</a>-based technology adding authentication information (OAuth only provides authorization capabilities). Existing OpenID Connect <a href="https://openid.net/developers/libraries/">implementations</a> allow to easily delegate authentication and authorization to third-party providers:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Popular OAuth cloud providers: <a href="https://github.com/">Github</a>, <a href="https://google.com/">Google</a>, <a href="https://microsoft.com/">Microsoft</a>, <a href="https://aws.amazon.com/">Amazon Web Services</a>, <a href="https://linkedin.com/">LinkedIn</a>, <a href="https://facebook.com/">Facebook</a>, <a href="https://www.okta.com/">Okta</a> and so on;</p>
</li>
<li>
<p>Popular corporate directory information services: <a href="https://www.openldap.org/">OpenLDAP</a>, <a href="https://en.wikipedia.org/wiki/Active_Directory">Active Directory</a> and other <a href="https://en.wikipedia.org/wiki/Lightweight_Directory_Access_Protocol">LDAP</a> protocol implementations.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Concrete list of supported third-party providers depends on OpenID Connect implementation you are using. Exact settings of how to interact with selected third-party provider are usually configured in OpenID Connect implementation settings.</p>
</div>
<div class="paragraph">
<div class="title">Moon and OpenID Connect</div>
<p><span class="image"><img src="img/moon-openid-connect.png" alt="moon-and-openid-connect"></span></p>
</div>
<div class="paragraph">
<p>As you <a href="#moon-components">know</a>, Moon is <strong>an HTTP API</strong> allowing to do browser automation from the code and <strong>a user web-interface</strong> helping to debug what&#8217;s happening in running browsers. Access to every of these two components is configured differently:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Access to <strong>Moon user interface</strong> can be protected using a third-party authentication reverse proxy like <a href="https://github.com/oauth2-proxy/oauth2-proxy">OAuth2 Proxy</a>.</p>
</li>
<li>
<p>Access to <strong>Moon HTTP API</strong> is protected by another sidecar daemon called <code>moon-auth</code> which is a part of Moon distribution. The main reason for creating a separate daemon is that web-interfaces are usually storing authentication information in cookies and only browsers can process them. Programs doing browser automation via Moon HTTP API are never passing authentication information in cookies, so <code>moon-auth</code> daemon converts credentials coming from such programs to OpenID Connect format.</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Protecting Moon components</div>
<p><span class="image"><img src="img/protecting-moon-components.png" alt="protecting-moon-components"></span></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="quotas"><a class="anchor" href="#quotas"></a>3.2.2. Quotas</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
As you already know Moon is a multi-user application. For every user you need to create one quota. For example for user <code>alice</code> you should create a quota named <code>alice</code> and so on. When only one quota is available - no authentication is required.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The main configuration object in Moon is called <code>quota</code>. This object contains all configuration specific to one Moon user. To list available quotas:</p>
</div>
<div class="listingblock">
<div class="title">Listing quotas</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ kubectl get quotas -n moon
NAME   NAMESPACE   CONFIG    BROWSERS   DEVICES   AGE
moon   moon        default   default    default   13h</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see every quota is a native Kubernetes object containing the following information:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Namespace</strong>. Kubernetes <a href="https://kubernetes.io/docs/concepts/workloads/pods/pod/">namespace</a> name where Moon starts browsers. By default, this is the same namespace where Moon is running. More details on what you can do with namespaces is described <a href="#moon-operation-modes">here</a>.</p>
</li>
<li>
<p><strong>Config</strong>. Name of Moon <a href="#configuration-object">configuration object</a> allowing to adjust resources consumption for Moon system images, user and group identifiers and other features.</p>
</li>
<li>
<p><strong>Browsers</strong>. Name of Moon <a href="#browsers-set">browsers set</a> to use for this quota.</p>
</li>
<li>
<p><strong>Devices</strong>. Names of Moon <a href="#devices-set">devices set</a> to use for this quota.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Using object names instead of their contents allows to easily reuse the same browsers set or devices set for different quotas. To view the same list in YAML format:</p>
</div>
<div class="listingblock">
<div class="title">Listing quotas as YAML</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ kubectl get quotas -n moon -o yaml
apiVersion: v1
items:
- apiVersion: moon.aerokube.com/v1
  kind: Quota
  metadata:
    name: moon                    <i class="conum" data-value="1"></i><b>(1)</b>
    namespace: moon
    # Other Kubernetes metadata
  spec:
    browsers: default             <i class="conum" data-value="2"></i><b>(2)</b>
    config: default               <i class="conum" data-value="3"></i><b>(3)</b>
    devices: default              <i class="conum" data-value="4"></i><b>(4)</b>
    namespace: moon               <i class="conum" data-value="5"></i><b>(5)</b>
kind: List
metadata:
  # List metadata</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Quota name</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Name of browsers set to use for this quota</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Name of configuration object to use for this quota</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Name of devices set to use for this quota</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Namespace where Moon starts browsers</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To edit a quota object:</p>
</div>
<div class="listingblock">
<div class="title">Editing a quota object</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ kubectl edit quota.moon moon -n moon # Do modifications in text editor, save and exit
$ kubectl edit team moon -n moon # An alias if you don't want to use fully qualified name</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
We are using <code>quota.moon</code> instead of just <code>quota</code> because in Kubernetes by default <code>quota</code> corresponds to <a href="https://kubernetes.io/docs/concepts/policy/resource-quotas/">ResourceQuota</a> object.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="configuration-object"><a class="anchor" href="#configuration-object"></a>3.2.3. Configuration Object</h4>
<div class="paragraph">
<p>Configuration object stores various configuration options: computing resources being assigned to system Moon images, group and user identifiers to run browser pods and so on. This object corresponds to <code>service.json</code> configuration file in Moon 1.x. To list available configuration objects:</p>
</div>
<div class="listingblock">
<div class="title">Listing configuration objects</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ kubectl get configs -n moon
NAME      AGE
default   2d22h</code></pre>
</div>
</div>
<div class="paragraph">
<p>To view the same list in YAML format:</p>
</div>
<div class="listingblock">
<div class="title">Listing configuration objects as YAML</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ kubectl get configs -n moon -o yaml
apiVersion: v1
items:
- apiVersion: moon.aerokube.com/v1
  kind: Config
  metadata:
    name: default                             <i class="conum" data-value="1"></i><b>(1)</b>
    namespace: moon
    # Other Kubernetes metadata
  spec:
    additionalTrustedCAs: |                   <i class="conum" data-value="2"></i><b>(2)</b>
      -----BEGIN CERTIFICATE-----
      ...
    containers:                               <i class="conum" data-value="3"></i><b>(3)</b>
      browser:                                <i class="conum" data-value="4"></i><b>(4)</b>
        resources:                            <i class="conum" data-value="5"></i><b>(5)</b>
          limits:                             <i class="conum" data-value="6"></i><b>(6)</b>
            cpu: &quot;1&quot;
            memory: 2Gi
          requests:                           <i class="conum" data-value="7"></i><b>(7)</b>
            cpu: 500m
            memory: 2Gi
      ca-certs:                               <i class="conum" data-value="8"></i><b>(8)</b>
        repository: aerokube/ca-certs         <i class="conum" data-value="9"></i><b>(9)</b>
        version: 2.0.0                        <i class="conum" data-value="10"></i><b>(10)</b>
        resources:                            <i class="conum" data-value="11"></i><b>(11)</b>
          limits:                             <i class="conum" data-value="12"></i><b>(12)</b>
            cpu: 250m
            memory: 64Mi
          requests:                           <i class="conum" data-value="13"></i><b>(13)</b>
            cpu: 100m
            memory: 64Mi
      defender:                               <i class="conum" data-value="14"></i><b>(14)</b>
        # The same fields as for ca-certs
      proxy:                                  <i class="conum" data-value="15"></i><b>(15)</b>
        # The same fields as for ca-certs
      video-recorder:                         <i class="conum" data-value="16"></i><b>(16)</b>
        # The same fields as for ca-certs
      vnc-server:                             <i class="conum" data-value="17"></i><b>(17)</b>
        # The same fields as for ca-certs
      x-server:                               <i class="conum" data-value="18"></i><b>(18)</b>
        # The same fields as for ca-certs
    group:                                    <i class="conum" data-value="19"></i><b>(19)</b>
      id: 4096                                <i class="conum" data-value="20"></i><b>(20)</b>
      name: user                              <i class="conum" data-value="21"></i><b>(21)</b>
    serviceAccountName: default               <i class="conum" data-value="22"></i><b>(22)</b>
    sessionTimeout: 5m                        <i class="conum" data-value="23"></i><b>(23)</b>
    storage:                                  <i class="conum" data-value="24"></i><b>(24)</b>
      accessKey: &quot;&quot;
      bucket: &quot;&quot;
      filename: &quot;&quot;
      endpoint: &quot;&quot;
      pattern: &quot;&quot;
      secretKey: &quot;&quot;
      secretRef:
        accessKey: RootUser
        name: minio
        secretKey: RootPass
    user:                                     <i class="conum" data-value="25"></i><b>(25)</b>
      id: 4096                                <i class="conum" data-value="26"></i><b>(26)</b>
      name: user                              <i class="conum" data-value="27"></i><b>(27)</b>
kind: List
metadata:
  # List metadata</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Configuration object name</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Additional root certification authorities to be used (needed to work with self-signed TLS certificates). Not shown when empty.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Service containers (<code>ca-certs</code>, <code>defender</code>, <code>proxy</code>, <code>video-recorder</code>, <code>vnc-server</code>, <code>x-server</code>) configuration</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td><code>browser</code> container configuration</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Computing resources assigned to container</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>CPU and memory limits assigned to container</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>CPU and memory requests assigned to container</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td><code>ca-certs</code> container configuration</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>Container image repository</td>
</tr>
<tr>
<td><i class="conum" data-value="10"></i><b>10</b></td>
<td>Container image version. Not shown when empty.</td>
</tr>
<tr>
<td><i class="conum" data-value="11"></i><b>11</b></td>
<td>Computing resources assigned to container</td>
</tr>
<tr>
<td><i class="conum" data-value="12"></i><b>12</b></td>
<td>CPU and memory limits assigned to container</td>
</tr>
<tr>
<td><i class="conum" data-value="13"></i><b>13</b></td>
<td>CPU and memory requests assigned to container</td>
</tr>
<tr>
<td><i class="conum" data-value="14"></i><b>14</b></td>
<td><code>defender</code> container configuration</td>
</tr>
<tr>
<td><i class="conum" data-value="15"></i><b>15</b></td>
<td><code>proxy</code> container configuration</td>
</tr>
<tr>
<td><i class="conum" data-value="16"></i><b>16</b></td>
<td><code>video-recorder</code> container configuration</td>
</tr>
<tr>
<td><i class="conum" data-value="17"></i><b>17</b></td>
<td><code>vnc-server</code> container configuration</td>
</tr>
<tr>
<td><i class="conum" data-value="18"></i><b>18</b></td>
<td><code>x-server</code> container configuration</td>
</tr>
<tr>
<td><i class="conum" data-value="19"></i><b>19</b></td>
<td>System group used to start containers</td>
</tr>
<tr>
<td><i class="conum" data-value="20"></i><b>20</b></td>
<td>System group numeric identifier (<code>gid</code>)</td>
</tr>
<tr>
<td><i class="conum" data-value="21"></i><b>21</b></td>
<td>System group name</td>
</tr>
<tr>
<td><i class="conum" data-value="22"></i><b>22</b></td>
<td>Kubernetes service account name to use</td>
</tr>
<tr>
<td><i class="conum" data-value="23"></i><b>23</b></td>
<td>Default Selenium session timeout</td>
</tr>
<tr>
<td><i class="conum" data-value="24"></i><b>24</b></td>
<td>S3 storage settings (used to save recorded videos)</td>
</tr>
<tr>
<td><i class="conum" data-value="25"></i><b>25</b></td>
<td>System user used to start containers</td>
</tr>
<tr>
<td><i class="conum" data-value="26"></i><b>26</b></td>
<td>System user numeric identifier (<code>uid</code>)</td>
</tr>
<tr>
<td><i class="conum" data-value="27"></i><b>27</b></td>
<td>System username</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To edit a configuration object:</p>
</div>
<div class="listingblock">
<div class="title">Editing a configuration object</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ kubectl edit config default -n moon # Do modifications in text editor, save and exit</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="browsers-set"><a class="anchor" href="#browsers-set"></a>3.2.4. Browsers Set</h4>
<div class="paragraph">
<p>The browsers set stores browsers startup configuration. This object corresponds to <code>browsers.json</code> file in Moon 1.x. To list available browser sets:</p>
</div>
<div class="listingblock">
<div class="title">Listing browser sets</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ kubectl get browsersets -n moon
NAME      AGE
default   2d23h</code></pre>
</div>
</div>
<div class="paragraph">
<p>To view the same list in YAML format:</p>
</div>
<div class="listingblock">
<div class="title">Listing browser sets as YAML</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ kubectl get browsersets -n moon -o yaml
apiVersion: v1
items:
- apiVersion: moon.aerokube.com/v1
  kind: BrowserSet
  metadata:
    name: default                                       <i class="conum" data-value="1"></i><b>(1)</b>
    namespace: moon
    # Other Kubernetes metadata
  spec:
    cypress:                                            <i class="conum" data-value="2"></i><b>(2)</b>
      chrome:                                           <i class="conum" data-value="3"></i><b>(3)</b>
        repository: quay.io/browsers/cypress-chrome     <i class="conum" data-value="4"></i><b>(4)</b>
      chromium:                                         <i class="conum" data-value="5"></i><b>(5)</b>
        # The same fields as for chrome
      edge:                                             <i class="conum" data-value="6"></i><b>(6)</b>
        # The same fields as for chrome
      electron:                                         <i class="conum" data-value="7"></i><b>(7)</b>
        # The same fields as for chrome
      firefox:                                          <i class="conum" data-value="8"></i><b>(8)</b>
        # The same fields as for chrome
    devtools:                                           <i class="conum" data-value="9"></i><b>(9)</b>
      chrome:
        # The same fields as for cypress
    playwright:                                         <i class="conum" data-value="10"></i><b>(10)</b>
      chrome:
        # The same fields as for cypress
      # Other supported browser types
    selenium:                                           <i class="conum" data-value="11"></i><b>(11)</b>
      MicrosoftEdge:
        repository: quay.io/browser/microsoft-edge-beta
      chrome:
        repository: quay.io/browser/google-chrome-stable
      firefox:
        repository: quay.io/browser/firefox-mozilla-build
kind: List
metadata:
  # List metadata</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Browser set name</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Cypress browsers configuration</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Cypress Chrome browser configuration</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Images repository to search for Cypress Chrome browser images</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Cypress Chromium browser configuration</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Cypress Microsoft Edge browser configuration</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Cypress Electron browser configuration</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>Cypress Firefox browser configuration</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>Chrome Developer Tools browsers configuration</td>
</tr>
<tr>
<td><i class="conum" data-value="10"></i><b>10</b></td>
<td>Playwright browsers configuration</td>
</tr>
<tr>
<td><i class="conum" data-value="11"></i><b>11</b></td>
<td>Selenium browsers configuration</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To edit a browser set object:</p>
</div>
<div class="listingblock">
<div class="title">Editing a browser set</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ kubectl edit browserset default -n moon # Do modifications in text editor, save and exit</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you were previously using Moon 1.x, you could notice that browsers set in Moon 2.x is slightly different compared to <code>browsers.json</code> from Moon 1.x. This is how a typical <code>browsers.json</code> file looks like:</p>
</div>
<div class="listingblock">
<div class="title">How Moon 1.x <code>browsers.json</code> file looks like</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">chrome</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">97.0</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">versions</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">97.0</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">image</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">quay.io/browsers/chrome:97.0</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">port</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">4444</span><span class="delimiter">&quot;</span></span>
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For every browser type and version you had to provide an exact browser image (e.g. <code>browsers/chrome:97.0</code>) and this file contained configuration only for Selenium browsers. The main problem with this approach is that it requires a manual update from Moon cluster administrator every time a new browser image appears. Container images for different versions of the same browser are usually stored in the same repository with different tags, e.g.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">quay.io/browser/google-chrome-stable:95.0 &lt;==&gt; Chrome 95.0
quay.io/browser/google-chrome-stable:96.0 &lt;==&gt; Chrome 96.0
quay.io/browser/google-chrome-stable:97.0 &lt;==&gt; Chrome 97.0</code></pre>
</div>
</div>
<div class="paragraph">
<p>In Moon 2.x instead of copy-pasting the same image specification you only need to provide repository name in browsers set object:</p>
</div>
<div class="listingblock">
<div class="title">Moon 2.x browser type specification</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">selenium</span>:
  <span class="key">chrome</span>:
    <span class="key">repository</span>: <span class="string"><span class="content">quay.io/browser/google-chrome-stable</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This new configuration format means that all images for <code>chrome</code> browser used in Selenium tests will be downloaded from <code>quay.io/browser/google-chrome-stable</code> repository. Concrete image tag is determined when you request to start a new browser. For example, you pass the following <a href="#selenium">Selenium</a> <a href="https://www.w3.org/TR/webdriver/#capabilities">capabilities</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">browserName = chrome
browserVersion = 96.0</code></pre>
</div>
</div>
<div class="paragraph">
<p>In that case Moon will use <code>quay.io/browser/google-chrome-stable:96.0</code> image. Similarly, in <a href="#cypress">Cypress</a>, <a href="#playwright">Playwright</a> and <a href="#devtools">Chrome Developer Tools</a> you are using URL path and parameters to pass the same information.</p>
</div>
<div class="sect4">
<h5 id="browsers-set-versions"><a class="anchor" href="#browsers-set-versions"></a>Browser Versions</h5>
<div class="paragraph">
<p>Although, not enabled by default, in Moon 2.x it is still possible to limit allowed browser versions:</p>
</div>
<div class="listingblock">
<div class="title">Limiting allowed browser versions</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">selenium</span>:
  <span class="key">chrome</span>:
    <span class="key">repository</span>: <span class="string"><span class="content">quay.io/browser/google-chrome-stable</span></span>
    <span class="key">versions</span>: <span class="string"><span class="content">[&quot;96.0&quot;, &quot;97.0&quot;]            </span></span><i class="conum" data-value="1"></i><b>(1)</b>
    <span class="key">default</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">96.0</span><span class="delimiter">&quot;</span></span>                       <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="key">port</span>: <span class="string"><span class="content">4444                            </span></span><i class="conum" data-value="3"></i><b>(3)</b>
    <span class="key">path</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">/</span><span class="delimiter">&quot;</span></span>                             <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Allowed browser versions list</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Default browser version</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Port inside browser container to send requests to (default is 4444)</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Base API path to send requests to</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When <code>versions</code> list is specified, Moon will only allow to start browser versions from this list. By default, if no version is provided by the user, the first available version is taken. You easily override default version using <code>default</code> field. When <code>versions</code> and <code>default</code> fields are omitted, default version is <code>latest</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="browsers-set-computing-resources"><a class="anchor" href="#browsers-set-computing-resources"></a>Computing Resources</h5>
<div class="paragraph">
<p>Default <a href="https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/">computing resources</a> assigned to every browser are configured in <a href="#configuration-object">configuration object</a>. For every browser type you can easily override these defaults as follows:</p>
</div>
<div class="listingblock">
<div class="title">Setting computing resources for browser pods</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">selenium</span>:
  <span class="key">chrome</span>:
    <span class="key">repository</span>: <span class="string"><span class="content">quay.io/browser/google-chrome-stable</span></span>
    <span class="key">resources</span>:                            <i class="conum" data-value="1"></i><b>(1)</b>
      <span class="key">limits</span>:                             <i class="conum" data-value="2"></i><b>(2)</b>
        <span class="key">cpu</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">1.0</span><span class="delimiter">&quot;</span></span>                        <i class="conum" data-value="3"></i><b>(3)</b>
        <span class="key">memory</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">1Gi</span><span class="delimiter">&quot;</span></span>                     <i class="conum" data-value="4"></i><b>(4)</b>
      <span class="key">requests</span>:                           <i class="conum" data-value="5"></i><b>(5)</b>
        <span class="key">cpu</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">1.0</span><span class="delimiter">&quot;</span></span>                        <i class="conum" data-value="6"></i><b>(6)</b>
        <span class="key">memory</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">1Gi</span><span class="delimiter">&quot;</span></span>                     <i class="conum" data-value="7"></i><b>(7)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Computing resources section</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Limits section (maximum allowed computing resources)</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>CPU limit</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Memory limit</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Request section</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>CPU request</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Memory request</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="browsers-set-environment-variables"><a class="anchor" href="#browsers-set-environment-variables"></a>Environment Variables</h5>
<div class="paragraph">
<p>In some situations you may need to set environment variables to browser pods. For example this may be needed to set <code>LANG</code> or <code>TZ</code> environment variables being used by some browsers to detect preferred language and time zone respectively. To set an arbitrary environment variable - use regular Kubernetes syntax:</p>
</div>
<div class="listingblock">
<div class="title">Setting arbitrary environment variables</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">selenium</span>:
  <span class="key">chrome</span>:
    <span class="key">repository</span>: <span class="string"><span class="content">quay.io/browser/google-chrome-stable</span></span>
    <span class="key">env</span>:                                <i class="conum" data-value="1"></i><b>(1)</b>
      - <span class="string"><span class="content">name: TZ                        </span></span><i class="conum" data-value="2"></i><b>(2)</b>
        <span class="key">value</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Europe/Paris</span><span class="delimiter">&quot;</span></span>
      - <span class="string"><span class="content">name: LANG</span></span>
        <span class="key">value</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">fr_FR.UTF-8</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Environment variables section</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Concrete environment variable</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Advanced features like loading environment variables from pod fields, ConfigMap or Secret:</p>
</div>
<div class="listingblock">
<div class="title">Loading environment variables</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">selenium</span>:
  <span class="key">chrome</span>:
    <span class="key">repository</span>: <span class="string"><span class="content">quay.io/browser/google-chrome-stable</span></span>
    <span class="key">env</span>:
        - <span class="string"><span class="content">name: MY_NODE_NAME</span></span>
          <span class="key">valueFrom</span>:
            <span class="key">fieldRef</span>:
              <span class="key">fieldPath</span>: <span class="string"><span class="content">spec.nodeName</span></span> <span class="comment"># Pod spec field value</span>
        - <span class="string"><span class="content">name: SECRET_USERNAME</span></span>
          <span class="key">valueFrom</span>:
            <span class="key">secretKeyRef</span>:
              <span class="key">name</span>: <span class="string"><span class="content">some-secret</span></span> <span class="comment"># Secret name</span>
              <span class="key">key</span>: <span class="string"><span class="content">username</span></span> <span class="comment"># Key name</span>
        - <span class="string"><span class="content">name: MEM_LIMIT</span></span>
          <span class="key">valueFrom</span>:
            <span class="key">resourceFieldRef</span>:
              <span class="key">containerName</span>: <span class="string"><span class="content">some-container</span></span> <span class="comment"># Container name</span>
              <span class="key">resource</span>: <span class="string"><span class="content">limits.memory</span></span> <span class="comment"># Resource parameter</span>
              <span class="key">divisor</span>: <span class="string"><span class="content">1Mi</span></span>
        - <span class="string"><span class="content">name: SOME_KEY</span></span>
          <span class="key">valueFrom</span>:
            <span class="key">configMapKeyRef</span>:
              <span class="key">name</span>: <span class="string"><span class="content">some-map</span></span> <span class="comment"># ConfigMap name</span>
              <span class="key">key</span>: <span class="string"><span class="content">some-key</span></span> <span class="comment"># Key name</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="browsers-set-custom-annotations"><a class="anchor" href="#browsers-set-custom-annotations"></a>Custom Annotations</h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Moon is using exactly the same annotations YAML format as <a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/annotations/">Kubernetes itself</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In some cases you may need to add custom <a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/annotations/">Kubernetes annotations</a> to started browser pods. If you need to add the same annotations to all browser types:</p>
</div>
<div class="listingblock">
<div class="title">Setting custom Kubernetes annotations applied to all browsers</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">apiVersion</span>: <span class="string"><span class="content">moon.aerokube.com/v1</span><span class="content">
  kind: BrowserSet
  metadata:
    name: default
    namespace: moon
    # Other Kubernetes metadata
  spec:
    annotations:                          <i class="conum" data-value="1"></i><b>(1)</b>
      key1: &quot;value1&quot;                      <i class="conum" data-value="2"></i><b>(2)</b>
      key2: &quot;value2&quot;</span></span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Global annotations section</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>One or more annotations to be set</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To add annotations to some browser types - do the same for concrete browser type in browser set as follows:</p>
</div>
<div class="listingblock">
<div class="title">Setting browser-specific Kubernetes annotations</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">selenium</span>:
  <span class="key">chrome</span>:
    <span class="key">repository</span>: <span class="string"><span class="content">quay.io/browser/google-chrome-stable</span></span>
    <span class="key">annotations</span>:                          <i class="conum" data-value="1"></i><b>(1)</b>
      <span class="key">key1</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">value1</span><span class="delimiter">&quot;</span></span>                      <i class="conum" data-value="2"></i><b>(2)</b>
      <span class="key">key2</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">value2</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Annotations specification section</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>One or more annotations to be set</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Moon adds some annotations by default to browser pods and their names are reserved:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 10. Moon Reserved Annotation Names</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Key</th>
<th class="tableblock halign-left valign-top">Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Custom session label passed in <code>name</code> capability</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="browsers-set-custom-labels"><a class="anchor" href="#browsers-set-custom-labels"></a>Custom Labels</h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Moon is using exactly the same labels YAML format as <a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/#syntax-and-character-set">Kubernetes itself</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In some cases you may need to add custom <a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/">Kubernetes labels</a> to started browser pods. If you need to add the same labels to all browser types:</p>
</div>
<div class="listingblock">
<div class="title">Setting custom Kubernetes labels applied to all browsers</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">apiVersion</span>: <span class="string"><span class="content">moon.aerokube.com/v1</span><span class="content">
  kind: BrowserSet
  metadata:
    name: default
    namespace: moon
    # Other Kubernetes metadata
  spec:
    labels:                          <i class="conum" data-value="1"></i><b>(1)</b>
      key1: &quot;value1&quot;                 <i class="conum" data-value="2"></i><b>(2)</b>
      key2: &quot;value2&quot;</span></span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Global labels section</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>One or more annotations to be set</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To add labels to some browser types - do the same in browser set as follows:</p>
</div>
<div class="listingblock">
<div class="title">Setting browser-specific Kubernetes labels</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">selenium</span>:
  <span class="key">chrome</span>:
    <span class="key">repository</span>: <span class="string"><span class="content">quay.io/browser/google-chrome-stable</span></span>
    <span class="key">labels</span>:                               <i class="conum" data-value="1"></i><b>(1)</b>
      <span class="key">key1</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">value1</span><span class="delimiter">&quot;</span></span>                      <i class="conum" data-value="2"></i><b>(2)</b>
      <span class="key">key2</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">value2</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Labels specification section</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>One or more labels to be set</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Moon adds some labels by default to browser pods and their names are reserved:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 11. Moon Reserved Label Names</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Key</th>
<th class="tableblock halign-left valign-top">Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">app</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stores unique name for every pod</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">browserName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stores browser name</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">browserVersion</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stores browser version</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">enableVNC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stores whether VNC is enabled</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">moon</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">System label, always equal to <code>browsers</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quota</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stores user quota name</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">screenResolution</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stores screen resolution requested by user</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="browsers-set-node-selectors"><a class="anchor" href="#browsers-set-node-selectors"></a>Node Selectors</h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Moon is using exactly the same node selector YAML format as <a href="https://kubernetes.io/docs/concepts/scheduling-eviction/assign-pod-node/#nodeselector">Kubernetes pods YAML</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Sometimes you may need to run browser pods on particular Kubernetes nodes (i.e. hardware hosts) only. Kubernetes allows to do this by specifying so-called <a href="https://kubernetes.io/docs/concepts/configuration/assign-pod-node/">node selectors</a>. If you need to add the same node selector to all browser types:</p>
</div>
<div class="listingblock">
<div class="title">Setting node selector applied to all browsers</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">apiVersion</span>: <span class="string"><span class="content">moon.aerokube.com/v1</span><span class="content">
  kind: BrowserSet
  metadata:
    name: default
    namespace: moon
    # Other Kubernetes metadata
  spec:
    nodeSelector:                         <i class="conum" data-value="1"></i><b>(1)</b>
      node-label-1: &quot;label1-value&quot;        <i class="conum" data-value="2"></i><b>(2)</b>
      node-label-2: &quot;label2-value&quot;</span></span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Node selector specification section</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>One or more Kubernetes node labels to match against</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To provide node selector to specific browser type:</p>
</div>
<div class="listingblock">
<div class="title">Setting node selector for specific browser type</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">selenium</span>:
  <span class="key">chrome</span>:
    <span class="key">repository</span>: <span class="string"><span class="content">quay.io/browser/google-chrome-stable</span></span>
    <span class="key">nodeSelector</span>:                         <i class="conum" data-value="1"></i><b>(1)</b>
      <span class="key">node-label-1</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">label1-value</span><span class="delimiter">&quot;</span></span>        <i class="conum" data-value="2"></i><b>(2)</b>
      <span class="key">node-label-2</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">label2-value</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Node selector specification section</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>One or more Kubernetes node labels to match against</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="browsers-set-affinity"><a class="anchor" href="#browsers-set-affinity"></a>Affinity</h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Moon is using exactly the same affinity configuration YAML format as <a href="https://kubernetes.io/docs/concepts/scheduling-eviction/assign-pod-node/#affinity-and-anti-affinity">Kubernetes pods YAML</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In addition to node selectors, you can also use all available node and pod affinity features available in Kubernetes. This allows you to have even more advanced pod scheduling settings like matching Kubernetes nodes against complex logical expressions, preventing some labeled pods to be running on the same node with another labeled pods and so on. If you need to add the same affinity setting to all browser types:</p>
</div>
<div class="listingblock">
<div class="title">Setting affinity applied to all browsers</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">apiVersion</span>: <span class="string"><span class="content">moon.aerokube.com/v1</span><span class="content">
  kind: BrowserSet
  metadata:
    name: default
    namespace: moon
    # Other Kubernetes metadata
  spec:
    affinity:                                            <i class="conum" data-value="1"></i><b>(1)</b>
      nodeAffinity:
        requiredDuringSchedulingIgnoredDuringExecution:
          nodeSelectorTerms:
          - matchExpressions:
            - key: kubernetes.io/e2e-az-name
              operator: In
              values:
              - e2e-az1
              - e2e-az2</span></span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Affinity specification section</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To provide affinity to specific browser type:</p>
</div>
<div class="listingblock">
<div class="title">Setting affinity for specific browser type</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">selenium</span>:
  <span class="key">chrome</span>:
    <span class="key">repository</span>: <span class="string"><span class="content">quay.io/browser/google-chrome-stable</span></span>
    <span class="key">affinity</span>:                                           <i class="conum" data-value="1"></i><b>(1)</b>
      <span class="key">nodeAffinity</span>:
        <span class="key">requiredDuringSchedulingIgnoredDuringExecution</span>:
          <span class="key">nodeSelectorTerms</span>:
          - <span class="string"><span class="content">matchExpressions:</span></span>
            - <span class="string"><span class="content">key: kubernetes.io/e2e-az-name</span></span>
              <span class="key">operator</span>: <span class="string"><span class="content">In</span></span>
              <span class="key">values</span>:
              - <span class="string"><span class="content">e2e-az1</span></span>
              - <span class="string"><span class="content">e2e-az2</span></span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Affinity specification section</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="browsers-set-tolerations"><a class="anchor" href="#browsers-set-tolerations"></a>Tolerations</h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Moon is using exactly the same tolerations configuration YAML format as <a href="https://kubernetes.io/docs/concepts/scheduling-eviction/taint-and-toleration/">Kubernetes pods YAML</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In addition to node selector and affinity, Kubernetes has a concept of <a href="https://kubernetes.io/docs/concepts/configuration/taint-and-toleration/">node taints</a>. Taints allow nodes to repel some pods from being scheduled on them. If you wish to run browser pods on tainted nodes - you have to add <strong>tolerations</strong>, that is to say a number of conditions to match against tainted nodes.</p>
</div>
<div class="paragraph">
<p>If you need to add the same tolerations to all browser types:</p>
</div>
<div class="listingblock">
<div class="title">Setting affinity applied to all browsers</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">apiVersion</span>: <span class="string"><span class="content">moon.aerokube.com/v1</span><span class="content">
  kind: BrowserSet
  metadata:
    name: default
    namespace: moon
    # Other Kubernetes metadata
  spec:
    tolerations:            <i class="conum" data-value="1"></i><b>(1)</b>
    - key: &quot;key1&quot;
      operator: &quot;Equal&quot;
      value: &quot;value1&quot;
      effect: &quot;NoSchedule&quot;</span></span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Tolerations specification section</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To assign tolerations to specific browser type:</p>
</div>
<div class="listingblock">
<div class="title">Setting tolerations for specific browser type</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">selenium</span>:
  <span class="key">chrome</span>:
    <span class="key">repository</span>: <span class="string"><span class="content">quay.io/browser/google-chrome-stable</span></span>
    <span class="key">tolerations</span>:                            <i class="conum" data-value="1"></i><b>(1)</b>
    - <span class="string"><span class="content">key: &quot;key1&quot;</span></span>
      <span class="key">operator</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Equal</span><span class="delimiter">&quot;</span></span>
      <span class="key">value</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">value1</span><span class="delimiter">&quot;</span></span>
      <span class="key">effect</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">NoSchedule</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Tolerations specification section</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="browsers-set-networking"><a class="anchor" href="#browsers-set-networking"></a>Networking</h5>
<div class="paragraph">
<p>Some scenarios require flexible networking configuration. For example you may need to override used DNS server or <code>/etc/hosts</code> entries. This can be easily done as follows:</p>
</div>
<div class="listingblock">
<div class="title">Setting advanced network configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">selenium</span>:
  <span class="key">chrome</span>:
    <span class="key">repository</span>: <span class="string"><span class="content">quay.io/browser/google-chrome-stable</span></span>
    <span class="key">dnsConfig</span>:                            <i class="conum" data-value="1"></i><b>(1)</b>
      <span class="key">nameservers</span>:
        - <span class="string"><span class="content">1.2.3.4</span></span>
      <span class="key">searches</span>:
        - <span class="string"><span class="content">ns1.svc.cluster-domain.example</span></span>
        - <span class="string"><span class="content">my.dns.search.suffix</span></span>
      <span class="key">options</span>:
        - <span class="string"><span class="content">name: ndots</span></span>
          <span class="key">value</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">2</span><span class="delimiter">&quot;</span></span>
        - <span class="string"><span class="content">name: edns0</span></span>
    <span class="key">hostAliases</span>:                          <i class="conum" data-value="2"></i><b>(2)</b>
      - <span class="string"><span class="content">ip: &quot;127.0.0.1&quot;</span></span>
        <span class="key">hostnames</span>:
        - <span class="string"><span class="delimiter">&quot;</span><span class="content">foo.local</span><span class="delimiter">&quot;</span></span>
        - <span class="string"><span class="delimiter">&quot;</span><span class="content">bar.local</span><span class="delimiter">&quot;</span></span>
      - <span class="string"><span class="content">ip: &quot;10.1.2.3&quot;</span></span>
        <span class="key">hostnames</span>:
        - <span class="string"><span class="delimiter">&quot;</span><span class="content">foo.remote</span><span class="delimiter">&quot;</span></span>
        - <span class="string"><span class="delimiter">&quot;</span><span class="content">bar.remote</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>DNS configuration section</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Host aliases (<code>/etc/hosts</code>) configuration section</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><code>dnsConfig</code> and <code>hostAliases</code> fields have exactly the same syntax as their Kubernetes equivalents (<a href="https://kubernetes.io/docs/concepts/services-networking/dns-pod-service/#pod-dns-config">pod DNS config</a> and <a href="https://kubernetes.io/docs/tasks/network/customize-hosts-file-for-pods/">host aliases</a> respectively).</p>
</div>
</div>
<div class="sect4">
<h5 id="browsers-set-privileged-mode"><a class="anchor" href="#browsers-set-privileged-mode"></a>Privileged Mode</h5>
<div class="paragraph">
<p>In some cases like running Android emulators browser container should be run in <code>privileged</code> mode. This setting can be applied for each browser type as follows:</p>
</div>
<div class="listingblock">
<div class="title">Activating Privileged Mode</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">selenium</span>:
  <span class="key">chrome</span>:
    <span class="comment"># For example Android emulators may require privileged mode</span>
    <span class="key">repository</span>: <span class="string"><span class="content">browsers/android</span></span>
    <span class="key">privileged</span>: <span class="string"><span class="content">true                    </span></span><i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Launch pod in privileged mode</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="devices-set"><a class="anchor" href="#devices-set"></a>3.2.5. Devices Set</h4>
<div class="paragraph">
<p>Moon loads information about available mobile devices for <a href="#mobile-emulation">Mobile Emulation</a> from <code>devices set</code> object. This object corresponds to <code>devices.json</code> file in Moon 1.x. To list available device sets:</p>
</div>
<div class="listingblock">
<div class="title">Listing device sets</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ kubectl get devicesets -n moon
NAME      AGE
default   2d23h</code></pre>
</div>
</div>
<div class="paragraph">
<p>To view the same list in YAML format:</p>
</div>
<div class="listingblock">
<div class="title">Listing device sets as YAML</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ kubectl get browsersets -n moon -o yaml
$ kubectl get devicesets -n moon -o yaml
apiVersion: v1
items:
- apiVersion: moon.aerokube.com/v1
  kind: DeviceSet
  metadata:
    name: default                                                                                 <i class="conum" data-value="1"></i><b>(1)</b>
    namespace: moon
    # Other Kubernetes metadata
  spec:
    devices:                                                                                      <i class="conum" data-value="2"></i><b>(2)</b>
      Apple iPhone 11:                                                                            <i class="conum" data-value="3"></i><b>(3)</b>
        height: 896                                                                               <i class="conum" data-value="4"></i><b>(4)</b>
        pixelRatio: 2                                                                             <i class="conum" data-value="5"></i><b>(5)</b>
        printVersion: true                                                                        <i class="conum" data-value="6"></i><b>(6)</b>
        userAgent: user-agent-string-for-chrome-%s                                                <i class="conum" data-value="7"></i><b>(7)</b>
        width: 414                                                                                <i class="conum" data-value="8"></i><b>(8)</b>
      # Other devices
kind: List
metadata:
  # List metadata</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Device set name</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Devices list</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Concrete device definition</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Device screen height</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Device pixel ratio</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Whether to substitute Chrome version to user agent string (<code>%s</code> placeholder is replaced by Chrome version)</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Device user agent</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>Device screen width</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To edit a device set object:</p>
</div>
<div class="listingblock">
<div class="title">Editing a device set</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ kubectl edit deviceset default -n moon # Do modifications in text editor, save and exit</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="video-recording"><a class="anchor" href="#video-recording"></a>3.3. Video Recording</h3>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Depending on <a href="#resources-service-images">computing resources configuration</a> enabling video recording will require approximately +1 CPU and +1 GB RAM for every browser sessions.</p>
</li>
<li>
<p>We consider video recording mainly a debugging feature and do not recommend recording videos for every test scenario. Not only because doing this slightly increases computing resources consumption, but also because nobody will review thousands of recorded videos (especially for passed test scenarios).</p>
</li>
</ol>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Video recording allows you to record the video of browser screen with your test scenario running in it. Recorded video can be then viewed in browser, video player or e.g. attached to test execution report. In Kubernetes or Openshift browsers are being run on a random network host and in case of auto-scaling enabled, these hosts periodically appear and disappear. So recorded videos should be saved to persistent storage before deleting browser pod. When requested Moon automatically sends recorded to video <a href="https://en.wikipedia.org/wiki/Amazon_S3">S3</a>-compatible storage. Such type of storage is supported by <a href="https://aws.amazon.com/">AWS</a>, <a href="https://cloud.google.com/">Google Cloud</a>, <a href="https://azure.microsoft.com/">Microsoft Azure</a>, <a href="https://digitalocean.com/">Digital Ocean</a> and many other cloud providers. To deploy a private S3-compatible storage you can use <a href="https://minio.io/">Minio</a>.</p>
</div>
<div class="paragraph">
<p>To enable video recording you need to:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Configure S3 storage in Moon settings.</p>
</li>
<li>
<p>Request to record a video during test run.</p>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="video-recording-s3"><a class="anchor" href="#video-recording-s3"></a>3.3.1. Enabling S3 Storage</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create an S3 bucket. In this example bucket name is <code>moon-test</code>. You can create an S3-compatible bucket in the majority of public cloud platforms. How to configure Moon with these platforms in shown in the table below:</p>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 12. S3 settings for popular cloud platforms</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Platform Name</th>
<th class="tableblock halign-left valign-top">Service Name</th>
<th class="tableblock halign-left valign-top">Endpoint</th>
<th class="tableblock halign-left valign-top">Signature Version</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">AWS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">AWS S3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Depends on region, e.g. <code><a href="https://s3.us-east-2.amazonaws.com" class="bare">https://s3.us-east-2.amazonaws.com</a></code>. See AWS <a href="https://docs.aws.amazon.com/general/latest/gr/s3.html">documentation</a> for detailed list of endpoints.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">S3v4</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DigitalOcean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DigitalOcean Spaces</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Depends on region, e.g. <code><a href="https://nyc3.digitaloceanspaces.com" class="bare">https://nyc3.digitaloceanspaces.com</a></code>. See <a href="https://www.digitalocean.com/docs/spaces/">documentation</a> for more details.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">S3v4</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Google Cloud</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Google Cloud Storage</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><a href="https://storage.googleapis.com" class="bare">https://storage.googleapis.com</a></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">S3v2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Microsoft Azure</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Azure Blob Storage</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No built-in S3 support. Need to deploy additional software like <a href="https://docs.min.io/docs/minio-gateway-for-azure.html">Minio</a>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">S3v4</p></td>
</tr>
</tbody>
</table>
</li>
<li>
<p>Access to S3 bucket can be provided either with <strong>a pair of static credentials</strong> (an <strong>access key</strong> and a <strong>secret key</strong>) or by <strong>adding cloud platform roles</strong>. This section shows how to configure static credentials. How to configure role-based access to S3 bucket is shown <a href="#video-recording-s3-roles">below</a>.</p>
</li>
<li>
<p>Update storage settings in <a href="#configuration-object">configuration object</a>:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml">  <span class="key">apiVersion</span>: <span class="string"><span class="content">moon.aerokube.com/v1</span></span>
  <span class="key">kind</span>: <span class="string"><span class="content">Config</span></span>
  <span class="key">metadata</span>:
    <span class="key">name</span>: <span class="string"><span class="content">default</span></span>
    <span class="key">namespace</span>: <span class="string"><span class="content">moon</span></span>
    <span class="comment"># Other Kubernetes metadata</span>
  <span class="key">spec</span>:
    <span class="comment"># Some fields before</span>
    <span class="key">storage</span>:
      <span class="key">accessKey</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">AKIAXXXXXXXXXXXXXXXX</span><span class="delimiter">&quot;</span></span> <span class="comment"># Set if a pair of credentials is used</span>
      <span class="key">bucket</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">moon-test</span><span class="delimiter">&quot;</span></span>
      <span class="key">filename</span>: <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span> <span class="comment"># Recorded video file name, e.g. myvideo.mp4</span>
      <span class="key">endpoint</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">https://s3.us-east-2.amazonaws.com</span><span class="delimiter">&quot;</span></span>
      <span class="key">pattern</span>: <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span> <span class="comment"># See below</span>
      <span class="key">secretKey</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">okUa0XXXXXXXXXXXXXXXXXXXX</span><span class="delimiter">&quot;</span></span> <span class="comment"># Set if a pair of credentials is used</span>
    <span class="comment"># Other fields</span></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="video-recording-enable"><a class="anchor" href="#video-recording-enable"></a>3.3.2. Requesting to Record a Video</h4>
<div class="paragraph">
<p>How to enable video recording depends on browser automation technology you are using:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#selenium-video-recording">Selenium</a></p>
</li>
<li>
<p><a href="#cypress-video-recording">Cypress</a></p>
</li>
<li>
<p><a href="#playwright-video-recording">Playwright</a></p>
</li>
<li>
<p><a href="#devtools-video-recording">Chrome Developer Tools</a></p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="video-recording-s3-custom-layout"><a class="anchor" href="#video-recording-s3-custom-layout"></a>Custom S3 Layout</h5>
<div class="paragraph">
<p>By default, videos are uploaded to S3 bucket as follows:</p>
</div>
<div class="listingblock">
<div class="title">Default S3 bucket layout</div>
<div class="content">
<pre>\---my-bucket
    \---- &lt;session-id&gt;
        |---- video.mp4</pre>
</div>
</div>
<div class="paragraph">
<p>Moon allows to organize any custom S3 keys layout using <strong>S3 key pattern</strong> with placeholders. A typical S3 key pattern looks like the following:</p>
</div>
<div class="listingblock">
<div class="title">Typical S3 key pattern</div>
<div class="content">
<pre>$quota/$browserName/$browserVersion/$sessionId</pre>
</div>
</div>
<div class="paragraph">
<p>Here every placeholder such as <code>$quota</code>, <code>$browserName</code>, <code>$browserVersion</code> and so on will be replaced by corresponding information: user name, browser name, browser version. The resulting S3 key will be used as a directory to save video files. A list of supported placeholders is shown in the table below:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 13. S3 Key Placeholders</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Placeholder</th>
<th class="tableblock halign-left valign-top">Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">$sessionId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Replaced by Selenium session ID</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">$browserName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Replaced by Selenium browser name capability value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">$browserVersion</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Replaced by Selenium browser version capability value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">$date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Replaced by current date, e.g. <code>2018-11-01</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">$quota</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Replaced by quota name (i.e. user name provided in Selenium URL)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Default S3 key pattern is just <code>$sessionId</code>:</p>
</div>
<div class="listingblock">
<div class="title">Default video paths</div>
<div class="content">
<pre>my-bucket/chrome-71-0-686efb96-eabe-4435-af31-21a33c8a4c8b/video.mp4</pre>
</div>
</div>
<div class="paragraph">
<p>You can change S3 key pattern in <a href="#configuration-object">configuration object</a> as follows:</p>
</div>
<div class="listingblock">
<div class="title">Setting custom S3 key pattern</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml">  <span class="key">apiVersion</span>: <span class="string"><span class="content">moon.aerokube.com/v1</span></span>
  <span class="key">kind</span>: <span class="string"><span class="content">Config</span></span>
  <span class="key">metadata</span>:
    <span class="key">name</span>: <span class="string"><span class="content">default</span></span>
    <span class="key">namespace</span>: <span class="string"><span class="content">moon</span></span>
    <span class="comment"># Other Kubernetes metadata</span>
  <span class="key">spec</span>:
    <span class="comment"># Some fields before</span>
    <span class="key">storage</span>:
      <span class="comment"># Other S3 storage settings</span>
      <span class="key">pattern</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">$quota/$browserName/$browserVersion/$sessionId</span><span class="delimiter">&quot;</span></span>
    <span class="comment"># Other fields</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To define an S3 key pattern for every browser session independently - use <code>pattern</code> capability described in <a href="#selenium-moon-capabilities">Moon-specific Capabilities</a> section.</p>
</div>
<div id="video-recording-s3-secret" class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>This feature is available since Moon 2.1.3.</p>
</li>
<li>
<p>Make sure that Kubernetes secret is created in the namespace where browser pods will be started.</p>
</li>
</ol>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In some cases you may want to load S3 credentials from Kubernetes secret instead of setting them as plain text in <a href="#configuration-object">configuration object</a>:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a Kubernetes <a href="https://kubernetes.io/docs/concepts/configuration/secret/">secret</a> in the namespace for respective <a href="https://aerokube.com/moon/latest/#quotas">quota</a>:</p>
<div class="listingblock">
<div class="title">An example Kubernetes secret with S3 credentials</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ cat secret.yaml
---
apiVersion: v1
kind: Secret
metadata:
  name: credentials
stringData:
  RootUser: &quot;AKIAXXXXXXXXXXXXXXXX&quot;
  RootPass: &quot;okUa0XXXXXXXXXXXXXXXXXXXX&quot;

$ kubectl create -n moon -f secret.yaml
secret/minio created</code></pre>
</div>
</div>
</li>
<li>
<p>Add <code>secretRef</code> field in <a href="#configuration-object">configuration object</a> as follows:</p>
<div class="listingblock">
<div class="title">Loading S3 credentials from Kubernetes secret</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml">  <span class="key">apiVersion</span>: <span class="string"><span class="content">moon.aerokube.com/v1</span></span>
  <span class="key">kind</span>: <span class="string"><span class="content">Config</span></span>
  <span class="key">metadata</span>:
    <span class="key">name</span>: <span class="string"><span class="content">default</span></span>
    <span class="key">namespace</span>: <span class="string"><span class="content">moon</span></span>
    <span class="comment"># Other Kubernetes metadata</span>
  <span class="key">spec</span>:
    <span class="comment"># Some fields before</span>
    <span class="key">storage</span>:
      <span class="comment"># Other S3 storage settings</span>
      <span class="key">secretRef</span>:
        <span class="key">accessKey</span>: <span class="string"><span class="content">RootUser</span></span> <span class="comment"># Name of the secret field with access key</span>
        <span class="key">name</span>: <span class="string"><span class="content">credentials</span></span> <span class="comment"># Secret name from previous step</span>
        <span class="key">secretKey</span>: <span class="string"><span class="content">RootPass</span></span>  <span class="comment"># Name of the secret field with secret key</span>
    <span class="comment"># Other fields</span></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="video-recording-s3-roles"><a class="anchor" href="#video-recording-s3-roles"></a>Role-based Access to S3</h5>
<div class="paragraph">
<p>Some teams prefer using cloud platform roles for giving access to S3 storage instead of a pair of static credentials. In this section we are showing how to deliver role-based access to S3 bucket in <a href="https://aws.amazon.com/">AWS</a> cloud. To do this:</p>
</div>
<div class="paragraph">
<p><strong>Option 1. Use kube2iam and Kubernetes annotations</strong>.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Install <a href="https://github.com/jtblin/kube2iam">kube2iam</a>.</p>
</li>
<li>
<p>Create an IAM role to access S3 bucket using the following CloudFormation template:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="comment">#jinja2:trim_blocks: False</span>
<span class="comment">#jinja2:lstrip_blocks: False</span>
{<span class="error">% set var = config.jinja_parameters %}</span>
<span class="key">AWSTemplateFormatVersion</span>: <span class="string"><span class="content">'2010-09-09'</span></span>

<span class="key">Description</span>: <span class="string"><span class="content">Contains infra components for Aerokube Moon</span></span>
<span class="key">Parameters</span>:
  <span class="key">TargetBucket</span>:
    <span class="key">Description</span>: <span class="string"><span class="content">Target bucket for IAM permissions</span></span>
    <span class="key">Type</span>: <span class="string"><span class="content">String</span></span>
<span class="key">Resources</span>:
  <span class="key">PodRole</span>:
    <span class="key">Type</span>: <span class="string"><span class="content">AWS::IAM::Role</span></span>
    <span class="key">Properties</span>:
      <span class="key">RoleName</span>: <span class="string"><span class="content">aerokube-moon</span></span>
      <span class="key">AssumeRolePolicyDocument</span>:
        <span class="key">Version</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">2012-10-17</span><span class="delimiter">&quot;</span></span>
        <span class="key">Statement</span>:
        - <span class="string"><span class="content">Effect: Allow</span></span>
          <span class="key">Action</span>: <span class="string"><span class="content">sts:AssumeRole</span></span>
          <span class="key">Principal</span>:
            <span class="key">Service</span>: <span class="string"><span class="content">ec2.amazonaws.com</span></span>
        - <span class="string"><span class="content">Effect: Allow</span></span>
          <span class="key">Action</span>: <span class="string"><span class="content">sts:AssumeRole</span></span>
          <span class="key">Principal</span>:
            <span class="key">AWS</span>: <span class="type">!Sub</span> <span class="string"><span class="content">arn:aws:iam::${AWS::AccountId}:role/EKSInstanceRole</span></span>
      <span class="key">Policies</span>:
        - <span class="string"><span class="content">PolicyName: aerokube-moon</span></span>
          <span class="key">PolicyDocument</span>:
            <span class="key">Statement</span>:
              - <span class="string"><span class="content">Action:</span><span class="content">
                  - s3:List*
                  - s3:Get*
                  - s3:Put*</span></span>
                <span class="key">Effect</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Allow</span><span class="delimiter">&quot;</span></span>
                <span class="key">Resource</span>:
                  - <span class="type">!Sub</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">arn:aws:s3:::${TargetBucket}/*</span><span class="delimiter">&quot;</span></span>
                  - <span class="type">!Sub</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">arn:aws:s3:::${TargetBucket}</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
</li>
<li>
<p>Annotate Moon namespace with the following annotation:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">annotations</span>:
  <span class="key">iam.amazonaws.com/allowed-roles</span>: <span class="string"><span class="delimiter">|</span><span class="content">
    [&quot;aerokube-moon&quot;]</span></span></code></pre>
</div>
</div>
</li>
<li>
<p>Add an annotation to browser pods in <a href="#browsers-set">browsers set</a>:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">apiVersion</span>: <span class="string"><span class="content">moon.aerokube.com/v1</span></span>
<span class="key">kind</span>: <span class="string"><span class="content">BrowserSet</span></span>
<span class="key">metadata</span>:
  <span class="key">name</span>: <span class="string"><span class="content">default</span></span>
  <span class="key">namespace</span>: <span class="string"><span class="content">moon</span></span>
  <span class="comment"># Other Kubernetes metadata</span>
<span class="key">spec</span>:
  <span class="key">annotations</span>:
    <span class="key">iam.amazonaws.com/role</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">aerokube-moon</span><span class="delimiter">&quot;</span></span>
  <span class="comment"># Other fields</span></code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Option 2. Add IAM role to Moon service account</strong>.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Configure an IAM role for EKS service account <a href="https://docs.aws.amazon.com/eks/latest/userguide/iam-roles-for-service-accounts.html">AWS documentation</a>.</p>
</li>
<li>
<p>Configure Moon to <a href="#faq-kubernetes-service-account">use</a> this service account.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="browser-ops"><a class="anchor" href="#browser-ops"></a>3.4. Automatically Updating Browser Versions</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This feature is available since Moon 2.3.0.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Moon 2.x is choosing browser images by naming convention. For example, when you request a Selenium browser <code>chrome 100.0</code> it will by default try to use <code>quay.io/browser/google-chrome-stable:100.0</code> image. Exact repository used to fetch images can be configured in <a href="#browsers-set">browsers set</a> object. However, for Moon UI a list of available browser versions is limited and should be configured explicitly in the same browsers set object. Starting from Moon 2.3.0 we provide an automated solution to maintain the list of browser versions in Moon UI always up to date. This solution is called <code>browser-ops</code> and is distributed as a separate <a href="https://kubernetes.io/docs/concepts/workloads/controllers/job/">Kubernetes job</a> that periodically checks for new browser versions in images repository and updates browsers set accordingly.</p>
</div>
<div class="sect3">
<h4 id="browser-ops-installation"><a class="anchor" href="#browser-ops-installation"></a>3.4.1. Installation</h4>
<div class="paragraph">
<p>To activate this solution you need to install one more <a href="https://helm.sh">Helm</a> chart:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Add Aerokube <a href="https://github.com/aerokube/charts">charts</a> repository if you don&#8217;t have it already:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ helm repo add aerokube https://charts.aerokube.com/
$ helm repo update</code></pre>
</div>
</div>
</li>
<li>
<p>Install <code>browser-ops</code> chart:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ helm upgrade --install -n moon browser-ops aerokube/browser-ops</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="browser-ops-configuration"><a class="anchor" href="#browser-ops-configuration"></a>3.4.2. Configuration Options</h4>
<div class="paragraph">
<p>Like for any other Helm chart, <code>browser-ops</code> configuration options are stored in <code>values.yaml</code> file and applied like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ helm upgrade --install -f values.yaml -n moon browser-ops aerokube/browser-ops</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>By default, browser versions will be updated every night. To change version update schedule:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">schedule</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">0 */2 * * *</span><span class="delimiter">&quot;</span></span> <span class="comment"># Run every two hours</span></code></pre>
</div>
</div>
</li>
<li>
<p>By default, <code>browser-ops</code> will configure Moon to use the latest available browser version. You can easily change this behavior to configure all available browser versions or fixed number of the latest available browser versions:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">browserImageVersions</span>: <span class="string"><span class="content">all</span></span> <span class="comment"># Use all available browser versions</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">browserImageVersions</span>: <span class="string"><span class="content">5</span></span> <span class="comment"># Use 5 available browser versions</span></code></pre>
</div>
</div>
</li>
<li>
<p>By default, <code>browser-ops</code> will use long browser versions like <code>102.0.1245.30</code> instead of <code>102.0</code>. To use short versions:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">browserImageTagFormat</span>: <span class="string"><span class="content">short</span></span></code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
When using short browser versions the latest available browser version will not be present in the list. This is because for one major browser version there could be several minor updates. Such behavior allows to not cache a minor browser version update that can be later updated one more time by browser developers.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>By default, <code>browser-ops</code> only updates browsers set object named <code>default</code>. If you have several browsers set objects, provide all required names of such objects:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">browsersets</span>:
- <span class="string"><span class="content">default</span></span>
- <span class="string"><span class="content">alpha</span></span>
- <span class="string"><span class="content">beta</span></span></code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="private-container-registry"><a class="anchor" href="#private-container-registry"></a>3.5. Using Private Container Registry</h3>
<div class="paragraph">
<p>By default, Moon images (<code>aerokube/defender</code>, <code>aerokube/logger</code> and so on) are downloaded from public container images registry. If in your environment due to security restrictions container images can only be downloaded from private registry (e.g. <code>my-registry.example.com</code>) you need to configure Moon to work with this registry. To do this:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Configure Kubernetes authentication to your private registry:</p>
<div class="literalblock">
<div class="content">
<pre>$ kubectl create secret docker-registry my-registry.example.com --docker-server=my-registry.example.com --docker-username=some-user --docker-password=registry-password --docker-email=some-user@example.com -n moon
$ kubectl patch serviceaccount moon -p '{"imagePullSecrets": [{"name": "my-registry.example.com"}]}' -n moon # Use correct service account name here</pre>
</div>
</div>
<div class="paragraph">
<p>In case of Openshift the following commands will work:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ oc create secret docker-registry my-registry.example.com --docker-server=my-registry.example.com --docker-username=some-user --docker-password=registry-password --docker-email=some-user@example.com -n moon
$ oc secrets link moon my-registry.example.com --for=pull -n moon</pre>
</div>
</div>
</li>
<li>
<p>Copy all desired browser images to your registry:</p>
<div class="literalblock">
<div class="content">
<pre>quay.io/browser/google-chrome-stable:96.0 =&gt; my-registry.example.com/browsers/chrome:96.0</pre>
</div>
</div>
</li>
<li>
<p>Update <a href="#browsers-set">browsers set</a> to use new browser images repository:</p>
<div class="listingblock">
<div class="title">Browsers Set with Private Container Repository</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">apiVersion</span>: <span class="string"><span class="content">moon.aerokube.com/v1</span></span>
<span class="key">kind</span>: <span class="string"><span class="content">BrowserSet</span></span>
<span class="key">metadata</span>:
    <span class="key">name</span>: <span class="string"><span class="content">default</span></span>
    <span class="key">namespace</span>: <span class="string"><span class="content">moon</span></span>
    <span class="comment"># Other Kubernetes metadata</span>
<span class="key">spec</span>:
    <span class="comment"># Other tools come here</span>
    <span class="key">selenium</span>:
      <span class="key">chrome</span>:
        <span class="key">repository</span>: <span class="string"><span class="content">my-registry.example.com/browsers/chrome</span></span>
      <span class="comment"># Other browser types come here</span></code></pre>
</div>
</div>
</li>
<li>
<p>Copy desired version of the Moon service images to your registry:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">aerokube/ca-certs:2.0.0 =&gt; my-registry.example.com/aerokube/ca-certs:2.0.0
aerokube/defender:2.0.0 =&gt; my-registry.example.com/aerokube/defender:2.0.0
aerokube/proxy:2.0.0 =&gt; my-registry.example.com/aerokube/proxy:2.0.0
aerokube/vnc-server:2.0.0 =&gt; my-registry.example.com/aerokube/vnc-server:2.0.0
aerokube/video-recorder:2.0.0 =&gt; my-registry.example.com/aerokube/video-recorder:2.0.0
aerokube/x-server:2.0.0 =&gt; my-registry.example.com/aerokube/vnc-server:2.0.0</code></pre>
</div>
</div>
</li>
<li>
<p>Override Moon service images, update <a href="#configuration-object">configuration object</a> with the following contents:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">apiVersion</span>: <span class="string"><span class="content">moon.aerokube.com/v1</span></span>
<span class="key">kind</span>: <span class="string"><span class="content">Config</span></span>
<span class="key">metadata</span>:
    <span class="key">name</span>: <span class="string"><span class="content">default</span></span>
    <span class="key">namespace</span>: <span class="string"><span class="content">moon</span></span>
    <span class="comment"># Other Kubernetes metadata</span>
<span class="key">spec</span>:
    <span class="key">containers</span>:
      <span class="key">ca-certs</span>:
        <span class="key">repository</span>: <span class="string"><span class="content">my-registry.example.com/aerokube/ca-certs</span></span>
        <span class="key">version</span>: <span class="string"><span class="content">2.0.0</span></span> <span class="comment"># You can omit this field and then Moon will use its own image tag (recommended approach)</span>
      <span class="key">defender</span>:
        <span class="key">repository</span>: <span class="string"><span class="content">my-registry.example.com/aerokube/defender</span></span>
      <span class="key">proxy</span>:
        <span class="key">repository</span>: <span class="string"><span class="content">my-registry.example.com/aerokube/proxy</span></span>
      <span class="key">vnc-server</span>:
        <span class="key">repository</span>: <span class="string"><span class="content">my-registry.example.com/aerokube/vnc-server</span></span>
      <span class="key">x-server</span>:
        <span class="key">repository</span>: <span class="string"><span class="content">my-registry.example.com/aerokube/x-server</span></span>
      <span class="key">video-recorder</span>:
        <span class="key">repository</span>: <span class="string"><span class="content">my-registry.example.com/aerokube/video-recorder</span></span></code></pre>
</div>
</div>
</li>
<li>
<p>Copy desired version of Moon main images to your registry:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">aerokube/moon:2.0.0 =&gt; my-registry.example.com/aerokube/moon:2.0.0
aerokube/moon-conf:2.0.0 =&gt; my-registry.example.com/aerokube/moon-conf:2.0.0
aerokube/moon-ui:2.0.0 =&gt; my-registry.example.com/aerokube/moon-ui:2.0.0</code></pre>
</div>
</div>
</li>
<li>
<p>Use new main Moon images from the previous step in Helm chart to start Moon and Moon UI.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="timeouts"><a class="anchor" href="#timeouts"></a>3.6. Adjusting Timeouts</h3>
<div class="sect3">
<h4 id="timeouts-moon"><a class="anchor" href="#timeouts-moon"></a>3.6.1. Adjusting Moon Timeouts</h4>
<div class="paragraph">
<p>Sometimes things go wrong: user can unexpectedly disconnect or browser session starts longer than needed. This can lead to overall cluster degradation because of broken browser pods occupying all available hardware. To prevent such cases Moon automatically detects and closes idle browser sessions. A session is considered idle when the delay between separate HTTP requests corresponding to a running session is bigger than configured timeout. Idle timeout may need to be increased when tested application pages are loading too slowly. To view or change idle timeout setting - take a look at <a href="#configuration-object">configuration object</a>:</p>
</div>
<div class="listingblock">
<div class="title">Listing configuration objects as YAML</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ kubectl get configs -n moon -o yaml
apiVersion: v1
items:
- apiVersion: moon.aerokube.com/v1
  kind: Config
  metadata:
    name: default
    namespace: moon
    # Other Kubernetes metadata
  spec:
    # Other fields
    # Use values like 60s or 1m10s here
    sessionTimeout: 5m                        <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Idle session timeout setting</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Several rarely needed Moon <a href="#cli-flags-moon">command-line flags</a> are responsible for advanced timeout settings:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 14. Rarely Needed Command-line Timeout Flags</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Flag</th>
<th class="tableblock halign-left valign-top">Default Value</th>
<th class="tableblock halign-left valign-top">Meaning</th>
<th class="tableblock halign-left valign-top">Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-delete-timeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10 minutes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maximum time to delete Kubernetes resources created for browser session.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Moon deletes resources using Kubernetes API. When this timeout expires - Moon stops respective request and gives up deleting resources.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-session-attempt-timeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">30 minutes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maximum time to start browser pod.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This time includes Kubernetes scheduling time and browser image download duration. You load balancer proxy timeout should be bigger than this setting.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="timeouts-other"><a class="anchor" href="#timeouts-other"></a>3.6.2. Adjusting Other Timeouts</h4>
<div class="paragraph">
<p>Not only Moon timeout settings can cause your tests to break. A typical Moon installation looks like the following:</p>
</div>
<div class="paragraph">
<div class="title">Possible Timeout Sources</div>
<p><span class="image"><img src="img/timeouts.png" alt="timeouts"></span></p>
</div>
<div class="paragraph">
<p>In addition to Moon timeouts other possible sources of timeouts exist:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Client-side Timeout.</strong> Every Selenium library is internally using an HTTP client having default request timeout settings. If you are frequently seeing <code>client disconnected</code> messages (meaning that client disconnected before request handling completed) in Moon log - this could be a sign to increase HTTP client timeouts in your code.</p>
</li>
<li>
<p><strong>Load Balancer Timeout.</strong> Usually Moon is running behind load balancer (<code>LoadBalancer</code>, <code>Ingress</code> or <code>Router</code>), and it also has a default request proxy timeout. A frequent value is <code>60 seconds</code>, so if you are often seeing test fails with <code>502 Bad Gateway</code> or <code>504 Gateway Timeout</code> errors - this could be a sign to increase load balancer timeout. How to do this depends on your cloud platform and load balancer type being used. So refer to their documentation for more details. An example of doing this for AWS cloud is shown in <a href="#faq-connection-closed-unexpectedly">Connection was closed unexpectedly</a> section.</p>
</li>
<li>
<p><strong>Cluster Capacity Reached.</strong> If you are seeing a lot of <code>unexpected status</code> messages in the log that can signalize that you used all available computing resources (CPUs and memory) assigned to Moon namespace.</p>
</li>
<li>
<p><strong>Cluster Fragmentation.</strong> Similarly to the previous one, in some cases you can have sufficient number of cores and not all browsers are exhausted. However, sometimes for example you can have 4 CPUs available distributed among 4 Kubernetes nodes (1 available CPU per node) and a new browser pod requiring at least 2 CPUs to start (all pod containers always run on the same node). In that case although total number of available CPUs is sufficient to start a pod, there is no node where pod will be able to start. If you are seeing too many browser pods in <code>Pending</code> state - check with <code>kubectl</code> command why these pods are not starting.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="resources"><a class="anchor" href="#resources"></a>3.7. Adjusting Resources Consumption</h3>
<div class="sect3">
<h4 id="resources-browser"><a class="anchor" href="#resources-browser"></a>3.7.1. Browser Resources Consumption</h4>
<div class="paragraph">
<p>Moon has reasonable defaults for resources consumed by every browser pod. Sometimes you may need to override these settings. To override resource settings globally for every browser image - use <a href="#configuration-object">configuration object</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="error">$ kubectl get configs -n moon -o yaml</span>
<span class="key">apiVersion</span>: <span class="string"><span class="content">v1</span></span>
<span class="key">items</span>:
- <span class="string"><span class="content">apiVersion: moon.aerokube.com/v1</span></span>
  <span class="key">kind</span>: <span class="string"><span class="content">Config</span></span>
  <span class="key">metadata</span>:
    <span class="key">name</span>: <span class="string"><span class="content">default</span></span>
    <span class="key">namespace</span>: <span class="string"><span class="content">moon</span></span>
    <span class="comment"># Other Kubernetes metadata</span>
  <span class="key">spec</span>:
    <span class="key">containers</span>:
      <span class="key">browser</span>:
        <span class="key">resources</span>:        <i class="conum" data-value="1"></i><b>(1)</b>
          <span class="key">limits</span>:
            <span class="key">cpu</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>
            <span class="key">memory</span>: <span class="string"><span class="content">2Gi</span></span>
      <span class="comment"># Other fields</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Browser container resources configuration</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To update resource settings - simply edit configuration object, save and exit:</p>
</div>
<div class="listingblock">
<div class="title">Editing a configuration object</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ kubectl edit config default -n moon # Update computing resources configuration, save and exit</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also override the same values for every browser type in <a href="#browsers-set">browsers set</a>. An example snippet can be found <a href="#browsers-set-computing-resources">here</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="resources-service-images"><a class="anchor" href="#resources-service-images"></a>3.7.2. Service Images Resources Consumption</h4>
<div class="paragraph">
<p>To check service images resources requirements - simply show configuration object for your quota in YAML format:</p>
</div>
<div class="listingblock">
<div class="title">Listing configuration objects as YAML</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="error">$ kubectl get configs -n moon -o yaml</span>
<span class="key">apiVersion</span>: <span class="string"><span class="content">v1</span></span>
<span class="key">items</span>:
- <span class="string"><span class="content">apiVersion: moon.aerokube.com/v1</span></span>
  <span class="key">kind</span>: <span class="string"><span class="content">Config</span></span>
  <span class="key">metadata</span>:
    <span class="key">name</span>: <span class="string"><span class="content">default</span></span>
    <span class="key">namespace</span>: <span class="string"><span class="content">moon</span></span>
    <span class="comment"># Other Kubernetes metadata</span>
  <span class="key">spec</span>:
    <span class="key">containers</span>:
      <span class="key">browser</span>:
        <span class="comment"># Some fields</span>
      <span class="key">ca-certs</span>:
        <span class="comment"># More fields go here</span>
        <span class="key">resources</span>:
          <span class="key">limits</span>:
            <span class="key">cpu</span>: <span class="string"><span class="content">250m</span></span>
            <span class="key">memory</span>: <span class="string"><span class="content">64Mi</span></span>
          <span class="key">requests</span>:
            <span class="key">cpu</span>: <span class="string"><span class="content">100m</span></span>
            <span class="key">memory</span>: <span class="string"><span class="content">64Mi</span></span>
      <span class="key">defender</span>:
        <span class="comment"># The same fields as for ca-certs</span>
      <span class="key">video-recorder</span>:
        <span class="comment"># The same fields as for ca-certs</span>
      <span class="key">vnc-server</span>:
        <span class="comment"># The same fields as for ca-certs</span>
      <span class="key">x-server</span>:
        <span class="comment"># The same fields as for ca-certs</span>
      <span class="comment"># Other fields</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To adjust CPU and memory consumption for each service image - simply update <a href="#configuration-object">configuration object</a> accordingly.</p>
</div>
</div>
<div class="sect3">
<h4 id="resources-qos"><a class="anchor" href="#resources-qos"></a>3.7.3. Pods Quality of Service</h4>
<div class="paragraph">
<p>Browser automation stability and speed highly depends on how many computing resources are actually available to browser pods. Kubernetes has so-called <a href="https://kubernetes.io/docs/tasks/configure-pod-container/quality-service-pod/">Quality of Service (QoS)</a> defining how many resources are assigned to pods being started. For stable browser automation we recommend always setting <code>Guaranteed</code> QoS class to Moon browser pods. To deliver this you have to make sure that <code>requests</code> and <code>limits</code> values for CPU and memory have equal values:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Moon by default sets <code>requests</code> equal to <code>limits</code> for service images like <code>defender</code>, <code>logger</code> and <code>videoRecorder</code>. But in recent releases you can override them independently if you wish.</p>
</li>
<li>
<p>For browser containers you can override <code>requests</code> and <code>limits</code> independently. Anyway we also recommend setting them to equal values. Only this way you will be sure that browsers are always getting the same computing resources. Otherwise, you may encounter randomly failing browser tests caused by insufficient computing resources assigned to some browser pods.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ca-certs"><a class="anchor" href="#ca-certs"></a>3.8. Using Additional Trusted TLS Certificates</h3>
<div class="paragraph">
<p>In corporate networks tested environments are often using additional trusted <a href="https://en.wikipedia.org/wiki/Transport_Layer_Security">TLS</a> certificates. Such certificates are issued by a <a href="https://en.wikipedia.org/wiki/Root_certificate">root certification authority</a> not known to browsers. When trying to open an HTTPS web-page using such TLS certificate, your browser by default will refuse to do this saying that "Your connection is not private" or "This connection is untrusted". In Selenium tests you can use a standard capability (<code>acceptInsecureCerts = true</code>) to ignore such certificate errors but this will not work when your web-page is using <a href="https://en.wikipedia.org/wiki/HTTP_Strict_Transport_Security">Strict Transport Security</a>.</p>
</div>
<div class="paragraph">
<p>In order to work properly with additional trusted TLS certificates, you have to add your root certification authority certificate to a list of trusted certificates:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Find root certificate for certification authority being used to secure your tested environment. Usually such certificates are being issued by IT security team or systems administrators and are publicly available in corporate network. For example your root certificate can look like this:</p>
<div class="literalblock">
<div class="content">
<pre>$ cat rootCA.crt
-----BEGIN CERTIFICATE-----
MIIGjzCCBHegAwIBAgIJAK1lW/5z8ZSoMA0GCSqGSIb3DQEBCwUAMIGLMQswCQYD
VQQGEwJFRTEQMA4GA1UECBMHRXN0b25pYTEQMA4GA1UEBxMHVGFsbGlubjEeMBwG
A1UEChQVQWVyb2t1YmUgU29mdHdhcmUgT8OcMRUwEwYDVQQDEwxhZXJva3ViZS5j
b20xITAfBgkqhkiG9w0BCQEWEmFkbWluQGFlcm9rdWJlLmNvbTAeFw0yMTAyMTcw
NjQ5NDJaFw0yMzEyMDgwNjQ5NDJaMIGLMQswCQYDVQQGEwJFRTEQMA4GA1UECBMH
RXN0b25pYTEQMA4GA1UEBxMHVGFsbGlubjEeMBwGA1UEChQVQWVyb2t1YmUgU29m
dHdhcmUgT8OcMRUwEwYDVQQDEwxhZXJva3ViZS5jb20xITAfBgkqhkiG9w0BCQEW
EmFkbWluQGFlcm9rdWJlLmNvbTCCAiIwDQYJKoZIhvcNAQEBBQADggIPADCCAgoC
ggIBAKdh54x9WZsSxIMfz1rFEHuJ8+3meUua0Q8cpgC/70F0G6X6BXOki0Cu7iET
6ETfirWuUdRKKGKXHLF8Fdv6WTqnLlDqgzy1Wp9DuPIgeJ+ztKZt+uJFkWjfQb9R
mn7Qs4vp/F9HTwqlTZl5jMQ+/nrcNAQeNEZ1H1AfZWAuSvrqp3rW33wl6IBZcqfD
VsMBknBKm/Zc8GpggY8NYxkfj7Jo2izwn/tV+DFgwF0pJkUrDZPPTiNW7q8Se2Vb
7tC6Iy9ZVgkH8hkrWrPzwW4zxz/d/Si7/cnn9A9+bF+pKrsHktnQ0ScDEAR5+52J
XAXkES/4pINpBcxvNUHGO6KXKH4rJVf3QvXXany0ugwVQ+QXirA6yOoY3XFgBxgU
P7Qd5pyQdVf/SwJ5Uk5Z9b2HXk8k/6jNxe1A6WiojTOnn1fD/VzOTn4xiobqNIpE
w5dUhlj/TiN+g3uGBH4BPo6IYHCmfsXFEcSZW75k7dRlZ3ZMI4k0utUVm3Y8B+TC
sj4WmwnXetFP2EMnRft7BnR13oLyzrFB8tkFafstcVoE6oR20pIBtAFxrSDWJ5dA
XdX2NGPNUCnd1RqJxu2SGA/xHHsyPT06iJeIZGUyRXmv6vBvyCkyeLtMEdq2Gzfi
MT0GtDkG5R+al/A+Ot3w3CMbMgUFrxvEhlxM1sEitclXJc4tAgMBAAGjgfMwgfAw
HQYDVR0OBBYEFBb9mCFAqV/JgmMxtwQ6UKzoLIQQMIHABgNVHSMEgbgwgbWAFBb9
mCFAqV/JgmMxtwQ6UKzoLIQQoYGRpIGOMIGLMQswCQYDVQQGEwJFRTEQMA4GA1UE
CBMHRXN0b25pYTEQMA4GA1UEBxMHVGFsbGlubjEeMBwGA1UEChQVQWVyb2t1YmUg
U29mdHdhcmUgT8OcMRUwEwYDVQQDEwxhZXJva3ViZS5jb20xITAfBgkqhkiG9w0B
CQEWEmFkbWluQGFlcm9rdWJlLmNvbYIJAK1lW/5z8ZSoMAwGA1UdEwQFMAMBAf8w
DQYJKoZIhvcNAQELBQADggIBAIUmJsxdrT8AN2yZqzI69qQKjLnDhuojdgM3XGL3
gJTldXR5OIMnw/na8WcIC3onHjgijUeEfslTIIHmNcqOd3hTfOq4Qq2/Qmpp+h1d
5dCzScrLFiDgjnzkX0VczOj/BtnZMgxx5x8YO80MMUWVEmVCk+i2bFVTypV9e4qw
1EJLmGTnKoo7l2jPHLUB5lL2LvSO4KHDhmWG5wtFg7/nd097yG5uBHda5ytbc6S8
CIS8IBJzd7TA4fr3qOhC298LMD96nJdccHqKYtlFvf9YZZ500nrA+pH6Kpo8PD67
8WiIW/CMtO0X9pxw+KRlmaDmCGGgRhvPyHoYqbX4svrca8uvErePtXIQILe/IISJ
TXLkiVsej8k3UDu77q/wX3ZdzknWakZyPj+CtYkkZL4vqkIDIFSUcXfynyDZNZEo
2d+npABzPB42+4xGZGGnFIsfuTMAgpbK8TAgPQNMIawfWTq2KhZ8MYHfPdkU3FBo
MaExr684sviAImqOotcoNQV2iMOKdwzA097jRBrfa43LhpdoWM0v7RVxB8s+kG0P
8nHOGmp6r6cIAk5hjHYAwQYiZjXuzvnFTtD9Ily63i+yVh8nRSY9NSLhpFpl4ezo
hn+savO4nm/HueAATnGR1iPlKnfXNVqQYdl+wwzqK1/3iHjzUUjyQkk0oTBk4Bez
ejbh
-----END CERTIFICATE-----</pre>
</div>
</div>
</li>
<li>
<p>Add certificate data to <a href="#configuration-object">configuration object</a>:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">apiVersion</span>: <span class="string"><span class="content">moon.aerokube.com/v1</span></span>
<span class="key">kind</span>: <span class="string"><span class="content">Config</span></span>
<span class="key">metadata</span>:
    <span class="key">name</span>: <span class="string"><span class="content">default</span></span>
    <span class="key">namespace</span>: <span class="string"><span class="content">moon</span></span>
    <span class="comment"># Other Kubernetes metadata</span>
<span class="key">spec</span>:
  <span class="key">additionalTrustedCAs</span>: <span class="string"><span class="delimiter">|</span><span class="content">
    -----BEGIN CERTIFICATE-----
    MIIGjzCCBHegAwIBAgIJAK1lW/5z8ZSoMA0GCSqGSIb3DQEBCwUAMIGLMQswCQYD
    VQQGEwJFRTEQMA4GA1UECBMHRXN0b25pYTEQMA4GA1UEBxMHVGFsbGlubjEeMBwG
    A1UEChQVQWVyb2t1YmUgU29mdHdhcmUgT8OcMRUwEwYDVQQDEwxhZXJva3ViZS5j
    ....</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If you need to add several certificates - then add every certificate to the new line:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">apiVersion</span>: <span class="string"><span class="content">moon.aerokube.com/v1</span></span>
<span class="key">kind</span>: <span class="string"><span class="content">Config</span></span>
<span class="key">metadata</span>:
    <span class="key">name</span>: <span class="string"><span class="content">default</span></span>
    <span class="key">namespace</span>: <span class="string"><span class="content">moon</span></span>
    <span class="comment"># Other Kubernetes metadata</span>
<span class="key">spec</span>:
  <span class="key">additionalTrustedCAs</span>: <span class="string"><span class="delimiter">|</span><span class="content">
    -----BEGIN CERTIFICATE-----
    MIIGjzCCBHegAwIBAgIJAK1lW/5z8ZSoMA0GCSqGSIb3DQEBCwUAMIGLMQswCQYD
    VQQGEwJFRTEQMA4GA1UECBMHRXN0b25pYTEQMA4GA1UEBxMHVGFsbGlubjEeMBwG
    A1UEChQVQWVyb2t1YmUgU29mdHdhcmUgT8OcMRUwEwYDVQQDEwxhZXJva3ViZS5j
    ...
    -----END CERTIFICATE-----
    -----BEGIN CERTIFICATE-----
    MIIDBjCCAe6gAwIBAgIBATANBgkqhkiG9w0BAQsFADAVMRMwEQYDVQQDEwptaW5p
    a3ViZUNBMB4XDTIyMDExMDEzMzgwNloXDTMyMDEwOTEzMzgwNlowFTETMBEGA1UE
    AxMKbWluaWt1YmVDQTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBALpJ
    ...
    -----END CERTIFICATE-----</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Added certificates are automatically applied to all browser types and uploading videos to S3 endpoints.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="multiple-namespaces"><a class="anchor" href="#multiple-namespaces"></a>3.9. Multiple Namespaces Mode</h3>
<div class="paragraph">
<p>This section has <a href="#users-basic-http-nginx-automated">moved</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="advanced-settings"><a class="anchor" href="#advanced-settings"></a>3.10. Advanced Settings</h3>
<div class="paragraph">
<p>This section describes how to configure some advanced features sometimes required by Kubernetes cluster settings. Moon is using just the same keys and values that Kubernetes itself does for most of the settings below. This is how a typical Kubernetes pod looks like:</p>
</div>
<div class="listingblock">
<div class="title">Standard Kubernetes pod YAML</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">apiVersion</span>: <span class="string"><span class="content">v1</span></span>
<span class="key">kind</span>: <span class="string"><span class="content">Pod</span></span>
<span class="key">metadata</span>:
  <span class="key">name</span>: <span class="string"><span class="content">my-app</span></span>
  <span class="key">annotations</span>:
    <span class="key">key1</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">value1</span><span class="delimiter">&quot;</span></span>
    <span class="key">key2</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">value2</span><span class="delimiter">&quot;</span></span>
  <span class="key">labels</span>:
    <span class="key">key1</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">value1</span><span class="delimiter">&quot;</span></span>
    <span class="key">key2</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">value2</span><span class="delimiter">&quot;</span></span>
<span class="key">spec</span>:
  <span class="key">containers</span>:
  - <span class="string"><span class="content">name: app</span></span>
    <span class="key">image</span>: <span class="string"><span class="content">my-company/my-app:1.0.0</span></span>
    <span class="key">resources</span>:
      <span class="key">requests</span>:
        <span class="key">memory</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">64Mi</span><span class="delimiter">&quot;</span></span>
        <span class="key">cpu</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">250m</span><span class="delimiter">&quot;</span></span>
      <span class="key">limits</span>:
        <span class="key">memory</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">128Mi</span><span class="delimiter">&quot;</span></span>
        <span class="key">cpu</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">500m</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now compare this with one of Moon objects:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">apiVersion</span>: <span class="string"><span class="content">moon.aerokube.com/v1</span><span class="content">
  kind: BrowserSet
  metadata:
    name: default
    namespace: moon
    # Other Kubernetes metadata
  spec:
    annotations:
      key1: &quot;value1&quot;
      key2: &quot;value2&quot;
    labels:
      key1: &quot;value1&quot;
      key2: &quot;value2&quot;</span></span></code></pre>
</div>
</div>
<div class="sect3">
<h4 id="advanced-settings-annotations"><a class="anchor" href="#advanced-settings-annotations"></a>3.10.1. Adding Custom Kubernetes Annotations</h4>
<div class="paragraph">
<p>This is configured globally or for concrete browser types in <a href="#browsers-set">browsers set</a>. How to do this is described <a href="#browsers-set-custom-annotations">here</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="advanced-settings-labels"><a class="anchor" href="#advanced-settings-labels"></a>3.10.2. Adding Custom Kubernetes Labels</h4>
<div class="paragraph">
<p>This is configured globally or for concrete browser types in <a href="#browsers-set">browsers set</a>. How to do this is described <a href="#browsers-set-custom-labels">here</a>. Also, you can override labels using <a href="#capability-labels"><code>labels</code> capability</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="advanced-settings-network-policies"><a class="anchor" href="#advanced-settings-network-policies"></a>3.10.3. Adding Network Policies</h4>
<div class="paragraph">
<p><a href="https://kubernetes.io/docs/concepts/services-networking/network-policies/">Network policies</a> are dedicated Kubernetes objects allowing to control network firewall rules. Using them with Moon is straightforward:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a <code>NetworkPolicy</code> object. This is how it can look like:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">apiVersion</span>: <span class="string"><span class="content">networking.k8s.io/v1</span></span>
<span class="key">kind</span>: <span class="string"><span class="content">NetworkPolicy</span></span>
<span class="key">metadata</span>:
  <span class="key">name</span>: <span class="string"><span class="content">my-network-policy</span></span>
  <span class="key">namespace</span>: <span class="string"><span class="content">moon</span></span>
<span class="key">spec</span>:
  <span class="key">podSelector</span>:
    <span class="key">matchLabels</span>: <span class="comment"># This rule will apply pods matching labels below</span>
      <span class="key">role</span>: <span class="string"><span class="content">browser</span></span>
  <span class="key">ingress</span>:
  - <span class="string"><span class="content">from:</span></span>
    - <span class="string"><span class="content">podSelector:</span><span class="content">
        matchLabels:
          role: my-app</span></span>
    <span class="key">ports</span>:
    - <span class="string"><span class="content">protocol: TCP</span></span>
      <span class="key">port</span>: <span class="string"><span class="content">6379</span></span></code></pre>
</div>
</div>
</li>
<li>
<p>Use <a href="#advanced-settings-labels">custom labels</a> to add respective label to browser pods:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">selenium</span>:
  <span class="key">chrome</span>:
    <span class="key">repository</span>: <span class="string"><span class="content">quay.io/browser/google-chrome-stable</span></span>
    <span class="key">labels</span>:
      <span class="key">role</span>: <span class="string"><span class="content">browser</span></span> <span class="comment"># Every Chrome pod will have this label set</span></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="node-selectors"><a class="anchor" href="#node-selectors"></a>3.10.4. Using Node Selectors</h4>
<div class="paragraph">
<p>This is configured globally or for concrete browser types in <a href="#browsers-set">browsers set</a>. How to do this is described <a href="#browsers-set-node-selectors">here</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="affinity"><a class="anchor" href="#affinity"></a>3.10.5. Using Affinity</h4>
<div class="paragraph">
<p>This is configured globally or for concrete browser types in <a href="#browsers-set">browsers set</a>. How to do this is described <a href="#browsers-set-affinity">here</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="tolerations"><a class="anchor" href="#tolerations"></a>3.10.6. Using Tolerations</h4>
<div class="paragraph">
<p>This is configured globally or for concrete browser types in <a href="#browsers-set">browsers set</a>. How to do this is described <a href="#browsers-set-tolerations">here</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="privileged-mode"><a class="anchor" href="#privileged-mode"></a>3.10.7. Running Browser Pods in Privileged Mode</h4>
<div class="paragraph">
<p>This is configured for concrete browser types in <a href="#browsers-set">browsers set</a>. How to do this is described <a href="#browsers-set-privileged-mode">here</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="advanced-settings-user-group"><a class="anchor" href="#advanced-settings-user-group"></a>3.10.8. Setting Custom User and Group Identifier to Browser Pods</h4>
<div class="paragraph">
<p>In Moon 2.x this is configured for all browser pods in <a href="#configuration-object">configuration object</a>. If you need to use different user and group identifiers for different Moon users, simply create several configuration objects and attach them to respective quota objects. Default values are:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 15. Default user and group assigned to browser pods</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default user id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4096</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default user name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">user</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default group id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4096</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default group name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">user</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="advanced-settings-service-account"><a class="anchor" href="#advanced-settings-service-account"></a>3.10.9. Setting Custom Service Account</h4>
<div class="paragraph">
<p>This is configured globally for all browser pods in <a href="#configuration-object">configuration object</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="upgrade"><a class="anchor" href="#upgrade"></a>3.11. Upgrading Moon Version</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Moon versions are following <a href="https://semver.org/">semantic versioning</a> scheme (<code>MAJOR.MINOR.PATCH</code>), e.g. 2.3.0, 2.5.3 and so on. Major version component means Moon generation (currently always equals to <code>2</code>). Minor version component is changed when we add new important features. Patch version component is changed when release mainly contains minor improvements and bug fixes.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Moon main <a href="#install-helm">installation</a> method is using <a href="https://helm.sh/">Helm</a> and a typical command allowing to do this is:</p>
</div>
<div class="listingblock">
<div class="title">A typical Moon installation command</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ helm upgrade --install -n moon moon aerokube/moon2</code></pre>
</div>
</div>
<div class="paragraph">
<p>Usually to upgrade software version with Helm you do:</p>
</div>
<div class="listingblock">
<div class="title">Upgrading Moon to the version with changed patch component only</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ helm repo update # To fetch latest Helm chart information
$ helm upgrade --install -n moon moon aerokube/moon2 # Exactly the same command as for fresh installation</code></pre>
</div>
</div>
<div class="paragraph">
<p>Commands above will work when upgrading Moon to the version where patch number changed (e.g. from 2.5.0 to 2.5.1, 2.5.2 and so on). However, if you are upgrading Moon to the version where minor component has changed (e.g. from 2.4.0 to 2.5.0), then upgrade procedure can be a bit more complex. This is because Moon 2 relies on so-called Kubernetes <a href="https://kubernetes.io/docs/concepts/extend-kubernetes/api-extension/custom-resources/">custom resources</a> to store its configuration and from time to time we add new configuration fields to these resources. Currently, Helm <a href="https://helm.sh/docs/chart_best_practices/custom_resource_definitions/#some-caveats-and-explanations">never upgrades</a> previously installed custom resource definitions, so you have to do this manually when upgrading to the new version with changed custom resource definitions:</p>
</div>
<div class="listingblock">
<div class="title">Upgrading Moon to the version with changed custom resource definitions</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ helm repo update
$ helm delete moon -n moon # Completely uninstall previous version
$ kubectl delete crd $(kubectl get crd | grep moon.aerokube.com | awk '{print $1}') # Delete custom resource definitions from previous Moon version
$ helm upgrade --install -n moon moon aerokube/moon2 # Install new Moon version</code></pre>
</div>
</div>
<div class="paragraph">
<p>We usually note about custom resource definitions change in release notes (like <a href="https://github.com/aerokube/moon/releases/2.5.0">here</a>). If you forget to upgrade custom resource definitions Moon can stop working with messages like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash"># During Helm upgrade command
unknown field &quot;spec.containers.proxy&quot;

# In Moon logs:
moon: no such config: &quot;default&quot;
config controller: config &quot;default&quot;: add: validate containers.proxy: value is not set: using default</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="monitoring"><a class="anchor" href="#monitoring"></a>3.12. Monitoring</h3>
<div class="paragraph">
<p>You can easily visualize browsers consumption and other Moon metrics with <a href="https://prometheus.io/">Prometheus</a> and <a href="https://grafana.com/">Grafana</a>. One of the simplest ways of deploying Prometheus in Kubernetes is using <a href="https://github.com/coreos/prometheus-operator">Prometheus Operator</a>.</p>
</div>
<div class="sect3">
<h4 id="monitoring-setup"><a class="anchor" href="#monitoring-setup"></a>3.12.1. Setup</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Moon should be already running (e.g. in <code>moon</code> namespace).</p>
</li>
<li>
<p>Deploy Prometheus and Grafana using Prometheus Operator (e.g. to <code>monitoring</code> namespace).</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>An example installation command using Helm 3 is:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ helm repo add prometheus-community https://prometheus-community.github.io/helm-charts
$ helm repo update
$ helm install kube-prometheus-stack prometheus-community/kube-prometheus-stack --create-namespace --namespace monitoring</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Having a configured Prometheus instance you have two ways of getting metrics: <strong>using built-in Moon metrics</strong> and <strong>filtering browser pods by labels</strong>.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="monitoring-built-in-metrics"><a class="anchor" href="#monitoring-built-in-metrics"></a>3.12.2. Built-in Moon metrics</h4>
<div class="paragraph">
<p>Built-in Moon metrics are exposed on the standard <code>/metrics</code> HTTP API.</p>
</div>
<div class="listingblock">
<div class="title">Getting Prometheus metrics</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ curl -s https://moon.example.com/metrics
# A lot of metrics come here</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following metrics are available:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 16. Moon Built-in Prometheus Metrics</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Labels</th>
<th class="tableblock halign-left valign-top">Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">moon_browser_limit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">gauge</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maximum number of browser sessions allowed by installed license key</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">moon_browser_running</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">gauge</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Total number of currently running browser sessions</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">moon_browser_count</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">gauge</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">quota, browserName, browserVersion</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Browser consumption corresponding to exact browser name and version</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">moon_browser_queued</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">gauge</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Total number of browser requests in queue</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">moon_license_expire</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">gauge</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Moon license key expiration timestamp</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="filter-by-labels"><a class="anchor" href="#filter-by-labels"></a>3.12.3. Filtering Browser Pods by Labels</h4>
<div class="paragraph">
<p>Installing Prometheus with <code>kube-prometheus-stack</code> will also automatically install <a href="https://github.com/kubernetes/kube-state-metrics">kube-state-metrics</a> component. This component allows you to filter Kubernetes pods by labels, annotations, status, start time and so on. To fetch information about browser pods with some labels set, use the following Prometheus query:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>kube_pod_labels{label_moon="browser", label_browserName="chrome", label_browserVersion="96.0"}</pre>
</div>
</div>
<div class="paragraph">
<p>Full list of available expressions can be found <a href="https://github.com/kubernetes/kube-state-metrics/blob/master/docs/pod-metrics.md">here</a>.</p>
</div>
<div class="paragraph">
<p>Moon can add custom labels to started browser pods (e.g. browser automation project name, tested feature name and so on). This can be done globally in using <a href="#browsers-set-custom-labels">browsers set</a>, <a href="#capability-labels">Selenium capabilities</a> and so on. For example, after having a label <code>project="MyCoolProject"</code> on browser pods, you can filter such pods like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>kube_pod_labels{label_moon="browser", label_project="MyCoolProject", label_browserName="chrome"}</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="log-files"><a class="anchor" href="#log-files"></a>3.13. Log Files</h3>
<div class="paragraph">
<p>Although Moon should just work out of the box, sometimes you may need the log output. Every Moon component is outputting logs to standard output (<code>stdout</code>), so you can use well-known <code>kubectl</code> commands to see the log. Everything related to browser sessions is being output by <code>moon</code> container:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ kubectl logs -lapp=moon -c moon -n moon</pre>
</div>
</div>
<div class="paragraph">
<p>To follow the logs while running the tests add <code>-f</code> flag:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ kubectl logs -f -lapp=moon -c moon -n moon</pre>
</div>
</div>
<div class="paragraph">
<p>You can also take a look at <code>moon-conf</code> and <code>moon-ui</code> logs as follows:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ kubectl logs -f -lapp=moon -c moon-conf -n moon
$ kubectl logs -f -lapp=moon -c moon-ui -n moon</pre>
</div>
</div>
<div class="paragraph">
<p>If you are encountering browser pods not being deleted - then take a look at <code>defender</code> container logs for every frozen browser pod:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ kubectl logs chrome-73-0-ac15ffaa-e641-4c7f-a54c-f25b5be1f135 -c defender -n moon</pre>
</div>
</div>
<div class="paragraph">
<p>Here <code>chrome-73-0-ac15ffaa-e641-4c7f-a54c-f25b5be1f135</code> is the browser session ID equal to browser pod name.</p>
</div>
</div>
<div class="sect2">
<h3 id="_cli_flags"><a class="anchor" href="#_cli_flags"></a>3.14. CLI Flags</h3>
<div class="paragraph">
<p>These flags should be <a href="https://kubernetes.io/docs/tasks/inject-data-application/define-command-argument-container/#define-a-command-and-arguments-when-you-create-a-pod">specified</a> in Kubernetes YAML files when starting the cluster.</p>
</div>
<div class="sect3">
<h4 id="cli-flags-moon"><a class="anchor" href="#cli-flags-moon"></a>3.14.1. Moon Container Flags</h4>
<div class="paragraph">
<p>The following flags are supported:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>-browser-limit value
    parallel browser sessions limit
-callback-url value
    moon callback url
-delete-timeout duration
    timeout to delete Kubernetes resources (default 10m0s)
-grace-period duration
    graceful shutdown period (default 5m0s)
-listen string
    host and port to listen to (default ":4444")
-moon-url value
    moon service url (default http://moon.moon:4444/wd/hub)
-session-attempt-timeout duration
    new session attempt timeout (default 30m0s)
-version
    show version and exit</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="cli-flags-moon-auth"><a class="anchor" href="#cli-flags-moon-auth"></a>3.14.2. Moon Auth Container Flags</h4>
<div class="paragraph">
<p>The following flags are supported:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>-ca-cert string
    ca certificate to verify discovery cert (optional)
-client-id string
    client id (required)
-client-secret string
    client secret (required)
-discovery-url value
    oidc discovery url (required)
-fail-login-timeout duration
    request timeout (default 30s)
-grace-period duration
    graceful shutdown period (default 30s)
-group value
    allowed user groups (optional)
-ignore-case
    ignore user groups case
-listen string
    address to bind (default ":4545")
-request-timeout duration
    request timeout (default 30s)
-upstream-url value
    upstream url (default http://127.0.0.1:4444/)
-version
    show version and exit</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="cli-flags-moon-basic-auth"><a class="anchor" href="#cli-flags-moon-basic-auth"></a>3.14.3. Moon Basic Auth Container Flags</h4>
<div class="paragraph">
<p>The following flags are supported:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>-f string
    htpasswd file path (default "/conf/auth")
-grace-period duration
    graceful shutdown period (default 30s)
-listen string
    address to bind (default ":4545")
-upstream-url value
    upstream url (default http://127.0.0.1:4444/)</pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_frequently_asked_questions"><a class="anchor" href="#_frequently_asked_questions"></a>4. Frequently Asked Questions</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="faq-moon-logs"><a class="anchor" href="#faq-moon-logs"></a>4.1. Where are Moon logs?</h3>
<div class="paragraph">
<p>See <a href="#log-files">Log Files</a> section.</p>
</div>
</div>
<div class="sect2">
<h3 id="faq-recorded-videos"><a class="anchor" href="#faq-recorded-videos"></a>4.2. Where are recorded videos stored?</h3>
<div class="paragraph">
<p>Moon automatically saves session logs and recorded video files to <a href="https://en.wikipedia.org/wiki/Amazon_S3">S3</a> compatible storage. If S3 storage is not configured - then video recording will not work.</p>
</div>
</div>
<div class="sect2">
<h3 id="faq-update-configuration"><a class="anchor" href="#faq-update-configuration"></a>4.3. How to update configuration of a running Moon cluster?</h3>
<div class="paragraph">
<p>Just update respective custom resources (<code>config</code>, <code>browserset</code>, <code>deviceset</code>, <code>quota</code>, <code>license</code>) with standard Kubernetes commands (<code>kubectl edit</code> or <code>kubectl replace</code>). For example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ kubectl edit config default -n moon # Updating configuration object
$ kubectl edit browserset default -n moon # Updating Moon browsers set
$ kubectl edit deviceset users -n moon # Updating Moon devices set
$ kubectl edit quota default -n moon # Updating Moon quota
$ kubectl edit license moon # Updating Moon license key</pre>
</div>
</div>
<div class="paragraph">
<p>These commands will open your preferred editor with respective data: do any desired modifications, save and exit. Changes are applied immediately.</p>
</div>
</div>
<div class="sect2">
<h3 id="faq-kubernetes-service-account"><a class="anchor" href="#faq-kubernetes-service-account"></a>4.4. Is it possible to configure Kubernetes service account for Moon?</h3>
<div class="paragraph">
<p>Yes, Moon has <code>serviceAccountName</code> setting in <a href="#configuration-object">configuration object</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="faq-custom-firewall-rules"><a class="anchor" href="#faq-custom-firewall-rules"></a>4.5. Is it possible to assign custom firewall rules to browser pods?</h3>
<div class="paragraph">
<p>Yes, using built-in <a href="https://kubernetes.io/docs/concepts/services-networking/network-policies/">Kubernetes Network Policies</a> feature. Moon already can assign custom labels to running browser pods. To apply a firewall rule to browser pods you need to assign a set of custom labels to these pods and then create a <code>NetworkPolicy</code> matching pods with <code>podSelector</code> using these labels. An example of how you can do this is shown <a href="#advanced-settings-network-policies">here</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="faq-connection-closed-unexpectedly"><a class="anchor" href="#faq-connection-closed-unexpectedly"></a>4.6. Connection was closed unexpectedly</h3>
<div class="paragraph">
<p>If your HTTP requests are randomly hanging - this can mean that you can have too small HTTP request timeout value on your network load balancer (<code>LoadBalancer</code>, <code>Ingress</code>, Openshift <code>Route</code>). Very often default value is about <code>30 seconds</code> and this can lead to closed connections when a lot of new Selenium session requests are being sent to Moon. How to set timeout setting usually depends on cloud platform you are using. For example when using AWS load balancer this can look like:</p>
</div>
<div class="listingblock">
<div class="title">Increasing AWS Load Balancer Timeout</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">kind</span>: <span class="string"><span class="content">Service</span></span>
<span class="key">apiVersion</span>: <span class="string"><span class="content">v1</span></span>
<span class="key">metadata</span>:
  <span class="key">name</span>: <span class="string"><span class="content">moon</span></span>
  <span class="key">namespace</span>: <span class="string"><span class="content">moon</span></span>
  <span class="key">annotations</span>:
    <span class="key">service.beta.kubernetes.io/aws-load-balancer-connection-idle-timeout</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">60</span><span class="delimiter">&quot;</span></span> <span class="comment"># AWS load balancer timeout setting</span>
<span class="key">spec</span>:
  <span class="key">type</span>: <span class="string"><span class="content">LoadBalancer</span></span>
  <span class="comment"># The rest of spec goes here...</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>With Nginx Ingress this can be adjusted like this:</p>
</div>
<div class="listingblock">
<div class="title">Increasing Nginx Ingress Timeout</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">apiVersion</span>: <span class="string"><span class="content">networking.k8s.io/v1</span></span>
<span class="key">kind</span>: <span class="string"><span class="content">Ingress</span></span>
<span class="key">metadata</span>:
  <span class="key">name</span>: <span class="string"><span class="content">moon</span></span>
  <span class="key">namespace</span>: <span class="string"><span class="content">moon</span></span>
  <span class="key">annotations</span>:
    <span class="key">nginx.ingress.kubernetes.io/proxy-connect-timeout</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">108000</span><span class="delimiter">&quot;</span></span> <span class="comment"># Note these timeout settings</span>
    <span class="key">nginx.ingress.kubernetes.io/proxy-send-timeout</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">108000</span><span class="delimiter">&quot;</span></span>
    <span class="key">nginx.ingress.kubernetes.io/proxy-read-timeout</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">108000</span><span class="delimiter">&quot;</span></span>
<span class="key">spec</span>:
  <span class="key">ingressClassName</span>: <span class="string"><span class="content">nginx</span></span>
  <span class="key">rules</span>:
    <span class="comment"># Rules come here...</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="faq-dns-lookup-timeouts"><a class="anchor" href="#faq-dns-lookup-timeouts"></a>4.7. DNS lookup timeouts</h3>
<div class="paragraph">
<p>If you are using <a href="https://github.com/coreos/flannel">Flannel</a> as Kubernetes networking engine and receiving DNS lookup timeouts like the following&#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>2019/02/21 08:37:32 [VNC_ERROR] [10.244.1.1] [dial tcp: lookup chrome-71-0-686efb96-eabe-4435-af31-21a33c8a4c8b on 10.96.0.10:53: read udp 10.244.1.11:40603-&gt;10.96.0.10:53: i/o timeout]</code></pre>
</div>
</div>
<div class="paragraph">
<p>&#8230;&#8203;then you may need to set the following kernel property on Kubernetes nodes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>$ sysctl net.bridge.bridge-nf-call-iptables=1</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="faq-session-timeouts-do-no-work"><a class="anchor" href="#faq-session-timeouts-do-no-work"></a>4.8. Browser session timeouts do not work</h3>
<div class="paragraph">
<p>This could because of incorrectly set <code>-moon-url</code> flag value. By default Moon is being exposed using Kubernetes service named <code>moon</code> and is available on port <code>4444</code>. In that case everything works out of the box with default <code>-moon-url</code> flag value. In customized deployment your Moon service name can differ and you have to set <code>-moon-url</code> value flag explicitly. For example, having Moon being exposed with service named <code>my-custom-moon-service</code> on port <code>3333</code>, you have to explicitly add flag <code>-moon-url <a href="http://my-custom-moon-service:3333/wd/hub" class="bare">http://my-custom-moon-service:3333/wd/hub</a></code> to your deployment manifests.</p>
</div>
</div>
<div class="sect2">
<h3 id="faq-json-errors"><a class="anchor" href="#faq-json-errors"></a>4.9. JSON processing errors in tests</h3>
<div class="paragraph">
<p>In some environments your Selenium tests could from time to time start getting JSON processing errors like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>Json exception: Expected to read a START_MAP but instead have: END. Last 0 characters read</code></pre>
</div>
</div>
<div class="paragraph">
<p>The main reason of such behavior usually is incorrectly configured request proxy timeout on <code>LoadBalancer</code> or <code>Ingress</code> time. Very frequently default timeout value is <code>60 seconds</code> and in cases when some Selenium operation takes more time, load balancer will abort request and send 502 error with no body or with HTML body. However Selenium clients always expect to have JSON in Selenium response body and anything else leads to JSON processing exceptions. To solve this - increase request timeout on load balancer side. How to do this should be described in load balancer documentation.</p>
</div>
</div>
<div class="sect2">
<h3 id="faq-private-registry"><a class="anchor" href="#faq-private-registry"></a>4.10. Is it possible to use Moon with private Docker registry?</h3>
<div class="paragraph">
<p>Yes. How to do this is described <a href="#private-container-registry">here</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="faq-ca-certs"><a class="anchor" href="#faq-ca-certs"></a>4.11. Is it possible to test HTTPS web applications with self-signed TLS certificates?</h3>
<div class="paragraph">
<p>Yes, you can globally configure self-signed TLS root certification authorities. How to do this is shown <a href="#ca-certs">here</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_license_agreement"><a class="anchor" href="#_license_agreement"></a>5. License Agreement</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Last updated March 18th, 2022. Replaces the prior version in its entirety.</p>
</div>
<div class="paragraph">
<p>This is a legal agreement. By downloading, installing, copying, saving on Customer&#8217;s computer, or otherwise using Aerokube software, support or products Customer becomes a party to this Agreement and Customer consents to be bound by all the terms and conditions set forth below.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Parties</strong></p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p><strong>"Aerokube"</strong>, <strong>"Licensor"</strong> or <strong>"We"</strong> means <strong>Aerokube Software OÃœ</strong>, having its principal place of business at Harju maakond, Tallinn, Kesklinna linnaosa, Karu tn 14-8, 10120, Estonia, registered in the Commercial Register of Estonia, registry code: 14653208.</p>
</li>
<li>
<p><strong>"Customer"</strong>, <strong>"Licensee"</strong> or <strong>"You"</strong> means the sole proprietor or legal entity specified in the Subscription Confirmation. For legal entities, "Customer" includes any entity which controls, is controlled by, or is under common control with Customer. For the purposes of this definition, "control" means one of the following:</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>The power, directly or indirectly, to direct or manage such entity, whether by contract or otherwise.</p>
</li>
<li>
<p>Ownership of fifty percent (50%) or more of the outstanding shares or beneficial ownership of such entity.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</li>
<li>
<p><strong>Definitions</strong></p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p><strong>"Agreement"</strong> means this License Agreement.</p>
</li>
<li>
<p><strong>"Product"</strong> means any generally available Licensor&#8217;s software product identified by Licensor as a software developer tool. For the avoidance of doubt, the Product is not produced to the specifications of Customer nor customized through modification or personalization, is intended for mass distribution, and no software code will be provided to Customer.</p>
</li>
<li>
<p><strong>"User"</strong> means any employee, independent contractor or other personnel obtaining access to the Product(s) from Customer.</p>
</li>
<li>
<p><strong>"Number of Concurrent Sessions"</strong> means maximum number of software testing processes being run using the Product in parallel. This can be for example browsers executing User&#8217;s tests.</p>
</li>
<li>
<p><strong>"License Key"</strong> means a unique key-code that enables a Licensee to use the Product by unlocking the fixed Number of Concurrent Sessions. Only Licensor and/or its representatives are permitted to produce License Keys for the Product.</p>
</li>
<li>
<p><strong>"Subscription"</strong> means an arrangement for making use of the Product of periodic nature on a prepayment plan. For the purpose of clarity, Subscription includes the subscription term, Products provided to Customer, subscription fees, payment schedules and fixed number of License Keys.</p>
</li>
<li>
<p><strong>"Product Evaluation"</strong> means using the Product without a valid License Key.</p>
</li>
<li>
<p><strong>"Subscription Confirmation"</strong> means an email confirming Customer&#8217;s rights to access and use Products, including total Number of Concurrent Sessions.</p>
</li>
<li>
<p><strong>"Product Installation"</strong> means a Product copy running on Customer&#8217;s computer device, hardware server or virtual machine.</p>
</li>
<li>
<p><strong>"Product Version"</strong> means a release, update, or upgrade of a particular Product that is not identified by Licensor as being made for the purpose of fixing software bugs.</p>
</li>
<li>
<p><strong>"Bug Fix Update"</strong> for a particular Product Version means a software update or release that is specifically identified by Licensor as a bug fix for that Product Version.</p>
</li>
<li>
<p><strong>"E-mail Support"</strong> means a form of customer support provided by the Licensor. At the time of writing, the corresponding e-mail address is <strong>support@aerokube.com</strong>; should the address be changed, the new address will be referred to on the Licensor&#8217;s web site.</p>
</li>
<li>
<p><strong>"Instant Messaging Support"</strong> means a form of customer support provided by the Licensor. At the time of writing, the corresponding address to support channel is <strong><a href="https://t.me/aerokube_moon" class="bare">https://t.me/aerokube_moon</a></strong>; should the address be changed, the new address will be referred to on the Licensor&#8217;s web site.</p>
</li>
<li>
<p><strong>"Affiliate"</strong> means any entity belonging to the same group as the Licensor.</p>
</li>
</ol>
</div>
</li>
<li>
<p><strong>How this Agreement Works</strong></p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p><strong>Entire Agreement.</strong> This Agreement, including the Third-Party Software license terms, constitutes the entire agreement between the parties concerning its subject matter and supersedes any prior agreements between Customer and Licensor regarding Customer&#8217;s use of any Products. No purchase order, other ordering document or any handwritten or typewritten text which purports to modify or supplement the printed text of this Agreement or any schedule will add to or vary the terms of this Agreement unless signed by both Customer and Licensor.</p>
</li>
<li>
<p><strong>Reservation of Rights.</strong> Aerokube reserves the right at any time to cease the support of the Product and to alter prices, features, specifications, capabilities, functions, terms of use, release dates, general availability or other characteristics of the Product.</p>
</li>
<li>
<p><strong>Changes to this Agreement.</strong> We may update or modify this Agreement from time to time, including any referenced policies and other documents. If a revision meaningfully reduces Customer&#8217;s rights, we will use reasonable efforts to notify Customer. If we modify this Agreement, the modified version of the Agreement will be effective from the start of the next Subscription term. In this case, if Customer objects to the updated Agreement terms, as Customer&#8217;s exclusive remedy, Customer may cancel the Subscription. Customer may be required to click through the updated Agreement to show its acceptance. For the avoidance of doubt, each Subscription Confirmation is subject to the version of the Agreement in effect on the Subscription Confirmation date.</p>
</li>
<li>
<p><strong>Opportunity to Review.</strong> Customer hereby declares that Customer has had sufficient opportunity to review this Agreement, understand the content of all of its clauses, negotiate its terms, and seek independent professional legal advice in that respect before entering into it. Consequently, any statutory "form contract" ("adhesion contract") regulations shall not be applicable to this Agreement.</p>
</li>
<li>
<p><strong>Severability.</strong> If a particular term of this Agreement is not enforceable, the unenforceability of that term will not affect any other terms of this Agreement.</p>
</li>
<li>
<p><strong>Headings.</strong> Headings and titles are for convenience only and do not affect the interpretation of this Agreement.</p>
</li>
<li>
<p><strong>No Waiver.</strong> Our failure to enforce or exercise any part of this Agreement is not a waiver of that section.</p>
</li>
<li>
<p><strong>Notice.</strong> Aerokube may deliver any notice to Customer via electronic mail to an email address provided by Customer, registered mail, personal delivery or renowned express courier (such as DHL, FedEx or UPS). Any such notice will be deemed to be effective:</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>On the day the notice is sent to Customer via email.</p>
</li>
<li>
<p>Upon personal delivery.</p>
</li>
<li>
<p>One (1) day after deposit with an express courier or five (5) days after deposit in the mail, whichever occurs first.</p>
</li>
</ol>
</div>
</li>
<li>
<p><strong>Governing Law.</strong> This Agreement will be governed by the laws of the Estonia, without reference to conflict of laws principles. Customer agrees that any litigation relating to this Agreement may only be brought in, and will be subject to the jurisdiction of, any competent court of the Estonia. The parties agree that the United Nations Convention on Contracts for the International Sale of Goods does not apply to this Agreement.</p>
</li>
<li>
<p><strong>Exceptions or Modifications.</strong> For exceptions or modifications to this Agreement, please contact Aerokube at: <a href="mailto:support@aerokube.com">support@aerokube.com</a> In case the terms of this Agreement are in conflict with the terms of any agreement individually negotiated and agreed between Aerokube and Customer, the terms of the latter shall prevail.</p>
</li>
<li>
<p><strong>Force Majeure.</strong> Except with respect to Customerâ€™s payment obligations, neither party shall be liable to the other for any delay or failure to perform any obligation under this Agreement (except for a failure to pay fees) if the delay or failure is due to unforeseen events which occur after the signing of this Agreement and which are beyond the reasonable control of such party (<strong>"Force Majeure Event"</strong>), such as a strike, blockade, war, act of terrorism, riot, natural disaster, failure or diminishment of power or telecommunications or data networks or services, or refusal of a license by a government agency. In the event of a Force Majeure Event that prevents one part from substantially performing its obligations hereunder for a period of ten (10) days or more, either party may terminate this Agreement on five (5) days written notice.</p>
</li>
</ol>
</div>
</li>
<li>
<p><strong>Grant of Rights</strong></p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>The Product include code and libraries licensed to Licensor by third parties, including open source software.</p>
</li>
<li>
<p>The Product is provided basing on the Number of Concurrent Sessions. If Customer complies with the terms of this Agreement, Customer has the rights stipulated hereunder for each Subscription that Customer acquires. Customer&#8217;s rights acquired in relation to the Product are limited to those necessary to enable Customer and its Users to effectively operate the Product(s). All other rights remain reserved to Licensor.</p>
</li>
<li>
<p>Unless the Subscription has expired or this Agreement is terminated in accordance with respective section, and subject to the terms and conditions specified herein, Licensor grants Customer a non-exclusive and non-transferable right to use each Product covered by the Subscription as stipulated below.</p>
</li>
<li>
<p>Customer <strong>may</strong>:</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>For each License Key included to Subscription have <strong>one</strong> Product Installation of any version covered by the Subscription on any operating system supported by the Product.</p>
</li>
<li>
<p>Do Product Evaluation on <strong>one</strong> Product Installation of any version on any operating system supported by the Product.</p>
</li>
<li>
<p>Make one backup copy of the Product solely for archival/security backup purposes.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Customer <strong>may not</strong>:</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>Allow the same Product Installation to be used concurrently by more than the Number of Concurrent Sessions specified for used License Key in Subscription Confirmation.</p>
</li>
<li>
<p>Rent, lease, reproduce, modify, adapt, create derivative works of, distribute, sell, or transfer the Product.</p>
</li>
<li>
<p>Provide access to the Product or the right to use the Product to a third party.</p>
</li>
<li>
<p>Reverse engineer, decompile, disassemble, modify, translate, make any attempt to discover the source code of the Product.</p>
</li>
<li>
<p>Remove or obscure any proprietary or other notices contained in the Product.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Customer acknowledges that no ownership right is conveyed to Customer under this Agreement, irrespective of the use of terms such as "purchase" or "sale". Licensor has and retains all rights, title and interest, including all intellectual property rights, in and to the Products and any and all related or underlying technology, and any modifications or derivative works thereof, including without limitation as they may incorporate Feedback (as defined below).</p>
</li>
<li>
<p>This Agreement applies whether Customer purchases a Subscription directly from Licensor or through resellers. If Customer purchases through a reseller, the Subscription details shall be as stated in the Subscription Confirmation issued by the reseller to Customer, and the reseller is responsible for the accuracy of any such Subscription Confirmation. Resellers are not authorized to make any promises or commitments on Licensor behalf, and Customer understands and agrees that Licensor is not bound by any obligations to Customer other than as specified in this Agreement.</p>
</li>
</ol>
</div>
</li>
<li>
<p><strong>Access to Products</strong></p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>All deliveries under this Agreement will be electronic. Customer and its Users must have an Internet connection in order to receive any deliveries. For the avoidance of doubt, Customer is responsible for downloading and installing the Products. Download instructions are made available on Licensor website at <a href="https://aerokube.com/moon/" class="bare">https://aerokube.com/moon/</a>.</p>
</li>
<li>
<p>Customer enables full access to Product Installation by specifying a License Key from Subscription Confirmation.</p>
</li>
<li>
<p>Subject to the terms of this Agreement, Customer is granted a right to install and use the Product for evaluation purposes without charge for unlimited amount of time. The Product contains a feature that will automatically limit allowed Number of Concurrent Sessions. Licensor reserves the right at any time to change that limit in new Product versions.</p>
</li>
</ol>
</div>
</li>
<li>
<p><strong>Fees</strong></p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Customer shall pay its Subscription fees in accordance with Licensor Terms of Purchase or the reseller&#8217;s terms of purchase, whichever are applicable.</p>
</li>
<li>
<p>The Subscription fees shall be paid in full, and any levies, duties and/or taxes imposed by Customer&#8217;s jurisdiction (including, but not limited to, value added tax, sales tax and withholding tax), shall be borne solely by Customer.</p>
</li>
<li>
<p>Customer may not deduct any amounts from fees payable to Licensor or the reseller, unless otherwise specified in the applicable terms of purchase.</p>
</li>
</ol>
</div>
</li>
<li>
<p><strong>Feedback</strong></p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Customer has no obligation to provide Licensor with ideas, suggestions, or proposals ("Feedback").</p>
</li>
<li>
<p>If Customer or Users submit Feedback to Licensor, then Customer grants Licensor a non-exclusive, worldwide, royalty-free license that is sub-licensable and transferable, to make, use, sell, have made, offer to sell, import, reproduce, publicly display, distribute, modify, or publicly perform the Feedback in any manner without any obligation, royalty or restriction based on intellectual property rights or otherwise.</p>
</li>
</ol>
</div>
</li>
<li>
<p><strong>LIMITED WARRANTY</strong></p>
<div class="paragraph">
<p>ALL PRODUCTS ARE PROVIDED TO CUSTOMER ON AN <strong>"AS IS"</strong> AND <strong>"AS AVAILABLE"</strong> BASIS WITHOUT WARRANTIES. USE OF THE PRODUCTS IS AT YOUR OWN RISK. AEROKUBE MAKES NO WARRANTY AS TO THEIR USE OR PERFORMANCE. TO THE MAXIMUM EXTENT PERMITTED BY APPLICABLE LAW, AEROKUBE, AND ITS SUPPLIERS (WHICH SHALL INCLUDE THE PROVIDERS OF THE THIRD PARTY SOFTWARE) AND RESELLERS, DISCLAIM ALL WARRANTIES AND CONDITIONS, EITHER EXPRESS OR IMPLIED, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE, TITLE, AND NON-INFRINGEMENT, WITH REGARD TO THE PRODUCTS, AND THE PROVISION OF OR FAILURE TO PROVIDE SUPPORT SERVICES. THIS LIMITED WARRANTY GIVES CUSTOMER SPECIFIC LEGAL RIGHTS. CUSTOMER MAY HAVE OTHER RIGHTS, WHICH VARY FROM STATE/JURISDICTION TO STATE/JURISDICTION. AEROKUBE (AND ITS AFFILIATES, AGENTS, DIRECTORS AND EMPLOYEES) DOES NOT WARRANT:</p>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>THAT THE PRODUCTS ARE ACCURATE, RELIABLE OR CORRECT</p>
</li>
<li>
<p>THAT THE PRODUCTS WILL MEET YOUR REQUIREMENTS</p>
</li>
<li>
<p>THAT THE PRODUCTS WILL BE AVAILABLE AT ANY PARTICULAR TIME OR LOCATION, UNINTERRUPTED OR SECURE</p>
</li>
<li>
<p>THAT ANY DEFECTS OR ERRORS WILL BE CORRECTED</p>
</li>
<li>
<p>THAT THE PRODUCTS ARE FREE OF VIRUSES OR OTHER HARMFUL COMPONENTS</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>ANY CONTENT OR DATA DOWNLOADED OR OTHERWISE OBTAINED THROUGH THE USE OF THE PRODUCTS ARE DOWNLOADED AT YOUR OWN RISK AND YOU WILL BE SOLELY RESPONSIBLE FOR ANY DAMAGE TO YOUR PROPERTY OR LOSS OF DATA THAT RESULTS FROM SUCH DOWNLOAD. NO WARRANTY OR LIABILITY AT ALL IS GIVEN TO PRODUCTS UNDER EVALUATION.</p>
</div>
</li>
<li>
<p><strong>DISCLAIMER OF DAMAGES</strong></p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>TO THE MAXIMUM EXTENT PERMITTED BY APPLICABLE LAW, IN NO EVENT WILL AEROKUBE (OR ITS AFFILIATES, AGENTS, DIRECTORS, OR EMPLOYEES), OR AEROKUBE LICENSORS, SUPPLIERS OR RESELLERS BE LIABLE TO CUSTOMER OR ANYONE ELSE FOR:</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>ANY LOSS OF USE, DATA, GOODWILL, OR PROFITS, WHETHER OR NOT FORESEEABLE</p>
</li>
<li>
<p>ANY LOSS OR DAMAGES IN CONNECTION WITH TERMINATION OR SUSPENSION OF CUSTOMER&#8217;S ACCESS TO OUR PRODUCTS IN ACCORDANCE WITH THIS AGREEMENT</p>
</li>
<li>
<p>ANY SPECIAL, INCIDENTAL, INDIRECT, CONSEQUENTIAL, EXEMPLARY OR PUNITIVE DAMAGES WHATSOEVER (EVEN IF WE HAVE BEEN ADVISED OF THE POSSIBILITY OF THESE DAMAGES), INCLUDING THOSE:</p>
<div class="olist upperalpha">
<ol class="upperalpha" type="A">
<li>
<p>RESULTING FROM LOSS OF USE, DATA, OR PROFITS, WHETHER OR NOT FORESEEABLE</p>
</li>
<li>
<p>BASED ON ANY THEORY OF LIABILITY, INCLUDING BREACH OF CONTRACT OR WARRANTY, STRICT LIABILITY, NEGLIGENCE OR OTHER TORTIOUS ACTION</p>
</li>
<li>
<p>ARISING FROM ANY OTHER CLAIM ARISING OUT OF OR IN CONNECTION WITH CUSTOMER&#8217;S USE OF OR ACCESS TO THE PRODUCTS OR SUPPORT.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>THE FOREGOING LIMITATION OF LIABILITY SHALL APPLY TO THE FULLEST EXTENT PERMITTED BY LAW IN THE APPLICABLE JURISDICTION.</p>
</li>
<li>
<p>THE TOTAL LIABILITY IN ANY MATTER ARISING OUT OF OR IN RELATION TO THIS AGREEMENT IS LIMITED TO ONE HUNDRED (100) US DOLLARS OR THE AGGREGATE AMOUNT PAID OR PAYABLE BY THE CUSTOMER FOR PRODUCTS DURING THE THREE-MONTH PERIOD PRECEDING THE EVENT GIVING RISE TO THE LIABILITY, WHICHEVER IS GREATER. THIS LIMITATION WILL APPLY EVEN IF WE OR YOU HAVE BEEN ADVISED OF THE POSSIBILITY OF LIABILITY EXCEEDING SUCH AMOUNT AND NOTWITHSTANDING ANY FAILURE OF THE ESSENTIAL PURPOSE OF ANY LIMITED REMEDY.</p>
</li>
</ol>
</div>
</li>
<li>
<p><strong>Term and Termination</strong></p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>The term of this Agreement will commence upon acceptance of this Agreement by Customer as set forth in the preamble above, and will continue for each Product through the end of the applicable subscription period specified in the respective Subscription Confirmation. This Agreement will automatically renew with respect to each Product for a successive subscription term, unless terminated as set forth herein.</p>
</li>
<li>
<p>Customer may terminate this Agreement at any time by cancelling its Product subscription. If such termination occurs during a then-current subscription period, this Agreement will continue to be effective until the end of that subscription period. Such termination does not relieve Customer of the obligation to pay any outstanding subscription fees owed to Licensor, and no credits or refunds will be issued to Customer for prepaid subscription fees (except as specified in the Licensor Terms of Purchase, if applicable).</p>
</li>
<li>
<p>Licensor <strong>may terminate</strong> this agreement if:</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>Customer has materially breached this Agreement and fails to cure such breach within thirty (30) days of written notice thereof.</p>
</li>
<li>
<p>Customer fails to make the timely payment of subscription fees in accordance with "Fees" Section of this Agreement.</p>
</li>
<li>
<p>Licensor is required to do so by law (for example, where the provision of the Product to Customer is, or becomes, unlawful).</p>
</li>
<li>
<p>Licensor elects to discontinue providing the Product, in whole or in part.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Licensor will make reasonable efforts to <strong>notify Customer</strong> via email as follows:</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>Thirty (30) days prior to termination of the Agreement when required to terminate by law or because of discontinued Product. In such events Customer will be entitled to a refund of the unused portion of prepaid subscription fees, if applicable.</p>
</li>
<li>
<p>Three (3) days prior to termination of the Agreement in other cases. In such events Customer will not be entitled to any refund of the unused portion of prepaid subscription fees.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</li>
<li>
<p><strong>Temporary Suspension for Non-payment</strong></p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Licensor reserves the right to suspend or limit Customer&#8217;s access to Aerokube Products if Customer fails to pay subscription fees on time.</p>
</li>
<li>
<p>If Licensor suspends or limits Customer&#8217;s access to Aerokube Products for non-payment according, Customer must pay all past due amounts in order to restore full access to Aerokube Products.</p>
</li>
<li>
<p>Customer hereby agrees that Licensor is entitled to charge Customer for the time period during which Customer has access to Aerokube Products until Customer or Licensor terminates or suspends Customer&#8217;s subscription in accordance with this Agreement.</p>
</li>
</ol>
</div>
</li>
<li>
<p><strong>Export Regulations</strong></p>
<div class="paragraph">
<p>Customer shall comply with all applicable laws and regulations with regards to economic sanctions, export controls, import regulations, and trade embargoes (all herein referred to as "Sanctions"), including those of the European Union and United States (specifically the Export Administration Regulations (EAR)). Customer declares that it is not a person targeted by Sanctions nor is it otherwise owned or controlled by or acting on behalf of any person targeted by Sanctions. Further, Customer warrants that it will not download or otherwise export or re-export the Product or any related technical data directly or indirectly to any person targeted by Sanctions or download or otherwise use the Product for any end-use prohibited or restricted by Sanctions.</p>
</div>
</li>
<li>
<p><strong>Customer Support</strong></p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Licensor provides Email Support as well as Instant Messaging Support. The response time will be reasonable, but no specific response time guarantees are given.</p>
</li>
<li>
<p>Customer may request additional paid support from Licensor which is subject of a supplementary individually negotiated Agreement between Customer and Licensor.</p>
</li>
<li>
<p>Any guarantees of support availability only apply to the latest version of Licensed Software available in Customer Subscription.</p>
</li>
</ol>
</div>
</li>
<li>
<p><strong>Customer Data</strong></p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p><strong>Use of Name and Logo.</strong> Customer agrees that Licensor may identify it as a customer of Aerokube and may refer to it by name, trade name and trademark, if applicable. Licensor may also briefly describe Customer&#8217;s business in Licensor marketing materials, on the Aerokube website and/or in public or legal documents. Customer hereby grants Licensor a worldwide, non-exclusive and royalty-free license to use Customer&#8217;s name and any of Customer&#8217;s trade names and trademarks solely pursuant to this marketing section. Notwithstanding anything to the contrary herein, Licensor acknowledges that in some cases Customer licenses and does not own marks or logos (for example, marks or logos of the Affiliates) and cannot permit Licensor to use such marks.</p>
</li>
<li>
<p><strong>Gathering of Usage Statistics.</strong> Customer acknowledges and agrees that the Product may contain a feature that reports the usage statistics, diagnostics information and usage meta-information of the Product back to the Licensor. Customer may opt out of the gathering of usage statistics by turning off this feature in the Product settings.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_pricing"><a class="anchor" href="#_pricing"></a>6. Pricing</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Last updated December 17th, 2021. Replaces the prior version in its entirety.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Moon price is calculated using so-called <code>Number of Concurrent Sessions</code> that is to say total number of browser sessions being run in parallel. We control this by limiting total number of simultaneously running browser pods to the value you are purchasing.</p>
</li>
<li>
<p>When no license key is provided <code>4 (four)</code> parallel browser sessions maximum are allowed. If such limit is sufficient for you - you are allowed use Moon without license key for unlimited period of time.</p>
</li>
<li>
<p>If free limit is insufficient - you need <code>a paid license</code>. Such license can include <code>any desired number</code> of parallel browser sessions (yes, even <code>42</code>).</p>
</li>
<li>
<p>Every parallel session has a fixed cost - <code>$5 USD</code> (five United States dollars). If you are a EU-based company - then we convert the price to euro (â‚¬).</p>
<div class="listingblock">
<div class="title">An example price calculation</div>
<div class="content">
<pre>42 sessions * $5/month = $210/month</pre>
</div>
</div>
</li>
<li>
<p>For simplicity, we calculated monthly prices for some frequent cases:</p>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 17. Moon License Pricing</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Number of Parallel Sessions</th>
<th class="tableblock halign-left valign-top">Price per Month, USD</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0-4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">free</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$25</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$50</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">15</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$75</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">20</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$100</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">25</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$125</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">30</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$150</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">40</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$200</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">50</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$250</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">75</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$375</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$500</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">150</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$750</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$1000</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">250</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$1250</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">500</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$2500</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">750</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$3750</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$5000</p></td>
</tr>
</tbody>
</table>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="mobile-emulation-devices"><a class="anchor" href="#mobile-emulation-devices"></a>Appendix A: Supported Mobile Devices</h2>
<div class="sectionbody">
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 18. Supported Mobile Devices</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><code>deviceName</code> capability</th>
<th class="tableblock halign-left valign-top">Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Apple iPad</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Apple iPad 10.2 (2019)</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Apple iPad Mini</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Apple iPad Mini 4</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Apple iPad Pro</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Apple iPad Pro (10.5)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">iPad Pro 10.5"</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Apple iPad Pro (12.9)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">iPad Pro 12.9"</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Apple iPhone 11</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Apple iPhone 11 Pro</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Apple iPhone 11 Pro Max</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Apple iPhone 4</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Apple iPhone 5/SE</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Apple iPhone 6/7/8</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Apple iPhone 6/7/8 Plus</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Apple iPhone 7</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Apple iPhone 7 Plus</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Apple iPhone 8</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Apple iPhone 8 Plus</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Apple iPhone SE</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Apple iPhone X</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Apple iPhone XR</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Apple iPhone Xs</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Apple iPhone Xs Max</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Blackberry PlayBook</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">BlackBerry Z30</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Google Nexus 4</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Google Nexus 5</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Google Nexus 5X</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Google Nexus 6</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Google Nexus 6P</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Google Nexus 7</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Google Nexus 10</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Google Pixel 2</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Google Pixel 2 XL</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Google Pixel 3</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Google Pixel 3 XL</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Google Pixel 4</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Google Pixel 4 XL</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">JioPhone 2</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kindle Fire HDX</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Laptop with HiDPI screen</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Laptop with MDPI screen</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Laptop with touch</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LG Optimus L70</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Microsoft Lumia 550</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Microsoft Lumia 950</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Microsoft Surface Duo</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Moto G4</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Nokia Lumia 520</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Nokia N9</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Palm PVG100</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Red Hydrogen One</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Samsung Galaxy A20</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Samsung Galaxy Fold</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Samsung Galaxy Note 2</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Samsung Galaxy Note 3</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Samsung Galaxy Note 8</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Samsung Galaxy Note 9</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Samsung Galaxy Note 10</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Samsung Galaxy Note 10+</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Samsung Galaxy S3</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Samsung Galaxy S5</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Samsung Galaxy S7</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Samsung Galaxy S8</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Samsung Galaxy S8+</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Samsung Galaxy S9</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Samsung Galaxy S9+</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Samsung Galaxy S10</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Samsung Galaxy S10+</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Samsung Galaxy S10e</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Samsung Galaxy Tab S3</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Samsung Galaxy Tab S4</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version latest<br>
Last updated 2023-10-25 14:26:56 UTC
</div>
</div>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-23854888-2"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-23854888-2');
</script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
    (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
        m[i].l=1*new Date();k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
    (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

    ym(43539754, "init", {
        clickmap:true,
        trackLinks:true,
        accurateTrackBounce:true,
        webvisor:true,
        trackHash:true
    });
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/43539754" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->
</body>
</html>