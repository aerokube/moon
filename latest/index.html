<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<meta name="description" content="A Selenium, Playwright and Puppeteer testing platform running in Kubernetes or Openshift clusters. Fully compatible with Selenium Webdriver protocol. Live and automated testing are supported. Runs on your own hardware or in any popular cloud platform: Google Cloud, Amazon Web Services, DigitalOcean, Microsoft Azure and so on.">
<meta name="author" content="Aerokube Software OÜ">
<link rel="icon" type="image/png" href="img/favicon.png">
<title>Moon - A cross browser Selenium, Playwright and Puppeteer solution for Kubernetes or Openshift cluster</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment @import statement to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
:not(pre)>code.nobreak{word-wrap:normal}
:not(pre)>code.nowrap{white-space:nowrap}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details>summary:first-of-type{cursor:pointer;display:list-item;outline:none;margin-bottom:.75em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class="highlight"],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid currentColor;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid currentColor;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
td.tableblock>.content>:last-child.sidebarblock{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<base href="https://aerokube.com/moon/latest/">
<meta property="og:image:height" content="1106">
<meta property="og:image:width" content="2113">
<meta property="og:title" content="Aerokube Moon | A cross browser Selenium solution for Kubernetes or Openshift cluster">
<meta property="og:description" content="Live and automated cross browser Selenium testing in Kubernetes or Openshift cluster">
<meta property="og:url" content="https://aerokube.com/moon/latest">
<meta property="og:image" content="https://aerokube.com/moon/latest/img/og-image.jpg">
<meta name="twitter:site" content="@aerokube">
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>Moon</h1>
<div class="details">
<span id="author" class="author">Aerokube Software OÜ</span><br>
<span id="revnumber">version latest,</span>
<span id="revdate">2021-02-19</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_getting_started">1. Getting Started</a>
<ul class="sectlevel2">
<li><a href="#_quick_start_guide">1.1. Quick Start Guide</a>
<ul class="sectlevel3">
<li><a href="#install-kubernetes">1.1.1. Installing to Kubernetes</a></li>
<li><a href="#install-openshift">1.1.2. Installing to Openshift</a></li>
<li><a href="#install-checklist">1.1.3. Moon Checklist</a></li>
</ul>
</li>
<li><a href="#_recommended_cluster_settings">1.2. Recommended Cluster Settings</a></li>
<li><a href="#_required_permissions">1.3. Required Permissions</a></li>
<li><a href="#_cluster_architecture">1.4. Cluster Architecture</a>
<ul class="sectlevel3">
<li><a href="#moon-components">1.4.1. Moon Components</a></li>
<li><a href="#moon-stateless">1.4.2. Why Moon is Stateless</a></li>
<li><a href="#moon-pod-contents">1.4.3. Browser Pod Contents</a></li>
</ul>
</li>
<li><a href="#_moon_vs_selenoid">1.5. Moon vs Selenoid</a></li>
</ul>
</li>
<li><a href="#_configuration">2. Configuration</a>
<ul class="sectlevel2">
<li><a href="#_users_list">2.1. Users List</a>
<ul class="sectlevel3">
<li><a href="#_updating_users_list">2.1.1. Updating Users List</a></li>
</ul>
</li>
<li><a href="#_browsers_list">2.2. Browsers List</a>
<ul class="sectlevel3">
<li><a href="#browsers-list-per-user">2.2.1. Per-user Browser Lists</a></li>
<li><a href="#browsers-list-guest-quota">2.2.2. Guest Quota</a></li>
<li><a href="#browsers-list-updating">2.2.3. Updating Browsers List</a></li>
<li><a href="#external-selenium">2.2.4. Using External Selenium</a></li>
</ul>
</li>
<li><a href="#_configuration_file">2.3. Configuration File</a></li>
<li><a href="#_devices_file">2.4. Devices File</a></li>
<li><a href="#_credentials_secret">2.5. Credentials Secret</a></li>
<li><a href="#_installing_license">2.6. Installing License</a>
<ul class="sectlevel3">
<li><a href="#license-yaml-manifests">2.6.1. Option 1: you are using official YAML manifests</a></li>
<li><a href="#license-helm">2.6.2. Option 2: you are using Helm</a></li>
<li><a href="#license-manually">2.6.3. Option 3: doing everything manually</a></li>
<li><a href="#license-how-it-works">2.6.4. How Licenses Work</a></li>
<li><a href="#license-restricted-cluster">2.6.5. Installing License to Restricted Cluster</a></li>
</ul>
</li>
<li><a href="#_monitoring">2.7. Monitoring</a></li>
<li><a href="#_advanced_configuration">2.8. Advanced Configuration</a>
<ul class="sectlevel3">
<li><a href="#s3">2.8.1. Uploading Files to S3</a></li>
<li><a href="#custom-docker-registry">2.8.2. Using Custom Docker Registry</a></li>
<li><a href="#timeouts">2.8.3. Adjusting Timeouts</a></li>
<li><a href="#resources">2.8.4. Adjusting Resources Consumption</a></li>
<li><a href="#volumes">2.8.5. Using Volumes</a></li>
<li><a href="#privileged-mode">2.8.6. Running Browser Pods in Privileged Mode</a></li>
<li><a href="#node-selectors">2.8.7. Using Node Selectors</a></li>
<li><a href="#tolerations">2.8.8. Using Tolerations</a></li>
<li><a href="#kubernetes-annotations">2.8.9. Using Custom Kubernetes Annotations</a></li>
<li><a href="#kubernetes-labels">2.8.10. Using Custom Kubernetes Labels</a></li>
<li><a href="#kernel-caps">2.8.11. Using Custom Linux Kernel Capabilities</a></li>
<li><a href="#service-account">2.8.12. Using Custom Service Account</a></li>
<li><a href="#user-group">2.8.13. Setting Custom User and Group Identifier to Browser Pods</a></li>
</ul>
</li>
<li><a href="#_log_files">2.9. Log Files</a></li>
<li><a href="#_cli_flags">2.10. CLI Flags</a>
<ul class="sectlevel3">
<li><a href="#cli-flags-moon">2.10.1. Moon Container Flags</a></li>
<li><a href="#cli-flags-moon-api">2.10.2. Moon API Container Flags</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_main_features">3. Main Features</a>
<ul class="sectlevel2">
<li><a href="#_special_capabilities">3.1. Special Capabilities</a>
<ul class="sectlevel3">
<li><a href="#capability-enableVNC">3.1.1. Live Browser Screen: enableVNC</a></li>
<li><a href="#capability-screenResolution">3.1.2. Custom Screen Resolution: screenResolution</a></li>
<li><a href="#capability-skin">3.1.3. Android Skin: skin</a></li>
<li><a href="#capability-video-recording">3.1.4. Video Recording: enableVideo, videoName, videoScreenSize, videoFrameRate, videoCodec</a></li>
<li><a href="#capability-logName">3.1.5. Custom Log Name: logName</a></li>
<li><a href="#capability-name">3.1.6. Custom Test Name: name</a></li>
<li><a href="#capability-timeZone">3.1.7. Per-session Time Zone: timeZone</a></li>
<li><a href="#capability-env">3.1.8. Per-session Environment Variables: env</a></li>
<li><a href="#capability-hostsEntries">3.1.9. Hosts Entries: hostsEntries</a></li>
<li><a href="#capability-nameservers">3.1.10. Custom DNS Servers: nameservers</a></li>
<li><a href="#capability-sessionTimeout">3.1.11. Custom Session Timeout: sessionTimeout</a></li>
<li><a href="#capability-s3KeyPattern">3.1.12. S3 Key Pattern: s3KeyPattern</a></li>
<li><a href="#capability-mobile-emulation">3.1.13. Mobile Emulation: mobileDevice</a></li>
<li><a href="#capability-protocol-extensions">3.1.14. Specifying Capabilities via Protocol Extensions</a></li>
</ul>
</li>
<li><a href="#_accessing_files_downloaded_with_browser">3.2. Accessing Files Downloaded with Browser</a></li>
<li><a href="#_accessing_clipboard">3.3. Accessing Clipboard</a></li>
<li><a href="#_using_playwright">3.4. Using Playwright</a>
<ul class="sectlevel3">
<li><a href="#playwright-select-browser">3.4.1. Selecting Requested Browser</a></li>
<li><a href="#playwright-select-browser-version">3.4.2. Selecting Exact Browser Version</a></li>
<li><a href="#playwright-select-playwright-version">3.4.3. Selecting Exact Playwright Version</a></li>
<li><a href="#playwright-additional-features">3.4.4. Enabling Additional Features</a></li>
</ul>
</li>
<li><a href="#_accessing_chrome_developer_tools">3.5. Accessing Chrome Developer Tools</a></li>
<li><a href="#_mobile_emulation">3.6. Mobile Emulation</a>
<ul class="sectlevel3">
<li><a href="#mobile-emulation-devices">3.6.1. Supported Mobile Devices</a></li>
</ul>
</li>
<li><a href="#_changing_browser_locale">3.7. Changing Browser Locale</a>
<ul class="sectlevel3">
<li><a href="#locale-firefox">3.7.1. Firefox</a></li>
<li><a href="#locale-chromium">3.7.2. Chromium-based Browsers</a></li>
</ul>
</li>
<li><a href="#_using_self_signed_tls_certificates">3.8. Using self-signed TLS certificates</a></li>
</ul>
</li>
<li><a href="#_frequently_asked_questions">4. Frequently Asked Questions</a>
<ul class="sectlevel2">
<li><a href="#faq-moon-logs">4.1. Where are Moon logs?</a></li>
<li><a href="#faq-recorded-videos">4.2. Where are recorded videos stored?</a></li>
<li><a href="#faq-update-configuration">4.3. How to update configuration of a running Moon cluster?</a></li>
<li><a href="#faq-kubernetes-service-account">4.4. Is it possible to configure Kubernetes service account for Moon?</a></li>
<li><a href="#faq-custom-firewall-rules">4.5. Is it possible to assign custom firewall rules to browser pods?</a></li>
<li><a href="#faq-sessions-not-starting">4.6. Sessions are not starting</a></li>
<li><a href="#faq-connection-closed-unexpectedly">4.7. Connection was closed unexpectedly</a></li>
<li><a href="#faq-browser-pods-freezing">4.8. Browser pods are freezing</a></li>
<li><a href="#faq-no-space-left">4.9. No space left on device</a></li>
<li><a href="#faq-dns-lookup-timeouts">4.10. DNS lookup timeouts</a></li>
<li><a href="#faq-no-such-host">4.11. No such host messages</a></li>
<li><a href="#faq-session-timeouts-do-no-work">4.12. Browser session timeouts do not work</a></li>
<li><a href="#faq-json-errors">4.13. JSON processing errors in tests</a></li>
</ul>
</li>
<li><a href="#_license_agreement">5. License Agreement</a></li>
<li><a href="#_privacy_policy">6. Privacy Policy</a>
<ul class="sectlevel2">
<li><a href="#privacy-information-we-collect">6.1. Information We Collect</a>
<ul class="sectlevel3">
<li><a href="#privacy-information-you-provide">6.1.1. Information You Provide</a></li>
<li><a href="#privacy-information-we-collect-you-use">6.1.2. Information We Collect When You Use Our Services</a></li>
<li><a href="#privacy-information-we-receive">6.1.3. Information We Receive from Third Parties</a></li>
</ul>
</li>
<li><a href="#privacy-how-we-use-information">6.2. How We Use Information</a></li>
<li><a href="#privacy-how-we-share-information">6.3. How We Share Information</a></li>
<li><a href="#privacy-access">6.4. Access</a></li>
<li><a href="#privacy-data-retention">6.5. Data Retention</a></li>
<li><a href="#privacy-how-we-protect-information">6.6. How We Protect Information</a></li>
<li><a href="#privacy-children">6.7. Children&#8217;s Privacy</a></li>
<li><a href="#privacy-gdpr">6.8. General Data Protection Regulation (GDPR)</a></li>
<li><a href="#privacy-changes">6.9. Changes To This Privacy Policy</a></li>
<li><a href="#privacy-contact">6.10. How to Contact Us</a></li>
</ul>
</li>
<li><a href="#_pricing">7. Pricing</a></li>
<li><a href="#_browser_image_information">Appendix A: Browser Image information</a></li>
<li><a href="#_cloud_platforms">Appendix B: Cloud Platforms</a>
<ul class="sectlevel2">
<li><a href="#cloud-digital-ocean">B.1. DigitalOcean</a></li>
<li><a href="#cloud-google-cloud">B.2. Google Cloud</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This reference for version: <em>latest</em></p>
</div>
<div class="paragraph">
<p>Moon is a browser automation solution compatible with <a href="https://www.w3.org/TR/webdriver/">Selenium</a>, <a href="https://playwright.dev/">Playwright</a> and <a href="https://pptr.dev/">Puppeteer</a> using <a href="https://kubernetes.io/">Kubernetes</a> to launch browsers.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_getting_started"><a class="anchor" href="#_getting_started"></a>1. Getting Started</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_quick_start_guide"><a class="anchor" href="#_quick_start_guide"></a>1.1. Quick Start Guide</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This section shows how to install Moon limited to 4 parallel browser sessions. Detailed information on installing a license key allowing to activate more parallel sessions is shown in <a href="#">Installing License</a> section.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="install-kubernetes"><a class="anchor" href="#install-kubernetes"></a>1.1.1. Installing to Kubernetes</h4>
<div class="sect4">
<h5 id="install-moon-deploy"><a class="anchor" href="#install-moon-deploy"></a>Option 1: you have a running Kubernetes cluster</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Prerequisites:</p>
<div class="ulist">
<ul>
<li>
<p>Running <a href="https://kubernetes.io/">Kubernetes</a> cluster</p>
</li>
<li>
<p><code>kubectl</code> client installed and pointing to the cluster</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If you are running Kubernetes cluster on virtual machines, we usually recommend having bigger VMs instead of smaller ones. This allows to avoid available CPUs and memory fragmentation issues. For example having 24 CPU cores overall it is better to start 3 x 8 CPU core VMs instead of 12 x 2 CPU core.</p>
</li>
<li>
<p>If you are starting Moon in Kubernetes cluster deployed on workstation with <a href="https://github.com/kubernetes/minikube/">minikube</a> tool - see <a href="#install-minikube">Option 3: you have Minikube</a>.</p>
</li>
</ol>
</div>
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Clone an example configuration repository:</p>
<div class="literalblock">
<div class="content">
<pre>$ git clone https://github.com/aerokube/moon-deploy.git
$ cd moon-deploy</pre>
</div>
</div>
</li>
<li>
<p>Run one command to start Moon and Moon API:</p>
<div class="literalblock">
<div class="content">
<pre>$ kubectl apply -f moon.yaml</pre>
</div>
</div>
<div class="paragraph">
<p>If you have only several CPUs available in your cluster - use <code>moon-local.yaml</code> file instead. By default Moon is started in a separate namespace called <code>moon</code> so we append <code>-n moon</code> to the next commands.</p>
</div>
</li>
<li>
<p>Wait for LoadBalancer IP to allocate:</p>
<div class="literalblock">
<div class="content">
<pre>$ kubectl get svc -n moon
NAME      TYPE           CLUSTER-IP      EXTERNAL-IP   PORT(S)                         AGE
browsers  ClusterIP      None            &lt;none&gt;        &lt;none&gt;                          51s
moon      LoadBalancer   10.63.242.109   &lt;pending&gt;     4444:31894/TCP,8080:30625/TCP   17s</pre>
</div>
</div>
<div class="paragraph">
<p>It will look like this when finished:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ kubectl get svc -n moon
NAME      TYPE           CLUSTER-IP      EXTERNAL-IP      PORT(S)                         AGE
browsers  ClusterIP      None            &lt;none&gt;           &lt;none&gt;                          51s
moon      LoadBalancer   10.63.242.109   104.154.161.58   4444:31894/TCP,8080:30625/TCP   1m</pre>
</div>
</div>
<div class="paragraph">
<p>Now you can optionally point a domain name to this IP address:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ host moon.example.com
moon.example.com has address 104.154.161.58</pre>
</div>
</div>
</li>
<li>
<p>Run your tests against <code>moon</code> like you do with regular Selenium:</p>
<div class="literalblock">
<div class="content">
<pre>http://104.154.161.58:4444/wd/hub</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
When running your tests for the first time for every browser version Kubernetes will download and cache requested browser image. This can take several minutes depending on your network connection.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Same address using domain name:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>http://moon.example.com:4444/wd/hub</pre>
</div>
</div>
</li>
<li>
<p>Moon web interface is available at:</p>
<div class="literalblock">
<div class="content">
<pre>http://104.154.161.58:8080/</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="install-helm"><a class="anchor" href="#install-helm"></a>Option 2: you are using Helm</h5>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Steps below require Helm 3 and will not work with older releases.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>We deliver already packed and published <a href="https://helm.sh/">Helm</a> charts, so installing Moon with Helm is straightforward:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Add Aerokube <a href="https://github.com/aerokube/charts">charts</a> repository:</p>
<div class="literalblock">
<div class="content">
<pre>$ helm repo add aerokube https://charts.aerokube.com/
$ helm repo update</pre>
</div>
</div>
</li>
<li>
<p>To list available Moon versions type:</p>
<div class="literalblock">
<div class="content">
<pre>$ helm search repo aerokube --versions</pre>
</div>
</div>
</li>
<li>
<p>Create a namespace:</p>
<div class="literalblock">
<div class="content">
<pre>$ kubectl create namespace moon</pre>
</div>
</div>
</li>
<li>
<p>To install or upgrade Moon type:</p>
<div class="literalblock">
<div class="content">
<pre>$ helm upgrade --install -n moon moon aerokube/moon</pre>
</div>
</div>
</li>
<li>
<p>Moon chart has a lot of various configuration parameters that can be listed as follows:</p>
<div class="literalblock">
<div class="content">
<pre>$ helm show values aerokube/moon</pre>
</div>
</div>
<div class="paragraph">
<p>To change one of these parameters - use <code>--set</code> flag:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ helm upgrade --install --set=moon.enabled.resources=false -n moon moon aerokube/moon</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="install-minikube"><a class="anchor" href="#install-minikube"></a>Option 3: you have Minikube</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Clone an example configuration repository:</p>
<div class="literalblock">
<div class="content">
<pre>$ git clone https://github.com/aerokube/moon-deploy.git
$ cd moon-deploy</pre>
</div>
</div>
</li>
<li>
<p>Run one command to start Moon and Moon API:</p>
<div class="literalblock">
<div class="content">
<pre>$ minikube kubectl -- apply -f moon-local.yaml</pre>
</div>
</div>
</li>
<li>
<p>Minikube does not automatically assign IP address to LoadBalancer, so let&#8217;s do this manually:</p>
<div class="literalblock">
<div class="content">
<pre>$ minikube kubectl -- patch svc moon -n moon --patch "{\"spec\":{\"externalIPs\":[\"$(minikube ip)\"]}}"</pre>
</div>
</div>
</li>
<li>
<p>The last step is to get Selenium URL:</p>
<div class="literalblock">
<div class="content">
<pre>$ minikube ip
192.168.99.100</pre>
</div>
</div>
<div class="paragraph">
<p>Use the following as Selenium URL:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>http://192.168.99.100:4444/wd/hub</pre>
</div>
</div>
<div class="paragraph">
<p>Moon web interface is available at:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>http://192.168.99.100:8080/</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When Minikube is using <a href="https://minikube.sigs.k8s.io/docs/drivers/docker/">Docker driver</a> to access Moon you can use <a href="https://minikube.sigs.k8s.io/docs/commands/tunnel/">minikube tunnel</a> command instead:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In a separate terminal run command to start Minikube tunnel:</p>
<div class="literalblock">
<div class="content">
<pre>$ minikube tunnel</pre>
</div>
</div>
</li>
<li>
<p>Use <code>127.0.0.1</code> to access Moon:</p>
<div class="literalblock">
<div class="content">
<pre>http://127.0.0.1:4444/wd/hub
http://127.0.0.1:8080/</pre>
</div>
</div>
</li>
</ol>
</div>
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="install-cloud"><a class="anchor" href="#install-cloud"></a>Option 4: you have DigitalOcean or Google Cloud</h5>
<div class="paragraph">
<p>We deliver ready to use configurations for these cloud platforms. Take a look at <a href="#">Cloud Platforms</a> section for more details.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="install-openshift"><a class="anchor" href="#install-openshift"></a>1.1.2. Installing to Openshift</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Prerequisites:</p>
<div class="ulist">
<ul>
<li>
<p>Running <a href="https://www.openshift.com/">Openshift</a> cluster</p>
</li>
<li>
<p><code>oc</code> client installed and pointing to the cluster</p>
</li>
</ul>
</div>
</li>
<li>
<p>Clone an example configuration repository:</p>
<div class="literalblock">
<div class="content">
<pre>$ git clone https://github.com/aerokube/moon-deploy.git
$ cd moon-deploy</pre>
</div>
</div>
</li>
<li>
<p>Add <code>edit</code> policy to <code>default</code> account so Moon could read project pod quota:</p>
<div class="literalblock">
<div class="content">
<pre>$ oc policy add-role-to-user edit system:serviceaccount:moon:default</pre>
</div>
</div>
<div class="paragraph">
<p>Here we assume that Openshift project for Moon is called <code>moon</code>.</p>
</div>
</li>
<li>
<p>Start Moon with Openshift UI or <code>oc</code> client using <code>moon-openshift.yaml</code> file:</p>
<div class="literalblock">
<div class="content">
<pre>$ oc create -f moon-openshift.yaml -n moon</pre>
</div>
</div>
</li>
<li>
<p>Run Selenium tests against <code>moon</code> service listening on port <code>4444</code>:</p>
<div class="literalblock">
<div class="content">
<pre>http://&lt;moon-ip-or-hostname&gt;:4444/wd/hub</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="install-checklist"><a class="anchor" href="#install-checklist"></a>1.1.3. Moon Checklist</h4>
<div class="paragraph">
<p>Although Moon installation is as simple as deploying one YAML manifest - there are some well-known issues you may encounter while running your tests. The following checklist will help you to have everything running smoothly from the beginning:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure you turned off DNS cache for Moon namespace as described in <a href="#faq-browser-pods-freezing">Browser pods are freezing</a> section.</p>
</li>
<li>
<p>For Moon 1.4.0+ make sure you have a required Kubernetes service described in <a href="#faq-sessions-not-starting">Sessions are not starting</a> section.</p>
</li>
<li>
<p>While using Moon for the first time - make sure you are not suffering from various Kubernetes issues described in <a href="#faq-no-space-left">No space left on device</a> and <a href="#faq-dns-lookup-timeouts">DNS lookup timeouts</a> sections as well as some Github issues: <a href="https://github.com/kubernetes/kops/issues/5916">kubernetes/kops#5916</a>.</p>
</li>
<li>
<p>In case of customized Moon installation (e.g. when changing Moon service name from default <code>moon</code> to something else) make sure you are setting <code>-moon-url</code> parameter correctly as described in <a href="#faq-session-timeouts-do-no-work">Browser session timeouts do not work</a> section.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_recommended_cluster_settings"><a class="anchor" href="#_recommended_cluster_settings"></a>1.2. Recommended Cluster Settings</h3>
<div class="ulist">
<ul>
<li>
<p><strong>Use the biggest possible cluster node sizes</strong>. For example having 100 CPUs overall it is better to launch 5 nodes with 20 CPUs each than 50 nodes with 2 CPUs each. Browser pods can in some cases require more than 2 CPUs and this can lead to preliminary cluster fragmentation.</p>
</li>
<li>
<p><strong>Avoid cluster nodes with RedHat \ CentOS if possible.</strong> Nodes using these distributions are known to suffer from issues related to firewall \ SeLinux and can be more complicated to configure correctly.</p>
</li>
<li>
<p><strong>Use Calico container network interface instead of Flannel if possible</strong>. Calico has better performance than Flannel especially on big clusters.</p>
</li>
<li>
<p><strong>Turn off DNS cache at least for Moon namespace</strong>. Being a completely stateless solution, Moon significantly depends on cluster DNS stability. One of the known Kubernetes issues is occasional DNS inconsistency - when somew browser pods are not accessible using domain name (it does not resolve). Such inconsistency can lead to frozen browser pods and cluster exhaustion. Possible way to turn off DNS cache is described in <a href="#faq-browser-pods-freezing">Browser pods are freezing</a> section.</p>
</li>
<li>
<p><strong>Use more than 1 Kubernetes API replica if needed</strong>. Moon is using Kubernetes API to create and delete browser pods. If you plan to run hundreds of browsers in parallel - take a look at Kubernetes API (Kubernetes master) host system metrics. Overloaded master can stop responding to requests properly and this can lead to frozen browser pods.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_required_permissions"><a class="anchor" href="#_required_permissions"></a>1.3. Required Permissions</h3>
<div class="paragraph">
<p>Moon requires very limited set of permissions and should work with default Kubernetes settings. The following table summarizes what needs to be accessible.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Required Moon Permissions</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Permission</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Purpose</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">To <strong>start</strong> and <strong>stop</strong> <a href="https://kubernetes.io/docs/concepts/workloads/pods/pod/">pods</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Used to start pods with browsers</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">To <strong>start</strong> and <strong>stop</strong> <a href="https://kubernetes.io/docs/concepts/services-networking/service/">services</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Used to provide network connectivity to browser pods</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">To <strong>read</strong> data from <a href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-pod-configmap/">config maps</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Used to share various configuration data among Moon replicas: S3 configuration, custom images configuration and so on</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">To <strong>read</strong> data from <a href="https://kubernetes.io/docs/concepts/configuration/secret/">secrets</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Used to share S3 credentials among Moon replicas</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">To <strong>read</strong> <a href="https://kubernetes.io/docs/concepts/policy/resource-quotas/">resource quota</a> information</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Used to verify that Moon can run no more than total number of browser pods allowed by license</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">To <strong>create</strong> and <strong>update</strong> <a href="https://kubernetes.io/docs/concepts/policy/resource-quotas/">resource quota</a> information</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Optional.</strong> Used only in case when no resource quota was configured</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">To <strong>create</strong> and <strong>delete</strong> <a href="https://kubernetes.io/docs/concepts/configuration/secret/">secrets</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Optional.</strong> Used only in case when no resource quota was configured</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
All these permissions are normally enabled by default when running Moon and its browser pods in the same Kubernetes namespace. To configure a namespace for browser pods - use <code>-namespace</code> flag for Moon and Moon API. If you are starting Moon in one namespace and specify <code>-namespace</code> flag pointing to another namespace, then you may require additional Kubernetes permissions to be enabled.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_cluster_architecture"><a class="anchor" href="#_cluster_architecture"></a>1.4. Cluster Architecture</h3>
<div class="sect3">
<h4 id="moon-components"><a class="anchor" href="#moon-components"></a>1.4.1. Moon Components</h4>
<div class="paragraph">
<div class="title">Moon Cluster Architecture</div>
<p><span class="image"><img src="img/architecture.png" alt="architecture"></span></p>
</div>
<div class="paragraph">
<p>Moon cluster consists of several important components:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>One or more <code>Moon</code> application instances. Their main purpose is to start and stop browser containers. These replicas are usually exposed as <a href="https://kubernetes.io/docs/concepts/services-networking/service/">Kubernetes service</a> available on standard Selenium port <code>4444</code>. You should run all the tests against this service.</p>
</li>
<li>
<p>One or more <code>Moon API</code> application instances. This API collects and returns various data about running browsers. <code>Moon API</code> can be optionally exposed as <a href="https://kubernetes.io/docs/concepts/services-networking/service/">Kubernetes service</a> available on HTTP port <code>8888</code>. By default it is only accessible inside Kubernetes cluster.</p>
</li>
<li>
<p>One or more <code>Moon UI</code> application instances. <code>Moon UI</code> collects information from Moon API and visualizes it. It is usually available on HTTP port <code>8080</code>.</p>
</li>
<li>
<p>Running browser pods. Moon is using exactly the same browser images as <a href="https://github.com/aerokube/selenoid">Selenoid</a>.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="moon-stateless"><a class="anchor" href="#moon-stateless"></a>1.4.2. Why Moon is Stateless</h4>
<div class="paragraph">
<p>Moon is completely stateless and does not require any external database to run browser sessions.</p>
</div>
<div class="paragraph">
<div class="title">Why Moon is Stateless</div>
<p><span class="image"><img src="img/moon-stateless.png" alt="moon-stateless"></span></p>
</div>
<div class="paragraph">
<p>When user requests a new browser session - a Kubernetes pod containing desired browser version is created. Moon also creates a Kubernetes service (with generated name like <code>chrome-71-0-&lt;UUID&gt;</code>) to deliver network connectivity to browser pod. Having a running pod and service - a standard new Selenium session request is sent to it. After receiving unique session identifier (so called <code>Selenium session ID</code>) Moon replaces it with the generated Kubernetes service name and returns the response to user. Subsequent Selenium requests are just proxied to respective service by using Selenium session ID as service name.</p>
</div>
</div>
<div class="sect3">
<h4 id="moon-pod-contents"><a class="anchor" href="#moon-pod-contents"></a>1.4.3. Browser Pod Contents</h4>
<div class="paragraph">
<p>In addition to container with browser every pod created by Moon contains one or more service images.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Service Images</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Purpose</th>
<th class="tableblock halign-left valign-top">Started</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">defender</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows only one browser session to be created in the pod, handles session timeouts</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Always</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">logger</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Uploads sessions logs to S3 storage</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When S3 storage is configured</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">video-recorder</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Captures running browser session video and uploads it to S3 storage</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When S3 storage is configured and video recording is requested by test</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_moon_vs_selenoid"><a class="anchor" href="#_moon_vs_selenoid"></a>1.5. Moon vs Selenoid</h3>
<div class="paragraph">
<p>Moon takes all the best practices and features from Selenoid and adds many more:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Unlimited automatic scalability.</strong> You always have enough browsers of any desired version available in the cluster. When running the cluster in cloud platforms such as <a href="http://cloud.google.com/">Google Cloud</a> you can adjust settings to automatically scale depending on current load. This allows to combine efficiency with competitive cost.</p>
</li>
<li>
<p><strong>Completely stateless</strong>. Selenoid stores in memory information about currently running browser sessions. If for some reason its process crashes - then all running sessions are lost. Moon contrarily has no internal state and can be replicated across datacenters. Browser sessions remain alive even if one or more replicas go down.</p>
</li>
<li>
<p><strong>Uniform load distribution</strong>. Load balancers like <a href="http://github.com/aerokube/ggr/">Ggr</a> are using random load distribution across available browser hosts. This makes them inefficient when overall load is above 80% of cluster capacity. Moon delivers exactly uniform distribution working good even under 100% load.</p>
</li>
<li>
<p><strong>Fully graceful</strong>. Any maintenance operations with the cluster do not interrupt running browser sessions. Every cluster component shuts down gracefully.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuration"><a class="anchor" href="#_configuration"></a>2. Configuration</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_users_list"><a class="anchor" href="#_users_list"></a>2.1. Users List</h3>
<div class="paragraph">
<p>Moon is a multi-user application allowing different users access different browser versions. A single <a href="https://httpd.apache.org/docs/2.4/misc/password_encryptions.html">htpasswd</a> file is used to store users information. This file is saved to <a href="https://kubernetes.io/docs/concepts/configuration/secret/">Kubernetes Secret</a> and mounted to Moon container as a volume. A typical users file is a text file with user names and their encrypted passwords separated by colon:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ cat users.htpasswd
test:$apr1$.dZyHlKN$jdoZkin/kPviFNArx/cVL1 # User is test, password is encrypted
alice:$apr1$mLYJAC4y$VYeJstWjWP/4iVlH/TNcD.
bob:$apr1$gyqzbSpt$RBNcxrsQaolPZCQZW0VQW1</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_updating_users_list"><a class="anchor" href="#_updating_users_list"></a>2.1.1. Updating Users List</h4>
<div class="paragraph">
<p>To add or remove users:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Modify <code>users.htpasswd</code> with <code>htpasswd</code> command:</p>
<div class="literalblock">
<div class="content">
<pre>$ htpasswd -Bbn new-user new-user-password &gt;&gt; users.htpasswd # Adding new user
$ htpasswd -Bb users.htpasswd some-user new-password # Updating password
$ htpasswd -D users.htpasswd test-user # Deleting existing user</pre>
</div>
</div>
</li>
<li>
<p>Update <code>users</code> secret:</p>
<div class="literalblock">
<div class="content">
<pre>$ kubectl replace secret users --filename=./users.htpasswd -n moon</pre>
</div>
</div>
</li>
<li>
<p>Changes are applied immediately without Moon restart.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_browsers_list"><a class="anchor" href="#_browsers_list"></a>2.2. Browsers List</h3>
<div class="paragraph">
<p>Moon is using a simple <a href="https://en.wikipedia.org/wiki/JSON">JSON</a>-based configuration to store available browsers list. A typical browsers list file looks like the following:</p>
</div>
<div class="listingblock">
<div class="title">Typical Browsers List File</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">firefox</span><span class="delimiter">&quot;</span></span>: {                                      <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="key"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">62.0</span><span class="delimiter">&quot;</span></span>,                              <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="key"><span class="delimiter">&quot;</span><span class="content">versions</span><span class="delimiter">&quot;</span></span>: {                                   <i class="conum" data-value="3"></i><b>(3)</b>
      <span class="key"><span class="delimiter">&quot;</span><span class="content">62.0</span><span class="delimiter">&quot;</span></span>: {                                     <i class="conum" data-value="4"></i><b>(4)</b>
        <span class="key"><span class="delimiter">&quot;</span><span class="content">image</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">selenoid/firefox:62.0</span><span class="delimiter">&quot;</span></span>,           <i class="conum" data-value="5"></i><b>(5)</b>
        <span class="key"><span class="delimiter">&quot;</span><span class="content">port</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">4444</span><span class="delimiter">&quot;</span></span>,                             <i class="conum" data-value="6"></i><b>(6)</b>
        <span class="key"><span class="delimiter">&quot;</span><span class="content">path</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">/wd/hub</span><span class="delimiter">&quot;</span></span>,                          <i class="conum" data-value="7"></i><b>(7)</b>
        <span class="key"><span class="delimiter">&quot;</span><span class="content">resources</span><span class="delimiter">&quot;</span></span>: {                              <i class="conum" data-value="8"></i><b>(8)</b>
          <span class="key"><span class="delimiter">&quot;</span><span class="content">limits</span><span class="delimiter">&quot;</span></span>: {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">cpu</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">2</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">memory</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">2Gi</span><span class="delimiter">&quot;</span></span>
          },
          <span class="key"><span class="delimiter">&quot;</span><span class="content">requests</span><span class="delimiter">&quot;</span></span>: {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">cpu</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">200m</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">memory</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">1Gi</span><span class="delimiter">&quot;</span></span>
          }
        },
        <span class="key"><span class="delimiter">&quot;</span><span class="content">privileged</span><span class="delimiter">&quot;</span></span>: <span class="value">true</span>,                         <i class="conum" data-value="9"></i><b>(9)</b>
        <span class="key"><span class="delimiter">&quot;</span><span class="content">nodeSelector</span><span class="delimiter">&quot;</span></span>: {                           <i class="conum" data-value="10"></i><b>(10)</b>
          <span class="key"><span class="delimiter">&quot;</span><span class="content">node-type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">hardware</span><span class="delimiter">&quot;</span></span>
        },
        <span class="key"><span class="delimiter">&quot;</span><span class="content">env</span><span class="delimiter">&quot;</span></span>: [<span class="string"><span class="delimiter">&quot;</span><span class="content">TZ=Europe/Moscow</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">LANG=ru</span><span class="delimiter">&quot;</span></span>],     <i class="conum" data-value="11"></i><b>(11)</b>
        <span class="key"><span class="delimiter">&quot;</span><span class="content">hosts</span><span class="delimiter">&quot;</span></span>: [<span class="string"><span class="delimiter">&quot;</span><span class="content">example.com:192.168.0.1</span><span class="delimiter">&quot;</span></span>],       <i class="conum" data-value="12"></i><b>(12)</b>
      },
      <span class="key"><span class="delimiter">&quot;</span><span class="content">60.0</span><span class="delimiter">&quot;</span></span>: {
        <span class="error">/</span><span class="error">/</span><span class="error">.</span><span class="error">.</span><span class="error">.</span>
      }
    }
  },
  <span class="key"><span class="delimiter">&quot;</span><span class="content">chrome</span><span class="delimiter">&quot;</span></span>: {
    <span class="error">/</span><span class="error">/</span><span class="error">.</span><span class="error">.</span><span class="error">.</span>
  },
  <span class="key"><span class="delimiter">&quot;</span><span class="content">opera</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">56.0</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">versions</span><span class="delimiter">&quot;</span></span>: {
        <span class="error">/</span><span class="error">/</span><span class="error">.</span><span class="error">.</span><span class="error">.</span>
    }
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Browser name</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Default browser version</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>A list of available browser versions</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Version name</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Image name</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Port to proxy connections to. In the majority of cases should be 4444.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Path relative to / where we request a new session, see below</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>Resource configuration for browser container (CPU and memory)</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>Whether to run browser pod in privileged mode (default is false)</td>
</tr>
<tr>
<td><i class="conum" data-value="10"></i><b>10</b></td>
<td>Kubernetes node selector (allows to run pods on particular hosts only)</td>
</tr>
<tr>
<td><i class="conum" data-value="11"></i><b>11</b></td>
<td>Environment variables passed to browser container</td>
</tr>
<tr>
<td><i class="conum" data-value="12"></i><b>12</b></td>
<td>Custom <code>/etc/hosts</code> entries to be passed to browser container in <code>hostname:ip</code> format</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="browsers-list-per-user"><a class="anchor" href="#browsers-list-per-user"></a>2.2.1. Per-user Browser Lists</h4>
<div class="paragraph">
<p>As you already know Moon is a multi-user application. For every user you need to create one file - <code>&lt;username&gt;.json</code>. For example for user <code>alice</code> from <code>users.htpasswd</code> you should create <code>alice.json</code>. All JSON files should be stored in the same directory specified by <code>-quota-dir</code> flag:</p>
</div>
<div class="listingblock">
<div class="title">Per-user browser lists</div>
<div class="content">
<pre>\---quota
    |---- alice.json
    |---- browsers.json
    |---- bob.json
    |---- test.json</pre>
</div>
</div>
<div class="paragraph">
<p>Such directory is then uploaded to <a href="https://kubernetes.io/docs/tasks/configure-pod-container/configmap/">Kubernetes ConfigMap</a> and mounted to Moon container as a volume.</p>
</div>
</div>
<div class="sect3">
<h4 id="browsers-list-guest-quota"><a class="anchor" href="#browsers-list-guest-quota"></a>2.2.2. Guest Quota</h4>
<div class="paragraph">
<p>In some cases you may need anonymous Selenium access - without username and password. In terms of Moon this is called <code>guest quota</code> and is configured with <code>-guest-user</code> flag (default value is <code>browsers</code>). Any browser versions specified in <code>&lt;guest-user&gt;.json</code> file will be available without username and password:</p>
</div>
<div class="listingblock">
<div class="title">Guest quota file name</div>
<div class="content">
<pre>-guest-user browsers ====&gt; browsers.json # This is the default
-guest-user guest-user ====&gt; guest-user.json</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="browsers-list-updating"><a class="anchor" href="#browsers-list-updating"></a>2.2.3. Updating Browsers List</h4>
<div class="paragraph">
<p>To add or remove browsers:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Having configuration files stored in <code>quota</code> directory apply desired modifications.</p>
</li>
<li>
<p>Update <code>quota</code> ConfigMap using contents of <code>quota</code> directory:</p>
<div class="literalblock">
<div class="content">
<pre>$ kubectl replace configmap quota --filename=quota -n moon</pre>
</div>
</div>
</li>
<li>
<p>Changes are applied immediately without Moon restart. All running user sessions will continue to work without any interruption.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="external-selenium"><a class="anchor" href="#external-selenium"></a>2.2.4. Using External Selenium</h4>
<div class="paragraph">
<p>Moon expects to run the majority of browsers in pods inside Kubernetes or Openshift cluster. However sometimes you may need to run Selenium tests on some external hosts: hardware servers or virtual machines. Mainly this could be needed in two situations:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Running Selenium tests on some complicated platforms such as MacOS or iOS. According to license agreement these platforms require Apple hardware devices and it is complicated to run Kubernetes on top of these devices.</p>
</li>
<li>
<p>Using Selenium online platforms (e.g. <a href="https://browsers.aerokube.com/">Aerokube Browsers</a>) for some browsers. In that case you can run the majority of browsers (e.g. Firefox, Chrome, Opera) in Moon and complicated browsers (don&#8217;t work on standard virtual machines) such as Chrome Mobile in external Selenium platform.</p>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="external-selenium-hosts"><a class="anchor" href="#external-selenium-hosts"></a>Using External Hosts</h5>
<div class="paragraph">
<p>For this case you should have the following:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>A set of hosts with Selenium-compatible solution (Selenoid, Appium, Selenium Grid, etc.): <code>host1.example.com:4444</code>, <code>host1.example.com:4444</code> and so on.</p>
</li>
<li>
<p>A <a href="https://en.wikipedia.org/wiki/Virtual_Network_Computing">VNC</a> server listening on every such host on standard port <code>5900</code>.</p>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Every VNC server should be password protected with the same password having 8+ characters.
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>For every browser version supported on the hosts you need to add the following to browsers list file:</p>
</div>
<div class="listingblock">
<div class="title">Typical Browsers List File</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json"><span class="key"><span class="delimiter">&quot;</span><span class="content">safari</span><span class="delimiter">&quot;</span></span>: {
  <span class="key"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">13.0</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">versions</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">77</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">image</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">aerokube/moon-external-host:1.0.0</span><span class="delimiter">&quot;</span></span>,                                         <i class="conum" data-value="1"></i><b>(1)</b>
      <span class="key"><span class="delimiter">&quot;</span><span class="content">port</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">4444</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">path</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">/</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">env</span><span class="delimiter">&quot;</span></span>: [
        <span class="string"><span class="delimiter">&quot;</span><span class="content">URLS=[</span><span class="char">\\</span><span class="char">\&quot;</span><span class="content">http://host1.example.com:4444/</span><span class="char">\\</span><span class="char">\&quot;</span><span class="content">, </span><span class="char">\\</span><span class="char">\&quot;</span><span class="content">http://host2.example.com:4444/</span><span class="char">\\</span><span class="char">\&quot;</span><span class="content">]</span><span class="delimiter">&quot;</span></span>,    <i class="conum" data-value="2"></i><b>(2)</b>
        <span class="string"><span class="delimiter">&quot;</span><span class="content">VNC_PASSWORD=myvncpassword</span><span class="delimiter">&quot;</span></span>, <span class="error">/</span><span class="error">/</span> <span class="error">A</span><span class="error">t</span> <span class="error">l</span><span class="error">e</span><span class="error">a</span><span class="error">s</span><span class="error">t</span> <span class="integer">8</span> <span class="error">s</span><span class="error">y</span><span class="error">m</span><span class="error">b</span><span class="error">o</span><span class="error">l</span><span class="error">s</span>                                 <i class="conum" data-value="3"></i><b>(3)</b>
        <span class="string"><span class="delimiter">&quot;</span><span class="content">SCREEN_RESOLUTION=1921x1080x24</span><span class="delimiter">&quot;</span></span> <span class="error">/</span><span class="error">/</span> <span class="error">T</span><span class="error">h</span><span class="error">i</span><span class="error">s</span> <span class="error">i</span><span class="error">s</span> <span class="error">o</span><span class="error">p</span><span class="error">t</span><span class="error">i</span><span class="error">o</span><span class="error">n</span><span class="error">a</span><span class="error">l</span>                                <i class="conum" data-value="4"></i><b>(4)</b>
      ]
    }
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Special proxy image for external hosts</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>A list of external hosts</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>VNC password value for the hosts</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td><em>Optional.</em> Screen resolution of remote host to use for VNC.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>With such configuration Selenium session requests with be randomly load-balanced across the hosts specified in <code>URLS</code> environment variable. VNC feature should also work - you should be seeing remote host screen in Moon UI.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_configuration_file"><a class="anchor" href="#_configuration_file"></a>2.3. Configuration File</h3>
<div class="paragraph">
<p>Moon stores all advanced configuration options (e.g. S3 settings) in a special JSON file called <code>service.json</code>:</p>
</div>
<div class="listingblock">
<div class="title">Typical <code>service.json</code> file</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">s3</span><span class="delimiter">&quot;</span></span>: {                                          <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="key"><span class="delimiter">&quot;</span><span class="content">endpoint</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">https://storage.googleapis.com</span><span class="delimiter">&quot;</span></span>,  <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="key"><span class="delimiter">&quot;</span><span class="content">bucketName</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">moon-test</span><span class="delimiter">&quot;</span></span>,                     <i class="conum" data-value="3"></i><b>(3)</b>
    <span class="key"><span class="delimiter">&quot;</span><span class="content">version</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">S3v2</span><span class="delimiter">&quot;</span></span>,                             <i class="conum" data-value="4"></i><b>(4)</b>
    <span class="key"><span class="delimiter">&quot;</span><span class="content">keyPattern</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">$quota/$date</span><span class="delimiter">&quot;</span></span>                   <i class="conum" data-value="5"></i><b>(5)</b>
  },
  <span class="key"><span class="delimiter">&quot;</span><span class="content">images</span><span class="delimiter">&quot;</span></span>: {                                      <i class="conum" data-value="6"></i><b>(6)</b>
    <span class="key"><span class="delimiter">&quot;</span><span class="content">logger</span><span class="delimiter">&quot;</span></span>: {                                    <i class="conum" data-value="7"></i><b>(7)</b>
      <span class="key"><span class="delimiter">&quot;</span><span class="content">image</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">my-reg.com/moon/logger:1.2.0</span><span class="delimiter">&quot;</span></span>,     <i class="conum" data-value="8"></i><b>(8)</b>
      <span class="key"><span class="delimiter">&quot;</span><span class="content">resources</span><span class="delimiter">&quot;</span></span>: {                               <i class="conum" data-value="9"></i><b>(9)</b>
        <span class="key"><span class="delimiter">&quot;</span><span class="content">limits</span><span class="delimiter">&quot;</span></span>: {                                <i class="conum" data-value="10"></i><b>(10)</b>
          <span class="key"><span class="delimiter">&quot;</span><span class="content">cpu</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">0.3</span><span class="delimiter">&quot;</span></span>,                            <i class="conum" data-value="11"></i><b>(11)</b>
          <span class="key"><span class="delimiter">&quot;</span><span class="content">memory</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">1024Mi</span><span class="delimiter">&quot;</span></span>                       <i class="conum" data-value="12"></i><b>(12)</b>
        },
        <span class="key"><span class="delimiter">&quot;</span><span class="content">requests</span><span class="delimiter">&quot;</span></span>: {                              <i class="conum" data-value="13"></i><b>(13)</b>
          <span class="key"><span class="delimiter">&quot;</span><span class="content">cpu</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">0.3</span><span class="delimiter">&quot;</span></span>,                            <i class="conum" data-value="14"></i><b>(14)</b>
          <span class="key"><span class="delimiter">&quot;</span><span class="content">memory</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">1024Mi</span><span class="delimiter">&quot;</span></span>                       <i class="conum" data-value="15"></i><b>(15)</b>
        }
      }
    }
  },
  <span class="key"><span class="delimiter">&quot;</span><span class="content">annotations</span><span class="delimiter">&quot;</span></span>: {                                 <i class="conum" data-value="16"></i><b>(16)</b>
    <span class="key"><span class="delimiter">&quot;</span><span class="content">key1</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">value1</span><span class="delimiter">&quot;</span></span>,                              <i class="conum" data-value="17"></i><b>(17)</b>
    <span class="key"><span class="delimiter">&quot;</span><span class="content">key2</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">value2</span><span class="delimiter">&quot;</span></span>
  },
  <span class="key"><span class="delimiter">&quot;</span><span class="content">labels</span><span class="delimiter">&quot;</span></span>: {                                      <i class="conum" data-value="18"></i><b>(18)</b>
    <span class="key"><span class="delimiter">&quot;</span><span class="content">key1</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">value1</span><span class="delimiter">&quot;</span></span>,                              <i class="conum" data-value="19"></i><b>(19)</b>
    <span class="key"><span class="delimiter">&quot;</span><span class="content">key2</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">value2</span><span class="delimiter">&quot;</span></span>
  },
  <span class="key"><span class="delimiter">&quot;</span><span class="content">runAs</span><span class="delimiter">&quot;</span></span>: {                                       <i class="conum" data-value="20"></i><b>(20)</b>
    <span class="key"><span class="delimiter">&quot;</span><span class="content">user</span><span class="delimiter">&quot;</span></span>: <span class="integer">1000</span>,                                  <i class="conum" data-value="21"></i><b>(21)</b>
    <span class="key"><span class="delimiter">&quot;</span><span class="content">group</span><span class="delimiter">&quot;</span></span>: <span class="integer">2000</span>                                  <i class="conum" data-value="22"></i><b>(22)</b>
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>S3 configuration section</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>S3 endpoint URL</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>S3 bucket name</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>S3 signature version (should be <code>S3v2</code> or <code>S3v4</code>)</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>S3 key pattern</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Custom Moon system images section (to use Moon with private Docker registries)</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Custom Moon image definition (one of <code>logger</code>, <code>defender</code>, <code>videoRecorder</code>)</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>Custom Moon image reference</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>Custom Moon image resources definition</td>
</tr>
<tr>
<td><i class="conum" data-value="10"></i><b>10</b></td>
<td>Custom Moon image limits section</td>
</tr>
<tr>
<td><i class="conum" data-value="11"></i><b>11</b></td>
<td>Custom Moon image CPU limit</td>
</tr>
<tr>
<td><i class="conum" data-value="12"></i><b>12</b></td>
<td>Custom Moon image memory limit</td>
</tr>
<tr>
<td><i class="conum" data-value="13"></i><b>13</b></td>
<td>Custom Moon image requests section</td>
</tr>
<tr>
<td><i class="conum" data-value="14"></i><b>14</b></td>
<td>Custom Moon image CPU request</td>
</tr>
<tr>
<td><i class="conum" data-value="15"></i><b>15</b></td>
<td>Custom Moon image memory request</td>
</tr>
<tr>
<td><i class="conum" data-value="16"></i><b>16</b></td>
<td>Custom pod annotations section (applies globally to all browser versions)</td>
</tr>
<tr>
<td><i class="conum" data-value="17"></i><b>17</b></td>
<td>Custom pod annotation key and value</td>
</tr>
<tr>
<td><i class="conum" data-value="18"></i><b>18</b></td>
<td>Custom pod labels section (applies globally to all browser versions)</td>
</tr>
<tr>
<td><i class="conum" data-value="19"></i><b>19</b></td>
<td>Custom pod label key and value</td>
</tr>
<tr>
<td><i class="conum" data-value="20"></i><b>20</b></td>
<td>Custom pod user and group id section</td>
</tr>
<tr>
<td><i class="conum" data-value="21"></i><b>21</b></td>
<td>Custom pod user id</td>
</tr>
<tr>
<td><i class="conum" data-value="22"></i><b>22</b></td>
<td>Custom pod group id</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><code>service.json</code> is mounted to Moon container as a regular file using Kubernetes config map. Path to configuration file is specified with <code>-config-file</code> Moon flag. Any changes to configuration file are applied immediately - no need to restart Moon.</p>
</div>
<div class="listingblock">
<div class="title">Adding <code>service.json</code> file to Moon</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">apiVersion</span>: <span class="string"><span class="content">v1</span></span>
<span class="key">kind</span>: <span class="string"><span class="content">ConfigMap</span></span>
<span class="key">metadata</span>:
  <span class="key">name</span>: <span class="string"><span class="content">config</span></span>
  <span class="key">namespace</span>: <span class="string"><span class="content">moon</span></span>
<span class="key">data</span>:
  <span class="key">service.json</span>: <span class="string"><span class="delimiter">|</span><span class="content">
    {
      &quot;s3&quot;: {
        &quot;endpoint&quot;: &quot;https://storage.googleapis.com&quot;,
        &quot;bucketName&quot;: &quot;moon-test&quot;,
        &quot;version&quot;: &quot;S3v2&quot;
      }
    }</span></span>
<span class="head"><span class="head">---</span></span>
<span class="key">apiVersion</span>: <span class="string"><span class="content">apps/v1beta1</span></span>
<span class="key">kind</span>: <span class="string"><span class="content">Deployment</span></span>
<span class="key">metadata</span>:
  <span class="key">name</span>: <span class="string"><span class="content">moon</span></span>
  <span class="key">namespace</span>: <span class="string"><span class="content">moon</span></span>
<span class="key">spec</span>:
  <span class="key">template</span>:
    <span class="key">metadata</span>:
      <span class="key">labels</span>:
        <span class="key">app</span>: <span class="string"><span class="content">moon</span></span>
    <span class="key">spec</span>:
      <span class="key">containers</span>:
      - <span class="string"><span class="content">name: moon</span></span>
        <span class="key">image</span>: <span class="string"><span class="content">aerokube/moon:latest-release</span></span>
        <span class="key">args</span>: <span class="string"><span class="content">[&quot;-config-file&quot;, &quot;/config/service.json&quot;]</span></span>
        <span class="key">volumeMounts</span>:
        - <span class="string"><span class="content">name: config</span></span>
          <span class="key">mountPath</span>: <span class="string"><span class="content">/config</span></span>
          <span class="key">readOnly</span>: <span class="string"><span class="content">true</span></span>
    <span class="key">volumes</span>:
      - <span class="string"><span class="content">name: config</span></span>
        <span class="key">configMap</span>:
          <span class="key">name</span>: <span class="string"><span class="content">config</span></span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_devices_file"><a class="anchor" href="#_devices_file"></a>2.4. Devices File</h3>
<div class="paragraph">
<p>Moon load information about available mobile devices for <a href="#">Mobile Emulation</a> from a special file usually called <code>devices.json</code>:</p>
</div>
<div class="listingblock">
<div class="title">Typical <code>devices.json</code> file</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
    <span class="key"><span class="delimiter">&quot;</span><span class="content">Google Nexus 4</span><span class="delimiter">&quot;</span></span>: { <i class="conum" data-value="1"></i><b>(1)</b>
      <span class="key"><span class="delimiter">&quot;</span><span class="content">width</span><span class="delimiter">&quot;</span></span>: <span class="integer">384</span>, <i class="conum" data-value="2"></i><b>(2)</b>
      <span class="key"><span class="delimiter">&quot;</span><span class="content">height</span><span class="delimiter">&quot;</span></span>: <span class="integer">640</span>, <i class="conum" data-value="3"></i><b>(3)</b>
      <span class="key"><span class="delimiter">&quot;</span><span class="content">pixelRatio</span><span class="delimiter">&quot;</span></span>: <span class="integer">2</span>, <i class="conum" data-value="4"></i><b>(4)</b>
      <span class="key"><span class="delimiter">&quot;</span><span class="content">userAgent</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">user-agent-string-for-chrome-%s</span><span class="delimiter">&quot;</span></span>, <i class="conum" data-value="5"></i><b>(5)</b>
      <span class="key"><span class="delimiter">&quot;</span><span class="content">printVersion</span><span class="delimiter">&quot;</span></span>: <span class="value">true</span> <i class="conum" data-value="6"></i><b>(6)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Mobile device name</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Device screen width</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Device screen height</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Device pixel ratio</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Device user agent</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Whether to substitute Chrome version to user agent string (<code>%s</code> placeholder is replaced by Chrome version)</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><code>devices.json</code> similarly to <code>service.json</code> is mounted to Moon container as a regular file using Kubernetes config map. Path to configuration file is specified with <code>-device-file</code> Moon flag. Any changes to configuration file are applied immediately - no need to restart Moon.</p>
</div>
</div>
<div class="sect2">
<h3 id="_credentials_secret"><a class="anchor" href="#_credentials_secret"></a>2.5. Credentials Secret</h3>
<div class="paragraph">
<p>Moon reads all credentials (e.g. S3 keys) from an optional Kubernetes secret called <code>credentials</code>. This secret is mounted to Moon container as a regular directory with distinct files corresponding to different keys. Path to credentials directory is specified with <code>-credentials-dir</code> Moon flag. Any changes to credentials secret are applied immediately - no need to restart Moon.</p>
</div>
<div class="listingblock">
<div class="title">Adding credentials secret to Moon</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">apiVersion</span>: <span class="string"><span class="content">v1</span></span>
<span class="key">kind</span>: <span class="string"><span class="content">Secret</span></span>
<span class="key">metadata</span>:
  <span class="key">name</span>: <span class="string"><span class="content">credentials</span></span>
  <span class="key">namespace</span>: <span class="string"><span class="content">moon</span></span>
<span class="key">stringData</span>:
  <span class="key">s3.accessKey</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">access-key-value</span><span class="delimiter">&quot;</span></span>
  <span class="key">s3.secretKey</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">secret-key-value</span><span class="delimiter">&quot;</span></span>
<span class="head"><span class="head">---</span></span>
<span class="key">apiVersion</span>: <span class="string"><span class="content">apps/v1beta1</span></span>
<span class="key">kind</span>: <span class="string"><span class="content">Deployment</span></span>
<span class="key">metadata</span>:
  <span class="key">name</span>: <span class="string"><span class="content">moon</span></span>
  <span class="key">namespace</span>: <span class="string"><span class="content">moon</span></span>
<span class="key">spec</span>:
  <span class="key">template</span>:
    <span class="key">metadata</span>:
      <span class="key">labels</span>:
        <span class="key">app</span>: <span class="string"><span class="content">moon</span></span>
    <span class="key">spec</span>:
      <span class="key">containers</span>:
      - <span class="string"><span class="content">name: moon</span></span>
        <span class="key">image</span>: <span class="string"><span class="content">aerokube/moon:latest-release</span></span>
        <span class="key">args</span>: <span class="string"><span class="content">[&quot;-credentials-dir&quot;, &quot;/credentials&quot;]</span></span>
        <span class="key">volumeMounts</span>:
        - <span class="string"><span class="content">name: credentials</span></span>
          <span class="key">mountPath</span>: <span class="string"><span class="content">/credentials</span></span>
          <span class="key">readOnly</span>: <span class="string"><span class="content">true</span></span>
    <span class="key">volumes</span>:
    - <span class="string"><span class="content">name: credentials</span></span>
      <span class="key">secret</span>:
        <span class="key">secretName</span>: <span class="string"><span class="content">credentials</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The following keys are supported:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 3. Supported Credentials Secret Keys</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Key</th>
<th class="tableblock halign-left valign-top">Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">s3.accessKey</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">S3 access key value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">s3.secretKey</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">S3 secret key value</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_installing_license"><a class="anchor" href="#_installing_license"></a>2.6. Installing License</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>According to license agreement you can use <strong>up to 4 parallel sessions without a license</strong>. If you wish to have more parallel sessions - order a license and follow this section steps to install the license. A trial license key with more parallel sessions can be generated on <a href="https://aerokube.com/moon/">Moon website</a>.</p>
</li>
<li>
<p>We recommend installing Moon to a clean namespace because pods already running in an existing namespace will be by default considered as browser pods and thus will consume your license.</p>
</li>
</ol>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To install a license you should have a license key file. A typical license file looks like this:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ cat license.key
Ti90a3ljSWpvV3hicU5ZY3U3ZVNMUzdzalVjU29nSVU2a3lmWDdENmhOSEs4SFJVVE5LNEpKL2oxRGhWTnRhZVBEQmx5cm1SM0dFWlVpbGIwOWhBSUpvWmlQMnNtYmtoZVRDbnJ3UTlIV3grMUMzaXFJalU3L0NIZDJuSzN3QUpIS0lyV2VoVjlRVUh5NzNCMFg0NEV5KzFSVXg1elhvaC9RUkNjTlBIOHR4WWtrRFBmTFhxYTFESlI0aXNObGtobWpXY2VJNVdna1lsWHFFOUp0OUxValZPN05hb2pCcHJzY0pvZjBrZys2YkhWUDR3cUJvYVFoSFJTYzMzZzNRSTkrWVd4dlZCeExmdTVxM2k2ZnluMDRHSEhGc21Fd2owVHdVa1Z3MmI5Z2FyVXlaVFF4RDdCRjVSVjBmSUVrU1pEQ0ZQdmIvMHZoKythY1V4OVRrR2FBREZzbWR3dExxRlU4NHF3MzBVdE5nTGhnNWYxRXRCQ215R1BHR0wyK2NpR0RDZDBTSXg4K1RsRGNWVzUyVVY4MUt6bkdOanJhTklOeXVtYjVPVXF6aVVpdmJZeVJNVVBSMWF3NUJRVGJDaHVycWVVdGtMMWFRZDgwOCtoWGRxODFOakxRNEJlVENNQTdPL2FneHBTUE1nL0J2QmVQKy84ZGhJeXd5Y0lxQVJhVWxocUdmUko2K05tbkFYV0hzZ2RjTng1dUVHU0w5VWF5TU1rR3RkZEZKQ1FiWmF0RnJMaDFHbHhKTndBRHFWcXIvQ0oxSzBQL2p6K2NFSWpsSG82TktvM3pudVFlanhYT2tGU1p1bWZrS1krZmF3VkVRZWlvcFlmZFk0TU9tc3U5TThsbng3T2VXQXZmOTFUQ2w1NUhBK1ZsQTMzN3VFOG1WV3ZlS0E1Tlk9O2V5SnNhV05sYm5ObFpTSTZJa0ZqYldVZ1RFeERJaXdpY0hKdlpIVmpkQ0k2SWsxdmIyNGlMQ0p0WVhoVFpYTnphVzl1Y3lJNk1qQXNJblJ2SWpveE5UTTRNelV5TURBd2ZRPT0=</pre>
</div>
</div>
<div class="sect3">
<h4 id="license-yaml-manifests"><a class="anchor" href="#license-yaml-manifests"></a>2.6.1. Option 1: you are using official YAML manifests</h4>
<div class="paragraph">
<p>Our <a href="https://github.com/aerokube/moon-deploy">official YAML manifests</a> already contain everything needed to install a license key and by default have the following definition:</p>
</div>
<div class="listingblock">
<div class="title">License key secret definition in YAML manifest</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">apiVersion</span>: <span class="string"><span class="content">v1</span></span>
<span class="key">kind</span>: <span class="string"><span class="content">Secret</span></span>
<span class="key">metadata</span>:
  <span class="key">name</span>: <span class="string"><span class="content">licensekey</span></span>
  <span class="key">namespace</span>: <span class="string"><span class="content">moon</span></span>
<span class="key">stringData</span>:
  <span class="key">license.key</span>: <span class="string"><span class="content">MG1RSVdpc2Z6YjdQQVZjd2lpei9KMkd1T3dzMTFuL1dlRjVSc3NOMUcxZk9QaUxWa3Q5SnBIakIxa09wWm0vVFJqQ0tsa21xVG1OODVRZnlQbjBjVmRHVWFLampTOFF1a3VLRXRPcEUwbnEySG16QWFQWHRDYTVjMm9jZzZFaUJqeFd5ODE4UFBHZzNCNWpCYXlha3oweFBscFl1RnB0V0U1Q3FwOGl5VDdKTk9abG5aSmlPdnRmZDFvSG1nNnVwVXBLV2E4RmYwWHcreERIR29ZTE1XTldPb1hvT2ZCUnZpcDhPWW05a1FqN0hBWWVOYUtLT1lPWlVJa1dsb1gxdjNOT1htTFpZalhsQ3h1Q3V6NWhiQjIwSjVIY0JTYnZybm9zYm14RXFkSFpQWVBKWUlKTzZvVlBnODhQeFErZ1EyTk5sWG82TC9XeXU3aisrNU0rSEdPcXlOSEdlNGx4Zm1nNVhjMWlnNkN1OCtNSVVYRzNqUllqOUY4ZHdReWpSbFNMNmFpL2dRQnc3TzY0U0lwdVF2d29jYi9kVzFSYWFRVkd3ZXYrOVdING8zRWRrYkVONUhRTmQ2MUxsUnFNdmtKeWVHV21tVlVUZ2dsMDRsTFFLTmZNVG81L2JVakNBMGhNeER5VHNJdmVRRGFMMklvTWpvcFk4VERlK1U2bUJvUDVxNVYrcCtDQVhjbjYxQlRaUVp0bmNqL0JBVkdNOEZ4NW9rWHRYSVAxUkY0a1VCckZVTDFyTWF1VkZqSk5xU1pLT293dUpMTTg2SEZ0Sld0eUlRK3ZZZm1pZU0xM292MnVleDBoRlhRdFkvMkt1dUhhN3dKV2pFT0pqaEVzTjhXSy82ZlFFbi9EQzcrNkw3NzhlbmVVZ2lLZ3VFbjlMMXZMYVZ5VWtQaWc9O2V5SnNhV05sYm5ObFpTSTZJa1JsWm1GMWJIUWlMQ0p3Y205a2RXTjBJam9pVFc5dmJpSXNJbTFoZUZObGMzTnBiMjV6SWpvMGZRPT0=</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You have to replace value of <code>license.key</code> with yours and reapply the manifest with <code>kubectl apply</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="license-helm"><a class="anchor" href="#license-helm"></a>2.6.2. Option 2: you are using Helm</h4>
<div class="paragraph">
<p>In our <a href="https://github.com/aerokube/charts">Helm charts</a> license key is exposed as <code>moon.licenseKey</code> parameter that could be set as follows:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ helm install --upgrade --set-file moon.licenseKey=/path/to/license.key -n moon moon aerokube/moon</pre>
</div>
</div>
<div class="paragraph">
<p>The same command using shell expansion:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ helm install --upgrade --set moon.licenseKey=$(&lt;/path/to/license.key) -n moon moon aerokube/moon</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="license-manually"><a class="anchor" href="#license-manually"></a>2.6.3. Option 3: doing everything manually</h4>
<div class="paragraph">
<p>Moon container is expecting to find license key file in the path specified by <code>-license-file</code> parameter. You need to mount license key file as a volume to every Moon container.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Having a license key file - create a Kubernetes secret:</p>
<div class="literalblock">
<div class="content">
<pre>$ kubectl create secret generic license-key --filename /path/to/license.key -n moon</pre>
</div>
</div>
<div class="paragraph">
<p>If you prefer YAML - this will look like:</p>
</div>
<div class="listingblock">
<div class="title">Creating a secret for license key</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">apiVersion</span>: <span class="string"><span class="content">v1</span></span>
<span class="key">kind</span>: <span class="string"><span class="content">Secret</span></span>
<span class="key">metadata</span>:
  <span class="key">name</span>: <span class="string"><span class="content">license-key</span></span>
  <span class="key">namespace</span>: <span class="string"><span class="content">moon</span></span>
<span class="key">stringData</span>:
  <span class="key">license.key</span>: <span class="string"><span class="content">Ti90a3ljSWpvV3hicU5ZY3U3ZVNMUzdzalVjU29nSVU2a3lmWDdENmhOSEs4SFJVVE5LNEpKL2oxRGhWTnRhZVBEQmx5cm1SM0dFWlVpbGIwOWhBSUpvWmlQMnNtYmtoZVRDbnJ3UTlIV3grMUMzaXFJalU3L0NIZDJuSzN3QUpIS0lyV2VoVjlRVUh5NzNCMFg0NEV5KzFSVXg1elhvaC9RUkNjTlBIOHR4WWtrRFBmTFhxYTFESlI0aXNObGtobWpXY2VJNVdna1lsWHFFOUp0OUxValZPN05hb2pCcHJzY0pvZjBrZys2YkhWUDR3cUJvYVFoSFJTYzMzZzNRSTkrWVd4dlZCeExmdTVxM2k2ZnluMDRHSEhGc21Fd2owVHdVa1Z3MmI5Z2FyVXlaVFF4RDdCRjVSVjBmSUVrU1pEQ0ZQdmIvMHZoKythY1V4OVRrR2FBREZzbWR3dExxRlU4NHF3MzBVdE5nTGhnNWYxRXRCQ215R1BHR0wyK2NpR0RDZDBTSXg4K1RsRGNWVzUyVVY4MUt6bkdOanJhTklOeXVtYjVPVXF6aVVpdmJZeVJNVVBSMWF3NUJRVGJDaHVycWVVdGtMMWFRZDgwOCtoWGRxODFOakxRNEJlVENNQTdPL2FneHBTUE1nL0J2QmVQKy84ZGhJeXd5Y0lxQVJhVWxocUdmUko2K05tbkFYV0hzZ2RjTng1dUVHU0w5VWF5TU1rR3RkZEZKQ1FiWmF0RnJMaDFHbHhKTndBRHFWcXIvQ0oxSzBQL2p6K2NFSWpsSG82TktvM3pudVFlanhYT2tGU1p1bWZrS1krZmF3VkVRZWlvcFlmZFk0TU9tc3U5TThsbng3T2VXQXZmOTFUQ2w1NUhBK1ZsQTMzN3VFOG1WV3ZlS0E1Tlk9O2V5SnNhV05sYm5ObFpTSTZJa0ZqYldVZ1RFeERJaXdpY0hKdlpIVmpkQ0k2SWsxdmIyNGlMQ0p0WVhoVFpYTnphVzl1Y3lJNk1qQXNJblJ2SWpveE5UTTRNelV5TURBd2ZRPT0=</span></span></code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>License key file contains raw (<strong>NOT</strong> <a href="https://en.wikipedia.org/wiki/Base64">Base64</a>-encoded) license key data. In some cases (e.g. when using <code>data</code> field in YAML) you may need to encode key data contents yourself.</p>
</li>
<li>
<p>When using YAML with <code>stringData</code> field - you don&#8217;t need to <a href="https://en.wikipedia.org/wiki/Base64">Base64</a>-encode license key one more time.</p>
</li>
<li>
<p>If you are using Moon started from Google Cloud Marketplace then secret name can differ, e.g. <code>moon-marketplace-license-key</code> instead of <code>license-key</code>.</p>
</li>
</ol>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>When starting Moon - mount this secret as a volume and point <code>-license-file</code> to mounted file:</p>
<div class="listingblock">
<div class="title">Starting Moon with license key</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">apiVersion</span>: <span class="string"><span class="content">apps/v1beta1</span></span>
<span class="key">kind</span>: <span class="string"><span class="content">Deployment</span></span>
<span class="key">metadata</span>:
  <span class="key">name</span>: <span class="string"><span class="content">moon</span></span>
  <span class="key">namespace</span>: <span class="string"><span class="content">moon</span></span>
<span class="key">spec</span>:
  <span class="key">replicas</span>: <span class="string"><span class="content">3</span></span>
  <span class="key">template</span>:
    <span class="key">metadata</span>:
      <span class="key">labels</span>:
        <span class="key">app</span>: <span class="string"><span class="content">moon</span></span>
    <span class="key">spec</span>:
      <span class="key">containers</span>:
      - <span class="string"><span class="content">name: moon</span></span>
        <span class="key">image</span>: <span class="string"><span class="content">aerokube/moon:latest-release</span></span>
        <span class="key">args</span>: <span class="string"><span class="content">[&quot;-license-file&quot;, &quot;/license/license.key&quot;]</span></span> <span class="comment"># Pointing to license key file</span>
        <span class="key">resources</span>:
            <span class="comment"># Resources here</span>
        <span class="key">ports</span>:
            <span class="comment"># Ports here</span>
        <span class="key">volumeMounts</span>:
        <span class="comment"># Other mounts here</span>
        - <span class="string"><span class="content">name: license-key</span></span> <span class="comment"># Mounting volume with license key</span>
          <span class="key">mountPath</span>: <span class="string"><span class="content">/license</span></span>
          <span class="key">readOnly</span>: <span class="string"><span class="content">true</span></span>
    <span class="key">volumes</span>:
    <span class="comment"># Other volumes here</span>
    - <span class="string"><span class="content">name: license-key</span></span> <span class="comment"># Creating volume from secret</span>
      <span class="key">secret</span>:
        <span class="key">secretName</span>: <span class="string"><span class="content">license-key</span></span></code></pre>
</div>
</div>
</li>
<li>
<p>If you update an existing secret with license key (already present in default deployment manifests) then settings are applied immediately without Moon restart. How fast Moon pods will "see" an updated license key depends on Kubernetes <a href="https://kubernetes.io/docs/concepts/configuration/secret/#mounted-secrets-are-updated-automatically">cache propagation delay</a> (default value is <code>1 minute</code>).</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="license-how-it-works"><a class="anchor" href="#license-how-it-works"></a>2.6.4. How Licenses Work</h4>
<div class="paragraph">
<p>Every license key gives you an ability to run <strong>fixed number of parallel browser sessions</strong>. To limit maximum number of browser sessions Moon is using built-in Kubernetes <a href="https://kubernetes.io/docs/concepts/policy/resource-quotas/">resource quota</a> feature. Every browser session in Moon is a separate Kubernetes <a href="https://kubernetes.io/docs/concepts/workloads/pods/pod/">pod</a>. When started Moon checks that respective pod resource quota exists (that is to say total number of pods is limited). If not found such resource quota is automatically created. You can have any desired number of Moon, Moon API and Moon UI replicas (i.e. pods) in your cluster. These pods are added to total number of parallel browser sessions from license key. For example:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Your license key covers <strong>100</strong> parallel sessions</p>
</li>
<li>
<p>You have <strong>5</strong> pods with Moon, Moon API and Moon UI (Moon pods)</p>
</li>
<li>
<p>Correct pods quota is no more than <strong>100 + 5 = 105</strong> pods</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Having such pods quota and 5 running Moon pods, Kubernetes will allow to start 100 browser pods maximum. New browser session requests exceeding the quota will wait for previous sessions to finish, i.e. previous pods to be removed by Moon. To determine that a running pod is a Moon pod its labels are analysed. Any pod is considered a Moon pod if the following <a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/">label selector</a> matches:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>app in (moon, moon-api, moon-ui)</pre>
</div>
</div>
<div class="paragraph">
<p>So when starting Moon - you should add a label <code>app</code> with value: <code>moon</code>, <code>moon-api</code> or <code>moon-ui</code> to respective pod definitions.</p>
</div>
</div>
<div class="sect3">
<h4 id="license-restricted-cluster"><a class="anchor" href="#license-restricted-cluster"></a>2.6.5. Installing License to Restricted Cluster</h4>
<div class="paragraph">
<p>In some environments Moon has no permission to automatically create resource quota for its namespace. In that case you need to ask your Kubernetes administrator to create resource quota manually:</p>
</div>
<div class="listingblock">
<div class="title">Required ResourceQuota object definition</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">apiVersion</span>: <span class="string"><span class="content">v1</span></span>
<span class="key">kind</span>: <span class="string"><span class="content">ResourceQuota</span></span>
<span class="key">metadata</span>:
    <span class="key">name</span>: <span class="string"><span class="content">max-moon-sessions</span></span>
    <span class="key">namespace</span>: <span class="string"><span class="content">moon</span></span>
<span class="key">spec</span>:
    <span class="key">hard</span>:
      <span class="key">pods</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">105</span><span class="delimiter">&quot;</span></span> <span class="comment"># 100 pods with browsers + 5 pods with Moon</span>
    <span class="key">scopes</span>: <span class="string"><span class="content">[&quot;NotTerminating&quot;]</span></span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_monitoring"><a class="anchor" href="#_monitoring"></a>2.7. Monitoring</h3>
<div class="paragraph">
<p>Moon has a dedicated microservice <code>moon-monitor</code> allowing to easily visualize browsers consumption with <a href="https://prometheus.io/">Prometheus</a> and <a href="https://grafana.com/">Grafana</a>.</p>
</div>
<div class="paragraph">
<div class="title">An example Grafana dashboard</div>
<p><span class="image"><img src="img/grafana.png" alt="grafana"></span></p>
</div>
<div class="paragraph">
<p><code>moon-monitor</code> (distributed as <code>aerokube/moon-monitor</code> image) exposes browsers consumption information in <a href="https://prometheus.io/docs/instrumenting/exposition_formats/#text-format-example">Prometheus text format</a> via <code>/metrics</code> HTTP API.
One of the most simple ways of deploying Prometheus in Kubernetes is using <a href="https://github.com/coreos/prometheus-operator">Prometheus Operator</a>. When using it monitoring solution could work like the following:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Moon should be already running (e.g. in <code>moon</code> namespace).</p>
</li>
<li>
<p>Deploy Prometheus and Grafana using Prometheus Operator (e.g. to <code>monitoring</code> namespace).</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>An example Prometheus Operator installation command using Helm 3 is:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ helm repo add stable https://kubernetes-charts.storage.googleapis.com/
$ helm install prometheus-operator stable/prometheus-operator --create-namespace --namespace monitoring</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Deploy <code>moon-monitor</code> to the same <code>monitoring</code> namespace (optionally using a service account with permissions to access <code>moon</code> namespace):</p>
<div class="listingblock">
<div class="title">Deploying moon-monitor with Kubernetes Service and Deployment</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">apiVersion</span>: <span class="string"><span class="content">v1</span></span>
<span class="key">kind</span>: <span class="string"><span class="content">ServiceAccount</span></span>
<span class="key">metadata</span>:
  <span class="key">name</span>: <span class="string"><span class="content">moon-monitor</span></span>
  <span class="key">namespace</span>: <span class="string"><span class="content">monitoring</span></span>
<span class="head"><span class="head">---</span></span>
<span class="key">apiVersion</span>: <span class="string"><span class="content">rbac.authorization.k8s.io/v1</span></span>
<span class="key">kind</span>: <span class="string"><span class="content">Role</span></span>
<span class="key">metadata</span>:
  <span class="key">name</span>: <span class="string"><span class="content">moon-monitor</span></span>
  <span class="key">namespace</span>: <span class="string"><span class="content">moon</span></span>
<span class="key">rules</span>:
- <span class="string"><span class="content">apiGroups:</span></span>
  - <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>
  <span class="key">resources</span>:
  - <span class="string"><span class="content">pods</span></span>
  - <span class="string"><span class="content">resourcequotas</span></span>
  <span class="key">verbs</span>:
  - <span class="string"><span class="content">get</span></span>
  - <span class="string"><span class="content">watch</span></span>
  - <span class="string"><span class="content">list</span></span>
<span class="head"><span class="head">---</span></span>
<span class="key">apiVersion</span>: <span class="string"><span class="content">rbac.authorization.k8s.io/v1</span></span>
<span class="key">kind</span>: <span class="string"><span class="content">RoleBinding</span></span>
<span class="key">metadata</span>:
  <span class="key">name</span>: <span class="string"><span class="content">moon-monitor</span></span>
  <span class="key">namespace</span>: <span class="string"><span class="content">moon</span></span>
<span class="key">roleRef</span>:
  <span class="key">kind</span>: <span class="string"><span class="content">Role</span></span>
  <span class="key">name</span>: <span class="string"><span class="content">moon-monitor</span></span>
  <span class="key">apiGroup</span>: <span class="string"><span class="content">rbac.authorization.k8s.io</span></span>
<span class="key">subjects</span>:
- <span class="string"><span class="content">kind: ServiceAccount</span></span>
  <span class="key">name</span>: <span class="string"><span class="content">moon-monitor</span></span>
  <span class="key">namespace</span>: <span class="string"><span class="content">monitoring</span></span>
<span class="head"><span class="head">---</span></span>
<span class="key">kind</span>: <span class="string"><span class="content">Service</span></span>
<span class="key">apiVersion</span>: <span class="string"><span class="content">v1</span></span>
<span class="key">metadata</span>:
  <span class="key">name</span>: <span class="string"><span class="content">moon-monitor</span></span>
  <span class="key">namespace</span>: <span class="string"><span class="content">monitoring</span></span>
  <span class="key">labels</span>:
    <span class="key">app</span>: <span class="string"><span class="content">moon-monitor</span></span>
<span class="key">spec</span>:
  <span class="key">selector</span>:
    <span class="key">app</span>: <span class="string"><span class="content">moon-monitor</span></span>
  <span class="key">ports</span>:
  - <span class="string"><span class="content">name: metrics</span></span>
    <span class="key">port</span>: <span class="string"><span class="content">8080</span></span>
<span class="head"><span class="head">---</span></span>
<span class="key">apiVersion</span>: <span class="string"><span class="content">apps/v1</span></span>
<span class="key">kind</span>: <span class="string"><span class="content">Deployment</span></span>
<span class="key">metadata</span>:
  <span class="key">name</span>: <span class="string"><span class="content">moon-monitor</span></span>
  <span class="key">namespace</span>: <span class="string"><span class="content">monitoring</span></span>
<span class="key">spec</span>:
  <span class="key">replicas</span>: <span class="string"><span class="content">1</span></span>
  <span class="key">selector</span>:
    <span class="key">matchLabels</span>:
      <span class="key">app</span>: <span class="string"><span class="content">moon-monitor</span></span>
  <span class="key">template</span>:
    <span class="key">metadata</span>:
      <span class="key">labels</span>:
        <span class="key">app</span>: <span class="string"><span class="content">moon-monitor</span></span>
    <span class="key">spec</span>:
      <span class="key">serviceAccountName</span>: <span class="string"><span class="content">moon-monitor</span></span>
      <span class="key">containers</span>:
      - <span class="string"><span class="content">name: moon-monitor</span></span>
        <span class="key">image</span>: <span class="string"><span class="content">aerokube/moon-monitor:latest</span></span>
        <span class="key">args</span>:
        - <span class="string"><span class="content">-namespace</span></span>
        - <span class="string"><span class="content">moon</span></span>
        <span class="key">imagePullPolicy</span>: <span class="string"><span class="content">IfNotPresent</span></span>
        <span class="key">ports</span>:
        - <span class="string"><span class="content">name: metrics</span></span>
          <span class="key">containerPort</span>: <span class="string"><span class="content">8080</span></span></code></pre>
</div>
</div>
</li>
<li>
<p>Create a <a href="https://github.com/coreos/prometheus-operator/blob/master/Documentation/design.md#servicemonitor">ServiceMonitor</a> object to start fetching Moon metrics:</p>
<div class="listingblock">
<div class="title">Creating ServiceMonitor for Moon</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">apiVersion</span>: <span class="string"><span class="content">monitoring.coreos.com/v1</span></span>
<span class="key">kind</span>: <span class="string"><span class="content">ServiceMonitor</span></span>
<span class="key">metadata</span>:
  <span class="key">name</span>: <span class="string"><span class="content">moon-monitor</span></span>
  <span class="key">namespace</span>: <span class="string"><span class="content">monitoring</span></span>
  <span class="key">labels</span>:
    <span class="key">release</span>: <span class="string"><span class="content">prometheus-operator</span></span>
<span class="key">spec</span>:
  <span class="key">selector</span>:
    <span class="key">matchLabels</span>:
      <span class="key">app</span>: <span class="string"><span class="content">moon-monitor</span></span>
  <span class="key">endpoints</span>:
  - <span class="string"><span class="content">port: metrics</span></span>
    <span class="key">interval</span>: <span class="string"><span class="content">15s</span></span></code></pre>
</div>
</div>
</li>
<li>
<p>To fetch browser consumption information from Prometheus, query it like the following:</p>
<div class="listingblock">
<div class="content">
<pre>sum(moon_browser_count{browserName="chrome"}) by (version)</pre>
</div>
</div>
<div class="paragraph">
<p>To create a Grafana dashboard you can import and customize our <a href="https://grafana.com/grafana/dashboards/12264">example configuration</a>. An example YAML manifest for deploying <code>moon-monitor</code> could be found <a href="https://github.com/aerokube/moon-deploy/blob/master/moon-monitor.yaml">here</a>.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_advanced_configuration"><a class="anchor" href="#_advanced_configuration"></a>2.8. Advanced Configuration</h3>
<div class="sect3">
<h4 id="s3"><a class="anchor" href="#s3"></a>2.8.1. Uploading Files to S3</h4>
<div class="sect4">
<h5 id="s3-configuration"><a class="anchor" href="#s3-configuration"></a>How to Configure S3 Support</h5>
<div class="paragraph">
<p>You can configure Moon to send sessions logs and recorded video files to <a href="https://en.wikipedia.org/wiki/Amazon_S3">S3</a>-compatible storage. Such type of storage is supported by <a href="https://aws.amazon.com/">AWS</a>, <a href="https://cloud.google.com/">Google Cloud</a>, <a href="https://azure.microsoft.com/">Microsoft Azure</a>, <a href="https://digitalocean.com/">Digital Ocean</a> and many other cloud providers. To deploy a private S3-compatible storage you can use <a href="https://minio.io/">Minio</a>. To enable S3 support in Moon:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create an S3 bucket. In this example bucket name is <code>moon-test</code>. You will get an access key and a secret key for the bucket. Also you need to know supported S3 protocol version (usually specified in documentation).</p>
</li>
<li>
<p>Create a <code>service.json</code> file with the following contents:</p>
<div class="literalblock">
<div class="content">
<pre>$ cat service.json
{
  "s3": {
    "endpoint": "https://storage.googleapis.com",
    "bucketName": "moon-test",
    "version": "S3v2"
  }
}</pre>
</div>
</div>
<div class="paragraph">
<p>You can create an S3-compatible bucket in the majority of public cloud platforms. How to configure Moon with these platforms in shown in the table below:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 4. S3 settings for popular cloud platforms</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Platform Name</th>
<th class="tableblock halign-left valign-top">Service Name</th>
<th class="tableblock halign-left valign-top">Endpoint</th>
<th class="tableblock halign-left valign-top">Signature Version</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">AWS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">AWS S3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Depends on region, e.g. <code><a href="https://s3.us-east-2.amazonaws.com" class="bare">https://s3.us-east-2.amazonaws.com</a></code>. See AWS <a href="https://docs.aws.amazon.com/general/latest/gr/s3.html">documentation</a> for detailed list of endpoints.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">S3v4</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DigitalOcean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DigitalOcean Spaces</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Depends on region, e.g. <code><a href="https://nyc3.digitaloceanspaces.com" class="bare">https://nyc3.digitaloceanspaces.com</a></code>. See <a href="https://www.digitalocean.com/docs/spaces/">documentation</a> for more details.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">S3v4</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Google Cloud</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Google Cloud Storage</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><a href="https://storage.googleapis.com" class="bare">https://storage.googleapis.com</a></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">S3v2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Microsoft Azure</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Azure Blob Storage</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No built-in S3 support. Need to deploy additional software like <a href="https://az.minio.io/">Minio</a>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">S3v4</p></td>
</tr>
</tbody>
</table>
</li>
<li>
<p>Save <code>service.json</code> to a Kubernetes config map, mount it as a file to Moon container and then specify path to the file using <code>-config-file</code> flag as shown in <a href="#">Configuration File</a> section.</p>
</li>
<li>
<p>Create a Kubernetes credentials secret, mount it as a directory to Moon container and then specify path to this directory using <code>-credentials-dir</code> flag as shown in <a href="#">Credentials Secret</a> section.</p>
<div class="listingblock">
<div class="title">S3 credentials secret</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">apiVersion</span>: <span class="string"><span class="content">v1</span></span>
<span class="key">kind</span>: <span class="string"><span class="content">Secret</span></span>
<span class="key">metadata</span>:
  <span class="key">name</span>: <span class="string"><span class="content">credentials</span></span>
  <span class="key">namespace</span>: <span class="string"><span class="content">moon</span></span>
<span class="key">stringData</span>:
  <span class="key">s3.accessKey</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">access-key-value</span><span class="delimiter">&quot;</span></span>
  <span class="key">s3.secretKey</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">secret-key-value</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
</li>
<li>
<p>When you update already mounted config map with <code>service.json</code> or a <code>credentials secret</code> - settings are applied immediately without Moon restart.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="s3-custom-layout"><a class="anchor" href="#s3-custom-layout"></a>Custom S3 Layout</h5>
<div class="paragraph">
<p>By default files are uploaded to S3 bucket as follows:</p>
</div>
<div class="listingblock">
<div class="title">Default S3 bucket layout</div>
<div class="content">
<pre>\---my-bucket
    \---- &lt;session-id&gt;
        |---- video.mp4
        |---- session.log</pre>
</div>
</div>
<div class="paragraph">
<p>Moon allows to organize any custom S3 keys layout using <strong>S3 key pattern</strong> with placeholders. A typical S3 key pattern looks like the following:</p>
</div>
<div class="listingblock">
<div class="title">Typical S3 key pattern</div>
<div class="content">
<pre>$quota/$browserName/$browserVersion/$platformName/$sessionId</pre>
</div>
</div>
<div class="paragraph">
<p>Here every placeholder such as <code>$quota</code>, <code>$browserName</code>, <code>$browserVersion</code> and so on will be replaced by corresponding information: user name, browser name, browser version. The resulting S3 key will be used as a directory to save log and video files. A list of supported placeholders is shown in the table below:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 5. S3 Key Placeholders</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Placeholder</th>
<th class="tableblock halign-left valign-top">Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">$sessionId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Replaced by Selenium session ID</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">$browserName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Replaced by Selenium browser name capability value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">$browserVersion</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Replaced by Selenium browser version capability value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">$platformName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Replaced by Selenium platform capability value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">$date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Replaced by current date, e.g. <code>2018-11-01</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">$quota</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Replaced by quota name (i.e. user name provided in Selenium URL)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Default S3 key pattern is just <code>$sessionId</code>:</p>
</div>
<div class="listingblock">
<div class="title">Default video and log paths</div>
<div class="content">
<pre>my-bucket/chrome-71-0-686efb96-eabe-4435-af31-21a33c8a4c8b/video.mp4
my-bucket/chrome-71-0-686efb96-eabe-4435-af31-21a33c8a4c8b/session.log</pre>
</div>
</div>
<div class="paragraph">
<p>You change S3 key pattern in <code>service.json</code> file as follows:</p>
</div>
<div class="listingblock">
<div class="title">Setting custom S3 key pattern in <code>service.json</code></div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">s3</span><span class="delimiter">&quot;</span></span>: {
    <span class="error">/</span><span class="error">/</span> <span class="error">T</span><span class="error">h</span><span class="error">e</span> <span class="error">r</span><span class="error">e</span><span class="error">s</span><span class="error">t</span> <span class="error">o</span><span class="error">f</span> <span class="error">S</span><span class="integer">3</span> <span class="error">s</span><span class="error">e</span><span class="error">t</span><span class="error">t</span><span class="error">i</span><span class="error">n</span><span class="error">g</span><span class="error">s</span> <span class="error">g</span><span class="error">o</span> <span class="error">h</span><span class="error">e</span><span class="error">r</span><span class="error">e</span><span class="error">.</span><span class="error">.</span><span class="error">.</span>
    <span class="key"><span class="delimiter">&quot;</span><span class="content">keyPattern</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">$quota/$browserName/$browserVersion/$platformName/$sessionId</span><span class="delimiter">&quot;</span></span>  <i class="conum" data-value="1"></i><b>(1)</b>
  },
  <span class="key"><span class="delimiter">&quot;</span><span class="content">images</span><span class="delimiter">&quot;</span></span>: {
    <span class="error">/</span><span class="error">/</span><span class="error">.</span><span class="error">.</span><span class="error">.</span>
  },
  <span class="key"><span class="delimiter">&quot;</span><span class="content">annotations</span><span class="delimiter">&quot;</span></span>: {
    <span class="error">/</span><span class="error">/</span><span class="error">.</span><span class="error">.</span><span class="error">.</span>
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Custom S3 key pattern</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To define S3 key pattern for every browser session independently - use <code>s3KeyPattern</code> capability described in <a href="#">Special Capabilities</a> section.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="custom-docker-registry"><a class="anchor" href="#custom-docker-registry"></a>2.8.2. Using Custom Docker Registry</h4>
<div class="paragraph">
<p>By default Moon downloads all images (<code>aerokube/defender</code>, <code>aerokube/logger</code> and so on) from public Docker registry. If in your environment due to security restrictions Docker images can only be downloaded from private registry you need to configure Moon to work with this registry. To do this:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Configure Kubernetes authentication to your private registry:</p>
<div class="literalblock">
<div class="content">
<pre>$ kubectl create secret docker-registry my-registry.example.com --docker-server=my-registry.example.com --docker-username=some-user --docker-password=registry-password --docker-email=some-user@example.com
$ kubectl patch serviceaccount default -p '{"imagePullSecrets": [{"name": "my-registry.example.com"}]}' # Use correct service account name here</pre>
</div>
</div>
<div class="paragraph">
<p>In case of Openshift the following commands will work:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ oc create secret docker-registry my-registry.example.com --docker-server=my-registry.example.com --docker-username=some-user --docker-password=registry-password --docker-email=some-user@example.com
$ oc secrets link default my-registry.example.com --for=pull</pre>
</div>
</div>
</li>
<li>
<p>Copy all desired browser images to your registry:</p>
<div class="literalblock">
<div class="content">
<pre>selenoid/chrome:73.0 =&gt; my-registry.example.com/moon/chrome:73.0</pre>
</div>
</div>
</li>
<li>
<p>Update <a href="#">Browsers List</a> file (<code>browsers.json</code>) to use new browser images:</p>
<div class="listingblock">
<div class="title">Browsers List File with Custom Images</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">chrome</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">73.0</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">versions</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">73.0</span><span class="delimiter">&quot;</span></span>: {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">image</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">my-registry.example.com/moon/chrome:73.0</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">port</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">4444</span><span class="delimiter">&quot;</span></span>
        },
        <span class="key"><span class="delimiter">&quot;</span><span class="content">72.0</span><span class="delimiter">&quot;</span></span>: {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">image</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">my-registry.example.com/moon/chrome:72.0</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">port</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">4444</span><span class="delimiter">&quot;</span></span>
        }
    }
  }
}</code></pre>
</div>
</div>
</li>
<li>
<p>Copy desired version of the Moon service images to your registry:</p>
<div class="literalblock">
<div class="content">
<pre>aerokube/moon-video-recorder:1.3.4 =&gt; my-registry.example.com/moon/moon-video-recorder:1.3.4
aerokube/defender:1.3.4 =&gt; my-registry.example.com/moon/defender:1.3.4
aerokube/logger =&gt; my-registry.example.com/moon/logger:1.3.4</pre>
</div>
</div>
</li>
<li>
<p>Override Moon service images, create a <code>service.json</code> file with the following contents:</p>
<div class="literalblock">
<div class="content">
<pre>$ cat service.json
{
  "images": {
    "videoRecorder": {
        "image": "my-registry.example.com/moon/moon-video-recorder:latest-release"
    },
    "defender": {
        "image": "my-registry.example.com/moon/defender:latest-release"
    },
    "logger": {
        "image": "my-registry.example.com/moon/logger:latest-release"
    }
  }
}</pre>
</div>
</div>
<div class="paragraph">
<p>If you already have S3 configuration in <code>service.json</code> file - just append new <code>images</code> key to it.</p>
</div>
</li>
<li>
<p>Save <code>service.json</code> to a Kubernetes config map, mount it as a file to Moon container and then specify path to the file using <code>-config-file</code> flag as shown in <a href="#">Configuration File</a> section. When you update a config map with <code>service.json</code> - settings are applied immediately without Moon restart.</p>
</li>
<li>
<p>Copy desired version of Moon main images to your registry:</p>
<div class="literalblock">
<div class="content">
<pre>aerokube/moon:1.3.4 =&gt; my-registry.example.com/moon/moon:1.3.4
aerokube/moon-api:1.3.4 =&gt; my-registry.example.com/moon/moon-api:1.3.4
aerokube/selenoid-ui:1.6.5 =&gt; my-registry.example.com/moon/selenoid-ui:1.6.5</pre>
</div>
</div>
</li>
<li>
<p>Use new main Moon images from the previous step in Kubernetes YAML definitions to start Moon, Moon API and Moon UI.</p>
</li>
<li>
<p>If you are using Playwright or Chrome Developer Tools feature - to override repository you have to set the following flags to <code>moon</code> container:</p>
<div class="literalblock">
<div class="content">
<pre>-chrome-devtools-repository my-registry.example.com/cdtp
-playwright-repository my-registry.example.com/playwright</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="timeouts"><a class="anchor" href="#timeouts"></a>2.8.3. Adjusting Timeouts</h4>
<div class="sect4">
<h5 id="timeouts-moon"><a class="anchor" href="#timeouts-moon"></a>Adjusting Moon Timeouts</h5>
<div class="paragraph">
<p>Sometimes things go wrong: user can unexpectedly disconnect or browser session starts longer than needed. This can lead to overall cluster degradation because of broken browser pods occupying all available hardware. To prevent such cases Moon automatically detects and closes suspicious browser sessions. Several flags allow to adjust timeout settings:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 6. Available Timeout Flags</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Flag</th>
<th class="tableblock halign-left valign-top">Default Value</th>
<th class="tableblock halign-left valign-top">Meaning</th>
<th class="tableblock halign-left valign-top">Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-timeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 minute</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maximum browser session idle time - measured as maximum time between separate HTTP requests corresponding to a running session.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When this timeout expires - session is automatically closed. You may need to increase this timeout when tested application pages load too slowly.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-session-attempt-timeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10 minutes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maximum time to start browser pod.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This time includes Kubernetes scheduling time and browser image download duration.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="timeouts-other"><a class="anchor" href="#timeouts-other"></a>Adjusting Other Timeouts</h5>
<div class="paragraph">
<p>Not only Moon timeout settings can cause your tests to break. A typical Moon installation looks like the following:</p>
</div>
<div class="paragraph">
<div class="title">Possible Timeout Sources</div>
<p><span class="image"><img src="img/timeouts.png" alt="timeouts"></span></p>
</div>
<div class="paragraph">
<p>In addition to Moon timeouts other possible sources of timeouts exist:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Client-side Timeout.</strong> Every Selenium library is internally using an HTTP client having default request timeout settings. If you are frequently seeing <code>CLIENT_DISCONNECTED</code> messages (meaning that client disconnected before request handling completed) in Moon log - this could be a sign to increase HTTP client timeouts in your code.</p>
</li>
<li>
<p><strong>Load Balancer Timeout.</strong> Usually Moon is running behind load balancer (<code>LoadBalancer</code>, <code>Ingress</code> or <code>Router</code>) and it also has a default request proxy timeout. A frequent value is <code>60 seconds</code>, so if you are often seeing test fails with <code>502 Bad Gateway</code> or <code>504 Gateway Timeout</code> errors - this could be a sign to increase load balancer timeout. How to do this depends on your cloud platform and load balancer type being used. So refer to their documentation for more details. An example of doing this for AWS cloud is shown in <a href="#faq-connection-closed-unexpectedly">Connection was closed unexpectedly</a> section.</p>
</li>
<li>
<p><strong>Cluster Capacity Reached.</strong> When you have already started the maximum number of browser pods allowed by your license, all new browser requests on top of this number will be waiting in queue for already running pods to stop. Waiting too much in queue will lead to user timeout described above. So if you are seeing a lot of <code>FORBIDDEN_TO_CREATE_POD</code> messages in the log that can signalize that you used all available browsers or all available computing resources (CPUs and memory) assigned to Moon namespace.</p>
</li>
<li>
<p><strong>Cluster Fragmentation.</strong> Similarly to the previous one, in some cases you can have sufficient number of cores and not all browsers are exhausted. However sometimes for example you can have 4 CPUs available distributed among 4 Kubernetes nodes (1 available CPU per node) and a new browser pod requiring at least 2 CPUs to start (all pod containers always run on the same node). In that case although total number of available CPUs is sufficient to start a pod, there is no node where pod will be able to start. If you are seeing too many browser pods in <code>Pending</code> state - check with <code>kubectl describe</code> command why these pods are not starting.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="resources"><a class="anchor" href="#resources"></a>2.8.4. Adjusting Resources Consumption</h4>
<div class="sect4">
<h5 id="resources-browser"><a class="anchor" href="#resources-browser"></a>Browser Resources Consumption</h5>
<div class="paragraph">
<p>Moon has reasonable defaults for resources consumed by every browser pod. Sometimes you may need to override these settings. To override resource settings globally for every browser image use one of the following flags:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 7. Resources Consumption Flags</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Flag</th>
<th class="tableblock halign-left valign-top">Default Value</th>
<th class="tableblock halign-left valign-top">Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-cpu-limit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hard CPU limit for browser container (no more than this limit is given)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-cpu-request</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Soft (guaranteed) CPU limit for browser container</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-memory-limit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1Gi</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hard memory limit for browser container</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-memory-request</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">512Mi</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Soft memory limit for browser container</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>You can also override the same values for every browser image in browsers list file:</p>
</div>
<div class="listingblock">
<div class="title">Overriding Resources in Browsers List File</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">firefox</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">62.0</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">versions</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">62.0</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">image</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">selenoid/firefox:62.0</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">port</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">4444</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">path</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">/wd/hub</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">resources</span><span class="delimiter">&quot;</span></span>: {                              <i class="conum" data-value="1"></i><b>(1)</b>
          <span class="key"><span class="delimiter">&quot;</span><span class="content">limits</span><span class="delimiter">&quot;</span></span>: {                               <i class="conum" data-value="2"></i><b>(2)</b>
            <span class="key"><span class="delimiter">&quot;</span><span class="content">cpu</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">2</span><span class="delimiter">&quot;</span></span>,                             <i class="conum" data-value="3"></i><b>(3)</b>
            <span class="key"><span class="delimiter">&quot;</span><span class="content">memory</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">2Gi</span><span class="delimiter">&quot;</span></span>                         <i class="conum" data-value="4"></i><b>(4)</b>
          },
          <span class="key"><span class="delimiter">&quot;</span><span class="content">requests</span><span class="delimiter">&quot;</span></span>: {                             <i class="conum" data-value="5"></i><b>(5)</b>
            <span class="key"><span class="delimiter">&quot;</span><span class="content">cpu</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">200m</span><span class="delimiter">&quot;</span></span>,                          <i class="conum" data-value="6"></i><b>(6)</b>
            <span class="key"><span class="delimiter">&quot;</span><span class="content">memory</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">1Gi</span><span class="delimiter">&quot;</span></span>                         <i class="conum" data-value="7"></i><b>(7)</b>
          }
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Resources definition section</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Limits definition section</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>CPU limit field</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Memory limit field</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Requests definition section</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>CPU request field</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Memory request field</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In some installations you may also want to completely disable CPU or memory limits for all browsers pods. This can be achieved with one of the following flags:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 8. Disabling Memory and CPU limits</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Flag</th>
<th class="tableblock halign-left valign-top">Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-disable-cpu-limits</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Completely disables CPU limits for all browser pods</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-disable-memory-limits</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Completely disables memory limits for all browser pods</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="resources-service-images"><a class="anchor" href="#resources-service-images"></a>Service Images Resources Consumption</h5>
<div class="paragraph">
<p>By default service images have the following resources requirements:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 9. Service Images Default Resources Limits</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">CPU Limit</th>
<th class="tableblock halign-left valign-top">Memory Limit</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">defender</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.25</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">128Mi</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">logger</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.25</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">128Mi</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">videoRecorder</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1024Mi</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>You can optionally adjust CPU and memory consumption for each service image in <code>service.json</code> configuration file similarly to browser images:</p>
</div>
<div class="listingblock">
<div class="title">Adjusting memory and CPU limits for service images</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">images</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">logger</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">image</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">my-registry.example.com/moon/logger:latest-release</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">resources</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">limits</span><span class="delimiter">&quot;</span></span>: {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">cpu</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">0.3</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">memory</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">1024Mi</span><span class="delimiter">&quot;</span></span>
        },
        <span class="key"><span class="delimiter">&quot;</span><span class="content">requests</span><span class="delimiter">&quot;</span></span>: {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">cpu</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">0.3</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">memory</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">1024Mi</span><span class="delimiter">&quot;</span></span>
        }
      }
    }
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="qos"><a class="anchor" href="#qos"></a>Pods Quality of Service</h5>
<div class="paragraph">
<p>Browser automation stability and speed highly depends on how many computing resources are actually available to browser pods. Kubernetes has so-called <a href="https://kubernetes.io/docs/tasks/configure-pod-container/quality-service-pod/">Quality of Service (QoS)</a> defining how many resources are assigned to pods being started. For stable browser automation we recommend always setting <code>Guaranteed</code> QoS class to Moon browser pods. To deliver this you have to make sure that <code>requests</code> and <code>limits</code> values for CPU and memory have equal values:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Moon by default sets <code>requests</code> equal to <code>limits</code> for service images like <code>defender</code>, <code>logger</code> and <code>videoRecorder</code>. But in recent releases you can override them independently if you wish.</p>
</li>
<li>
<p>For browser containers you can override <code>requests</code> and <code>limits</code> independently as shown above. Anyway we also recommend setting them to equal values. Only this way you will be sure that browsers are always getting the same computing resources. Otherwise you may encounter randomly failing browser tests caused by insufficient computing resources assigned to some browser pods.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="volumes"><a class="anchor" href="#volumes"></a>2.8.5. Using Volumes</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This was initially created for mounting really big files cached on Kubernetes nodes to browser containers. We do not recommend using the feature for uploading files to browser. Instead use standard Selenium file upload capability.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Currently Moon supports only mounting volumes from the Kubernetes node (<code>hostPath</code> volumes). Volumes are mounted only to browser container within browser pod. To add such volume - modify browsers list file as follows:</p>
</div>
<div class="listingblock">
<div class="title">Mounting HostPath Volumes</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">firefox</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">62.0</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">versions</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">62.0</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">image</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">selenoid/firefox:62.0</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">port</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">4444</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">path</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">/wd/hub</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">volumes</span><span class="delimiter">&quot;</span></span>: [<span class="string"><span class="delimiter">&quot;</span><span class="content">/host/path:/mount/path/inside/container</span><span class="delimiter">&quot;</span></span>]   <i class="conum" data-value="1"></i><b>(1)</b>
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>A list of hostPath volumes to mount</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="privileged-mode"><a class="anchor" href="#privileged-mode"></a>2.8.6. Running Browser Pods in Privileged Mode</h4>
<div class="paragraph">
<p>In some cases like running Android emulators browser container should be run in <code>privileged</code> mode. This setting can be applied separately to each browser version in browsers list file as follows:</p>
</div>
<div class="listingblock">
<div class="title">Starting Container in Privileged Mode</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">firefox</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">62.0</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">versions</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">62.0</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">image</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">selenoid/firefox:62.0</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">port</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">4444</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">path</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">/wd/hub</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">privileged</span><span class="delimiter">&quot;</span></span>: <span class="value">true</span>                  <i class="conum" data-value="1"></i><b>(1)</b>
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Launch container in privileged mode</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="node-selectors"><a class="anchor" href="#node-selectors"></a>2.8.7. Using Node Selectors</h4>
<div class="paragraph">
<p>Sometimes you may need to run browser pods on particular Kubernetes nodes (i.e. hardware hosts) only. Kubernetes allows to do this by specifying so called <a href="https://kubernetes.io/docs/concepts/configuration/assign-pod-node/">node selectors</a>. To provide such selector to Moon browser pods update browsers list as shown below:</p>
</div>
<div class="listingblock">
<div class="title">Adding Node Selectors</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">firefox</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">62.0</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">versions</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">62.0</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">image</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">selenoid/firefox:62.0</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">port</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">4444</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">path</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">/wd/hub</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">nodeSelector</span><span class="delimiter">&quot;</span></span>: {                    <i class="conum" data-value="1"></i><b>(1)</b>
          <span class="key"><span class="delimiter">&quot;</span><span class="content">node-type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">hardware</span><span class="delimiter">&quot;</span></span>
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Node selector for this browser version</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="tolerations"><a class="anchor" href="#tolerations"></a>2.8.8. Using Tolerations</h4>
<div class="paragraph">
<p>Kubernetes has a cool feature called <a href="https://kubernetes.io/docs/concepts/configuration/taint-and-toleration/">Taints</a> allowing to fine tune pods scheduling across nodes. If you wish to run browser pods on tainted nodes - you have to adjust so-called <code>tolerations</code>, that is to say a number of conditions to match against tainted nodes. Moon is using exactly the same format as Kubernetes to define tolerations:</p>
</div>
<div class="listingblock">
<div class="title">Adding Tolerations</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">firefox</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">62.0</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">versions</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">62.0</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">image</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">selenoid/firefox:62.0</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">port</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">4444</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">path</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">/wd/hub</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">tolerations</span><span class="delimiter">&quot;</span></span>: [                    <i class="conum" data-value="1"></i><b>(1)</b>
            {
                <span class="key"><span class="delimiter">&quot;</span><span class="content">key</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">key1</span><span class="delimiter">&quot;</span></span>,
                <span class="key"><span class="delimiter">&quot;</span><span class="content">operator</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Exists</span><span class="delimiter">&quot;</span></span>,
                <span class="key"><span class="delimiter">&quot;</span><span class="content">value</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">value1</span><span class="delimiter">&quot;</span></span>,
                <span class="key"><span class="delimiter">&quot;</span><span class="content">effect</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">NoExecute</span><span class="delimiter">&quot;</span></span>,
                <span class="key"><span class="delimiter">&quot;</span><span class="content">tolerationSeconds</span><span class="delimiter">&quot;</span></span>: <span class="integer">3600</span>
            }
        ]
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>A list of tolerations for this browser version</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="kubernetes-annotations"><a class="anchor" href="#kubernetes-annotations"></a>2.8.9. Using Custom Kubernetes Annotations</h4>
<div class="paragraph">
<p>In some cases you may need to add custom <a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/annotations/">Kubernetes annotations</a> to started browser pods. Moon allows to configure custom annotations globally or individually for every browser version. Global annotations are configured in <a href="#">Configuration File</a> (aka <code>service.json</code>) as follows:</p>
</div>
<div class="listingblock">
<div class="title">Adding global annotations to <code>service.json</code> file</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">s3</span><span class="delimiter">&quot;</span></span>: {
    <span class="error">/</span><span class="error">/</span><span class="error">.</span><span class="error">.</span><span class="error">.</span>
  },
  <span class="key"><span class="delimiter">&quot;</span><span class="content">images</span><span class="delimiter">&quot;</span></span>: {
    <span class="error">/</span><span class="error">/</span><span class="error">.</span><span class="error">.</span><span class="error">.</span>
  },
  <span class="key"><span class="delimiter">&quot;</span><span class="content">annotations</span><span class="delimiter">&quot;</span></span>: {                                 <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="key"><span class="delimiter">&quot;</span><span class="content">key1</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">value1</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">key2</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">value2</span><span class="delimiter">&quot;</span></span>
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>A list of global Kubernetes annotations</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To configure Kubernetes annotations for single desired browser version - just add the same <code>annotations</code> section to <a href="#">Browsers List</a> file as follows:</p>
</div>
<div class="listingblock">
<div class="title">Adding annotations to browser version</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">firefox</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">62.0</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">versions</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">62.0</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">image</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">selenoid/firefox:62.0</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">port</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">4444</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">path</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">/wd/hub</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">annotations</span><span class="delimiter">&quot;</span></span>: {                           <i class="conum" data-value="1"></i><b>(1)</b>
          <span class="key"><span class="delimiter">&quot;</span><span class="content">key1</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">value1</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">key2</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">value2</span><span class="delimiter">&quot;</span></span>
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>A list of Kubernetes annotations for this browser version</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Moon adds some annotations by default to browser pods and their names are reserved:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 10. Moon Reserved Annotation Names</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Key</th>
<th class="tableblock halign-left valign-top">Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Custom session label passed in <code>name</code> capability</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">timeZone</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Custom time zone value passed in <code>timeZone</code> capability</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="kubernetes-labels"><a class="anchor" href="#kubernetes-labels"></a>2.8.10. Using Custom Kubernetes Labels</h4>
<div class="paragraph">
<p>In some cases you may need to add custom <a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/">Kubernetes labels</a> to started browser pods. Moon allows to configure custom labels globally or individually for every browser version. Similarly to annotations global labels are configured in <a href="#">Configuration File</a> (aka <code>service.json</code>) as follows:</p>
</div>
<div class="listingblock">
<div class="title">Adding global labels to <code>service.json</code> file</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">s3</span><span class="delimiter">&quot;</span></span>: {
    <span class="error">/</span><span class="error">/</span><span class="error">.</span><span class="error">.</span><span class="error">.</span>
  },
  <span class="key"><span class="delimiter">&quot;</span><span class="content">images</span><span class="delimiter">&quot;</span></span>: {
    <span class="error">/</span><span class="error">/</span><span class="error">.</span><span class="error">.</span><span class="error">.</span>
  },
  <span class="key"><span class="delimiter">&quot;</span><span class="content">labels</span><span class="delimiter">&quot;</span></span>: {           <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="key"><span class="delimiter">&quot;</span><span class="content">key1</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">value1</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">key2</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">value2</span><span class="delimiter">&quot;</span></span>
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>A list of global Kubernetes labels</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To configure Kubernetes labels for single desired browser version - just add the same <code>labels</code> section to <a href="#">Browsers List</a> file as follows:</p>
</div>
<div class="listingblock">
<div class="title">Adding labels to browser version</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">chrome</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">77.0</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">versions</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">77.0</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">image</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">selenoid/chrome:77.0</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">port</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">4444</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">labels</span><span class="delimiter">&quot;</span></span>: {                           <i class="conum" data-value="1"></i><b>(1)</b>
          <span class="key"><span class="delimiter">&quot;</span><span class="content">key1</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">value1</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">key2</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">value2</span><span class="delimiter">&quot;</span></span>
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>A list of Kubernetes labels for this browser version</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Moon adds some labels by default to browser pods and their names are reserved:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 11. Moon Reserved Label Names</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Key</th>
<th class="tableblock halign-left valign-top">Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">app</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stores unique name for every pod</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">browserName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stores <code>browserName</code> capability value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">enableVideo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stores <code>enableVideo</code> capability value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">enableVNC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stores <code>enableVNC</code> capability value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">moon</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">System label, always equal to <code>browsers</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quota</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stores user quota name</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">screenResolution</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stores screen resolution requested by user</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stores <code>version</code> or <code>browserVersion</code> capability value</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="kernel-caps"><a class="anchor" href="#kernel-caps"></a>2.8.11. Using Custom Linux Kernel Capabilities</h4>
<div class="paragraph">
<p>By default Moon starts all browser pods without any explicit <a href="http://man7.org/linux/man-pages/man7/capabilities.7.html">Linux kernel capabilities</a>. In some cases you may need to set custom Linux capabilities to started browser pods (e.g. <code>SYS_ADMIN</code>). Full list of such capabilities is available in Linux kernel <a href="https://github.com/torvalds/linux/blob/master/include/uapi/linux/capability.h">source</a>. Linux capabilities are configured in <a href="#">Configuration File</a> (aka <code>service.json</code>) as follows:</p>
</div>
<div class="listingblock">
<div class="title">Adding global Linux capabilities to <code>service.json</code> file</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">s3</span><span class="delimiter">&quot;</span></span>: {
    <span class="error">/</span><span class="error">/</span><span class="error">.</span><span class="error">.</span><span class="error">.</span>
  },
  <span class="key"><span class="delimiter">&quot;</span><span class="content">images</span><span class="delimiter">&quot;</span></span>: {
    <span class="error">/</span><span class="error">/</span><span class="error">.</span><span class="error">.</span><span class="error">.</span>
  },
  <span class="key"><span class="delimiter">&quot;</span><span class="content">kernelCaps</span><span class="delimiter">&quot;</span></span>: [ <span class="string"><span class="delimiter">&quot;</span><span class="content">NET_ADMIN</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">KILL</span><span class="delimiter">&quot;</span></span> ]   <i class="conum" data-value="1"></i><b>(1)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>A list of global Linux capabilities</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="service-account"><a class="anchor" href="#service-account"></a>2.8.12. Using Custom Service Account</h4>
<div class="paragraph">
<p>By default Moon is using service account named <code>default</code> to access Kubernetes API. In some cases you only have permissions for another service account, e.g. named <code>moon</code>. To use this service account with Moon you need to change deployment as follows:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Optionally create a service account as follows:</p>
<div class="listingblock">
<div class="title">Creating custom service account</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">apiVersion</span>: <span class="string"><span class="content">v1</span></span>
<span class="key">kind</span>: <span class="string"><span class="content">ServiceAccount</span></span>
<span class="key">metadata</span>:
  <span class="key">name</span>: <span class="string"><span class="content">custom-moon-service-account</span></span> <span class="comment"># &lt;== Insert desired service account name</span>
  <span class="key">namespace</span>: <span class="string"><span class="content">moon</span></span></code></pre>
</div>
</div>
</li>
<li>
<p>Make sure you have respective Kubernetes <a href="https://kubernetes.io/docs/reference/access-authn-authz/rbac/#role-and-clusterrole">Role</a> and <a href="https://kubernetes.io/docs/reference/access-authn-authz/rbac/#rolebinding-and-clusterrolebinding">RoleBinding</a> for desired service account:</p>
<div class="listingblock">
<div class="title">Assigning roles to custom service account</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">apiVersion</span>: <span class="string"><span class="content">rbac.authorization.k8s.io/v1</span></span>
<span class="key">kind</span>: <span class="string"><span class="content">Role</span></span>
<span class="key">metadata</span>:
  <span class="key">namespace</span>: <span class="string"><span class="content">moon</span></span>
  <span class="key">name</span>: <span class="string"><span class="content">moon</span></span>
<span class="key">rules</span>:
- <span class="string"><span class="content">apiGroups:</span></span>
  - <span class="string"><span class="delimiter">&quot;</span><span class="content">*</span><span class="delimiter">&quot;</span></span>
  <span class="key">resources</span>:
  - <span class="string"><span class="delimiter">&quot;</span><span class="content">*</span><span class="delimiter">&quot;</span></span>
  <span class="key">verbs</span>:
  - <span class="string"><span class="delimiter">&quot;</span><span class="content">*</span><span class="delimiter">&quot;</span></span>
<span class="head"><span class="head">---</span></span>
<span class="key">apiVersion</span>: <span class="string"><span class="content">rbac.authorization.k8s.io/v1</span></span>
<span class="key">kind</span>: <span class="string"><span class="content">RoleBinding</span></span>
<span class="key">metadata</span>:
  <span class="key">name</span>: <span class="string"><span class="content">moon</span></span>
  <span class="key">namespace</span>: <span class="string"><span class="content">moon</span></span>
<span class="key">roleRef</span>:
  <span class="key">kind</span>: <span class="string"><span class="content">Role</span></span>
  <span class="key">name</span>: <span class="string"><span class="content">moon</span></span>
  <span class="key">apiGroup</span>: <span class="string"><span class="content">rbac.authorization.k8s.io</span></span>
<span class="key">subjects</span>:
- <span class="string"><span class="content">kind: ServiceAccount</span></span>
  <span class="key">namespace</span>: <span class="string"><span class="content">moon</span></span>
  <span class="key">name</span>: <span class="string"><span class="content">custom-moon-service-account</span></span> <span class="comment"># &lt;== Insert name of service account to assign roles</span></code></pre>
</div>
</div>
</li>
<li>
<p>Use your custom service account when deploying Moon pods:</p>
<div class="listingblock">
<div class="title">Using custom service account for Mood pods</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">apiVersion</span>: <span class="string"><span class="content">apps/v1</span></span>
<span class="key">kind</span>: <span class="string"><span class="content">Deployment</span></span>
<span class="key">metadata</span>:
    <span class="comment"># ... deployment metadata definition</span>
<span class="key">spec</span>:
  <span class="key">replicas</span>: <span class="string"><span class="content">2</span></span>
  <span class="key">selector</span>:
    <span class="comment"># ... selector definition</span>
  <span class="key">template</span>:
    <span class="key">metadata</span>:
        <span class="comment"># ... spec metadata definition</span>
    <span class="key">spec</span>:
      <span class="key">serviceAccountName</span>: <span class="string"><span class="content">custom-moon-service-account</span></span> <span class="comment"># &lt;== Insert name of service account here</span>
      <span class="key">containers</span>:
      - <span class="string"><span class="content">name: moon</span></span>
        <span class="key">image</span>: <span class="string"><span class="content">aerokube/moon:1.4.1</span></span>
    <span class="comment"># ... the rest of spec</span></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="user-group"><a class="anchor" href="#user-group"></a>2.8.13. Setting Custom User and Group Identifier to Browser Pods</h4>
<div class="paragraph">
<p>Starting from release 1.4.2 by default Moon starts all browser pods with fixed <a href="https://en.wikipedia.org/wiki/User_identifier">UID</a> <code>106 (selenium)</code> and <a href="https://en.wikipedia.org/wiki/Group_identifier">GID</a> <code>65534 (nogroup)</code>. This allows to run browser pods even in restricted clusters without root permissions allowed. In order to change UID and GID values being set - use the following syntax in <a href="#">Configuration File</a>:</p>
</div>
<div class="listingblock">
<div class="title">Setting custom UID and GID globally in <code>service.json</code></div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
    <span class="key"><span class="delimiter">&quot;</span><span class="content">runAs</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">user</span><span class="delimiter">&quot;</span></span>: <span class="integer">1000</span>,                  <i class="conum" data-value="1"></i><b>(1)</b>
      <span class="key"><span class="delimiter">&quot;</span><span class="content">group</span><span class="delimiter">&quot;</span></span>: <span class="integer">2000</span>                  <i class="conum" data-value="2"></i><b>(2)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Custom user identifier (UID)</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Custom group identifier (GID)</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To set custom UID and GID values for selected browser versions - use <a href="#">Browsers List</a> file:</p>
</div>
<div class="listingblock">
<div class="title">Setting custom UID and GID for selected browser version</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">chrome</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">versions</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">80.0</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">80.0</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">image</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">selenoid/chrome:80.0</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">port</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">4444</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">runAs</span><span class="delimiter">&quot;</span></span>: {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">user</span><span class="delimiter">&quot;</span></span>: <span class="integer">1000</span>,                  <i class="conum" data-value="1"></i><b>(1)</b>
          <span class="key"><span class="delimiter">&quot;</span><span class="content">group</span><span class="delimiter">&quot;</span></span>: <span class="integer">2000</span>                  <i class="conum" data-value="2"></i><b>(2)</b>
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Custom user identifier (UID)</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Custom group identifier (GID)</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Similarly to</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_log_files"><a class="anchor" href="#_log_files"></a>2.9. Log Files</h3>
<div class="paragraph">
<p>Although Moon should just work out of the box, sometimes you may need the log output. Every Moon component is outputting logs to standard output (<code>stdout</code>) so you can use well-known <code>kubectl</code> commands to see the log. Everything related to Selenium sessions is being output by <code>moon</code> container:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ kubectl logs -l app=moon -c moon -n moon
2019/05/03 11:20:37 [INIT] [Loading quota files from: quota]
2019/05/03 11:20:37 [INIT] [Quota configuration updated]
2019/05/03 11:20:37 [INIT] [Loading users from: users/users.htpasswd]
...</pre>
</div>
</div>
<div class="paragraph">
<p>To follow the logs while running the tests add <code>-f</code> flag:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ kubectl logs -f -l app=moon -c moon -n moon</pre>
</div>
</div>
<div class="paragraph">
<p>Every log line contains:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 12. Log entry contents</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field</th>
<th class="tableblock halign-left valign-top">Example</th>
<th class="tableblock halign-left valign-top">Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2017/11/01 19:12:42</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Status</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[SESSION_ATTEMPTED]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">See table below for complete list of statuses.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Additional fields</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[my-user]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">One or more sections showing additional information such as browser name, user name, IP address or error message</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Duration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[4.15s]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">For some log entries this field shows how much time operation took</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The following statuses are available:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 13. Log entry statuses</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Status</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">AWAITING_DRIVER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Waiting for webdriver binary to start</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">BAD_LABEL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Wrong pod label is requested</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">BAD_REQUEST</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Failed to process user request</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">BAD_RESOURCES</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User incorrectly configured browser container resources</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">BAD_SCREEN_RESOLUTION</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User requested to set wrong custom screen resolution</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">BAD_TIMEZONE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User requested to set wrong custom time zone inside container</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">BAD_TIMEOUT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User requested to set wrong session timeout</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">BAD_VIDEO_FRAME_RATE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User requested to capture video with wrong frame rate</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">BAD_VIDEO_SCREEN_SIZE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User requested to capture video with wrong screen size</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CLIENT_DISCONNECTED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User disconnected and session was interrupted</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CREATING_POD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Starting to create pod with browser</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DELETING_POD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Starting to delete pod with browser</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DELETING_SESSION</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Received request to delete browser session</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">EMPTY_REQUEST</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Received empty request from user</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">FAILED_TO_CREATE_POD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Failed to create browser pod</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">FAILED_TO_DELETE_POD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Failed to delete browser pod</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">FAILED_TO_DELETE_SESSION</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Failed to delete browser session</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">FAILED_TO_GET_LOGS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Failed to get session logs</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">FORBIDDEN_TO_CREATE_POD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kubernetes return forbidden status when creating pod</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">INIT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service initialization messages</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LOGS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Requested session logs</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LOGS_CLIENT_DISCONNECTED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client disconnected while streaming session logs</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MALFORMED_VOLUME</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Moon skipped malformed volume specification from <code>browsers.json</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">POD_CREATED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Browser pod created</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">POD_DELETED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Browser pod deleted</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PROXYING</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Proxying requests to specified URL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PROXY_ERROR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Failed to proxy requests to specified URL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SERVER_ERROR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Failed to create pod or service due to internal server error (probably a bug)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DRIVER_IS_UP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Webdriver binary successfully started</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SESSION_CREATED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Browser session successfully created</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SESSION_DELETED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Session successfully deleted</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SESSION_FAILED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Failed to create new session</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SESSION_TIMED_OUT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Existing session timed out</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SESSION_NOT_FOUND</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Received request with empty session ID</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SHUTTING_DOWN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Shutting down the service</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">STATUS_ERROR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Failed to refresh Moon status</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">STATUS_REQUEST</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Received Moon status request</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">STATUS_REQUEST_ERROR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Failed to return Moon status</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">STOP_AWAITING_DRIVER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stopped waiting for webdriver binary to start</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">UNSUPPORTED_BROWSER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User requested unsupported browser</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">USER_NOT_FOUND</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Trying to request session with unknown user</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">VNC_CLIENT_DISCONNECTED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User disconnected while proxying VNC traffic</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">VNC_ERROR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An error occurred while proxying VNC traffic</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">VNC_SESSION</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User requested VNC session</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">VNC_SESSION_CLOSED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User closed VNC session</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>You can also take a look at <code>moon-api</code> and moon-ui logs as follows:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ kubectl logs -f moon-58f8b57966-s648q -c moon-api -n moon
$ kubectl logs -f moon-58f8b57966-s648q -c moon-ui -n moon</pre>
</div>
</div>
<div class="paragraph">
<p>If you are encountering browser pods not being deleted - then take a look at <code>defender</code> container logs for every frozen browser pod:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ kubectl logs chrome-73-0-ac15ffaa-e641-4c7f-a54c-f25b5be1f135 -c defender -n moon # Here chrome-73-0-ac15ffaa-e641-4c7f-a54c-f25b5be1f135 is Selenium session ID equal to browser pod name</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_cli_flags"><a class="anchor" href="#_cli_flags"></a>2.10. CLI Flags</h3>
<div class="paragraph">
<p>These flags should be <a href="https://kubernetes.io/docs/tasks/inject-data-application/define-command-argument-container/#define-a-command-and-arguments-when-you-create-a-pod">specified</a> in Kubernetes YAML files when starting the cluster.</p>
</div>
<div class="sect3">
<h4 id="cli-flags-moon"><a class="anchor" href="#cli-flags-moon"></a>2.10.1. Moon Container Flags</h4>
<div class="paragraph">
<p>The following flags are supported:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>-browser-timeout duration
    awaiting browser timeout (default 30s)
-chrome-devtools-repository string
    repository to pull chrome devtools images (default "cdtp")
-config-file string
    optional configuration file (default "config/service.json")
-cpu-limit string
    browser container cpu limit (default "1")
-cpu-request string
    browser container cpu request (default "0.5")
-credentials-dir string
    directory where credentials are mounted (default "credentials")
-device-file string
    mobile devices configuration file (default "config/devices.json")
-disable-cpu-limits
    disable cpu limits for pods
-disable-memory-limits
    disable memory limits for pods
-domain-name string
    browsers service domain name (default "browsers")
-grace-period duration
    graceful shutdown (default 30s)
-guest-user string
    guest quota user name (default "browsers")
-license-file string
    path to license file (default "license/license.key")
-listen string
    address to bind (default ":4444")
-memory-limit string
    browser container memory limit (default "1Gi")
-memory-request string
    browser container memory request (default "512Mi")
-moon-url string
    moon service url (default "http://moon:4444/wd/hub")
-namespace string
    namespace
-playwright-repository string
    repository to pull playwright images (default "playwright")
-quota-dir string
    quota directory (default "quota")
-service-account-name string
    service account name (default "default")
-session-attempt-timeout duration
    new session attempt timeout (default 30m0s)
-timeout duration
    override session timeout (default 1m0s)
-users-file string
    path to users file (default "users/users.htpasswd")
-version
    show version and exit</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="cli-flags-moon-api"><a class="anchor" href="#cli-flags-moon-api"></a>2.10.2. Moon API Container Flags</h4>
<div class="paragraph">
<p>The following flags are supported:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>-domain-name string
    browsers service domain name (default "browsers")
-grace-period duration
    graceful shutdown period (default 30s)
-guest-user string
    guest quota user name (default "browsers")
-license-file string
    path to license file (default "license/license.key")
-listen string
    address to bind (default ":8080")
-namespace string
    namespace
-quota-dir string
    quota directory (default "quota")
-sse-period duration
    sse refresh period (default 5s)
-version
    Show version and exit</pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_main_features"><a class="anchor" href="#_main_features"></a>3. Main Features</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_special_capabilities"><a class="anchor" href="#_special_capabilities"></a>3.1. Special Capabilities</h3>
<div class="paragraph">
<p>Moon supports a set of custom capabilities. You can pass them in tests to enable or disable some features.</p>
</div>
<div class="sect3">
<h4 id="capability-enableVNC"><a class="anchor" href="#capability-enableVNC"></a>3.1.1. Live Browser Screen: enableVNC</h4>
<div class="paragraph">
<p>Moon supports showing browser screen during test execution. To see browser screen add capability:</p>
</div>
<div class="listingblock">
<div class="title">Type: boolean</div>
<div class="content">
<pre>enableVNC: true</pre>
</div>
</div>
<div class="paragraph">
<p>Browser screen will be shown in <a href="http://aerokube.com/selenoid-ui/latest/">Selenoid UI</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="capability-screenResolution"><a class="anchor" href="#capability-screenResolution"></a>3.1.2. Custom Screen Resolution: screenResolution</h4>
<div class="paragraph">
<p>Moon allows you to set custom screen resolution in containers being run:</p>
</div>
<div class="listingblock">
<div class="title">Type: string, format: &lt;width&gt;x&lt;height&gt;</div>
<div class="content">
<pre>screenResolution: "1280x1024"</pre>
</div>
</div>
<div class="paragraph">
<p>You can optionally add colors depth:</p>
</div>
<div class="listingblock">
<div class="title">Type: string, format: &lt;width&gt;x&lt;height&gt;x&lt;colors-depth&gt;</div>
<div class="content">
<pre>screenResolution: "1280x1024x24"</pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This capability sets only screen resolution - not browser window size.
Most of browsers have some default window size value this is why your screenshot size can be smaller than screen resolution specified in capability.
You should manually resize window to desired width and height or use Selenium <code>maximize</code> operation.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="capability-skin"><a class="anchor" href="#capability-skin"></a>3.1.3. Android Skin: skin</h4>
<div class="paragraph">
<p>When testing for Android platform you can select emulator skin with capabilities. List of available skins:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 14. Available Android Skins</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Skin</th>
<th class="tableblock halign-left valign-top">Screen Resolution</th>
<th class="tableblock halign-left valign-top">DPI</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">QVGA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">240x320</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">120</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">WQVGA400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">240x400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">120</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">WQVGA432</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">240x432</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">120</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">HVGA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">320x480</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">160</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">WVGA800</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">480x800</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">240</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">WVGA854</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">480x854</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">240</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">WSVGA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1024x600</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">160</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">WXGA720</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">720x1280</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">320</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">WXGA800</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1280x800</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">160</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">WXGA800-7in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">800x1280</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">213</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>To select a skin - set <code>skin</code> capability:</p>
</div>
<div class="listingblock">
<div class="title">Type: string, format: &lt;desired-skin&gt;</div>
<div class="content">
<pre>skin: "WXGA720"</pre>
</div>
</div>
<div class="paragraph">
<p>You can also pass desired screen resolution as follows:</p>
</div>
<div class="listingblock">
<div class="title">Type: string, format: &lt;desired-screen-resolution&gt;</div>
<div class="content">
<pre>skin: "720x1280"</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="capability-video-recording"><a class="anchor" href="#capability-video-recording"></a>3.1.4. Video Recording: enableVideo, videoName, videoScreenSize, videoFrameRate, videoCodec</h4>
<div class="paragraph">
<p>To enable video recording for session, add:</p>
</div>
<div class="listingblock">
<div class="title">Type: boolean</div>
<div class="content">
<pre>enableVideo: true</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>By default saved video files are named <code>video.mp4</code>. To provide custom video name specify:</p>
<div class="listingblock">
<div class="title">Type: string</div>
<div class="content">
<pre>videoName: "my-cool-video.mp4"</pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
It is important to add <code>mp4</code> file extension.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>By default the entire screen picture is being recorded.
Specifying <code>screenResolution</code> capability changes recorded video size (width and height) accordingly.
You can override video screen size by passing a capability. In case of <code>videoScreenSize</code>
resolution is less than actual, screen on video will be trimmed starting from top-left corner:</p>
<div class="listingblock">
<div class="title">Type: string</div>
<div class="content">
<pre>videoScreenSize: "1024x768"</pre>
</div>
</div>
</li>
<li>
<p>Default video frame rate is <code>12</code> frames per second. Specifying <code>videoFrameRate</code> capability changes this value:</p>
<div class="listingblock">
<div class="title">Type: int</div>
<div class="content">
<pre>videoFrameRate: 24</pre>
</div>
</div>
</li>
<li>
<p>By default Moon is using <code>libx264</code> codec for video output. If this codec is consuming too much CPU, you can change it using <code>videoCodec</code> capability:</p>
<div class="listingblock">
<div class="title">Type: string</div>
<div class="content">
<pre>videoCodec: "mpeg4"</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="capability-logName"><a class="anchor" href="#capability-logName"></a>3.1.5. Custom Log Name: logName</h4>
<div class="paragraph">
<p>By default saved log files are named <code>session.log</code>. To provide custom log name specify:</p>
</div>
<div class="listingblock">
<div class="title">Type: string</div>
<div class="content">
<pre>logName: "session.log"</pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
It is important to add <code>log</code> file extension.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="capability-name"><a class="anchor" href="#capability-name"></a>3.1.6. Custom Test Name: name</h4>
<div class="paragraph">
<p>For debugging purposes it is often useful to give a distinct name to every test case. You can set test case name by passing the following capability:</p>
</div>
<div class="listingblock">
<div class="title">Type: string</div>
<div class="content">
<pre>name: "myCoolTestName"</pre>
</div>
</div>
<div class="paragraph">
<p>The main application of this capability - is debugging tests in the UI which is showing specified name for every running session.</p>
</div>
</div>
<div class="sect3">
<h4 id="capability-timeZone"><a class="anchor" href="#capability-timeZone"></a>3.1.7. Per-session Time Zone: timeZone</h4>
<div class="paragraph">
<p>Some tests require particular time zone to be set in operating system.</p>
</div>
<div class="listingblock">
<div class="title">Type: string</div>
<div class="content">
<pre>timeZone: "Europe/Moscow"</pre>
</div>
</div>
<div class="paragraph">
<p>You can find most of available time zones <a href="https://en.wikipedia.org/wiki/List_of_tz_database_time_zones">here</a>.
Without this capability launched browser containers will have Moon timezone.</p>
</div>
</div>
<div class="sect3">
<h4 id="capability-env"><a class="anchor" href="#capability-env"></a>3.1.8. Per-session Environment Variables: env</h4>
<div class="paragraph">
<p>Sometimes you may want to set some environment variables for every test case (for example to test with different default locales). To achieve this pass one more capability:</p>
</div>
<div class="listingblock">
<div class="title">Type: array, format: &lt;key&gt;=&lt;value&gt;</div>
<div class="content">
<pre>env: ["LANG=ru_RU.UTF-8", "LANGUAGE=ru:en", "LC_ALL=ru_RU.UTF-8"]</pre>
</div>
</div>
<div class="paragraph">
<p>Environment variables from this capability are appended to variables from configuration file.</p>
</div>
</div>
<div class="sect3">
<h4 id="capability-hostsEntries"><a class="anchor" href="#capability-hostsEntries"></a>3.1.9. Hosts Entries: hostsEntries</h4>
<div class="paragraph">
<p>Although you can configure a separate list of <code>/etc/hosts</code> entries for every browser image in <a href="#">Browsers List</a> sometimes you may need to add more entries for particular test cases. This can be easily achieved with:</p>
</div>
<div class="listingblock">
<div class="title">Type: array, format: &lt;hostname&gt;:&lt;ip-address&gt;</div>
<div class="content">
<pre>hostsEntries: ["example.com:192.168.0.1", "test.com:192.168.0.2"]</pre>
</div>
</div>
<div class="paragraph">
<p>Entries from this capability will be override <code>/etc/hosts</code> entries from browsers list file.</p>
</div>
</div>
<div class="sect3">
<h4 id="capability-nameservers"><a class="anchor" href="#capability-nameservers"></a>3.1.10. Custom DNS Servers: nameservers</h4>
<div class="paragraph">
<p>By default browser pods are using global Kubernetes DNS settings. Sometimes you may need to override used DNS servers list for particular test cases. This can be easily achieved with:</p>
</div>
<div class="listingblock">
<div class="title">Type: array, format: &lt;dns-ip-address&gt;</div>
<div class="content">
<pre>nameservers: ["192.168.0.1", "192.168.0.2"]</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="capability-sessionTimeout"><a class="anchor" href="#capability-sessionTimeout"></a>3.1.11. Custom Session Timeout: sessionTimeout</h4>
<div class="paragraph">
<p>Sometimes you may want to change idle timeout for selected browser session. To achieve this - pass the following capability:</p>
</div>
<div class="listingblock">
<div class="title">Type: string</div>
<div class="content">
<pre>sessionTimeout: "1m30s"</pre>
</div>
</div>
<div class="paragraph">
<p>Timeout is always specified in Golang duration format, e.g. <code>30s</code> or <code>2m</code> or <code>1h2m30s</code> and so on.</p>
</div>
</div>
<div class="sect3">
<h4 id="capability-s3KeyPattern"><a class="anchor" href="#capability-s3KeyPattern"></a>3.1.12. S3 Key Pattern: s3KeyPattern</h4>
<div class="paragraph">
<p>This capability allows to override S3 key pattern (specified by <code>s3 &gt; keyPattern</code> key in <code>service.json</code>) used when uploading files to S3.</p>
</div>
<div class="listingblock">
<div class="title">Type: string</div>
<div class="content">
<pre>s3KeyPattern: "$quota/$browserName/$sessionId"</pre>
</div>
</div>
<div class="paragraph">
<p>The same key placeholders are supported. Please refer to <a href="#s3">Uploading Files To S3</a> section for more details.</p>
</div>
</div>
<div class="sect3">
<h4 id="capability-mobile-emulation"><a class="anchor" href="#capability-mobile-emulation"></a>3.1.13. Mobile Emulation: mobileDevice</h4>
<div class="paragraph">
<p>This capability configures desired mobile device <a href="#">Mobile Emulation</a>:</p>
</div>
<div class="listingblock">
<div class="title">Type: object</div>
<div class="content">
<pre>"mobileDevice": {
    "deviceName": "Apple iPhone XR",
    "orientation": "landscape"
}</pre>
</div>
</div>
<div class="paragraph">
<p>To select which device to emulate use <code>deviceName</code> key:</p>
</div>
<div class="listingblock">
<div class="title">Type: string</div>
<div class="content">
<pre>deviceName: "Apple iPhone XR"</pre>
</div>
</div>
<div class="paragraph">
<p>To explicitly specify device screen orientation (portait or landscape) use <code>orientation</code> key:</p>
</div>
<div class="listingblock">
<div class="title">Type: string</div>
<div class="content">
<pre>orientation: "landscape"</pre>
</div>
</div>
<div class="paragraph">
<p>Possible <code>orientation</code> values are: <code>portait</code>, <code>vertical</code> (alias for <code>portrait</code>), <code>landscape</code>, <code>horizontal</code> (alias for <code>landscape</code>).</p>
</div>
</div>
<div class="sect3">
<h4 id="capability-protocol-extensions"><a class="anchor" href="#capability-protocol-extensions"></a>3.1.14. Specifying Capabilities via Protocol Extensions</h4>
<div class="paragraph">
<p>Some Selenium clients allow passing only a limited number of capabilities specified in <a href="https://w3c.github.io/webdriver/webdriver-spec.html">WebDriver specification</a>. For such cases Moon supports reading capabilities using <a href="https://w3c.github.io/webdriver/webdriver-spec.html#protocol-extensions">WebDriver protocol extensions</a> feature. The following two examples deliver the same result. Usually capabilities are passed like this:</p>
</div>
<div class="listingblock">
<div class="title">Passing Capabilities as Usually</div>
<div class="content">
<pre>{"browserName": "firefox", "version": "62.0", "screenResolution": "1280x1024x24"}</pre>
</div>
</div>
<div class="paragraph">
<p>Moon is using <code>moon:options</code> key to read protocol extension capabilities:</p>
</div>
<div class="listingblock">
<div class="title">Passing Capabilities using Protocol Extensions</div>
<div class="content">
<pre>{"browserName": "firefox", "version": "62.0", "moon:options": {"screenResolution": "1280x1024x24"}}</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_accessing_files_downloaded_with_browser"><a class="anchor" href="#_accessing_files_downloaded_with_browser"></a>3.2. Accessing Files Downloaded with Browser</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Files are accessible only when browser session is running.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Your tests may need to download files with browsers. To analyze these files a common requirement is then to somehow extract downloaded files from browser containers. Moon provides a <code>/download</code> API dramatically simplifying downloading such files. To work with it:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Start a new session, for example with ID <code>firefox-61-0-f2bcd32b-d932-4cdc-a639-687ab8e4f840</code>.</p>
</li>
<li>
<p>In tests code save all files to <code>~/Downloads</code> directory.</p>
</li>
<li>
<p>Access all downloaded files using an URL:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>http://moon-host.example.com:4444/download/firefox-61-0-f2bcd32b-d932-4cdc-a639-687ab8e4f840/myfile.txt</code></pre>
</div>
</div>
</li>
<li>
<p>Close the session</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_accessing_clipboard"><a class="anchor" href="#_accessing_clipboard"></a>3.3. Accessing Clipboard</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Clipboard is accessible only when browser session is running.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Sometimes you may need to interact with the clipboard to check that your application copy-paste feature works. Moon has a dedicated API to interact with the clipboard. To use it:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Start a new session, for example with ID <code>firefox-61-0-f2bcd32b-d932-4cdc-a639-687ab8e4f840</code>.</p>
</li>
<li>
<p>To get clipboard value send the following HTTP request:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>$ curl http://moon-host.example.com:4444/clipboard/firefox-61-0-f2bcd32b-d932-4cdc-a639-687ab8e4f840

some-clipboard-value</code></pre>
</div>
</div>
</li>
<li>
<p>To update clipboard value:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>$ curl -X POST --data 'some-clipboard-value' http://moon-host.example.com:4444/clipboard/firefox-61-0-f2bcd32b-d932-4cdc-a639-687ab8e4f840</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_using_playwright"><a class="anchor" href="#_using_playwright"></a>3.4. Using Playwright</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This feature is supported in Moon 1.6.0 and above.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Moon is able to run browser images for <a href="https://github.com/microsoft/playwright">Playwright</a> framework out of the box. An example Playwright test that will work with Moon looks like the following:</p>
</div>
<div class="listingblock">
<div class="title">An example Playwright test working with Moon</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript">const { firefox } = require(<span class="string"><span class="delimiter">'</span><span class="content">playwright</span><span class="delimiter">'</span></span>);

(async () =&gt; {
  <span class="keyword">var</span> browser = await firefox.connect({ <span class="key">timeout</span>: <span class="integer">0</span>, <span class="key">wsEndpoint</span>: <span class="string"><span class="delimiter">'</span><span class="content">ws://moon.example.com:4444/playwright/firefox</span><span class="delimiter">'</span></span> });
  const page = await browser.newPage();
  await page.<span class="reserved">goto</span>(<span class="string"><span class="delimiter">'</span><span class="content">https://aerokube.com/moon/</span><span class="delimiter">'</span></span>);
  await page.screenshot({ <span class="key">path</span>: <span class="error">`</span>screenshot.png<span class="error">`</span> });
  await browser.close();
})();</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can see that the only difference from standard Playwright example is a web socket endpoint URL. Playwright compared to Selenium has no <a href="https://www.w3.org/TR/webdriver/#capabilities">capabilities</a> concept. The only way to request an exact browser version or e.g. enable video recording is passing all these requirements in websocket endpoint URL. Next section describe supported URL naming conventions.</p>
</div>
<div class="sect3">
<h4 id="playwright-select-browser"><a class="anchor" href="#playwright-select-browser"></a>3.4.1. Selecting Requested Browser</h4>
<div class="paragraph">
<p>You can request one of browsers supported by Playwright (<code>firefox</code>, <code>chromium</code> or <code>webkit</code>) by specifying its name in URL. By default Moon will use <code>playwright/&lt;browser-name&gt;:latest</code> public image.</p>
</div>
<div class="listingblock">
<div class="title">Requesting Chromium (<code>playwright/chromium:latest</code> image)</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">ws://moon.example.com:4444/playwright/chromium</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Requesting Firefox (<code>playwright/firefox:latest</code> image)</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">ws://moon.example.com:4444/playwright/firefox</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Requesting Webkit (<code>playwright/webkit:latest</code> image)</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">ws://moon.example.com:4444/playwright/webkit</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="playwright-select-browser-version"><a class="anchor" href="#playwright-select-browser-version"></a>3.4.2. Selecting Exact Browser Version</h4>
<div class="paragraph">
<p>Every browser version is distributed as a separate image tagged <code>playwright/&lt;browser-name&gt;:&lt;browser-version&gt;</code>. To use an exact browser version - add this version as follows:</p>
</div>
<div class="listingblock">
<div class="title">Selecting Firefox 76.0 (<code>playwright/firefox:76.0</code> image)</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">ws://moon.example.com:4444/playwright/firefox/76.0</code></pre>
</div>
</div>
<div class="paragraph">
<p>Full list of images can be found <a href="https://aerokube.com/images/latest/#_playwright">here</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="playwright-select-playwright-version"><a class="anchor" href="#playwright-select-playwright-version"></a>3.4.3. Selecting Exact Playwright Version</h4>
<div class="paragraph">
<p>Currently Playwright API can change from version to version. Because of that it is recommended to make sure that Playwright client version being used in your code corresponds to Playwright server version in browser image. To use an image compatible with exact Playwright version - add this version as follows:</p>
</div>
<div class="listingblock">
<div class="title">Selecting an image compatible to Playwright 1.5.1 (<code>playwright/firefox:playwright-1.5.1</code> image)</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">ws://moon.example.com:4444/playwright/firefox/playwright-1.5.1</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="playwright-additional-features"><a class="anchor" href="#playwright-additional-features"></a>3.4.4. Enabling Additional Features</h4>
<div class="paragraph">
<p>In addition to selecting browser and its version - you can enable additional features like using headless browser versions, enabling video recording and so on. All these optional features are set by adding parameters to URL:</p>
</div>
<div class="listingblock">
<div class="title">Adding parameters to enable additional features</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">ws://moon.example.com:4444/playwright/chrome?headless=false&amp;enableVideo=true</code></pre>
</div>
</div>
<div class="paragraph">
<p>Full list of supported parameters and their meaning is shown below.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 15. Supported parameters for enabling additional features</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter name</th>
<th class="tableblock halign-left valign-top">Possible values</th>
<th class="tableblock halign-left valign-top">Default value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">arg</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Browser command-line arguments</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not set</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">One or more additional command-line arguments to be passed to browser. This parameter can be passed multiple times: <code>arg=--use-fake-ui-for-media-stream&amp;arg=--use-gl</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">devtools</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code> or <code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to show Chrome Developer Toolbar (only applicable to <code>chromium</code> browser).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">enableVideo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code> or <code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to record video of running browser session (same meaning as <code>enableVideo</code> Selenium capability). Only works in conjunction with <code>headless=false</code>, i.e. <code>headless=false&amp;enableVideo=true</code>. You can see browser screen in Moon UI only when this is set to <code>false</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">env</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Environment variables</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not set</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">One or more environment variables that will be visible to the browser. This parameter can be passed multiple times: <code>env=LANG%3Dde_AT.UTF-8&amp;env=LANGUAGE%3Dat:de</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">headless</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code> or <code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to run browser in headless mode.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any human-readable string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not set</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows to set custom test name (same meaning as <code>name</code> Selenium capability).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">screenResolution</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1280x1024</code> or <code>1280x1024x24</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1920x1080x24</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets resolution of the desktop where browser is running. <strong>Use Playwright methods to set browser window size.</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">timeZone</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Europe/Moscow</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time zone set to Moon</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets time zone being used by browser.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">videoCodec</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Supported video codec name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>libx264</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows to customize video codec name being used by video recorder (same meaning as <code>videoCodec</code> Selenium capability).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">videoFrameRate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>24</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>12</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows to customize frame rate of the video being recorded (same meaning as <code>videoFrameRate</code> Selenium capability).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">videoName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;your-name&gt;.mp4</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>video.mp4</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows to customize video file name being uploaded to S3 (same meaning as <code>videoName</code> Selenium capability).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">videoScreenSize</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1280x1024</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1920x1080</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets resolution of the video being recorded  (same meaning as <code>videoScreenSize</code> Selenium capability).</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_accessing_chrome_developer_tools"><a class="anchor" href="#_accessing_chrome_developer_tools"></a>3.5. Accessing Chrome Developer Tools</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>This is feature is supported in Moon 1.7.0 and above.</p>
</li>
<li>
<p>This feature will work only for Chrome 63+.</p>
</li>
<li>
<p>We recommend using the most recent Chrome version possible.</p>
</li>
</ol>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Moon can automate browsers using <a href="https://chromedevtools.github.io/devtools-protocol/">Chrome Developer Tools Protocol</a>. This allows you to run tests in parallel using libraries like <a href="https://github.com/puppeteer/puppeteer">Puppeteer</a> or <a href="https://github.com/getgauge/taiko">Taiko</a>. In order to start a new browser with these tools - simply use the following URL:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">ws://moon.example.com:4444/cdtp/chrome</code></pre>
</div>
</div>
<div class="paragraph">
<p>An example Puppeteer test is shown below:</p>
</div>
<div class="listingblock">
<div class="title">Accessing Developer Tools API with Puppeteer</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript">const puppeteer = require(<span class="string"><span class="delimiter">'</span><span class="content">puppeteer-core</span><span class="delimiter">'</span></span>);
const host = <span class="string"><span class="delimiter">'</span><span class="content">moon.example.com</span><span class="delimiter">'</span></span>;
(async () =&gt; {
    const devtools = await puppeteer.connect(
        { <span class="key">timeout</span>: <span class="integer">0</span>, <span class="key">browserWSEndpoint</span>: <span class="error">`</span>ws:<span class="comment">//${host}:4444/cdtp/chrome` }</span>
    ); <span class="comment">// For every call of this method a new browser is started</span>
    const page = await devtools.newPage();
    await page.<span class="reserved">goto</span>(<span class="string"><span class="delimiter">'</span><span class="content">https://aerokube.com</span><span class="delimiter">'</span></span>);
    await page.screenshot({<span class="key">path</span>: <span class="string"><span class="delimiter">'</span><span class="content">screenshot.png</span><span class="delimiter">'</span></span>});
    const title = await page.title();

    console.log(title);

    await devtools.close();
})();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Similarly to Playwright you can choose browser version and enable additional features by changing connection URL.</p>
</div>
<div class="listingblock">
<div class="title">Selecting Chrome version (<code>cdtp/chrome:85.0</code> image)</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">ws://moon.example.com:4444/cdtp/chrome/85.0</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Adding parameters to enable additional features</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">ws://moon.example.com:4444/cdtp/chrome?headless=false&amp;enableVideo=true</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 16. Supported parameters for enabling additional features</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter name</th>
<th class="tableblock halign-left valign-top">Possible values</th>
<th class="tableblock halign-left valign-top">Default value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">devtools</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code> or <code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to show Chrome Developer Toolbar.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">enableVideo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code> or <code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to record video of running browser session.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">headless</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code> or <code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to run browser in headless mode.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any human-readable string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not set</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows to set custom test name.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">screenResolution</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1280x1024</code> or <code>1280x1024x24</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1920x1080x24</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets resolution of the desktop where browser is running.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">timeZone</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Europe/Moscow</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time zone set to Moon</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets time zone being used by browser.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">videoCodec</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Supported video codec name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>libx264</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows to customize video codec name being used by video recorder.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">videoFrameRate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>24</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>12</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows to customize frame rate of the video being recorded.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">videoName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;your-name&gt;.mp4</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>video.mp4</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows to customize video file name being uploaded to S3.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">videoScreenSize</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1280x1024</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1920x1080</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets resolution of the video being recorded.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_mobile_emulation"><a class="anchor" href="#_mobile_emulation"></a>3.6. Mobile Emulation</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>This feature is supported in Moon 1.8.0 and above.</p>
</li>
<li>
<p>This feature works with Chrome browser only.</p>
</li>
<li>
<p>Testing mobile applications is not possible.</p>
</li>
</ol>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Running automated tests in mobile platforms is nowadays very important. Using a set of real devices connected to server via USB requires too much work to deploy and maintain. Running Android Emulators requires hardware server or virtual machines with nested virtualization enabled. Running iOS Simulators requires to have Apple hardware. Even with correct computing resources tests are slower than on desktop platforms and consume slightly more CPUs and memory per browser.</p>
</div>
<div class="paragraph">
<p>Your goal however is catching bugs and not deploying complicated browser automation infrastructure. There are a lot of cases when a bug related to mobile version of tested web application can be reproduced simply by having exactly the same screen size and <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/User-Agent">User-Agent</a> HTTP header being sent by browser. This feature is already available in Chromium-based browsers and is called <strong>Mobile Emulation</strong>.</p>
</div>
<div class="paragraph">
<p>Moon provides an improved version of mobile emulation. In order to start a new browser with mobile emulation you have to use the following URL as Selenium URL:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">http://moon.example.com:4444/mobile</code></pre>
</div>
</div>
<div class="paragraph">
<p>Example tests using this functionality are shown below:</p>
</div>
<div class="listingblock">
<div class="title">Mobile Emulation in Java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ChromeOptions options = <span class="keyword">new</span> ChromeOptions();
options.setCapability(<span class="string"><span class="delimiter">&quot;</span><span class="content">browserVersion</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">87.0</span><span class="delimiter">&quot;</span></span>);
options.setCapability(<span class="string"><span class="delimiter">&quot;</span><span class="content">moon:options</span><span class="delimiter">&quot;</span></span>, <span class="keyword">new</span> <span class="predefined-type">HashMap</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt;() {{
    put(<span class="string"><span class="delimiter">&quot;</span><span class="content">mobileDevice</span><span class="delimiter">&quot;</span></span>, <span class="keyword">new</span> <span class="predefined-type">HashMap</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt;(){
        {
            put(<span class="string"><span class="delimiter">&quot;</span><span class="content">deviceName</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Apple iPhone XR</span><span class="delimiter">&quot;</span></span>);
            put(<span class="string"><span class="delimiter">&quot;</span><span class="content">orientation</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">landscape</span><span class="delimiter">&quot;</span></span>);
        }
    });
}});
WebDriver driver = <span class="keyword">new</span> RemoteWebDriver(<span class="keyword">new</span> <span class="predefined-type">URL</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">http://moon.example.com:4444/mobile</span><span class="delimiter">&quot;</span></span>), options);</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Mobile Emulation in Python</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">import</span> <span class="include">selenium.webdriver</span>

capabilities = {
    <span class="string"><span class="delimiter">&quot;</span><span class="content">browserName</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">chrome</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">&quot;</span><span class="content">version</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">87.0</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">&quot;</span><span class="content">moon:options</span><span class="delimiter">&quot;</span></span>: {
        <span class="string"><span class="delimiter">&quot;</span><span class="content">mobileDevice</span><span class="delimiter">&quot;</span></span>: {
            <span class="string"><span class="delimiter">&quot;</span><span class="content">deviceName</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Apple iPhone XR</span><span class="delimiter">&quot;</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">orientation</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">landscape</span><span class="delimiter">&quot;</span></span>
        }
    }
}

driver = selenium.webdriver.remote.webdriver.WebDriver(
    command_executor=<span class="string"><span class="delimiter">'</span><span class="content">http://moon.example.com:4444/mobile</span><span class="delimiter">'</span></span>,
    desired_capabilities = capabilities,
    keep_alive = <span class="predefined-constant">False</span>,
)

<span class="keyword">try</span>:
    driver.get(<span class="string"><span class="delimiter">'</span><span class="content">https://aerokube.com/moon/</span><span class="delimiter">'</span></span>)
    driver.get_screenshot_as_file(<span class="string"><span class="delimiter">'</span><span class="content">screenshot.png</span><span class="delimiter">'</span></span>)
<span class="keyword">finally</span>:
    driver.quit()</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="mobile-emulation-devices"><a class="anchor" href="#mobile-emulation-devices"></a>3.6.1. Supported Mobile Devices</h4>
<div class="paragraph">
<p>Moon comes with a preconfigured list of supported devices stored in <a href="#">Devices File</a>. In order to add your own mobile devices definitions - simply update this file and wait for Moon to reload it.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 17. Supported Mobile Devices</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><code>deviceName</code> capability</th>
<th class="tableblock halign-left valign-top">Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Apple iPad</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Apple iPad 10.2 (2019)</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Apple iPad Mini</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Apple iPad Mini 4</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Apple iPad Pro</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Apple iPad Pro (10.5)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">iPad Pro 10.5"</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Apple iPad Pro (12.9)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">iPad Pro 12.9"</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Apple iPhone 11</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Apple iPhone 11 Pro</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Apple iPhone 11 Pro Max</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Apple iPhone 4</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Apple iPhone 5/SE</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Apple iPhone 6/7/8</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Apple iPhone 6/7/8 Plus</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Apple iPhone 7</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Apple iPhone 7 Plus</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Apple iPhone 8</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Apple iPhone 8 Plus</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Apple iPhone SE</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Apple iPhone X</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Apple iPhone XR</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Apple iPhone Xs</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Apple iPhone Xs Max</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Blackberry PlayBook</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">BlackBerry Z30</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Google Nexus 4</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Google Nexus 5</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Google Nexus 5X</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Google Nexus 6</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Google Nexus 6P</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Google Nexus 7</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Google Nexus 10</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Google Pixel 2</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Google Pixel 2 XL</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Google Pixel 3</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Google Pixel 3 XL</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Google Pixel 4</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Google Pixel 4 XL</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">JioPhone 2</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kindle Fire HDX</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Laptop with HiDPI screen</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Laptop with MDPI screen</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Laptop with touch</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LG Optimus L70</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Microsoft Lumia 550</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Microsoft Lumia 950</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Microsoft Surface Duo</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Moto G4</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Nokia Lumia 520</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Nokia N9</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Palm PVG100</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Red Hydrogen One</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Samsung Galaxy A20</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Samsung Galaxy Fold</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Samsung Galaxy Note 2</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Samsung Galaxy Note 3</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Samsung Galaxy Note 8</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Samsung Galaxy Note 9</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Samsung Galaxy Note 10</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Samsung Galaxy Note 10+</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Samsung Galaxy S3</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Samsung Galaxy S5</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Samsung Galaxy S7</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Samsung Galaxy S8</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Samsung Galaxy S8+</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Samsung Galaxy S9</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Samsung Galaxy S9+</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Samsung Galaxy S10</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Samsung Galaxy S10+</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Samsung Galaxy S10e</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Samsung Galaxy Tab S3</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Samsung Galaxy Tab S4</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_changing_browser_locale"><a class="anchor" href="#_changing_browser_locale"></a>3.7. Changing Browser Locale</h3>
<div class="paragraph">
<p>In some test cases you may need to override preferred browser locale. You can do this with standard Selenium capabilities. How to override locale depends on browser.</p>
</div>
<div class="sect3">
<h4 id="locale-firefox"><a class="anchor" href="#locale-firefox"></a>3.7.1. Firefox</h4>
<div class="listingblock">
<div class="title">Overriding Browser Locale in Firefox</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">FirefoxOptions options = <span class="keyword">new</span> FirefoxOptions();
options.setCapability(<span class="string"><span class="delimiter">&quot;</span><span class="content">browserVersion</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">75.0</span><span class="delimiter">&quot;</span></span>);
options.addPreference(<span class="string"><span class="delimiter">&quot;</span><span class="content">intl.accept_languages</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">de</span><span class="delimiter">&quot;</span></span>);
WebDriver driver = <span class="keyword">new</span> RemoteWebDriver(<span class="keyword">new</span> <span class="predefined-type">URL</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">http://moon.example.com:4444/wd/hub</span><span class="delimiter">&quot;</span></span>), options);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="locale-chromium"><a class="anchor" href="#locale-chromium"></a>3.7.2. Chromium-based Browsers</h4>
<div class="listingblock">
<div class="title">Overriding Browser Locale in Chromium-base Browsers</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ChromeOptions options = <span class="keyword">new</span> ChromeOptions();
options.setCapability(<span class="string"><span class="delimiter">&quot;</span><span class="content">browserVersion</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">81.0</span><span class="delimiter">&quot;</span></span>);
options.setCapability(<span class="string"><span class="delimiter">&quot;</span><span class="content">env</span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">Arrays</span>.asList(<span class="string"><span class="delimiter">&quot;</span><span class="content">LANG=de_AT.UTF-8</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">LANGUAGE=at:de</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">LC_ALL=de_AT.UTF-8</span><span class="delimiter">&quot;</span></span>));
WebDriver driver = <span class="keyword">new</span> RemoteWebDriver(<span class="keyword">new</span> <span class="predefined-type">URL</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">http://moon.example.com:4444/wd/hub</span><span class="delimiter">&quot;</span></span>), options);</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_using_self_signed_tls_certificates"><a class="anchor" href="#_using_self_signed_tls_certificates"></a>3.8. Using self-signed TLS certificates</h3>
<div class="paragraph">
<p>In corporate networks tested environments are often using self-signed <a href="https://en.wikipedia.org/wiki/Transport_Layer_Security">TLS</a> certificates. Such certificates are issued by a <a href="https://en.wikipedia.org/wiki/Root_certificate">root certification authority</a> not known to browsers. When trying to open an HTTPS web-page using a self-signed certificate, your browser by default will refuse to do this saying that "Your connection is not private" or "This connection is untrusted". In Selenium tests you can use a standard capability (<code>acceptInsecureCerts = true</code>) to ignore such certificate errors but this will not work when your web-page is using <a href="https://en.wikipedia.org/wiki/HTTP_Strict_Transport_Security">HSTS</a>.</p>
</div>
<div class="paragraph">
<p>In order to work properly with self-signed certificates, you have to add your root certification authority certificate to a list of trusted certificates:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Find root certificate for certification authority being used to secure your tested environment. Usually such certificates are being issued by IT security team or systems administrators and are publicly available. For example your root certificate can look like this:</p>
<div class="literalblock">
<div class="content">
<pre>$ cat rootCA.crt
-----BEGIN CERTIFICATE-----
MIIGjzCCBHegAwIBAgIJAK1lW/5z8ZSoMA0GCSqGSIb3DQEBCwUAMIGLMQswCQYD
VQQGEwJFRTEQMA4GA1UECBMHRXN0b25pYTEQMA4GA1UEBxMHVGFsbGlubjEeMBwG
A1UEChQVQWVyb2t1YmUgU29mdHdhcmUgT8OcMRUwEwYDVQQDEwxhZXJva3ViZS5j
b20xITAfBgkqhkiG9w0BCQEWEmFkbWluQGFlcm9rdWJlLmNvbTAeFw0yMTAyMTcw
NjQ5NDJaFw0yMzEyMDgwNjQ5NDJaMIGLMQswCQYDVQQGEwJFRTEQMA4GA1UECBMH
RXN0b25pYTEQMA4GA1UEBxMHVGFsbGlubjEeMBwGA1UEChQVQWVyb2t1YmUgU29m
dHdhcmUgT8OcMRUwEwYDVQQDEwxhZXJva3ViZS5jb20xITAfBgkqhkiG9w0BCQEW
EmFkbWluQGFlcm9rdWJlLmNvbTCCAiIwDQYJKoZIhvcNAQEBBQADggIPADCCAgoC
ggIBAKdh54x9WZsSxIMfz1rFEHuJ8+3meUua0Q8cpgC/70F0G6X6BXOki0Cu7iET
6ETfirWuUdRKKGKXHLF8Fdv6WTqnLlDqgzy1Wp9DuPIgeJ+ztKZt+uJFkWjfQb9R
mn7Qs4vp/F9HTwqlTZl5jMQ+/nrcNAQeNEZ1H1AfZWAuSvrqp3rW33wl6IBZcqfD
VsMBknBKm/Zc8GpggY8NYxkfj7Jo2izwn/tV+DFgwF0pJkUrDZPPTiNW7q8Se2Vb
7tC6Iy9ZVgkH8hkrWrPzwW4zxz/d/Si7/cnn9A9+bF+pKrsHktnQ0ScDEAR5+52J
XAXkES/4pINpBcxvNUHGO6KXKH4rJVf3QvXXany0ugwVQ+QXirA6yOoY3XFgBxgU
P7Qd5pyQdVf/SwJ5Uk5Z9b2HXk8k/6jNxe1A6WiojTOnn1fD/VzOTn4xiobqNIpE
w5dUhlj/TiN+g3uGBH4BPo6IYHCmfsXFEcSZW75k7dRlZ3ZMI4k0utUVm3Y8B+TC
sj4WmwnXetFP2EMnRft7BnR13oLyzrFB8tkFafstcVoE6oR20pIBtAFxrSDWJ5dA
XdX2NGPNUCnd1RqJxu2SGA/xHHsyPT06iJeIZGUyRXmv6vBvyCkyeLtMEdq2Gzfi
MT0GtDkG5R+al/A+Ot3w3CMbMgUFrxvEhlxM1sEitclXJc4tAgMBAAGjgfMwgfAw
HQYDVR0OBBYEFBb9mCFAqV/JgmMxtwQ6UKzoLIQQMIHABgNVHSMEgbgwgbWAFBb9
mCFAqV/JgmMxtwQ6UKzoLIQQoYGRpIGOMIGLMQswCQYDVQQGEwJFRTEQMA4GA1UE
CBMHRXN0b25pYTEQMA4GA1UEBxMHVGFsbGlubjEeMBwGA1UEChQVQWVyb2t1YmUg
U29mdHdhcmUgT8OcMRUwEwYDVQQDEwxhZXJva3ViZS5jb20xITAfBgkqhkiG9w0B
CQEWEmFkbWluQGFlcm9rdWJlLmNvbYIJAK1lW/5z8ZSoMAwGA1UdEwQFMAMBAf8w
DQYJKoZIhvcNAQELBQADggIBAIUmJsxdrT8AN2yZqzI69qQKjLnDhuojdgM3XGL3
gJTldXR5OIMnw/na8WcIC3onHjgijUeEfslTIIHmNcqOd3hTfOq4Qq2/Qmpp+h1d
5dCzScrLFiDgjnzkX0VczOj/BtnZMgxx5x8YO80MMUWVEmVCk+i2bFVTypV9e4qw
1EJLmGTnKoo7l2jPHLUB5lL2LvSO4KHDhmWG5wtFg7/nd097yG5uBHda5ytbc6S8
CIS8IBJzd7TA4fr3qOhC298LMD96nJdccHqKYtlFvf9YZZ500nrA+pH6Kpo8PD67
8WiIW/CMtO0X9pxw+KRlmaDmCGGgRhvPyHoYqbX4svrca8uvErePtXIQILe/IISJ
TXLkiVsej8k3UDu77q/wX3ZdzknWakZyPj+CtYkkZL4vqkIDIFSUcXfynyDZNZEo
2d+npABzPB42+4xGZGGnFIsfuTMAgpbK8TAgPQNMIawfWTq2KhZ8MYHfPdkU3FBo
MaExr684sviAImqOotcoNQV2iMOKdwzA097jRBrfa43LhpdoWM0v7RVxB8s+kG0P
8nHOGmp6r6cIAk5hjHYAwQYiZjXuzvnFTtD9Ily63i+yVh8nRSY9NSLhpFpl4ezo
hn+savO4nm/HueAATnGR1iPlKnfXNVqQYdl+wwzqK1/3iHjzUUjyQkk0oTBk4Bez
ejbh
-----END CERTIFICATE-----</pre>
</div>
</div>
</li>
<li>
<p>Encode certificate data with <a href="https://en.wikipedia.org/wiki/Base64">Base64</a> algorithm:</p>
<div class="literalblock">
<div class="content">
<pre>$ cat rootCA.crt | base64
LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUdqekNDQkhlZ0F3SUJBZ0lKQUsxbFcvNXo4WlNvTUEwR0NTcUdTSWIzRFFFQkN3VUFNSUdMTVFzd0NRWUQKVlFRR0V3SkZSVEVRTUE0R0ExVUVDQk1IUlhOMGIyNXBZVEVRTUE0R0ExVUVCeE1IVkdGc2JHbHViakVlTUJ3RwpBMVVFQ2hRVlFXVnliMnQxWW1VZ1UyOW1kSGRoY21VZ1Q4T2NNUlV3RXdZRFZRUURFd3hoWlhKdmEzVmlaUzVqCmIyMHhJVEFmQmdrcWhraUc5dzBCQ1FFV0VtRmtiV2x1UUdGbGNtOXJkV0psTG1OdmJUQWVGdzB5TVRBeU1UY3cKTmpRNU5ESmFGdzB5TXpFeU1EZ3dOalE1TkRKYU1JR0xNUXN3Q1FZRFZRUUdFd0pGUlRFUU1BNEdBMVVFQ0JNSApSWE4wYjI1cFlURVFNQTRHQTFVRUJ4TUhWR0ZzYkdsdWJqRWVNQndHQTFVRUNoUVZRV1Z5YjJ0MVltVWdVMjltCmRIZGhjbVVnVDhPY01SVXdFd1lEVlFRREV3eGhaWEp2YTNWaVpTNWpiMjB4SVRBZkJna3Foa2lHOXcwQkNRRVcKRW1Ga2JXbHVRR0ZsY205cmRXSmxMbU52YlRDQ0FpSXdEUVlKS29aSWh2Y05BUUVCQlFBRGdnSVBBRENDQWdvQwpnZ0lCQUtkaDU0eDlXWnNTeElNZnoxckZFSHVKOCszbWVVdWEwUThjcGdDLzcwRjBHNlg2QlhPa2kwQ3U3aUVUCjZFVGZpcld1VWRSS0tHS1hITEY4RmR2NldUcW5MbERxZ3p5MVdwOUR1UElnZUorenRLWnQrdUpGa1dqZlFiOVIKbW43UXM0dnAvRjlIVHdxbFRabDVqTVErL25yY05BUWVORVoxSDFBZlpXQXVTdnJxcDNyVzMzd2w2SUJaY3FmRApWc01Ca25CS20vWmM4R3BnZ1k4Tll4a2ZqN0pvMml6d24vdFYrREZnd0YwcEprVXJEWlBQVGlOVzdxOFNlMlZiCjd0QzZJeTlaVmdrSDhoa3JXclB6d1c0enh6L2QvU2k3L2NubjlBOStiRitwS3JzSGt0blEwU2NERUFSNSs1MkoKWEFYa0VTLzRwSU5wQmN4dk5VSEdPNktYS0g0ckpWZjNRdlhYYW55MHVnd1ZRK1FYaXJBNnlPb1kzWEZnQnhnVQpQN1FkNXB5UWRWZi9Td0o1VWs1WjliMkhYazhrLzZqTnhlMUE2V2lvalRPbm4xZkQvVnpPVG40eGlvYnFOSXBFCnc1ZFVobGovVGlOK2czdUdCSDRCUG82SVlIQ21mc1hGRWNTWlc3NWs3ZFJsWjNaTUk0azB1dFVWbTNZOEIrVEMKc2o0V213blhldEZQMkVNblJmdDdCblIxM29MeXpyRkI4dGtGYWZzdGNWb0U2b1IyMHBJQnRBRnhyU0RXSjVkQQpYZFgyTkdQTlVDbmQxUnFKeHUyU0dBL3hISHN5UFQwNmlKZUlaR1V5UlhtdjZ2QnZ5Q2t5ZUx0TUVkcTJHemZpCk1UMEd0RGtHNVIrYWwvQStPdDN3M0NNYk1nVUZyeHZFaGx4TTFzRWl0Y2xYSmM0dEFnTUJBQUdqZ2ZNd2dmQXcKSFFZRFZSME9CQllFRkJiOW1DRkFxVi9KZ21NeHR3UTZVS3pvTElRUU1JSEFCZ05WSFNNRWdiZ3dnYldBRkJiOQptQ0ZBcVYvSmdtTXh0d1E2VUt6b0xJUVFvWUdScElHT01JR0xNUXN3Q1FZRFZRUUdFd0pGUlRFUU1BNEdBMVVFCkNCTUhSWE4wYjI1cFlURVFNQTRHQTFVRUJ4TUhWR0ZzYkdsdWJqRWVNQndHQTFVRUNoUVZRV1Z5YjJ0MVltVWcKVTI5bWRIZGhjbVVnVDhPY01SVXdFd1lEVlFRREV3eGhaWEp2YTNWaVpTNWpiMjB4SVRBZkJna3Foa2lHOXcwQgpDUUVXRW1Ga2JXbHVRR0ZsY205cmRXSmxMbU52YllJSkFLMWxXLzV6OFpTb01Bd0dBMVVkRXdRRk1BTUJBZjh3CkRRWUpLb1pJaHZjTkFRRUxCUUFEZ2dJQkFJVW1Kc3hkclQ4QU4yeVpxekk2OXFRS2pMbkRodW9qZGdNM1hHTDMKZ0pUbGRYUjVPSU1udy9uYThXY0lDM29uSGpnaWpVZUVmc2xUSUlIbU5jcU9kM2hUZk9xNFFxMi9RbXBwK2gxZAo1ZEN6U2NyTEZpRGdqbnprWDBWY3pPai9CdG5aTWd4eDV4OFlPODBNTVVXVkVtVkNrK2kyYkZWVHlwVjllNHF3CjFFSkxtR1RuS29vN2wyalBITFVCNWxMMkx2U080S0hEaG1XRzV3dEZnNy9uZDA5N3lHNXVCSGRhNXl0YmM2UzgKQ0lTOElCSnpkN1RBNGZyM3FPaEMyOThMTUQ5Nm5KZGNjSHFLWXRsRnZmOVlaWjUwMG5yQStwSDZLcG84UEQ2Nwo4V2lJVy9DTXRPMFg5cHh3K0tSbG1hRG1DR0dnUmh2UHlIb1lxYlg0c3ZyY2E4dXZFcmVQdFhJUUlMZS9JSVNKClRYTGtpVnNlajhrM1VEdTc3cS93WDNaZHprbldha1p5UGorQ3RZa2taTDR2cWtJRElGU1VjWGZ5bnlEWk5aRW8KMmQrbnBBQnpQQjQyKzR4R1pHR25GSXNmdVRNQWdwYks4VEFnUFFOTUlhd2ZXVHEyS2haOE1ZSGZQZGtVM0ZCbwpNYUV4cjY4NHN2aUFJbXFPb3Rjb05RVjJpTU9LZHd6QTA5N2pSQnJmYTQzTGhwZG9XTTB2N1JWeEI4cytrRzBQCjhuSE9HbXA2cjZjSUFrNWhqSFlBd1FZaVpqWHV6dm5GVHREOUlseTYzaSt5Vmg4blJTWTlOU0xocEZwbDRlem8KaG4rc2F2TzRubS9IdWVBQVRuR1IxaVBsS25mWE5WcVFZZGwrd3d6cUsxLzNpSGp6VVVqeVFrazBvVEJrNEJlegplamJoCi0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Output should be a single string, so under Linux correct command would be:</p>
<div class="literalblock">
<div class="content">
<pre>$ cat rootCA.crt | base64 -w0</pre>
</div>
</div>
</li>
<li>
<p>On Windows there is no built-in command, so you can use an online Base64 encoder.</p>
</li>
</ol>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Set an environment variable starting with <code>ROOT_CA_</code> to browser image. How to do this depends on used automation technology. When using Selenium you have to set <a href="#capability-env">env</a> capability:</p>
<div class="listingblock">
<div class="title">Adding root certification authority</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">import</span> <span class="include">selenium.webdriver</span>

capabilities = {
    <span class="string"><span class="delimiter">&quot;</span><span class="content">browserName</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">chrome</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">&quot;</span><span class="content">version</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">87.0</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">&quot;</span><span class="content">moon:options</span><span class="delimiter">&quot;</span></span>: {
        <span class="string"><span class="delimiter">&quot;</span><span class="content">env</span><span class="delimiter">&quot;</span></span>: {
            <span class="comment"># You can add as many certification authorities as needed</span>
            <span class="string"><span class="delimiter">&quot;</span><span class="content">ROOT_CA_MY-CA-1</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">LS0tLS1CRUdJTiBDRVJUSU.....</span><span class="delimiter">&quot;</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">ROOT_CA_MY-CA-2</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">...</span><span class="delimiter">&quot;</span></span>,
        }
    }
}

driver = selenium.webdriver.remote.webdriver.WebDriver(
    command_executor=<span class="string"><span class="delimiter">'</span><span class="content">http://moon.example.com:4444/wd/hub</span><span class="delimiter">'</span></span>,
    desired_capabilities = capabilities,
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>When using <a href="#">Playwright</a> and <a href="#">Puppeteer</a> - add the same environment variables in connection URL using <a href="https://en.wikipedia.org/wiki/Percent-encoding">URL encoding</a>:</p>
</div>
<div class="listingblock">
<div class="title">Adding root certification authority to Playwright or Puppeteer</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">ws://moon.example.com:4444/playwright/chrome?headless=false&amp;enableVideo=true&amp;env=ROOT_CA_MY-CA-1%3DLS0tLS1CRUdJ...&amp;env=ROOT_CA_MY-CA-2%3DLS0tLS1CRUdJ...</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_frequently_asked_questions"><a class="anchor" href="#_frequently_asked_questions"></a>4. Frequently Asked Questions</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="faq-moon-logs"><a class="anchor" href="#faq-moon-logs"></a>4.1. Where are Moon logs?</h3>
<div class="paragraph">
<p>See <a href="#">Log Files</a> section.</p>
</div>
</div>
<div class="sect2">
<h3 id="faq-recorded-videos"><a class="anchor" href="#faq-recorded-videos"></a>4.2. Where are recorded videos stored?</h3>
<div class="paragraph">
<p>Moon automatically saves session logs and recorded video files to <a href="https://en.wikipedia.org/wiki/Amazon_S3">S3</a> compatible storage. If S3 storage is not configured - then video recording will not work.</p>
</div>
</div>
<div class="sect2">
<h3 id="faq-update-configuration"><a class="anchor" href="#faq-update-configuration"></a>4.3. How to update configuration of a running Moon cluster?</h3>
<div class="paragraph">
<p>Just update respective config maps (<code>config</code>, <code>quota</code>) or secrets (<code>users</code>, <code>credentials</code>) with standard Kubernetes commands (<code>kubectl edit</code> or <code>kubectl replace</code>). For example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ kubectl edit configmap config -n moon # Updating global Moon configuration
$ kubectl edit configmap quota -n moon # Updating Moon quota
$ kubectl edit secret users -n moon # Updating Moon users
$ kubectl edit secret credentials -n moon # Updating Moon credentials (e.g. S3 access keypair)</pre>
</div>
</div>
<div class="paragraph">
<p>These commands will open your preferred editor with respective data: do any desired modifications, save and exit. Changes are applied immediately but how fast Moon will see them depends on Kubernetes caching settings (default is <code>1 minute</code>).</p>
</div>
</div>
<div class="sect2">
<h3 id="faq-kubernetes-service-account"><a class="anchor" href="#faq-kubernetes-service-account"></a>4.4. Is it possible to configure Kubernetes service account for Moon?</h3>
<div class="paragraph">
<p>Yes, Moon has <code>-service-account-name</code> flag described in <a href="#cli-flags-moon">Moon Container Flags</a> section.</p>
</div>
</div>
<div class="sect2">
<h3 id="faq-custom-firewall-rules"><a class="anchor" href="#faq-custom-firewall-rules"></a>4.5. Is it possible to assign custom firewall rules to browser pods?</h3>
<div class="paragraph">
<p>Yes, using built-in <a href="https://kubernetes.io/docs/concepts/services-networking/network-policies/">Kubernetes Network Policies</a> feature. Moon already can assign custom labels to running browser pods. How to do this is described in <a href="#kubernetes-labels">Using Custom Kubernetes Labels</a> section. To apply a firewall rule to browser pods you need to assign a set of custom labels to these pods and then create a <code>NetworkPolicy</code> matching pods with <code>podSelector</code> using these labels.</p>
</div>
</div>
<div class="sect2">
<h3 id="faq-sessions-not-starting"><a class="anchor" href="#faq-sessions-not-starting"></a>4.6. Sessions are not starting</h3>
<div class="paragraph">
<p>In recent Moon versions (1.4.0+) you may encounter an issue when browser sessions are not starting at all. Moon logs will show something like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>2019/12/26 13:33:16 [POD_CREATED] [browsers] [172.26.213.8] [chrome-78-0-77632dac-b46c-4e6e-af24-8a160251e931] [0.03s]
2019/12/26 13:33:16 [AWAITING_DRIVER] [browsers] [172.26.213.8] [chrome-78-0-77632dac-b46c-4e6e-af24-8a160251e931]
2019/12/26 13:49:14 [CLIENT_DISCONNECTED] [browsers] [172.26.213.8] [chrome-78-0-77632dac-b46c-4e6e-af24-8a160251e931] [] [957.78s]</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the majority of cases this is because you did not create a special Kubernetes service like the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">apiVersion</span>: <span class="string"><span class="content">v1</span></span>
<span class="key">kind</span>: <span class="string"><span class="content">Service</span></span>
<span class="key">metadata</span>:
  <span class="key">name</span>: <span class="string"><span class="content">browsers</span></span>
  <span class="key">namespace</span>: <span class="string"><span class="content">moon</span></span>
<span class="key">spec</span>:
  <span class="key">selector</span>:
    <span class="key">moon</span>: <span class="string"><span class="content">browser</span></span>
  <span class="key">clusterIP</span>: <span class="string"><span class="content">None</span></span>
  <span class="key">publishNotReadyAddresses</span>: <span class="string"><span class="content">true</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This service is required for successful network communication between Moon and created browser pods and is included to our <a href="https://github.com/aerokube/moon-deploy/">official deployment manifests</a> by default.</p>
</div>
<div class="paragraph">
<p>One more possible reason could be related to DNS configuration in your cluster. Moon relies on resolving short domain names like <code>chrome-85-0-xxxxxx</code> to communicate with browser pods. If in your cluster only fully qualified domain names (such as <code>chrome-85-0-xxxxxx.moon.svc.cluster-domain.example</code>) are allowed you need to additionally configure DNS settings of Moon pod:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">apiVersion</span>: <span class="string"><span class="content">apps/v1</span></span>
<span class="key">kind</span>: <span class="string"><span class="content">Deployment</span></span>
<span class="key">metadata</span>:
  <span class="key">name</span>: <span class="string"><span class="content">moon</span></span>
  <span class="key">namespace</span>: <span class="string"><span class="content">moon</span></span>
<span class="key">spec</span>:
  <span class="key">replicas</span>: <span class="string"><span class="content">2</span></span>
  <span class="key">selector</span>:
    <span class="key">matchLabels</span>:
      <span class="key">app</span>: <span class="string"><span class="content">moon</span></span>
  <span class="key">template</span>:
    <span class="key">metadata</span>:
      <span class="key">labels</span>:
        <span class="key">app</span>: <span class="string"><span class="content">moon</span></span>
    <span class="key">spec</span>:
      <span class="key">containers</span>:
      - <span class="string"><span class="content">name: moon</span></span>
        <span class="comment"># ...</span>
      <span class="key">dnsConfig</span>:
        <span class="key">nameservers</span>:
        - <span class="string"><span class="content">1.2.3.4</span></span>
        <span class="key">searches</span>:
          - <span class="string"><span class="content">ns1.svc.cluster-domain.example</span></span>
          - <span class="string"><span class="content">my.dns.search.suffix</span></span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="faq-connection-closed-unexpectedly"><a class="anchor" href="#faq-connection-closed-unexpectedly"></a>4.7. Connection was closed unexpectedly</h3>
<div class="paragraph">
<p>If your HTTP requests are randomly hanging - this can mean that you can have too low HTTP request timeout value on your network load balancer (<code>LoadBalancer</code>, <code>Ingress</code>, Openshift <code>Route</code>). Very often default value is about <code>30 seconds</code> and this can lead to closed connections when a lot of new Selenium session requests are being sent to Moon. How to set timeout setting usually depends on cloud platform you are using. For example in AWS this can look like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">kind</span>: <span class="string"><span class="content">Service</span></span>
<span class="key">apiVersion</span>: <span class="string"><span class="content">v1</span></span>
<span class="key">metadata</span>:
  <span class="key">name</span>: <span class="string"><span class="content">moon</span></span>
  <span class="key">namespace</span>: <span class="string"><span class="content">moon</span></span>
  <span class="key">annotations</span>:
    <span class="key">service.beta.kubernetes.io/aws-load-balancer-connection-idle-timeout</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">60</span><span class="delimiter">&quot;</span></span> <span class="comment"># AWS load balancer timeout setting</span>
<span class="key">spec</span>:
  <span class="key">type</span>: <span class="string"><span class="content">LoadBalancer</span></span>
  <span class="comment"># The rest of spec goes here...</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="faq-browser-pods-freezing"><a class="anchor" href="#faq-browser-pods-freezing"></a>4.8. Browser pods are freezing</h3>
<div class="paragraph">
<p>This is a known issue in Kubernetes CoreDNS server settings. Current fix is to turn off DNS caching for Moon namespace. To do this:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Open DNS configuration map for editing (this will open an editor):</p>
<div class="literalblock">
<div class="content">
<pre>$ kubectl edit cm coredns -n kube-system</pre>
</div>
</div>
</li>
<li>
<p>You will see YAML content like the following:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">apiVersion</span>: <span class="string"><span class="content">v1</span></span>
<span class="key">data</span>:
  <span class="key">Corefile</span>: <span class="string"><span class="delimiter">|</span><span class="content">
    .:53 {
        errors
        health
        kubernetes cluster.local in-addr.arpa ip6.arpa {
           pods insecure
           upstream
           fallthrough in-addr.arpa ip6.arpa
        }
        prometheus :9153
        proxy . /etc/resolv.conf
        cache 30
        loop
        reload
        loadbalance
    }</span></span>
<span class="key">kind</span>: <span class="string"><span class="content">ConfigMap</span></span>
<span class="key">metadata</span>:
  <span class="key">creationTimestamp</span>: <span class="string"><span class="content">2019-01-17T10:32:38Z</span></span>
  <span class="key">name</span>: <span class="string"><span class="content">coredns</span></span>
  <span class="key">namespace</span>: <span class="string"><span class="content">kube-system</span></span>
  <span class="key">resourceVersion</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">206</span><span class="delimiter">&quot;</span></span>
  <span class="key">selfLink</span>: <span class="string"><span class="content">/api/v1/namespaces/kube-system/configmaps/coredns</span></span>
  <span class="key">uid</span>: <span class="string"><span class="content">3668d0fe-1a43-11e9-ad0b-025000000001</span></span></code></pre>
</div>
</div>
</li>
<li>
<p>Update <code>Corefile</code> section as follows:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">apiVersion</span>: <span class="string"><span class="content">v1</span></span>
<span class="key">data</span>:
  <span class="key">Corefile</span>: <span class="string"><span class="delimiter">|</span><span class="content">
    moon.svc.cluster.local:53 {
        errors
        kubernetes cluster.local {
          namespaces moon
        }
    }
    .:53 {
        errors
        health
        ready
        kubernetes cluster.local in-addr.arpa ip6.arpa {
           pods insecure
           fallthrough in-addr.arpa ip6.arpa
           ttl 30
        }
        cache 30
        prometheus :9153
        forward . /etc/resolv.conf
        loop
        reload
        loadbalance
    }</span></span>
<span class="comment"># ... the rest of the file</span></code></pre>
</div>
</div>
</li>
<li>
<p>Save changes and exit the editor.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="faq-no-space-left"><a class="anchor" href="#faq-no-space-left"></a>4.9. No space left on device</h3>
<div class="paragraph">
<p>If you are getting the following error&#8230;&#8203;</p>
</div>
<div class="literalblock">
<div class="content">
<pre>2019/01/23 13:47:11 [INIT] [Failed to init quota reloader: unable to watch directory: no space left on device]</pre>
</div>
</div>
<div class="paragraph">
<p>&#8230;&#8203;and have sufficient disk space then it can be caused by insufficient number of <a href="https://en.wikipedia.org/wiki/Inotify">inotify</a> watchers. Moon is using inotify to automatically reload configuration files when they change. To fix this execute one command on Kubernetes hosts:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ echo fs.inotify.max_user_watches=524288 | sudo tee -a /etc/sysctl.conf &amp;&amp; sudo sysctl -p</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="faq-dns-lookup-timeouts"><a class="anchor" href="#faq-dns-lookup-timeouts"></a>4.10. DNS lookup timeouts</h3>
<div class="paragraph">
<p>If you are using <a href="https://github.com/coreos/flannel">Flannel</a> as Kubernetes networking engine and receiving DNS lookup timeouts like the following&#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>2019/02/21 08:37:32 [VNC_ERROR] [10.244.1.1] [dial tcp: lookup chrome-71-0-686efb96-eabe-4435-af31-21a33c8a4c8b on 10.96.0.10:53: read udp 10.244.1.11:40603-&gt;10.96.0.10:53: i/o timeout]</code></pre>
</div>
</div>
<div class="paragraph">
<p>&#8230;&#8203;then you may need to set the following kernel property on Kubernetes nodes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>$ sysctl net.bridge.bridge-nf-call-iptables=1</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="faq-no-such-host"><a class="anchor" href="#faq-no-such-host"></a>4.11. No such host messages</h3>
<div class="paragraph">
<p>If you are seeing messages like this&#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>[PROXY_ERROR] [unknown] [10.240.6.76] [POST http://chrome-60-0-1ae4b9f3-5b5c-441a-af0b-b1f24b39c252.browsers:4545/session] [dial tcp: lookup chrome-60-0-1ae4b9f3-5b5c-441a-af0b-b1f24b39c252.browsers on 10.0.0.10:53: no such host]</code></pre>
</div>
</div>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>then check that you disabled DNS cache for Moon namespace as shown in <a href="#faq-browser-pods-freezing">Browser pods are freezing</a> section.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="faq-session-timeouts-do-no-work"><a class="anchor" href="#faq-session-timeouts-do-no-work"></a>4.12. Browser session timeouts do not work</h3>
<div class="paragraph">
<p>This could because of incorrectly set <code>-moon-url</code> flag value. By default Moon is being exposed using Kubernetes service named <code>moon</code> and is available on port <code>4444</code>. In that case everything works out of the box with default <code>-moon-url</code> flag value. In customized deployment your Moon service name can differ and you have to set <code>-moon-url</code> value flag explicitly. For example, having Moon being exposed with service named <code>my-custom-moon-service</code> on port <code>3333</code>, you have to explicitly add flag <code>-moon-url <a href="http://my-custom-moon-service:3333/wd/hub" class="bare">http://my-custom-moon-service:3333/wd/hub</a></code> to your deployment manifests.</p>
</div>
</div>
<div class="sect2">
<h3 id="faq-json-errors"><a class="anchor" href="#faq-json-errors"></a>4.13. JSON processing errors in tests</h3>
<div class="paragraph">
<p>In some environments your Selenium tests could from time to time start getting JSON processing errors like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>Json exception: Expected to read a START_MAP but instead have: END. Last 0 characters read</code></pre>
</div>
</div>
<div class="paragraph">
<p>The main reason of such behavior usually is incorrectly configured request proxy timeout on <code>LoadBalancer</code> or <code>Ingress</code> time. Very frequently default timeout value is <code>60 seconds</code> and in cases when some Selenium operation takes more time, load balancer will abort request and send 502 error with no body or with HTML body. However Selenium clients always expect to have JSON in Selenium response body and anything else leads to JSON processing exceptions. To solve this - increase request timeout on load balancer side. How to do this should be described in load balancer documentation.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_license_agreement"><a class="anchor" href="#_license_agreement"></a>5. License Agreement</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Last updated December 11th, 2020. Replaces the prior version in its entirety.</p>
</div>
<div class="paragraph">
<p>This is a legal agreement. By downloading, installing, copying, saving on Customer&#8217;s computer, or otherwise using Aerokube software, support or products Customer becomes a party to this Agreement and Customer consents to be bound by all the terms and conditions set forth below.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Parties</strong></p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p><strong>"Aerokube"</strong>, <strong>"Licensor"</strong> or <strong>"We"</strong> means <strong>Aerokube Software OÜ</strong>, having its principal place of business at Harju maakond, Tallinn, Kesklinna linnaosa, Estonia pst 5-309B, 10143, Estonia, registered in the Commercial Register of Estonia, registry code: 14653208.</p>
</li>
<li>
<p><strong>"Customer"</strong>, <strong>"Licensee"</strong> or <strong>"You"</strong> means the sole proprietor or legal entity specified in the Subscription Confirmation. For legal entities, "Customer" includes any entity which controls, is controlled by, or is under common control with Customer. For the purposes of this definition, "control" means one of the following:</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>The power, directly or indirectly, to direct or manage such entity, whether by contract or otherwise.</p>
</li>
<li>
<p>Ownership of fifty percent (50%) or more of the outstanding shares or beneficial ownership of such entity.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</li>
<li>
<p><strong>Definitions</strong></p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p><strong>"Agreement"</strong> means this License Agreement.</p>
</li>
<li>
<p><strong>"Product"</strong> means any generally available Licensor&#8217;s software product identified by Licensor as a software developer tool. For the avoidance of doubt, the Product is not produced to the specifications of Customer nor customized through modification or personalization, is intended for mass distribution, and no software code will be provided to Customer.</p>
</li>
<li>
<p><strong>"User"</strong> means any employee, independent contractor or other personnel obtaining access to the Product(s) from Customer.</p>
</li>
<li>
<p><strong>"Number of Concurrent Sessions"</strong> means maximum number of software testing processes being run using the Product in parallel. This can be for example browsers executing User&#8217;s tests.</p>
</li>
<li>
<p><strong>"License Key"</strong> means a unique key-code that enables a Licensee to use the Product by unlocking the fixed Number of Concurrent Sessions. Only Licensor and/or its representatives are permitted to produce License Keys for the Product.</p>
</li>
<li>
<p><strong>"Subscription"</strong> means an arrangement for making use of the Product of periodic nature on a prepayment plan. For the purpose of clarity, Subscription includes the subscription term, Products provided to Customer, subscription fees, payment schedules and fixed number of License Keys.</p>
</li>
<li>
<p><strong>"Product Evaluation"</strong> means using the Product without a valid License Key.</p>
</li>
<li>
<p><strong>"Subscription Confirmation"</strong> means an email confirming Customer&#8217;s rights to access and use Products, including total Number of Concurrent Sessions.</p>
</li>
<li>
<p><strong>"Product Installation"</strong> means a Product copy running on Customer&#8217;s computer device, hardware server or virtual machine.</p>
</li>
<li>
<p><strong>"Product Version"</strong> means a release, update, or upgrade of a particular Product that is not identified by Licensor as being made for the purpose of fixing software bugs.</p>
</li>
<li>
<p><strong>"Bug Fix Update"</strong> for a particular Product Version means a software update or release that is specifically identified by Licensor as a bug fix for that Product Version.</p>
</li>
<li>
<p><strong>"Fallback Date"</strong> means the date that was 12 months prior to the date of expiration of the Subscription.</p>
</li>
<li>
<p><strong>"Fallback Version"</strong> means the most recent Product Version that Licensor made available for public purchase prior to the Fallback Date, along with any Bug Fix Updates for that Product Version. For the purpose of clarity, Fallback Version does not include any Product updates or upgrades other than Bug Fix Updates that Customer may have used in the period between the Fallback Date and the date of expiration of the Subscription.</p>
</li>
<li>
<p><strong>"E-mail Support"</strong> means a form of customer support provided by the Licensor. At the time of writing, the corresponding e-mail address is <strong>support@aerokube.com</strong>; should the address be changed, the new address will be referred to on the Licensor&#8217;s web site.</p>
</li>
<li>
<p><strong>"Instant Messaging Support"</strong> means a form of customer support provided by the Licensor. At the time of writing, the corresponding address to support channel is <strong><a href="https://t.me/aerokube_moon" class="bare">https://t.me/aerokube_moon</a></strong>; should the address be changed, the new address will be referred to on the Licensor&#8217;s web site.</p>
</li>
<li>
<p><strong>"Affiliate"</strong> means any entity belonging to the same group as the Licensor.</p>
</li>
</ol>
</div>
</li>
<li>
<p><strong>How this Agreement Works</strong></p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p><strong>Entire Agreement.</strong> This Agreement, including the Third-Party Software license terms, constitutes the entire agreement between the parties concerning its subject matter and supersedes any prior agreements between Customer and Licensor regarding Customer&#8217;s use of any Products. No purchase order, other ordering document or any handwritten or typewritten text which purports to modify or supplement the printed text of this Agreement or any schedule will add to or vary the terms of this Agreement unless signed by both Customer and Licensor.</p>
</li>
<li>
<p><strong>Reservation of Rights.</strong> Aerokube reserves the right at any time to cease the support of the Product and to alter prices, features, specifications, capabilities, functions, terms of use, release dates, general availability or other characteristics of the Product.</p>
</li>
<li>
<p><strong>Changes to this Agreement.</strong> We may update or modify this Agreement from time to time, including any referenced policies and other documents. If a revision meaningfully reduces Customer&#8217;s rights, we will use reasonable efforts to notify Customer. If we modify this Agreement, the modified version of the Agreement will be effective from the start of the next Subscription term. In this case, if Customer objects to the updated Agreement terms, as Customer&#8217;s exclusive remedy, Customer may cancel the Subscription. Customer may be required to click through the updated Agreement to show its acceptance. For the avoidance of doubt, each Subscription Confirmation is subject to the version of the Agreement in effect on the Subscription Confirmation date.</p>
</li>
<li>
<p><strong>Opportunity to Review.</strong> Customer hereby declares that Customer has had sufficient opportunity to review this Agreement, understand the content of all of its clauses, negotiate its terms, and seek independent professional legal advice in that respect before entering into it. Consequently, any statutory "form contract" ("adhesion contract") regulations shall not be applicable to this Agreement.</p>
</li>
<li>
<p><strong>Severability.</strong> If a particular term of this Agreement is not enforceable, the unenforceability of that term will not affect any other terms of this Agreement.</p>
</li>
<li>
<p><strong>Headings.</strong> Headings and titles are for convenience only and do not affect the interpretation of this Agreement.</p>
</li>
<li>
<p><strong>No Waiver.</strong> Our failure to enforce or exercise any part of this Agreement is not a waiver of that section.</p>
</li>
<li>
<p><strong>Notice.</strong> Aerokube may deliver any notice to Customer via electronic mail to an email address provided by Customer, registered mail, personal delivery or renowned express courier (such as DHL, FedEx or UPS). Any such notice will be deemed to be effective:</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>On the day the notice is sent to Customer via email.</p>
</li>
<li>
<p>Upon personal delivery.</p>
</li>
<li>
<p>One (1) day after deposit with an express courier or five (5) days after deposit in the mail, whichever occurs first.</p>
</li>
</ol>
</div>
</li>
<li>
<p><strong>Governing Law.</strong> This Agreement will be governed by the laws of the Estonia, without reference to conflict of laws principles. Customer agrees that any litigation relating to this Agreement may only be brought in, and will be subject to the jurisdiction of, any competent court of the Estonia. The parties agree that the United Nations Convention on Contracts for the International Sale of Goods does not apply to this Agreement.</p>
</li>
<li>
<p><strong>Exceptions or Modifications.</strong> For exceptions or modifications to this Agreement, please contact Aerokube at: <a href="mailto:support@aerokube.com">support@aerokube.com</a> In case the terms of this Agreement are in conflict with the terms of any agreement individually negotiated and agreed between Aerokube and Customer, the terms of the latter shall prevail.</p>
</li>
<li>
<p><strong>Force Majeure.</strong> Except with respect to Customer’s payment obligations, neither party shall be liable to the other for any delay or failure to perform any obligation under this Agreement (except for a failure to pay fees) if the delay or failure is due to unforeseen events which occur after the signing of this Agreement and which are beyond the reasonable control of such party (<strong>"Force Majeure Event"</strong>), such as a strike, blockade, war, act of terrorism, riot, natural disaster, failure or diminishment of power or telecommunications or data networks or services, or refusal of a license by a government agency. In the event of a Force Majeure Event that prevents one part from substantially performing its obligations hereunder for a period of ten (10) days or more, either party may terminate this Agreement on five (5) days written notice.</p>
</li>
</ol>
</div>
</li>
<li>
<p><strong>Grant of Rights</strong></p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>The Product include code and libraries licensed to Licensor by third parties, including open source software.</p>
</li>
<li>
<p>The Product is provided basing on the Number of Concurrent Sessions. If Customer complies with the terms of this Agreement, Customer has the rights stipulated hereunder for each Subscription that Customer acquires. Customer&#8217;s rights acquired in relation to the Product are limited to those necessary to enable Customer and its Users to effectively operate the Product(s). All other rights remain reserved to Licensor.</p>
</li>
<li>
<p>Unless the Subscription has expired or this Agreement is terminated in accordance with respective section, and subject to the terms and conditions specified herein, Licensor grants Customer a non-exclusive and non-transferable right to use each Product covered by the Subscription as stipulated below.</p>
</li>
<li>
<p>Customer <strong>may</strong>:</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>For each License Key included to Subscription have <strong>one</strong> Product Installation of any version covered by the Subscription on any operating system supported by the Product.</p>
</li>
<li>
<p>Do Product Evaluation on <strong>one</strong> Product Installation of any version on any operating system supported by the Product.</p>
</li>
<li>
<p>Make one backup copy of the Product solely for archival/security backup purposes.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Customer <strong>may not</strong>:</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>Allow the same Product Installation to be used concurrently by more than the Number of Concurrent Sessions specified for used License Key in Subscription Confirmation.</p>
</li>
<li>
<p>Rent, lease, reproduce, modify, adapt, create derivative works of, distribute, sell, or transfer the Product.</p>
</li>
<li>
<p>Provide access to the Product or the right to use the Product to a third party.</p>
</li>
<li>
<p>Reverse engineer, decompile, disassemble, modify, translate, make any attempt to discover the source code of the Product.</p>
</li>
<li>
<p>Remove or obscure any proprietary or other notices contained in the Product.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Following the expiration of this Agreement, the rights stipulated in "Grant of Rights" section shall continue on a perpetual, royalty-free, non-exclusive, and non-transferable basis for the continued use of a Fallback Version of each Product covered by the Subscription. The limitations set forth in this section apply to the usage of the Fallback Version. The rights granted in this section are expressly contingent upon Customer not being in breach of this Agreement, including having paid in full the applicable Subscription fees for the preceding 12 months or longer without interruption.</p>
</li>
<li>
<p>Customer acknowledges that no ownership right is conveyed to Customer under this Agreement, irrespective of the use of terms such as "purchase" or "sale". Licensor has and retains all rights, title and interest, including all intellectual property rights, in and to the Products and any and all related or underlying technology, and any modifications or derivative works thereof, including without limitation as they may incorporate Feedback (as defined below).</p>
</li>
<li>
<p>This Agreement applies whether Customer purchases a Subscription directly from Licensor or through resellers. If Customer purchases through a reseller, the Subscription details shall be as stated in the Subscription Confirmation issued by the reseller to Customer, and the reseller is responsible for the accuracy of any such Subscription Confirmation. Resellers are not authorized to make any promises or commitments on Licensor behalf, and Customer understands and agrees that Licensor is not bound by any obligations to Customer other than as specified in this Agreement.</p>
</li>
</ol>
</div>
</li>
<li>
<p><strong>Access to Products</strong></p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>All deliveries under this Agreement will be electronic. Customer and its Users must have an Internet connection in order to receive any deliveries. For the avoidance of doubt, Customer is responsible for downloading and installing the Products. Download instructions are made available on Licensor website at <a href="https://aerokube.com" class="bare">https://aerokube.com</a>.</p>
</li>
<li>
<p>Customer enables full access to Product Installation by specifying a License Key from Subscription Confirmation.</p>
</li>
<li>
<p>Subject to the terms of this Agreement, Customer is granted a right to install and use the Product for evaluation purposes without charge for unlimited amount of time. The Product contains a feature that will automatically limit allowed Number of Concurrent Sessions. Licensor reserves the right at any time to change that limit in new Product versions.</p>
</li>
</ol>
</div>
</li>
<li>
<p><strong>Fees</strong></p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Customer shall pay its Subscription fees in accordance with Licensor Terms of Purchase or the reseller&#8217;s terms of purchase, whichever are applicable.</p>
</li>
<li>
<p>The Subscription fees shall be paid in full, and any levies, duties and/or taxes imposed by Customer&#8217;s jurisdiction (including, but not limited to, value added tax, sales tax and withholding tax), shall be borne solely by Customer.</p>
</li>
<li>
<p>Customer may not deduct any amounts from fees payable to Licensor or the reseller, unless otherwise specified in the applicable terms of purchase.</p>
</li>
</ol>
</div>
</li>
<li>
<p><strong>Feedback</strong></p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Customer has no obligation to provide Licensor with ideas, suggestions, or proposals ("Feedback").</p>
</li>
<li>
<p>If Customer or Users submit Feedback to Licensor, then Customer grants Licensor a non-exclusive, worldwide, royalty-free license that is sub-licensable and transferable, to make, use, sell, have made, offer to sell, import, reproduce, publicly display, distribute, modify, or publicly perform the Feedback in any manner without any obligation, royalty or restriction based on intellectual property rights or otherwise.</p>
</li>
</ol>
</div>
</li>
<li>
<p><strong>LIMITED WARRANTY</strong></p>
<div class="paragraph">
<p>ALL PRODUCTS ARE PROVIDED TO CUSTOMER ON AN <strong>"AS IS"</strong> AND <strong>"AS AVAILABLE"</strong> BASIS WITHOUT WARRANTIES. USE OF THE PRODUCTS IS AT YOUR OWN RISK. AEROKUBE MAKES NO WARRANTY AS TO THEIR USE OR PERFORMANCE. TO THE MAXIMUM EXTENT PERMITTED BY APPLICABLE LAW, AEROKUBE, AND ITS SUPPLIERS (WHICH SHALL INCLUDE THE PROVIDERS OF THE THIRD PARTY SOFTWARE) AND RESELLERS, DISCLAIM ALL WARRANTIES AND CONDITIONS, EITHER EXPRESS OR IMPLIED, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE, TITLE, AND NON-INFRINGEMENT, WITH REGARD TO THE PRODUCTS, AND THE PROVISION OF OR FAILURE TO PROVIDE SUPPORT SERVICES. THIS LIMITED WARRANTY GIVES CUSTOMER SPECIFIC LEGAL RIGHTS. CUSTOMER MAY HAVE OTHER RIGHTS, WHICH VARY FROM STATE/JURISDICTION TO STATE/JURISDICTION. AEROKUBE (AND ITS AFFILIATES, AGENTS, DIRECTORS AND EMPLOYEES) DOES NOT WARRANT:</p>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>THAT THE PRODUCTS ARE ACCURATE, RELIABLE OR CORRECT</p>
</li>
<li>
<p>THAT THE PRODUCTS WILL MEET YOUR REQUIREMENTS</p>
</li>
<li>
<p>THAT THE PRODUCTS WILL BE AVAILABLE AT ANY PARTICULAR TIME OR LOCATION, UNINTERRUPTED OR SECURE</p>
</li>
<li>
<p>THAT ANY DEFECTS OR ERRORS WILL BE CORRECTED</p>
</li>
<li>
<p>THAT THE PRODUCTS ARE FREE OF VIRUSES OR OTHER HARMFUL COMPONENTS</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>ANY CONTENT OR DATA DOWNLOADED OR OTHERWISE OBTAINED THROUGH THE USE OF THE PRODUCTS ARE DOWNLOADED AT YOUR OWN RISK AND YOU WILL BE SOLELY RESPONSIBLE FOR ANY DAMAGE TO YOUR PROPERTY OR LOSS OF DATA THAT RESULTS FROM SUCH DOWNLOAD. NO WARRANTY OR LIABILITY AT ALL IS GIVEN TO PRODUCTS UNDER EVALUATION.</p>
</div>
</li>
<li>
<p><strong>DISCLAIMER OF DAMAGES</strong></p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>TO THE MAXIMUM EXTENT PERMITTED BY APPLICABLE LAW, IN NO EVENT WILL AEROKUBE (OR ITS AFFILIATES, AGENTS, DIRECTORS, OR EMPLOYEES), OR AEROKUBE LICENSORS, SUPPLIERS OR RESELLERS BE LIABLE TO CUSTOMER OR ANYONE ELSE FOR:</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>ANY LOSS OF USE, DATA, GOODWILL, OR PROFITS, WHETHER OR NOT FORESEEABLE</p>
</li>
<li>
<p>ANY LOSS OR DAMAGES IN CONNECTION WITH TERMINATION OR SUSPENSION OF CUSTOMER&#8217;S ACCESS TO OUR PRODUCTS IN ACCORDANCE WITH THIS AGREEMENT</p>
</li>
<li>
<p>ANY SPECIAL, INCIDENTAL, INDIRECT, CONSEQUENTIAL, EXEMPLARY OR PUNITIVE DAMAGES WHATSOEVER (EVEN IF WE HAVE BEEN ADVISED OF THE POSSIBILITY OF THESE DAMAGES), INCLUDING THOSE:</p>
<div class="olist upperalpha">
<ol class="upperalpha" type="A">
<li>
<p>RESULTING FROM LOSS OF USE, DATA, OR PROFITS, WHETHER OR NOT FORESEEABLE</p>
</li>
<li>
<p>BASED ON ANY THEORY OF LIABILITY, INCLUDING BREACH OF CONTRACT OR WARRANTY, STRICT LIABILITY, NEGLIGENCE OR OTHER TORTIOUS ACTION</p>
</li>
<li>
<p>ARISING FROM ANY OTHER CLAIM ARISING OUT OF OR IN CONNECTION WITH CUSTOMER&#8217;S USE OF OR ACCESS TO THE PRODUCTS OR SUPPORT.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>THE FOREGOING LIMITATION OF LIABILITY SHALL APPLY TO THE FULLEST EXTENT PERMITTED BY LAW IN THE APPLICABLE JURISDICTION.</p>
</li>
<li>
<p>THE TOTAL LIABILITY IN ANY MATTER ARISING OUT OF OR IN RELATION TO THIS AGREEMENT IS LIMITED TO ONE HUNDRED (100) US DOLLARS OR THE AGGREGATE AMOUNT PAID OR PAYABLE BY THE CUSTOMER FOR PRODUCTS DURING THE THREE-MONTH PERIOD PRECEDING THE EVENT GIVING RISE TO THE LIABILITY, WHICHEVER IS GREATER. THIS LIMITATION WILL APPLY EVEN IF WE OR YOU HAVE BEEN ADVISED OF THE POSSIBILITY OF LIABILITY EXCEEDING SUCH AMOUNT AND NOTWITHSTANDING ANY FAILURE OF THE ESSENTIAL PURPOSE OF ANY LIMITED REMEDY.</p>
</li>
</ol>
</div>
</li>
<li>
<p><strong>Term and Termination</strong></p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>The term of this Agreement will commence upon acceptance of this Agreement by Customer as set forth in the preamble above, and will continue for each Product through the end of the applicable subscription period specified in the respective Subscription Confirmation. This Agreement will automatically renew with respect to each Product for a successive subscription term, unless terminated as set forth herein.</p>
</li>
<li>
<p>Customer may terminate this Agreement at any time by cancelling its Product subscription. If such termination occurs during a then-current subscription period, this Agreement will continue to be effective until the end of that subscription period. Such termination does not relieve Customer of the obligation to pay any outstanding subscription fees owed to Licensor, and no credits or refunds will be issued to Customer for prepaid subscription fees (except as specified in the Licensor Terms of Purchase, if applicable).</p>
</li>
<li>
<p>Licensor <strong>may terminate</strong> this agreement if:</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>Customer has materially breached this Agreement and fails to cure such breach within thirty (30) days of written notice thereof.</p>
</li>
<li>
<p>Customer fails to make the timely payment of subscription fees in accordance with "Fees" Section of this Agreement.</p>
</li>
<li>
<p>Licensor is required to do so by law (for example, where the provision of the Product to Customer is, or becomes, unlawful).</p>
</li>
<li>
<p>Licensor elects to discontinue providing the Product, in whole or in part.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Licensor will make reasonable efforts to <strong>notify Customer</strong> via email as follows:</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>Thirty (30) days prior to termination of the Agreement when required to terminate by law or because of discontinued Product. In such events Customer will be entitled to a refund of the unused portion of prepaid subscription fees, if applicable.</p>
</li>
<li>
<p>Three (3) days prior to termination of the Agreement in other cases. In such events Customer will not be entitled to any refund of the unused portion of prepaid subscription fees.</p>
</li>
</ol>
</div>
</li>
<li>
<p><strong>Survival.</strong> Upon the expiration or termination of this Agreement by Customer and if Customer elects to use the Fallback Version of the Product this Agreement statements will also survive with respect to said Fallback Version.</p>
</li>
</ol>
</div>
</li>
<li>
<p><strong>Temporary Suspension for Non-payment</strong></p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Licensor reserves the right to suspend or limit Customer&#8217;s access to Aerokube Products if Customer fails to pay subscription fees on time.</p>
</li>
<li>
<p>If Licensor suspends or limits Customer&#8217;s access to Aerokube Products for non-payment according, Customer must pay all past due amounts in order to restore full access to Aerokube Products.</p>
</li>
<li>
<p>Customer hereby agrees that Licensor is entitled to charge Customer for the time period during which Customer has access to Aerokube Products until Customer or Licensor terminates or suspends Customer&#8217;s subscription in accordance with this Agreement.</p>
</li>
</ol>
</div>
</li>
<li>
<p><strong>Export Regulations</strong></p>
<div class="paragraph">
<p>Customer shall comply with all applicable laws and regulations with regards to economic sanctions, export controls, import regulations, and trade embargoes (all herein referred to as "Sanctions"), including those of the European Union and United States (specifically the Export Administration Regulations (EAR)). Customer declares that it is not a person targeted by Sanctions nor is it otherwise owned or controlled by or acting on behalf of any person targeted by Sanctions. Further, Customer warrants that it will not download or otherwise export or re-export the Product or any related technical data directly or indirectly to any person targeted by Sanctions or download or otherwise use the Product for any end-use prohibited or restricted by Sanctions.</p>
</div>
</li>
<li>
<p><strong>Customer Support</strong></p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Licensor provides Email Support as well as Instant Messaging Support. The response time will be reasonable, but no specific response time guarantees are given.</p>
</li>
<li>
<p>Customer may request additional paid support from Licensor which is subject of a supplementary individually negotiated Agreement between Customer and Licensor.</p>
</li>
<li>
<p>Any guarantees of support availability only apply to the latest version of Licensed Software available in Customer Subscription.</p>
</li>
</ol>
</div>
</li>
<li>
<p><strong>Customer Data</strong></p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p><strong>Use of Name and Logo.</strong> Customer agrees that Licensor may identify it as a customer of Aerokube and may refer to it by name, trade name and trademark, if applicable. Licensor may also briefly describe Customer&#8217;s business in Licensor marketing materials, on the Aerokube website and/or in public or legal documents. Customer hereby grants Licensor a worldwide, non-exclusive and royalty-free license to use Customer&#8217;s name and any of Customer&#8217;s trade names and trademarks solely pursuant to this marketing section. Notwithstanding anything to the contrary herein, Licensor acknowledges that in some cases Customer licenses and does not own marks or logos (for example, marks or logos of the Affiliates) and cannot permit Licensor to use such marks.</p>
</li>
<li>
<p><strong>Gathering of Usage Statistics.</strong> Customer acknowledges and agrees that the Product may contain a feature that reports the usage statistics, diagnostics information and usage meta-information of the Product back to the Licensor. Customer may opt out of the gathering of usage statistics by turning off this feature in the Product settings.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_privacy_policy"><a class="anchor" href="#_privacy_policy"></a>6. Privacy Policy</h2>
<div class="sectionbody">
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
This privacy policy is applicable to <a href="https://aerokube.com/moon/#cloud">Moon Cloud</a> solution only.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Last updated: <strong>December, 15th, 2020</strong>. Replaces the prior version in its entirety.</p>
</div>
<div class="paragraph">
<p>This Privacy Policy describes how Aerokube Software OÜ and its affiliates ("Aerokube", "we," "our" or "us") collect, use, and share information in connection with your use of Moon Cloud service (collectively, the "Services"). An affiliated company (referred to in this Privacy Notice as “Affiliated” or an “Affiliate”) means any entity that directly or indirectly controls, is controlled by, or is under common control with us, and “control” for purposes of this definition, means direct or indirect ownership or control of more than 50% of the voting interests of the subject entity. This Privacy Policy (the "Privacy Policy") does not apply to information our customers may process when using our Services.</p>
</div>
<div class="paragraph">
<p>In this Privacy Policy, the term <strong>"Personal Data"</strong> means data relating to a living individual who is or can be identified either from the data or from the data in conjunction with other information that is in, or is likely to come into, our possession, and includes personal data as described in Data Protection Legislation. Any Personal Data that we collect from you for these purposes is hereinafter referred to together as <strong>"Your Data"</strong>.</p>
</div>
<div class="paragraph">
<p>We may collect and receive information about users of our Services ("users," "you," or "your") from various sources, including:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Information you provide through your user account on the Services (your "Account") if you register for the Services</p>
</li>
<li>
<p>Your use of the Services</p>
</li>
<li>
<p>From third-party websites, services, and partners</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>We recommend that you read this Privacy Policy in full to ensure you are fully informed. If you have any questions about this Privacy Policy or Aerokube&#8217;s data collection, use, and disclosure practices, please contact us at <a href="mailto:privacy@aerokube.com">privacy@aerokube.com</a>. The data controller of your personal information is Aerokube Software OÜ.</p>
</div>
<div class="sect2">
<h3 id="privacy-information-we-collect"><a class="anchor" href="#privacy-information-we-collect"></a>6.1. Information We Collect</h3>
<div class="sect3">
<h4 id="privacy-information-you-provide"><a class="anchor" href="#privacy-information-you-provide"></a>6.1.1. Information You Provide</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Account Registration.</strong> There is no dedicated account registration procedure. We create and provide one or several pairs of access credentials (user name and password) to Services ourselves.</p>
</li>
<li>
<p><strong>Communications.</strong> If you contact us directly, we may receive additional information about you such as your name, email address, phone number, the contents of the message with attachments you may send us, and any other information you may choose to provide. We may also receive a confirmation when you open an email from us.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="privacy-information-we-collect-you-use"><a class="anchor" href="#privacy-information-we-collect-you-use"></a>6.1.2. Information We Collect When You Use Our Services</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Log Files.</strong> We gather certain information automatically and store it in log files. When you use our Services, we may collect certain information automatically from your device: IP addresses, internet service provider, browser type, operating system, date or time stamp, landing page and referring URL. In some countries, including countries in the European Economic Area, the information referenced above in this paragraph may be considered personal information under applicable data protection laws.</p>
</li>
<li>
<p><strong>Cookies.</strong> Cookie is a small text file that is placed on your device by a web server and allows a website to recognize your browser and to provide features based on who you are. We store information that we collect through cookies or log files to record your preferences. We may also automatically collect information about your use of features of our Services, about the functionality of our Services, frequency of visits, and other information related to your interactions with the Services.</p>
</li>
<li>
<p><strong>Usage of our Services.</strong> When you use our Services, we may collect information about your utilization of our Services. We collect and store system-level metrics such as processor and memory usage, storage capacity. We use this data to operate the Services, maintain and improve the performance and utilization of the Services, develop new features, protect the security and safety of our Services and our customers, and provide customer support. We also use this data to develop aggregate analysis and business intelligence that enable us to operate, protect, make informed decisions, and report on the performance of our business.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="privacy-information-we-receive"><a class="anchor" href="#privacy-information-we-receive"></a>6.1.3. Information We Receive from Third Parties</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Third-Party Partners.</strong> We may receive publicly available information about you from our third-party partners and combine it with data that we have about you.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="privacy-how-we-use-information"><a class="anchor" href="#privacy-how-we-use-information"></a>6.2. How We Use Information</h3>
<div class="paragraph">
<p>We use the information we collect in various ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>To provide, operate, maintain, improve, personalize, and expand our Services</p>
</li>
<li>
<p>To understand and analyze how you use our Services</p>
</li>
<li>
<p>To develop new products, services, features, and functionality</p>
</li>
<li>
<p>To communicate with you for customer service</p>
</li>
<li>
<p>To provide you with updates relating to the Service</p>
</li>
<li>
<p>For marketing and promotional purposes</p>
</li>
<li>
<p>To process your transactions</p>
</li>
<li>
<p>To find and prevent fraud</p>
</li>
<li>
<p>To enforce our Terms of Service or other legal rights</p>
</li>
<li>
<p>To comply to applicable laws and regulations when requested by any judicial process or governmental agency</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="privacy-how-we-share-information"><a class="anchor" href="#privacy-how-we-share-information"></a>6.3. How We Share Information</h3>
<div class="paragraph">
<p>We may share the information we collect in various ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Vendors and Service Providers.</strong> We may share information with third-party vendors and service providers that provide services on our behalf, such as helping to provide our Services, for promotional or marketing purposes, to provide you with information relevant to you such as product announcements, software updates, special offers, or other information.</p>
</li>
<li>
<p><strong>Aggregate Information.</strong> Where legally permissible, we may use and share information about users with our partners in aggregated or de-identified form that can’t reasonably be used to identify you.</p>
</li>
<li>
<p><strong>Third-Party Partners.</strong> We also share information about users with third-party partners in order to receive additional publicly available information about you.</p>
</li>
<li>
<p><strong>Analytics.</strong> We use analytics providers such as Google Analytics and Yandex Metrica.</p>
</li>
<li>
<p><strong>Business Transfers.</strong> Information may be disclosed and otherwise transferred to any potential acquirer, successor, or assignee as part of any proposed merger, acquisition, debt financing, sale of assets, or similar transaction, or in the event of insolvency, bankruptcy, or receivership in which information is transferred to one or more third parties as one of our business assets.</p>
</li>
<li>
<p><strong>When Required By Law.</strong> We may also share information to:</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Satisfy any applicable law, regulation, legal process, or governmental request</p>
</li>
<li>
<p>Enforce this Privacy Policy and our Terms of Service, including investigation of potential violations hereof</p>
</li>
<li>
<p>Detect, prevent, or otherwise address fraud, security, or technical issues</p>
</li>
<li>
<p>Respond to your requests</p>
</li>
<li>
<p>Protect our rights, property or safety, our users and the public</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This includes exchanging information with other companies and organizations for fraud protection and spam or malware prevention.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Where we wish to use Your Data in any other way, we will ensure that we notify you and get your consent first. You will be given the opportunity to withhold or withdraw your consent for the use of Your Data for purposes other than those listed in this Privacy Policy.</p>
</div>
<div class="paragraph">
<p>Aerokube is a global business. We may transfer personal information to countries other than the country in which the data was originally collected. These countries may not have the same data protection laws as the country in which you initially provided the information. When we transfer your personal information to other countries, we will protect that information as described in this Privacy Policy.</p>
</div>
</div>
<div class="sect2">
<h3 id="privacy-access"><a class="anchor" href="#privacy-access"></a>6.4. Access</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If you are a registered user, you may access certain information associated with your Account by logging into our Services or emailing <a href="mailto:privacy@aerokube.com">privacy@aerokube.com</a>.</p>
</li>
<li>
<p>If you terminate your Account, any public activity on your Account prior to deletion may remain stored on our servers and may remain accessible to the public.</p>
</li>
<li>
<p>To protect your privacy and security, we may also take reasonable steps to verify your identity before updating or removing your information.</p>
</li>
<li>
<p>The information you provide us may be archived or stored periodically by us according to backup processes for disaster recovery purposes.</p>
</li>
<li>
<p>Your ability to access and correct your information may be temporarily limited where access and correction could:</p>
<div class="ulist">
<ul>
<li>
<p>Inhibit our ability to comply with a legal obligation, to investigate, make or defend legal claims</p>
</li>
<li>
<p>Result in disclosure of personal information about a third party</p>
</li>
<li>
<p>Result in breach of a contract or disclosure of trade secrets or other proprietary business information belonging to Aerokube or a third party.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="privacy-data-retention"><a class="anchor" href="#privacy-data-retention"></a>6.5. Data Retention</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>We retain personal information we collect from you where we have an ongoing legitimate business need to do so. For example, to provide you with a service you have requested or to comply with applicable legal, tax, or accounting requirements.</p>
</li>
<li>
<p>When we have no ongoing legitimate business need to process your personal information, we will either delete or anonymize it. If this is not possible (for example, because your personal information has been stored in backup archives), then we will securely store your personal information and isolate it from any further processing until deletion is possible.</p>
</li>
<li>
<p>In general personal information that you provide to us, and any logs created by us relating to User Uploaded Data, will be kept and stored for 90 days from the date of upload/creation, after which point they will then be automatically deleted by us.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="privacy-how-we-protect-information"><a class="anchor" href="#privacy-how-we-protect-information"></a>6.6. How We Protect Information</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>We do our utmost to protect user privacy through the appropriate use of security technology. We restrict access to Your Data to employees, contractors and agents who need to know such Your Data in order to operate, develop or improve the services that we provide. We ensure that we have appropriate physical and technological security measures to protect your information; and we ensure that when we outsource any processes that the service provider has appropriate security measures in place.</p>
</li>
<li>
<p>The Service may contain hyperlinks to websites owned and operated by third parties. These third party websites have their own privacy policies, including cookies. We do not accept any responsibility or liability for the privacy practices of such third party websites and your use of such websites is at your own risk.</p>
</li>
<li>
<p>We will implement appropriate technical and organisational measures to ensure a level of security appropriate to the risks that are presented by the processing of Your Data. In particular, we will consider the risks presented by accidental or unlawful destruction, loss, alteration, unauthorised disclosure of, or access to Your Data transmitted, stored or otherwise processed.</p>
</li>
<li>
<p>We use strong secure data transmission techniques such as TLS (HTTPs) on all parts of its service/website. You Data is always being trasmitted in encrypted form.</p>
</li>
<li>
<p>Passwords and security tokens are stripped before they are logged into our system.</p>
</li>
<li>
<p>Unfortunately, the transmission of information via the Internet is not completely secure. Although we will do our best to protect Your Data, we cannot guarantee the security of any data transmitted us and any such transmission is at your own risk. Once we have received your information, we will use strict procedures and security features to try to prevent unauthorised access. To the extent permitted by law, we are not responsible for any delays, delivery failures, or any other loss or damage resulting from the transfer of data over communications networks and facilities, including the internet, or any delay or delivery failure on the part of any other service provider not contracted by us, and you acknowledge that the Service may be subject to limitations, delays and other problems inherent in the use of such communications facilities. You will appreciate that we cannot guarantee the absolute prevention of cyber-attacks such as hacking, spyware and viruses. Accordingly, you will not hold us liable for any unauthorized disclosure, loss or destruction of Your Data arising from such risks.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="privacy-children"><a class="anchor" href="#privacy-children"></a>6.7. Children&#8217;s Privacy</h3>
<div class="paragraph">
<p>We do not knowingly collect information from children under the age of 13. Children under 13 are prohibited from using our Services. If you learn that a child has provided us with personal information in violation of this Privacy Policy, you can alert us at <a href="mailto:privacy@aerokube.com">privacy@aerokube.com</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="privacy-gdpr"><a class="anchor" href="#privacy-gdpr"></a>6.8. General Data Protection Regulation (GDPR)</h3>
<div class="paragraph">
<p>If you are a resident of the European Economic Area (EEA), you have the following data protection rights:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>To <strong>access</strong>, <strong>correct</strong>, <strong>update</strong>, or <strong>request deletion</strong> of your personal information. You can do so at any time by emailing <a href="mailto:privacy@aerokube.com">privacy@aerokube.com</a>.</p>
</li>
<li>
<p>In addition, you can <strong>object to the processing</strong> of your personal information, ask us to <strong>restrict the processing</strong> of your personal information, or <strong>request portability</strong> of your personal information. Again, you can exercise these rights by emailing <a href="mailto:privacy@aerokube.com">privacy@aerokube.com</a>.</p>
</li>
<li>
<p>You have the right to <strong>opt-out of marketing communications</strong> we send you at any time. You can exercise this right by clicking on the "unsubscribe" or "opt-out" link in the marketing emails we send you. To opt-out of other forms of marketing, please contact us by emailing <a href="mailto:privacy@aerokube.com">privacy@aerokube.com</a>.</p>
</li>
<li>
<p>Similarly, if we have collected and process your personal information with your consent, then you can <strong>withdraw your consent</strong> at any time.  Withdrawing your consent will not affect the lawfulness of any processing we conducted prior to your withdrawal, nor will it affect the processing of your personal information conducted in reliance on lawful processing grounds other than consent.</p>
</li>
<li>
<p>You have the <strong>right to complain to a data protection authority</strong> about our collection and use of your personal information. For more information, please contact your local data protection authority.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>We respond to all requests we receive from individuals wishing to exercise their data protection rights in accordance with applicable data protection laws.</p>
</div>
</div>
<div class="sect2">
<h3 id="privacy-changes"><a class="anchor" href="#privacy-changes"></a>6.9. Changes To This Privacy Policy</h3>
<div class="paragraph">
<p>This Privacy Policy may be modified from time to time, so please review it frequently. Changes to this Privacy Policy will be posted on our websites. If we materially change the ways in which we use or share personal information previously collected from you through our Services, we will notify you through our Services, by email, or other communication.</p>
</div>
</div>
<div class="sect2">
<h3 id="privacy-contact"><a class="anchor" href="#privacy-contact"></a>6.10. How to Contact Us</h3>
<div class="paragraph">
<p>If you need to contact us with regard to any of your rights as set out in this Policy, all such requests should be made in writing by email to <a href="mailto:privacy@aerokube.com">privacy@aerokube.com</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_pricing"><a class="anchor" href="#_pricing"></a>7. Pricing</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Last updated August 7th, 2019. Replaces the prior version in its entirety.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Moon price is calculated using so-called <code>Number of Concurrent Sessions</code> that is to say total number of browser sessions being run in parallel. We control this by limiting total number of simultaneously running browser pods to the value you are purchasing.</p>
</li>
<li>
<p>When no license key is provided <code>4 (four)</code> parallel browser sessions maximum are allowed. If such limit is sufficient for you - you are allowed use Moon without license key for unlimited period of time.</p>
</li>
<li>
<p>If free limit is insufficient - you need <code>a paid license</code>. Such license can include <code>any desired number</code> of parallel browser sessions (yes, even <code>42</code>).</p>
</li>
<li>
<p>Every parallel session has a fixed cost - <code>$5 USD</code> (five United States dollars). If you are a EU-based company - then we convert the price to euro (€) and an additional VAT 20% applies.</p>
<div class="listingblock">
<div class="title">An example price calculation</div>
<div class="content">
<pre>42 sessions * $5/month = $210/month</pre>
</div>
</div>
</li>
<li>
<p>For simplicity we calculated monthly prices for some frequent cases:</p>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 18. Moon License Pricing</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Number of Parallel Sessions</th>
<th class="tableblock halign-left valign-top">Price per Month, USD</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0-4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">free</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$25</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$50</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">15</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$75</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">20</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$100</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">25</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$125</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">30</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$150</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">40</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$200</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">50</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$250</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">75</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$375</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$500</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">150</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$750</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$1000</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">250</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$1250</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">500</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$2500</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">750</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$3750</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$5000</p></td>
</tr>
</tbody>
</table>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_browser_image_information"><a class="anchor" href="#_browser_image_information"></a>Appendix A: Browser Image information</h2>
<div class="sectionbody">
<div class="paragraph">
<p>See <a href="https://aerokube.com/images/latest/" class="bare">https://aerokube.com/images/latest/</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_cloud_platforms"><a class="anchor" href="#_cloud_platforms"></a>Appendix B: Cloud Platforms</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Moon ready-to-use configurations are present in popular cloud platforms and can be run in a few clicks. This section contains step-by-step instructions on launching Moon in these platforms.</p>
</div>
<div class="sect2">
<h3 id="cloud-digital-ocean"><a class="anchor" href="#cloud-digital-ocean"></a>B.1. DigitalOcean</h3>
<div class="paragraph">
<p>Moon can be run from <a href="https://marketplace.digitalocean.com/">DigitalOcean Marketplace</a> as follows:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Go to <a href="https://marketplace.digitalocean.com/apps/moon">Moon page</a>:</p>
<div class="paragraph">
<p><span class="image"><img src="img/digitalocean-marketplace-page.png" alt="digitalocean-marketplace"></span></p>
</div>
</li>
<li>
<p>Click on <strong>Create Moon</strong> button.</p>
</li>
<li>
<p>Choose a data center region near you:</p>
<div class="paragraph">
<p><span class="image"><img src="img/digitalocean-cluster-datacenter.png" alt="digitalocean-cluster-datacenter"></span></p>
</div>
</li>
<li>
<p>Select a name for your cluster:</p>
<div class="paragraph">
<p><span class="image"><img src="img/digitalocean-cluster-name.png" alt="digitalocean-cluster-name"></span></p>
</div>
</li>
<li>
<p>Click on <strong>Create Cluster</strong> button.</p>
</li>
<li>
<p>Wait for Kubernetes cluster to start. Follow instructions on the screen to configure access to cluster.</p>
</li>
<li>
<p>Go to <strong>Manage &gt; Networking &gt; Load Balancers</strong> and find IP address of Moon load balancer:</p>
<div class="paragraph">
<p><span class="image"><img src="img/digitalocean-cluster-load-balancer.png" alt="digitalocean-cluster-load-balancer"></span></p>
</div>
</li>
<li>
<p>Moon user interface is available at <code><a href="http://&lt;load-balancer-ip-address&gt;:8080/" class="bare">http://&lt;load-balancer-ip-address&gt;:8080/</a></code>. Selenium tests should be run against <code><a href="http://&lt;load-balancer-ip-address&gt;:4444/wd/hub" class="bare">http://&lt;load-balancer-ip-address&gt;:4444/wd/hub</a></code>.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="cloud-google-cloud"><a class="anchor" href="#cloud-google-cloud"></a>B.2. Google Cloud</h3>
<div class="paragraph">
<p>Moon can be run from <a href="https://console.cloud.google.com/marketplace">Google Cloud Marketplace</a> as follows:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Go to <a href="https://console.cloud.google.com/marketplace/details/aerokube/moon">Moon page</a> and click the <strong>Configure</strong> button:</p>
<div class="paragraph">
<p><span class="image"><img src="img/google-cloud-marketplace-page.png" alt="google-cloud-marketplace"></span></p>
</div>
</li>
<li>
<p>Select a zone near you for a new Kubernetes cluster to be created and click on <strong>Create cluster</strong> button:</p>
<div class="paragraph">
<p><span class="image"><img src="img/google-cloud-cluster-settings.png" alt="google-cloud-cluster-settings"></span></p>
</div>
</li>
<li>
<p>Wait for cluster to be created and click on <strong>Deploy button</strong>.</p>
</li>
<li>
<p>Wait for Moon to start (mainly you are waiting for the load balancer to initialize). You may need to refresh the page several times until correct URLs appear in <strong>Moon info</strong> section.</p>
<div class="paragraph">
<p><span class="image"><img src="img/google-cloud-app-details.png" alt="google-cloud-app-details"></span></p>
</div>
</li>
<li>
<p>Click on <strong>Moon UI access URL</strong> to open Moon user interface. Use <strong>Moon Selenium access URL</strong> in your tests.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version latest<br>
Last updated 2021-02-19 17:39:40 UTC
</div>
</div>
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
pre.CodeRay{background:#f7f7f8}
.CodeRay .line-numbers{border-right:1px solid currentColor;opacity:.35;padding:0 .5em 0 0}
.CodeRay span.line-numbers{display:inline-block;margin-right:.75em}
.CodeRay .line-numbers strong{color:#000}
table.CodeRay{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.CodeRay td{vertical-align:top;line-height:inherit}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.code{padding:0 0 0 .75em}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-23854888-2"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-23854888-2');
</script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
    (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
        m[i].l=1*new Date();k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
    (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

    ym(43539754, "init", {
        clickmap:true,
        trackLinks:true,
        accurateTrackBounce:true,
        webvisor:true,
        trackHash:true
    });
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/43539754" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->
</body>
</html>